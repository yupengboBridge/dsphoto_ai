			<!DOCTYPE html>
			<style>
			body{
			font: 14px/1 "Lucida Grande","Lucida Sans Unicode",Lucida,Arial,Helvetica,sans-serif;
			margin-left: 0;
			margin-top: 0;
			}
			table.index {
			border-spacing:0px;
			width:100%;
			}
			table.index tr th{
			border-bottom:solid 1px #d0d0d0;
			border-left:solid 1px #d0d0d0;
			color:gray;
			text-align:left;
			padding:3px;
			}

			table.index tr td{
			padding:3px;
			}
			table.index tr.odd td{
			padding:3px;
			background-color:#e5e5e5;
			}
			.pre{
			padding-left:10px;
			font-family:monospace;
			display:inline;
			margin:0px;
			font-family:monospace;
			}
			.highlight{
			background-color:#ea9b00;
			}
			.covered{
			background-color:#ebd9b4;
			}
			.lineno{
				font-family:monospace;
				background-color:#666666;
				color:white;
			}
			</style><script>
function highlight_touched_lines()
{
var functionname = $('#testnames').val();
if(functionname.length == 0 ) {
	$('pre').removeClass('highlight');
	return;
}
if($('#exclusive:checked').length) {
	$('.highlight').removeClass('highlight').addClass('covered');
	$('pre[title='+functionname+']').removeClass('covered').addClass('highlight');
} else {
	$('.highlight').removeClass('highlight').addClass('covered');
	$('pre[title*='+functionname+']').removeClass('covered').addClass('highlight');
}

}
/*! jQuery v1.7.2 jquery.com | jquery.org/license */
(function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cu(a){if(!cj[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){ck||(ck=c.createElement("iframe"),ck.frameBorder=ck.width=ck.height=0),b.appendChild(ck);if(!cl||!ck.createElement)cl=(ck.contentWindow||ck.contentDocument).document,cl.write((f.support.boxModel?"<!doctype html>":"")+"<html><body>"),cl.close();d=cl.createElement(a),cl.body.appendChild(d),e=f.css(d,"display"),b.removeChild(ck)}cj[a]=e}return cj[a]}function ct(a,b){var c={};f.each(cp.concat.apply([],cp.slice(0,b)),function(){c[this]=a});return c}function cs(){cq=b}function cr(){setTimeout(cs,0);return cq=f.now()}function ci(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ch(){try{return new a.XMLHttpRequest}catch(b){}}function cb(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function ca(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function b_(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bD.test(a)?d(a,e):b_(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)});else if(!c&&f.type(b)==="object")for(var e in b)b_(a+"["+e+"]",b[e],c,d);else d(a,b)}function b$(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d]);e&&f.extend(!0,a,e)}function bZ(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bS,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=bZ(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=bZ(a,c,d,e,"*",g));return l}function bY(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bO),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function bB(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?1:0,g=4;if(d>0){if(c!=="border")for(;e<g;e+=2)c||(d-=parseFloat(f.css(a,"padding"+bx[e]))||0),c==="margin"?d+=parseFloat(f.css(a,c+bx[e]))||0:d-=parseFloat(f.css(a,"border"+bx[e]+"Width"))||0;return d+"px"}d=by(a,b);if(d<0||d==null)d=a.style[b];if(bt.test(d))return d;d=parseFloat(d)||0;if(c)for(;e<g;e+=2)d+=parseFloat(f.css(a,"padding"+bx[e]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+bx[e]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+bx[e]))||0);return d+"px"}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;b.nodeType===1&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),c==="object"?b.outerHTML=a.outerHTML:c!=="input"||a.type!=="checkbox"&&a.type!=="radio"?c==="option"?b.selected=a.defaultSelected:c==="input"||c==="textarea"?b.defaultValue=a.defaultValue:c==="script"&&b.text!==a.text&&(b.text=a.text):(a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value)),b.removeAttribute(f.expando),b.removeAttribute("_submit_attached"),b.removeAttribute("_change_attached"))}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i)for(d=0,e=i[c].length;d<e;d++)f.event.add(b,c,i[c][d])}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function T(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function K(){return!0}function J(){return!1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?+d:j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else d=b}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.2",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a!=null&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(n.test(b.replace(o,"@").replace(p,"]").replace(q,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(c){if(typeof c!="string"||!c)return null;var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H)return H.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h,i){var j,k=d==null,l=0,m=a.length;if(d&&typeof d=="object"){for(l in d)e.access(a,c,l,d[l],1,h,f);g=1}else if(f!==b){j=i===b&&e.isFunction(f),k&&(j?(j=c,c=function(a,b,c){return j.call(e(a),c)}):(c.call(a,f),c=null));if(c)for(;l<m;l++)c(a[l],d,j?f.call(a[l],l,c(a[l],d)):f,i);g=1}return g?a:k?c.call(a):m?c(a[0],d):h},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test("Â ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m,n=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++)g=b[d],h=f.type(g),h==="array"?n(g):h==="function"&&(!a.unique||!p.has(g))&&c.push(g)},o=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,j=!0,m=k||0,k=0,l=c.length;for(;c&&m<l;m++)if(c[m].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}j=!1,c&&(a.once?e===!0?p.disable():c=[]:d&&d.length&&(e=d.shift(),p.fireWith(e[0],e[1])))},p={add:function(){if(c){var a=c.length;n(arguments),j?l=c.length:e&&e!==!0&&(k=a,o(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var f=0;f<c.length;f++)if(b[d]===c[f]){j&&f<=l&&(l--,f<=m&&m--),c.splice(f--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return!c},lock:function(){d=b,(!e||e===!0)&&p.disable();return this},locked:function(){return!d},fireWith:function(b,c){d&&(j?a.once||d.push([b,c]):(!a.once||!e)&&o(b,c));return this},fire:function(){p.fireWith(this,arguments);return this},fired:function(){return!!i}};return p};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null)a=h;else for(var b in h)a[b]=h[b];return a}},i=h.promise({}),j;for(j in g)i[j]=g[j].fire,i[j+"With"]=g[j].fireWith;i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++)b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g;g||j.resolveWith(j,b)}else j!==a&&j.resolveWith(j,d?[a]:[]);return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p=c.createElement("div"),q=c.documentElement;p.setAttribute("className","t"),p.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=p.getElementsByTagName("*"),e=p.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=p.getElementsByTagName("input")[0],b={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:p.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,pixelMargin:!0},f.boxModel=b.boxModel=c.compatMode==="CSS1Compat",i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete p.test}catch(r){b.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",function(){b.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),i.setAttribute("name","t"),p.appendChild(i),j=c.createDocumentFragment(),j.appendChild(p.lastChild),b.checkClone=j.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,j.removeChild(i),j.appendChild(p);if(p.attachEvent)for(n in{submit:1,change:1,focusin:1})m="on"+n,o=m in p,o||(p.setAttribute(m,"return;"),o=typeof p[m]=="function"),b[n+"Bubbles"]=o;j.removeChild(p),j=g=h=p=i=null,f(function(){var d,e,g,h,i,j,l,m,n,q,r,s,t,u=c.getElementsByTagName("body")[0];!u||(m=1,t="padding:0;margin:0;border:",r="position:absolute;top:0;left:0;width:1px;height:1px;",s=t+"0;visibility:hidden;",n="style='"+r+t+"5px solid #000;",q="<div "+n+"display:block;'><div style='"+t+"0;display:block;overflow:hidden;'></div></div>"+"<table "+n+"' cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",d=c.createElement("div"),d.style.cssText=s+"width:0;height:0;position:static;top:0;margin-top:"+m+"px",u.insertBefore(d,u.firstChild),p=c.createElement("div"),d.appendChild(p),p.innerHTML="<table><tr><td style='"+t+"0;display:none'></td><td>t</td></tr></table>",k=p.getElementsByTagName("td"),o=k[0].offsetHeight===0,k[0].style.display="",k[1].style.display="none",b.reliableHiddenOffsets=o&&k[0].offsetHeight===0,a.getComputedStyle&&(p.innerHTML="",l=c.createElement("div"),l.style.width="0",l.style.marginRight="0",p.style.width="2px",p.appendChild(l),b.reliableMarginRight=(parseInt((a.getComputedStyle(l,null)||{marginRight:0}).marginRight,10)||0)===0),typeof p.style.zoom!="undefined"&&(p.innerHTML="",p.style.width=p.style.padding="1px",p.style.border=0,p.style.overflow="hidden",p.style.display="inline",p.style.zoom=1,b.inlineBlockNeedsLayout=p.offsetWidth===3,p.style.display="block",p.style.overflow="visible",p.innerHTML="<div style='width:5px;'></div>",b.shrinkWrapBlocks=p.offsetWidth!==3),p.style.cssText=r+s,p.innerHTML=q,e=p.firstChild,g=e.firstChild,i=e.nextSibling.firstChild.firstChild,j={doesNotAddBorder:g.offsetTop!==5,doesAddBorderForTableAndCells:i.offsetTop===5},g.style.position="fixed",g.style.top="20px",j.fixedPosition=g.offsetTop===20||g.offsetTop===15,g.style.position=g.style.top="",e.style.overflow="hidden",e.style.position="relative",j.subtractsBorderForOverflowNotVisible=g.offsetTop===-5,j.doesNotIncludeMarginInBodyOffset=u.offsetTop!==m,a.getComputedStyle&&(p.style.marginTop="1%",b.pixelMargin=(a.getComputedStyle(p,null)||{marginTop:0}).marginTop!=="1%"),typeof d.style.zoom!="undefined"&&(d.style.zoom=1),u.removeChild(d),l=p=d=null,f.extend(b,j))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b)return;n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c);g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c])return g.events;k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k])return;if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++)delete d[b[e]];if(!(c?m:f.isEmptyObject)(d))return}}if(!c){delete j[k].data;if(!m(j[k]))return}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d,e,g,h,i,j=this[0],k=0,m=null;if(a===b){if(this.length){m=f.data(j);if(j.nodeType===1&&!f._data(j,"parsedAttrs")){g=j.attributes;for(i=g.length;k<i;k++)h=g[k].name,h.indexOf("data-")===0&&(h=f.camelCase(h.substring(5)),l(j,h,m[h]));f._data(j,"parsedAttrs",!0)}}return m}if(typeof a=="object")return this.each(function(){f.data(this,a)});d=a.split(".",2),d[1]=d[1]?"."+d[1]:"",e=d[1]+"!";return f.access(this,function(c){if(c===b){m=this.triggerHandler("getData"+e,[d[0]]),m===b&&j&&(m=f.data(j,a),m=l(j,a,m));return m===b&&d[1]?this.data(d[0]):m}d[1]=c,this.each(function(){var b=f(this);b.triggerHandler("setData"+e,d),f.data(this,a,c),b.triggerHandler("changeData"+e,d)})},null,c,arguments.length>1,null,!1)},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){var d=2;typeof a!="string"&&(c=a,a="fx",d--);if(arguments.length<d)return f.queue(this[0],a);return c===b?this:this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0))h++,l.add(m);m();return d.promise(c)}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,f.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,f.prop,a,b,arguments.length>1)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,g=this[0];{if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.type]||f.valHooks[this.nodeName.toLowerCase()];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}if(g){c=f.valHooks[g.type]||f.valHooks[g.nodeName.toLowerCase()];if(c&&"get"in c&&(d=c.get(g,"value"))!==b)return d;d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0)return null;c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j)return b;h.push(b)}}if(j&&!h.length&&i.length)return f(i[g]).val();return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn)return f(a)[c](d);if(typeof a.getAttribute=="undefined")return f.prop(a,c,d);i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set"in h&&i&&(g=h.set(a,d,c))!==b)return g;a.setAttribute(c,""+d);return d}if(h&&"get"in h&&i&&(g=h.get(a,c))!==null)return g;g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h,i=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;i<g;i++)e=d[i],e&&(c=f.propFix[e]||e,h=u.test(e),h||f.attr(a,e,""),a.removeAttribute(v?e:c),h&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button"))return w.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button"))return w.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set"in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get"in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0,coords:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/(?:^|\s)hover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(
a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler,g=p.selector),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:g&&G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1)a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o)f.event.remove(a,j+b[h],c,d,!0);continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++)s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s));r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered))return;h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h])return;c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j)j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1)return;r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode)r.push([m,s]),n=m;n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++)m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault();c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=f.event.special[c.type]||{},j=[],k,l,m,n,o,p,q,r,s,t,u;g[0]=c,c.delegateTarget=this;if(!i.preDispatch||i.preDispatch.call(this,c)!==!1){if(e&&(!c.button||c.type!=="click")){n=f(this),n.context=this.ownerDocument||this;for(m=c.target;m!=this;m=m.parentNode||this)if(m.disabled!==!0){p={},r=[],n[0]=m;for(k=0;k<e;k++)s=d[k],t=s.selector,p[t]===b&&(p[t]=s.quick?H(m,s.quick):n.is(t)),p[t]&&r.push(s);r.length&&j.push({elem:m,matches:r})}}d.length>e&&j.push({elem:this,matches:d.slice(e)});for(k=0;k<j.length&&!c.isPropagationStopped();k++){q=j[k],c.currentTarget=q.elem;for(l=0;l<q.matches.length&&!c.isImmediatePropagationStopped();l++){s=q.matches[l];if(h||!c.namespace&&!s.namespace||c.namespace_re&&c.namespace_re.test(s.namespace))c.data=s.data,c.handleObj=s,o=((f.event.special[s.origType]||{}).handle||s.handler).apply(q.elem,g),o!==b&&(c.result=o,o===!1&&(c.preventDefault(),c.stopPropagation()))}}i.postDispatch&&i.postDispatch.call(this,c);return c.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando])return a;var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;)e=i[--d],a[e]=g[e];a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event))return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d))a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b;return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form"))return!1;f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),d._submit_attached=!0)})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(f.nodeName(this,"form"))return!1;f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))});return!1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=d||c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=J;else if(!e)return this;g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a)this.off(g,c,a[g]);return this}if(c===!1||typeof c=="function")d=c,c=b;d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return e;var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b))if(w.length===2&&o.relative[w[0]])j=y(w[0]+w[1],d,f);else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length)b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length)q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}else k=w=[]}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]")if(!u)e.push.apply(e,k);else if(d&&d.nodeType===1)for(t=0;k[t]!=null;t++)k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t]);else for(t=0;k[t]!=null;t++)k[t]&&k[t].nodeType===1&&e.push(j[t]);else s(k,e);l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9||d===11){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=m(b[3],null,null,c);else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],e=b[3];if(c===1&&e===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));o.match.globalPOS=p;var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return s(e.getElementsByTagName(b),f);if(h[2]&&o.find.CLASS&&e.getElementsByClassName)return s(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return s([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return s([],f);if(i.id===h[3])return s([i],f)}try{return s(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p)return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}catch(r){}finally{l||k.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)m[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.globalPOS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++)f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h});g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return f.inArray(this[0],f(a));return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var V="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")[\\s/>]","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){return f.access(this,function(a){return a===b?f.text(this):this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f
.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){return f.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return c.nodeType===1?c.innerHTML.replace(W,""):null;if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},c.nodeType===1&&(f.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(g){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,function(a,b){b.src?f.ajax({type:"GET",global:!1,url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||f.isXMLDoc(a)||!bc.test("<"+a.nodeName+">")?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g)e[g]&&bk(d[g],e[g])}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g)bj(d[g],e[g])}}d=e=null;return h},clean:function(a,b,d,e){var g,h,i,j=[];b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);for(var k=0,l;(l=a[k])!=null;k++){typeof l=="number"&&(l+="");if(!l)continue;if(typeof l=="string")if(!_.test(l))l=b.createTextNode(l);else{l=l.replace(Y,"<$1></$2>");var m=(Z.exec(l)||["",""])[1].toLowerCase(),n=bg[m]||bg._default,o=n[0],p=b.createElement("div"),q=bh.childNodes,r;b===c?bh.appendChild(p):U(b).appendChild(p),p.innerHTML=n[1]+l+n[2];while(o--)p=p.lastChild;if(!f.support.tbody){var s=$.test(l),t=m==="table"&&!s?p.firstChild&&p.firstChild.childNodes:n[1]==="<table>"&&!s?p.childNodes:[];for(i=t.length-1;i>=0;--i)f.nodeName(t[i],"tbody")&&!t[i].childNodes.length&&t[i].parentNode.removeChild(t[i])}!f.support.leadingWhitespace&&X.test(l)&&p.insertBefore(b.createTextNode(X.exec(l)[0]),p.firstChild),l=p.childNodes,p&&(p.parentNode.removeChild(p),q.length>0&&(r=q[q.length-1],r&&r.parentNode&&r.parentNode.removeChild(r)))}var u;if(!f.support.appendChecked)if(l[0]&&typeof (u=l.length)=="number")for(i=0;i<u;i++)bn(l[i]);else bn(l);l.nodeType?j.push(l):j=f.merge(j,l)}if(d){g=function(a){return!a.type||be.test(a.type)};for(k=0;j[k];k++){h=j[k];if(e&&f.nodeName(h,"script")&&(!h.type||be.test(h.type)))e.push(h.parentNode?h.parentNode.removeChild(h):h);else{if(h.nodeType===1){var v=f.grep(h.getElementsByTagName("script"),g);j.splice.apply(j,[k+1,0].concat(v))}d.appendChild(h)}}}return j},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()])continue;c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events)e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle);b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bp=/alpha\([^)]*\)/i,bq=/opacity=([^)]*)/,br=/([A-Z]|^ms)/g,bs=/^[\-+]?(?:\d*\.)?\d+$/i,bt=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,bu=/^([\-+])=([\-+.\de]+)/,bv=/^margin/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Top","Right","Bottom","Left"],by,bz,bA;f.fn.css=function(a,c){return f.access(this,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)},a,c,arguments.length>1)},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=by(a,"opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d,h==="string"&&(g=bu.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d))return;h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(by)return by(a,c)},swap:function(a,b,c){var d={},e,f;for(f in b)d[f]=a.style[f],a.style[f]=b[f];e=c.call(a);for(f in b)a.style[f]=d[f];return e}}),f.curCSS=f.css,c.defaultView&&c.defaultView.getComputedStyle&&(bz=function(a,b){var c,d,e,g,h=a.style;b=b.replace(br,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b))),!f.support.pixelMargin&&e&&bv.test(b)&&bt.test(c)&&(g=h.width,h.width=c,c=e.width,h.width=g);return c}),c.documentElement.currentStyle&&(bA=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f==null&&g&&(e=g[b])&&(f=e),bt.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),by=bz||bA,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){if(c)return a.offsetWidth!==0?bB(a,b,d):f.swap(a,bw,function(){return bB(a,b,d)})},set:function(a,b){return bs.test(b)?b+"px":b}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return bq.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bp,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bp.test(g)?g.replace(bp,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){return f.swap(a,{display:"inline-block"},function(){return b?by(a,"margin-right"):a.style.marginRight})}})}),f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)}),f.each({margin:"",padding:"",border:"Width"},function(a,b){f.cssHooks[a+b]={expand:function(c){var d,e=typeof c=="string"?c.split(" "):[c],f={};for(d=0;d<4;d++)f[a+bx[d]+b]=e[d]||e[d-2]||e[0];return f}}});var bC=/%20/g,bD=/\[\]$/,bE=/\r?\n/g,bF=/#.*$/,bG=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bH=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bI=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bJ=/^(?:GET|HEAD)$/,bK=/^\/\//,bL=/\?/,bM=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bN=/^(?:select|textarea)/i,bO=/\s+/,bP=/([?&])_=[^&]*/,bQ=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bR=f.fn.load,bS={},bT={},bU,bV,bW=["*/"]+["*"];try{bU=e.href}catch(bX){bU=c.createElement("a"),bU.href="",bU=bU.href}bV=bQ.exec(bU.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bR)return bR.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bM,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bN.test(this.nodeName)||bH.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bE,"\r\n")}}):{name:b.name,value:c.replace(bE,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b$(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b$(a,b);return a},ajaxSettings:{url:bU,isLocal:bI.test(bV[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bW},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bY(bS),ajaxTransport:bY(bT),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?ca(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified"))f.lastModified[k]=y;if(z=v.getResponseHeader("Etag"))f.etag[k]=z}if(a===304)w="notmodified",o=!0;else try{r=cb(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}else{u=w;if(!w||a)w="error",a<0&&(a=0)}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bG.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bF,"").replace(bK,bV[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bO),d.crossDomain==null&&(r=bQ.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bV[1]&&r[2]==bV[2]&&(r[3]||(r[1]==="http:"?80:443))==(bV[3]||(bV[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),bZ(bS,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bJ.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bL.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bP,"$1_="+x);d.url=y+(y===d.url?(bL.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bW+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=bZ(bT,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2)w(-1,z);else throw z}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)b_(g,a[g],c,e);return d.join("&").replace(bC,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cc=f.now(),cd=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cc++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=typeof b.data=="string"&&/^application\/x\-www\-form\-urlencoded/.test(b.contentType);if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(cd.test(b.url)||e&&cd.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(cd,l),b.url===j&&(e&&(k=k.replace(cd,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var ce=a.ActiveXObject?function(){for(var a in cg)cg[a](0,1)}:!1,cf=0,cg;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ch()||ci()}:ch,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,ce&&delete cg[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n);try{m.text=h.responseText}catch(a){}try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cf,ce&&(cg||(cg={},f(a).unload(ce)),cg[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var cj={},ck,cl,cm=/^(?:toggle|show|hide)$/,cn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,co,cp=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cq;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(ct("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),(e===""&&f.css(d,"display")==="none"||!f.contains(d.ownerDocument.documentElement,d))&&f._data(d,"olddisplay",cu(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(ct("hide",3),a,b,c);var d,e,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(ct("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o,p,q;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]);if((k=f.cssHooks[g])&&"expand"in k){l=k.expand(a[g]),delete a[g];for(i in l)i in a||(a[i]=l[i])}}for(g in a){h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cu(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new f.fx(this,b,i),h=a[i],cm.test(h)?(q=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),q?(f._data(this,"toggle"+i,q==="show"?"hide":"show"),j[q]()):j[h]()):(m=cn.exec(h),n=j.cur(),m?(o=parseFloat(m[2]),p=m[3]||(f.cssNumber[i]?"":"px"),p!=="px"&&(f.style(this,i,(o||1)+p),n=(o||1)/j.cur()*n,f.style(this,i,n+p)),m[1]&&(o=(m[1]==="-="?-1:1)*o+n),j.custom(n,o,p)):j.custom(n,h,""));return!0}var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null)for(b in g)g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b);else g[b=a+".run"]&&g[b].stop&&h(this,g,b);for(b=e.length;b--;)e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1));(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:ct("show",1),slideUp:ct("hide",1),slideToggle:ct("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a){return a},swing:function(a){return-Math.cos(a*Math.PI)/2+.5}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cq||cr(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){f._data(e.elem,"fxshow"+e.prop)===b&&(e.options.hide?f._data(e.elem,"fxshow"+e.prop,e.start):e.options.show&&f._data(e.elem,"fxshow"+e.prop,e.end))},h()&&f.timers.push(h)&&!co&&(co=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cq||cr(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(g=!1);if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(co),co=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(cp.concat.apply([],cp),function(a,b){b.indexOf("margin")&&(f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)})}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cv,cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?cv=function(a,b,c,d){try{d=a.getBoundingClientRect()}catch(e){}if(!d||!f.contains(c,a))return d?{top:d.top,left:d.left}:{top:0,left:0};var g=b.body,h=cy(b),i=c.clientTop||g.clientTop||0,j=c.clientLeft||g.clientLeft||0,k=h.pageYOffset||f.support.boxModel&&c.scrollTop||g.scrollTop,l=h.pageXOffset||f.support.boxModel&&c.scrollLeft||g.scrollLeft,m=d.top+k-i,n=d.left+l-j;return{top:m,left:n}}:cv=function(a,b,c){var d,e=a.offsetParent,g=a,h=b.body,i=b.defaultView,j=i?i.getComputedStyle(a,null):a.currentStyle,k=a.offsetTop,l=a.offsetLeft;while((a=a.parentNode)&&a!==h&&a!==c){if(f.support.fixedPosition&&j.position==="fixed")break;d=i?i.getComputedStyle(a,null):a.currentStyle,k-=a.scrollTop,l-=a.scrollLeft,a===e&&(k+=a.offsetTop,l+=a.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(a.nodeName))&&(k+=parseFloat(d.borderTopWidth)||0,l+=parseFloat(d.borderLeftWidth)||0),g=e,e=a.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&d.overflow!=="visible"&&(k+=parseFloat(d.borderTopWidth)||0,l+=parseFloat(d.borderLeftWidth)||0),j=d}if(j.position==="relative"||j.position==="static")k+=h.offsetTop,l+=h.offsetLeft;f.support.fixedPosition&&j.position==="fixed"&&(k+=Math.max(c.scrollTop,h.scrollTop),l+=Math.max(c.scrollLeft,h.scrollLeft));return{top:k,left:l}},f.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){f.offset.setOffset(this,a,b)});var c=this[0],d=c&&c.ownerDocument;if(!d)return null;if(c===d.body)return f.offset.bodyOffset(c);return cv(c,d,d.documentElement)},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);f.fn[a]=function(e){return f.access(this,function(a,e,g){var h=cy(a);if(g===b)return h?c in h?h[c]:f.support.boxModel&&h.document.documentElement[e]||h.document.body[e]:a[e];h?h.scrollTo(d?f(h).scrollLeft():g,d?g:f(h).scrollTop()):a[e]=g},a,e,arguments.length,null)}}),f.each({Height:"height",Width:"width"},function(a,c){var d="client"+a,e="scroll"+a,g="offset"+a;f.fn["inner"+a]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,c,"padding")):this[c]():null},f.fn["outer"+a]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,c,a?"margin":"border")):this[c]():null},f.fn[c]=function(a){return f.access(this,function(a,c,h){var i,j,k,l;if(f.isWindow(a)){i=a.document,j=i.documentElement[d];return f.support.boxModel&&j||i.body&&i.body[d]||j}if(a.nodeType===9){i=a.documentElement;if(i[d]>=i[e])return i[d];return Math.max(a.body[e],i[e],a.body[g],i[g])}if(h===b){k=f.css(a,c),l=parseFloat(k);return f.isNumeric(l)?l:k}f(a).css(c,h)},c,a,arguments.length,null)}}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})})(window);

$(function() { highlight_touched_lines();} );
</script>
<div style='font-family:arial;color:white;position:fixed;top:0px;left:0px;;width:100%;height:52;background-color:#0a0a0a;'><table width="100%"><tr><td colspan="3">/usr/local/apache/htdocs/photo_db/lib.php</td></tr><tr><td><b style='font-size:18px'>Statement Coverage&nbsp;=&nbsp;&nbsp;<span style='color:red'>7.62%</span></b>&nbsp;&nbsp(215/2823)</td><td><b style='font-size:18px'>Line Coverage&nbsp;=&nbsp;&nbsp;2%</b>&nbsp;&nbsp;(215/8983)</td><td colspan='3'>Highlight statements covered by test&nbsp;&nbsp;<select style='width:200px' onchange='highlight_touched_lines();' name='testnames' id='testnames'><option value=''>Select</option></select>&nbsp;&nbsp;Exclusive<input onchange='highlight_touched_lines();' type='checkbox' id='exclusive'/></td></tr></table></div><div style='padding-top:52'><span class='lineno'>00001</span><pre class='pre'>&lt;?php</pre><br/><span class='lineno'>00002</span><pre class='pre'>// lib.php</pre><br/><span class='lineno'>00003</span><pre class='pre'>ini_set( &quot;display_errors&quot;, &quot;Off&quot;);</pre><br/><span class='lineno'>00004</span><pre title='' class='pre covered'>ini_set( &quot;default_charset&quot;, &quot;utf-8&quot;);</pre><br/><span class='lineno'>00005</span><pre title='' class='pre covered'>require_once './codespy-master/codespy.php';</pre><br/><span class='lineno'>00006</span><pre title='' class='pre covered'>\codespy\Analyzer::$outputdir = '/usr/local/apache/htdocs/photo_db/test';</pre><br/><span class='lineno'>00007</span><pre title='' class='pre covered'>\codespy\Analyzer::$outputformat = 'html';</pre><br/><span class='lineno'>00008</span><pre class='pre'>//error_reporting (E_ERROR | E_WARNING);</pre><br/><span class='lineno'>00009</span><pre class='pre'>//error_reporting (E_ERROR);</pre><br/><span class='lineno'>00010</span><pre class='pre'>//added by wangtongchao 2012-02-14 begin</pre><br/><span class='lineno'>00011</span><pre title='' class='pre covered'>$one_page_records_cnt = 20;</pre><br/><span class='lineno'>00012</span><pre class='pre'>//added by wangtongchao 2012-02-14 end</pre><br/><span class='lineno'>00013</span><pre class='pre'></pre><br/><span class='lineno'>00014</span><pre class='pre'>function db_connect()</pre><br/><span class='lineno'>00015</span><pre class='pre'>{</pre><br/><span class='lineno'>00016</span><pre title='' class='pre covered'>	global $db_host, $db_name, $db_user, $db_password, $db_charset, $is_connect, $db_link;</pre><br/><span class='lineno'>00017</span><pre class='pre'></pre><br/><span class='lineno'>00018</span><pre title='' class='pre covered'>	$is_connect = false;</pre><br/><span class='lineno'>00019</span><pre class='pre'></pre><br/><span class='lineno'>00020</span><pre class='pre'>	// ãã¹ã¯ã¼ãä»¥å¤ãç©ºã®å ´åã¯ã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>00021</span><pre class='pre'>	if (empty($db_host) || empty($db_name) || empty($db_user) || empty($db_charset))</pre><br/><span class='lineno'>00022</span><pre class='pre'>	{</pre><br/><span class='lineno'>00023</span><pre class='pre'>		$err_message = &quot;ãã¼ã¿ãã¼ã¹æå ±ã«ä¸åãããã¾ãã&quot;;</pre><br/><span class='lineno'>00024</span><pre class='pre'>		throw new Exception($err_message);</pre><br/><span class='lineno'>00025</span><pre class='pre'>	}</pre><br/><span class='lineno'>00026</span><pre class='pre'>	// ãã¼ã¿ãã¼ã¹ã­ã£ã©ã¯ã¿ã¼ã»ããã®ãã§ãã¯ããã¾ããï¼çç¥ï¼</pre><br/><span class='lineno'>00027</span><pre class='pre'></pre><br/><span class='lineno'>00028</span><pre class='pre'>	// ãã¼ã¿ãã¼ã¹ã«æ¥ç¶ãã¾ãã</pre><br/><span class='lineno'>00029</span><pre title='' class='pre covered'>	$hostdb = &quot;mysql:host=&quot;. $db_host . &quot;; dbname=&quot; . $db_name;</pre><br/><span class='lineno'>00030</span><pre title='' class='pre covered'>	$pdo = new PDO($hostdb, $db_user, $db_password);</pre><br/><span class='lineno'>00031</span><pre class='pre'></pre><br/><span class='lineno'>00032</span><pre class='pre'>	// ä½¿ç¨ããã­ã£ã©ã¯ã¿ã¼ã»ãããè¨­å®ãã¾ãã</pre><br/><span class='lineno'>00033</span><pre class='pre'>	//$sql = &quot;set character SET :DBCHAR&quot;;</pre><br/><span class='lineno'>00034</span><pre title='' class='pre covered'>	$sql = &quot;set names :DBCHAR&quot;;</pre><br/><span class='lineno'>00035</span><pre title='' class='pre covered'>	$stmt = $pdo-&gt;prepare($sql);</pre><br/><span class='lineno'>00036</span><pre title='' class='pre covered'>	$stmt-&gt;bindValue(':DBCHAR', $db_charset);</pre><br/><span class='lineno'>00037</span><pre title='' class='pre covered'>	$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>00038</span><pre class='pre'></pre><br/><span class='lineno'>00039</span><pre title='' class='pre covered'>	$is_connect = $result;</pre><br/><span class='lineno'>00040</span><pre class='pre'></pre><br/><span class='lineno'>00041</span><pre class='pre'>	// PDOã®ã¤ã³ã¹ã¿ã³ã¹ãè¿ãã¾ãã</pre><br/><span class='lineno'>00042</span><pre title='' class='pre covered'>	return $pdo;</pre><br/><span class='lineno'>00043</span><pre class='pre'>}</pre><br/><span class='lineno'>00044</span><pre class='pre'></pre><br/><span class='lineno'>00045</span><pre class='pre'>/**</pre><br/><span class='lineno'>00046</span><pre class='pre'> * ã¨ã©ã¼ã¡ãã»ã¼ã¸ãè¡¨ç¤ºããå¦çãä¸­æ­ãã¾ãã</pre><br/><span class='lineno'>00047</span><pre class='pre'> **/</pre><br/><span class='lineno'>00048</span><pre class='pre'>function error_exit($msg)</pre><br/><span class='lineno'>00049</span><pre class='pre'>{</pre><br/><span class='lineno'>00050</span><pre class='pre'>	// ã¨ã©ã¼ãæã£ãå ´åã¯ãã¨ã©ã¼ç»é¢ãè¡¨ç¤ºãã¾ãï¿½?</pre><br/><span class='lineno'>00051</span><pre class='pre'>	global $charset;</pre><br/><span class='lineno'>00052</span><pre class='pre'>	global $site_name;</pre><br/><span class='lineno'>00053</span><pre class='pre'></pre><br/><span class='lineno'>00054</span><pre class='pre'>	print &quot;&lt;html&gt;\r\n&quot;;</pre><br/><span class='lineno'>00055</span><pre class='pre'>	print &quot;&lt;head&gt;\r\n&quot;;</pre><br/><span class='lineno'>00056</span><pre class='pre'>	print &quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=$charset\&quot;&gt;\r\n&quot;;</pre><br/><span class='lineno'>00057</span><pre class='pre'>	//print &quot;&lt;link rel=\&quot;stylesheet\&quot; type=\&quot;text/css\&quot; href=\&quot;./css/base.css\&quot;&gt;\r\n&quot;;</pre><br/><span class='lineno'>00058</span><pre class='pre'>	print &quot;&lt;title&gt;$site_name&lt;/title&gt;\r\n&quot;;</pre><br/><span class='lineno'>00059</span><pre class='pre'>	print &quot;&lt;/head&gt;\r\n&quot;;</pre><br/><span class='lineno'>00060</span><pre class='pre'>	print &quot;&lt;body&gt;\r\n&quot;;</pre><br/><span class='lineno'>00061</span><pre class='pre'></pre><br/><span class='lineno'>00062</span><pre class='pre'>	print &quot;&lt;div align=\&quot;center\&quot;&gt;\r\n&quot;;</pre><br/><span class='lineno'>00063</span><pre class='pre'>	print &quot;&lt;h1&gt;$site_name&lt;/h1&gt;\r\n&quot;;</pre><br/><span class='lineno'>00064</span><pre class='pre'>	print &quot;&lt;font color=\&quot;red\&quot;&gt;&quot;;</pre><br/><span class='lineno'>00065</span><pre class='pre'>	$ed = count($msg);</pre><br/><span class='lineno'>00066</span><pre class='pre'>	for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>00067</span><pre class='pre'>	{</pre><br/><span class='lineno'>00068</span><pre class='pre'>		print $msg[$i] . &quot;&lt;br /&gt;&quot;;</pre><br/><span class='lineno'>00069</span><pre class='pre'>	}</pre><br/><span class='lineno'>00070</span><pre class='pre'>	print &quot;&lt;/font&gt;\r\n&quot;;</pre><br/><span class='lineno'>00071</span><pre class='pre'>	print &quot;&lt;/div&gt;\r\n&quot;;</pre><br/><span class='lineno'>00072</span><pre class='pre'>	print &quot;&lt;/body&gt;\r\n&quot;;</pre><br/><span class='lineno'>00073</span><pre class='pre'>	print &quot;&lt;/html&gt;\r\n&quot;;</pre><br/><span class='lineno'>00074</span><pre class='pre'></pre><br/><span class='lineno'>00075</span><pre class='pre'>	exit (-1);</pre><br/><span class='lineno'>00076</span><pre class='pre'>}</pre><br/><span class='lineno'>00077</span><pre class='pre'></pre><br/><span class='lineno'>00078</span><pre class='pre'>/**</pre><br/><span class='lineno'>00079</span><pre class='pre'> *  éåããå¤ãåãåºãã¾ã</pre><br/><span class='lineno'>00080</span><pre class='pre'> *</pre><br/><span class='lineno'>00081</span><pre class='pre'> *  éåããå¤ãåãåºãã¾ããããé£æ³ã­ã¼ãå­å¨ããªãå ´åã¯ããã©ã«ãå¤ï¼å¼æ°ï¼ï¼ãè¿ãã¾ã</pre><br/><span class='lineno'>00082</span><pre class='pre'> *</pre><br/><span class='lineno'>00083</span><pre class='pre'> *  @param array $array å¤ãåå¾ãããéå</pre><br/><span class='lineno'>00084</span><pre class='pre'> *  @param mixed $key éåããå¤ãåå¾ãããé£æ³ã­ã¼</pre><br/><span class='lineno'>00085</span><pre class='pre'> *  @return mixed éåããåãåºããå¤ãé£æ³ã­ã¼ãå­å¨ããªããã°$defaultãè¿ãã¾ãã</pre><br/><span class='lineno'>00086</span><pre class='pre'> * ä¾ï¼</pre><br/><span class='lineno'>00087</span><pre class='pre'> *   $first_name = array_get_value($user_info, 'first_name', 'ãªãã');</pre><br/><span class='lineno'>00088</span><pre class='pre'> *   $last_name = array_get_value($user_info, 'last_name', 'ãããã¡');</pre><br/><span class='lineno'>00089</span><pre class='pre'> */</pre><br/><span class='lineno'>00090</span><pre class='pre'>function array_get_value($array, $key, $default='')</pre><br/><span class='lineno'>00091</span><pre class='pre'>{</pre><br/><span class='lineno'>00092</span><pre class='pre'>	//return $array[$key];</pre><br/><span class='lineno'>00093</span><pre title='' class='pre covered'>    return isset($array[$key]) ? $array[$key]: $default;</pre><br/><span class='lineno'>00094</span><pre class='pre'>}</pre><br/><span class='lineno'>00095</span><pre class='pre'></pre><br/><span class='lineno'>00096</span><pre class='pre'>/**</pre><br/><span class='lineno'>00097</span><pre class='pre'> * HTMLè¡¨ç¤ºç¨</pre><br/><span class='lineno'>00098</span><pre class='pre'> * &rarr;htmlã¨ã³ãã£ãã£ã¼å¤æãè¡ãã¹ã©ãã·ã¥ãåãé¤ãã¾ãã</pre><br/><span class='lineno'>00099</span><pre class='pre'> */</pre><br/><span class='lineno'>00100</span><pre class='pre'>function dp($dp_str)</pre><br/><span class='lineno'>00101</span><pre class='pre'>{</pre><br/><span class='lineno'>00102</span><pre title='' class='pre covered'>	return stripslashes(htmlentities($dp_str, ENT_QUOTES, &quot;utf-8&quot;));</pre><br/><span class='lineno'>00103</span><pre class='pre'>	//return htmlspecialchars($dp_str, ENT_QUOTES, &quot;utf-8&quot;);</pre><br/><span class='lineno'>00104</span><pre class='pre'>}</pre><br/><span class='lineno'>00105</span><pre class='pre'></pre><br/><span class='lineno'>00106</span><pre class='pre'>/**</pre><br/><span class='lineno'>00107</span><pre class='pre'> * æå­åãã¡ã¼ã«ã¢ãã¬ã¹ã¨ãã¦å½¢å¼çã«æ­£ãããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00108</span><pre class='pre'> * ï¼ä¸è¬çãªãã®ã®ã¿ã«å¯¾å¿ãã¦ãã¾ãï¼</pre><br/><span class='lineno'>00109</span><pre class='pre'> */</pre><br/><span class='lineno'>00110</span><pre class='pre'>function mail_checkk($mailaddress){</pre><br/><span class='lineno'>00111</span><pre class='pre'>	if (preg_match('/^[a-zA-Z0-9_\.\-]+@[A-Za-z0-9]+\.[A-Za-z0-9]+$/',$mailaddress))</pre><br/><span class='lineno'>00112</span><pre class='pre'>	{</pre><br/><span class='lineno'>00113</span><pre class='pre'>		return true;</pre><br/><span class='lineno'>00114</span><pre class='pre'>	}</pre><br/><span class='lineno'>00115</span><pre class='pre'>	else{</pre><br/><span class='lineno'>00116</span><pre class='pre'>		return false;</pre><br/><span class='lineno'>00117</span><pre class='pre'>	}</pre><br/><span class='lineno'>00118</span><pre class='pre'>}</pre><br/><span class='lineno'>00119</span><pre class='pre'></pre><br/><span class='lineno'>00120</span><pre class='pre'>/**</pre><br/><span class='lineno'>00121</span><pre class='pre'> * æå®ã®é·ãã§ä¸ç¹ãªã¼ãã¼ãä½æãã¾ãã</pre><br/><span class='lineno'>00122</span><pre class='pre'> * â»æçµçãªé·ãã¯ãæå®ã®é·ãï¼ï¼ã§ãã</pre><br/><span class='lineno'>00123</span><pre class='pre'> */</pre><br/><span class='lineno'>00124</span><pre class='pre'>function santen_reader($strtmp, $len)</pre><br/><span class='lineno'>00125</span><pre class='pre'>{</pre><br/><span class='lineno'>00126</span><pre class='pre'>	if (mb_strlen($strtmp,&quot;utf-8&quot;) &gt; $len)</pre><br/><span class='lineno'>00127</span><pre class='pre'>	//if (strlen($strtmp) &gt; $len)</pre><br/><span class='lineno'>00128</span><pre class='pre'>	{</pre><br/><span class='lineno'>00129</span><pre title='' class='pre covered'>		return mb_substr($strtmp, 0 ,$len, &quot;utf-8&quot;) . &quot;&hellip;&quot;;</pre><br/><span class='lineno'>00130</span><pre class='pre'>		//return substr($strtmp, 0 ,$len) . &quot;&hellip;&quot;;</pre><br/><span class='lineno'>00131</span><pre class='pre'>	}</pre><br/><span class='lineno'>00132</span><pre class='pre'>	else</pre><br/><span class='lineno'>00133</span><pre class='pre'>	{</pre><br/><span class='lineno'>00134</span><pre title='' class='pre covered'>		return $strtmp;</pre><br/><span class='lineno'>00135</span><pre class='pre'>	}</pre><br/><span class='lineno'>00136</span><pre class='pre'>}</pre><br/><span class='lineno'>00137</span><pre class='pre'></pre><br/><span class='lineno'>00138</span><pre class='pre'></pre><br/><span class='lineno'>00139</span><pre class='pre'>/**</pre><br/><span class='lineno'>00140</span><pre class='pre'> * æå­åãæ¥ä»ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00141</span><pre class='pre'> *   ãã§ãã¯å¯¾è±¡ï¼yyyy/mm/dd</pre><br/><span class='lineno'>00142</span><pre class='pre'> *           ï¼yyyy/m/d</pre><br/><span class='lineno'>00143</span><pre class='pre'> *           ï¼yyyy-mm-dd</pre><br/><span class='lineno'>00144</span><pre class='pre'> *           ï¼yyyy-m-d</pre><br/><span class='lineno'>00145</span><pre class='pre'> *           ï¼yyyymmdd     ä»¥ä¸</pre><br/><span class='lineno'>00146</span><pre class='pre'> * @param String $dt</pre><br/><span class='lineno'>00147</span><pre class='pre'> * @return Boolean</pre><br/><span class='lineno'>00148</span><pre class='pre'> */</pre><br/><span class='lineno'>00149</span><pre class='pre'>function is_date($dt)</pre><br/><span class='lineno'>00150</span><pre class='pre'>{</pre><br/><span class='lineno'>00151</span><pre class='pre'>	// ä½ãå¥ã£ã¦ããªãå ´åã¯FALSEã§ãã</pre><br/><span class='lineno'>00152</span><pre class='pre'>	if (empty($dt))</pre><br/><span class='lineno'>00153</span><pre class='pre'>	{</pre><br/><span class='lineno'>00154</span><pre class='pre'>		return FALSE;</pre><br/><span class='lineno'>00155</span><pre class='pre'>	}</pre><br/><span class='lineno'>00156</span><pre class='pre'></pre><br/><span class='lineno'>00157</span><pre class='pre'>	// æå­åã®'/'ã®ä½ç½®ãåå¾ãã¾ãã</pre><br/><span class='lineno'>00158</span><pre class='pre'>	$dlen = strlen($dt);				// é·ã</pre><br/><span class='lineno'>00159</span><pre class='pre'>	$fpos = strpos($dt, &quot;/&quot;);			// å</pre><br/><span class='lineno'>00160</span><pre class='pre'>	$bpos = strrpos($dt, &quot;/&quot;);			// å¾ã</pre><br/><span class='lineno'>00161</span><pre class='pre'></pre><br/><span class='lineno'>00162</span><pre class='pre'>	// '/'ã®ä½ç½®ãåå¾ã§ãããã©ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00163</span><pre class='pre'>	if ($fpos == false || $bpos == false)</pre><br/><span class='lineno'>00164</span><pre class='pre'>	{</pre><br/><span class='lineno'>00165</span><pre class='pre'>		// ã§ããªãã£ãå ´åã¯'-'ã®ä½ç½®ãåå¾ãã¾ãã</pre><br/><span class='lineno'>00166</span><pre class='pre'>		$fpos = strpos($dt, &quot;-&quot;);		// å</pre><br/><span class='lineno'>00167</span><pre class='pre'>		$bpos = strrpos($dt, &quot;-&quot;);		// å¾ã</pre><br/><span class='lineno'>00168</span><pre class='pre'>	}</pre><br/><span class='lineno'>00169</span><pre class='pre'></pre><br/><span class='lineno'>00170</span><pre class='pre'>	// '/' ãããã¯ '-' ã®ä½ç½®ãåå¾ã§ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00171</span><pre class='pre'>	if ($fpos != false)</pre><br/><span class='lineno'>00172</span><pre class='pre'>	{</pre><br/><span class='lineno'>00173</span><pre class='pre'>		// åå¾ã§ããå ´åã®å¦çã§ãã</pre><br/><span class='lineno'>00174</span><pre class='pre'>		// å¹´ææ¥ã«åå²ãã¾ãã</pre><br/><span class='lineno'>00175</span><pre class='pre'>		$year = substr($dt, 0, $fpos);</pre><br/><span class='lineno'>00176</span><pre class='pre'>		$month = substr($dt, $fpos + 1, $bpos - $fpos - 1);</pre><br/><span class='lineno'>00177</span><pre class='pre'>		$day = substr($dt, $bpos + 1, $dlen - $bpos - 1);</pre><br/><span class='lineno'>00178</span><pre class='pre'></pre><br/><span class='lineno'>00179</span><pre class='pre'>		// åå¾ããå¹´ææ¥ãããããæ°å¤ã®å ´åã®ã¿ãã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00180</span><pre class='pre'>		if (is_numeric($year) &amp;&amp; is_numeric($month) &amp;&amp; is_numeric($day))</pre><br/><span class='lineno'>00181</span><pre class='pre'>		{</pre><br/><span class='lineno'>00182</span><pre class='pre'>			return checkdate($month, $day, $year);</pre><br/><span class='lineno'>00183</span><pre class='pre'>		}</pre><br/><span class='lineno'>00184</span><pre class='pre'>		else</pre><br/><span class='lineno'>00185</span><pre class='pre'>		{</pre><br/><span class='lineno'>00186</span><pre class='pre'>			return FALSE;</pre><br/><span class='lineno'>00187</span><pre class='pre'>		}</pre><br/><span class='lineno'>00188</span><pre class='pre'>	}</pre><br/><span class='lineno'>00189</span><pre class='pre'></pre><br/><span class='lineno'>00190</span><pre class='pre'>	// åå¾ã§ããªãã£ãå ´åã®å¦çã§ãã</pre><br/><span class='lineno'>00191</span><pre class='pre'>	// æå­åãyyyymmddã®å½¢å¼ï¼é·ããï¼ï¼ãã©ãããã§ãã¯ãã¾ããã</pre><br/><span class='lineno'>00192</span><pre class='pre'>	if ($dlen == 8)</pre><br/><span class='lineno'>00193</span><pre class='pre'>	{</pre><br/><span class='lineno'>00194</span><pre class='pre'>		// å¹´ææ¥ã«åå²ãã¾ãã</pre><br/><span class='lineno'>00195</span><pre class='pre'>		$year = substr($dt, 0, 4);</pre><br/><span class='lineno'>00196</span><pre class='pre'>		$month = substr($dt, 4, 2);</pre><br/><span class='lineno'>00197</span><pre class='pre'>		$day = substr($dt, 6, 2);</pre><br/><span class='lineno'>00198</span><pre class='pre'></pre><br/><span class='lineno'>00199</span><pre class='pre'>		// åå¾ããå¹´ææ¥ãããããæ°å¤ã®å ´åã®ã¿ãã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00200</span><pre class='pre'>		if (is_numeric($year) &amp;&amp; is_numeric($month) &amp;&amp; is_numeric($day))</pre><br/><span class='lineno'>00201</span><pre class='pre'>		{</pre><br/><span class='lineno'>00202</span><pre class='pre'>			return checkdate($month, $day, $year);</pre><br/><span class='lineno'>00203</span><pre class='pre'>		}</pre><br/><span class='lineno'>00204</span><pre class='pre'>		else</pre><br/><span class='lineno'>00205</span><pre class='pre'>		{</pre><br/><span class='lineno'>00206</span><pre class='pre'>			return FALSE;</pre><br/><span class='lineno'>00207</span><pre class='pre'>		}</pre><br/><span class='lineno'>00208</span><pre class='pre'>	}</pre><br/><span class='lineno'>00209</span><pre class='pre'></pre><br/><span class='lineno'>00210</span><pre class='pre'>	// ãã¹ã¦ã®æ¡ä»¶ã«å½ã¦ã¯ã¾ããªãå ´åã¯FALSEã¨ãã¾ãã</pre><br/><span class='lineno'>00211</span><pre class='pre'>	return FALSE;</pre><br/><span class='lineno'>00212</span><pre class='pre'>}</pre><br/><span class='lineno'>00213</span><pre class='pre'></pre><br/><span class='lineno'>00214</span><pre class='pre'>function conv_htmlstr($src, $mode, $cs, $lno)</pre><br/><span class='lineno'>00215</span><pre class='pre'>{</pre><br/><span class='lineno'>00216</span><pre class='pre'>	$ds = array();</pre><br/><span class='lineno'>00217</span><pre class='pre'></pre><br/><span class='lineno'>00218</span><pre class='pre'>	for ($i = 0 ; $i &lt; count($src) ; $i++)</pre><br/><span class='lineno'>00219</span><pre class='pre'>	{</pre><br/><span class='lineno'>00220</span><pre class='pre'>		if ($lno &gt; 0)</pre><br/><span class='lineno'>00221</span><pre class='pre'>		{</pre><br/><span class='lineno'>00222</span><pre class='pre'>			$ds[] = sprintf(&quot;%4d:&quot;, $i + 1 + $lno);</pre><br/><span class='lineno'>00223</span><pre class='pre'>		}</pre><br/><span class='lineno'>00224</span><pre class='pre'>		$ds[] .= htmlentities($src[$i], $mode, $cs);</pre><br/><span class='lineno'>00225</span><pre class='pre'>		$ds[] .= &quot;\r\n&quot;;</pre><br/><span class='lineno'>00226</span><pre class='pre'>	}</pre><br/><span class='lineno'>00227</span><pre class='pre'></pre><br/><span class='lineno'>00228</span><pre class='pre'>	return $ds;</pre><br/><span class='lineno'>00229</span><pre class='pre'>}</pre><br/><span class='lineno'>00230</span><pre class='pre'></pre><br/><span class='lineno'>00231</span><pre class='pre'>/*</pre><br/><span class='lineno'>00232</span><pre class='pre'> * é¢æ°åï¼header_out</pre><br/><span class='lineno'>00233</span><pre class='pre'> * é¢æ°èª¬æï¼ã­ã°ã¤ã³ç»é¢ã¸é·ç§»ãã</pre><br/><span class='lineno'>00234</span><pre class='pre'> * ãã©ã¡ã¿ï¼strurlï¼url</pre><br/><span class='lineno'>00235</span><pre class='pre'> * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>00236</span><pre class='pre'> */</pre><br/><span class='lineno'>00237</span><pre class='pre'>function header_out($strurl)</pre><br/><span class='lineno'>00238</span><pre class='pre'>{</pre><br/><span class='lineno'>00239</span><pre class='pre'>	print &quot;&lt;script type='text/javascript'&gt;&quot;;</pre><br/><span class='lineno'>00240</span><pre class='pre'>	print &quot;document.location.href=\&quot;&quot;.$strurl.&quot;\&quot;&quot;;</pre><br/><span class='lineno'>00241</span><pre class='pre'>	print &quot;&lt;/script&gt;&quot;;</pre><br/><span class='lineno'>00242</span><pre class='pre'>}</pre><br/><span class='lineno'>00243</span><pre class='pre'></pre><br/><span class='lineno'>00244</span><pre class='pre'>/**</pre><br/><span class='lineno'>00245</span><pre class='pre'> * ãã¡ã¤ã«ãã¢ããã­ã¼ããã¾ãã</pre><br/><span class='lineno'>00246</span><pre class='pre'> *</pre><br/><span class='lineno'>00247</span><pre class='pre'> * 	ãã³ã³ã¹ãã©ã¯ã¿ã¼ã</pre><br/><span class='lineno'>00248</span><pre class='pre'> * 		FileUpload($fl, $cf, $thdir, $flw, $fname, $cre, $wcredit)</pre><br/><span class='lineno'>00249</span><pre class='pre'> * 			@param array $fl 		åãã¡ã¤ã«ï¼éåï¼</pre><br/><span class='lineno'>00250</span><pre class='pre'> * 			@param array $cf 		å®ç¾©æå ±				ï¼æå®ãªãï¼config.phpã®$upload_confï¼</pre><br/><span class='lineno'>00251</span><pre class='pre'> * 										$cf['dir'] 			ï¼ã¢ããã­ã¼ããã©ã«ã</pre><br/><span class='lineno'>00252</span><pre class='pre'> * 										$cf['temp_dir']		ï¼ãã³ãã©ãªã¼ãã©ã«ã</pre><br/><span class='lineno'>00253</span><pre class='pre'> * 										$cf['maxsize']		ï¼ã¢ããã­ã¼ããã¡ã¤ã«ã®ä¸éãµã¤ãº</pre><br/><span class='lineno'>00254</span><pre class='pre'> * 										$cf['site_url']		ï¼ãµã¤ãURL</pre><br/><span class='lineno'>00255</span><pre class='pre'> * 			@param array $thdir		ãµã ãã¤ã«ãã©ã«ãæå ±	ï¼æå®ãªãï¼config.phpã®$thumb_dirï¼</pre><br/><span class='lineno'>00256</span><pre class='pre'> * 			@param array $flw		ãµã ãã¤ã«æ¨ªå¹			ï¼æå®ãªãï¼config.phpã®$thumb_widthï¼</pre><br/><span class='lineno'>00257</span><pre class='pre'> * 			@param string $fname	ãã©ã³ãå				ï¼æå®ãªãï¼config.phpã®$font_nameï¼</pre><br/><span class='lineno'>00258</span><pre class='pre'> * 			@param string $cre		ã¯ã¬ã¸ãã</pre><br/><span class='lineno'>00259</span><pre class='pre'> * 			@param array $wcredit	ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ãã©ãã	ï¼æå®ãªãï¼config.phpã®$write_creditï¼</pre><br/><span class='lineno'>00260</span><pre class='pre'> *</pre><br/><span class='lineno'>00261</span><pre class='pre'> * 	ãã¡ã³ãã¼ã</pre><br/><span class='lineno'>00262</span><pre class='pre'> * 		var $message;				ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>00263</span><pre class='pre'> * 		var $result;				ã¢ããã­ã¼ãçµæ</pre><br/><span class='lineno'>00264</span><pre class='pre'> * 		var $img_width;				ã¤ã¡ã¼ã¸ãµã¤ãºï¼æ¨ªï¼	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00265</span><pre class='pre'> * 		var $img_height;			ã¤ã¡ã¼ã¸ãµã¤ãºï¼ç¸¦ï¼	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00266</span><pre class='pre'> * 		var $up_url;				ã¢ããã­ã¼ãURLï¼æçµçã«ã¢ããã­ã¼ããããURLï¼</pre><br/><span class='lineno'>00267</span><pre class='pre'> * 													0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00268</span><pre class='pre'> *		var $ext;					æ¡å¼µå­ï¼åãã¡ã¤ã«åï¼</pre><br/><span class='lineno'>00269</span><pre class='pre'> *</pre><br/><span class='lineno'>00270</span><pre class='pre'> * 	$fileï¼ã¢ããã­ã¼ããã¡ã¤ã«å¨æå ±ï¼	&rarr;	$upfileï¼åã®ãã¡ã¤ã«åï¼+$extï¼æ¡å¼µå­ï¼</pre><br/><span class='lineno'>00271</span><pre class='pre'> * 										&darr;ã¦ãã¼ã¯ãªãã¡ã¤ã«åã¸</pre><br/><span class='lineno'>00272</span><pre class='pre'> * 									$svnameï¼ã¦ãã¼ã¯ãªãã¡ã¤ã«åï¼YmdHis999ï¼+$extï¼æ¡å¼µå­ï¼</pre><br/><span class='lineno'>00273</span><pre class='pre'> * 										&darr;ãã³ãã©ãªã¼ã¸</pre><br/><span class='lineno'>00274</span><pre class='pre'> * 									$uploadconf['temp_dir'] + $svname + $ext</pre><br/><span class='lineno'>00275</span><pre class='pre'> * 										&darr;ãã§ãã¯OK</pre><br/><span class='lineno'>00276</span><pre class='pre'> * 									$uploadconf['dir'] + dirnoï¼0ï½9ã¾ã§ã®ãã©ã«ãï¼ + $svname + $extãï¼$svfullpath[0]ï¼</pre><br/><span class='lineno'>00277</span><pre class='pre'> * 										&darr;URLã«å¤æ</pre><br/><span class='lineno'>00278</span><pre class='pre'> * 									$uploadconf['site_url'] + $svfullpath[0]ãï¼$up_urlï¼</pre><br/><span class='lineno'>00279</span><pre class='pre'> */</pre><br/><span class='lineno'>00280</span><pre class='pre'>class FileUpload</pre><br/><span class='lineno'>00281</span><pre class='pre'>{</pre><br/><span class='lineno'>00282</span><pre class='pre'>	var $message;									// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>00283</span><pre class='pre'>	var $result;									// ã¢ããã­ã¼ãçµæ</pre><br/><span class='lineno'>00284</span><pre class='pre'>	var $img_width;									// ã¤ã¡ã¼ã¸ãµã¤ãºï¼æ¨ªï¼	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00285</span><pre class='pre'>	var $img_height;								// ã¤ã¡ã¼ã¸ãµã¤ãºï¼ç¸¦ï¼	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00286</span><pre class='pre'>	var $up_url;									// ã¢ããã­ã¼ãURLï¼æçµçã«ã¢ããã­ã¼ããããURLï¼</pre><br/><span class='lineno'>00287</span><pre class='pre'>													//					0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00288</span><pre class='pre'>	var $ext;										// æ¡å¼µå­ï¼åãã¡ã¤ã«åï¼</pre><br/><span class='lineno'>00289</span><pre class='pre'></pre><br/><span class='lineno'>00290</span><pre class='pre'>	private $file;									// ãã¡ã¤ã«æå ±</pre><br/><span class='lineno'>00291</span><pre class='pre'>	private $dirno;									// uploadããã³thumbãã©ã«ãä»¥ä¸0-9ã®ã©ã®ãã©ã«ãã«å¥ããã</pre><br/><span class='lineno'>00292</span><pre class='pre'>	private $svname;								// ä¿å­ãã¡ã¤ã«åä½æåï¼YmdHis999ï¼</pre><br/><span class='lineno'>00293</span><pre class='pre'>	private $svfullpath;							// ä¿å­ãã¡ã¤ã«åï¼ãã«ãã¹:./$uploadconf['dir']/YmdHis999/dirno/svname.extï¼</pre><br/><span class='lineno'>00294</span><pre class='pre'>	private $upfile;								// ã¢ããã­ã¼ããã¡ã¤ã«å</pre><br/><span class='lineno'>00295</span><pre class='pre'>	private $uploadsize;							// ã¢ããã­ã¼ããµã¤ãº</pre><br/><span class='lineno'>00296</span><pre class='pre'>	private $uploadconf;							// ã¢ããã­ã¼ãç¨å®ç¾©</pre><br/><span class='lineno'>00297</span><pre class='pre'>													//	$uploadconf['dir'] = &quot;./uploads/&quot;;			ã¢ããã­ã¼ããã©ã«ã</pre><br/><span class='lineno'>00298</span><pre class='pre'>													//	$uploadconf['temp_dir'] = &quot;./temporary/&quot;;	ãã³ãã©ãªã¼ãã©ã«ã</pre><br/><span class='lineno'>00299</span><pre class='pre'>													//	$uploadconf['maxsize'] = 1000000;			 ã¢ããã­ã¼ããã¡ã¤ã«ã®å¶éãµã¤ãº</pre><br/><span class='lineno'>00300</span><pre class='pre'>													//	$uploadconf['site_url'] = 'http:			ãµã¤ãURL</pre><br/><span class='lineno'>00301</span><pre class='pre'>	private $flwidth;								// ãµã ãã¤ã«ãä½æããã¨ãã®æ¨ªå¹</pre><br/><span class='lineno'>00302</span><pre class='pre'>	private $thumbdir;								// ãµã ãã¤ã«ãä¿å­ãããã©ã«ã</pre><br/><span class='lineno'>00303</span><pre class='pre'>	private $font_name;								// ãã©ã³ãå</pre><br/><span class='lineno'>00304</span><pre class='pre'>	private $credit;								// ã¯ã¬ã¸ãã</pre><br/><span class='lineno'>00305</span><pre class='pre'>	private $write_ok;								// ãã©ã³ããæ¸ãè¾¼ããã©ãã</pre><br/><span class='lineno'>00306</span><pre class='pre'></pre><br/><span class='lineno'>00307</span><pre class='pre'>	/**</pre><br/><span class='lineno'>00308</span><pre class='pre'>	 * ã³ã³ã¹ãã©ã¯ã¿ã¼</pre><br/><span class='lineno'>00309</span><pre class='pre'>	 */</pre><br/><span class='lineno'>00310</span><pre class='pre'>	function __construct($fl, $cf, $thdir, $flw, $fname, $cre, $wcredit)</pre><br/><span class='lineno'>00311</span><pre class='pre'>	{</pre><br/><span class='lineno'>00312</span><pre class='pre'>		// config.phpããããã©ã«ãå¤ãèª­ã¿è¾¼ãããã®globalã§ãã</pre><br/><span class='lineno'>00313</span><pre class='pre'>		global $upload_conf, $thumb_dir, $thumb_width, $font_name, $write_credit;</pre><br/><span class='lineno'>00314</span><pre class='pre'>		global $credit_fontsize;</pre><br/><span class='lineno'>00315</span><pre class='pre'></pre><br/><span class='lineno'>00316</span><pre class='pre'>		// ã¡ã³ãã¼ãåæåãã¾ãã</pre><br/><span class='lineno'>00317</span><pre class='pre'>		$this-&gt;message = &quot;&quot;;						// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>00318</span><pre class='pre'>		$this-&gt;result = true;						// çµæï¼æåï¼trueï¼</pre><br/><span class='lineno'>00319</span><pre class='pre'>		$this-&gt;file = &quot;&quot;;							// ãã¡ã¤ã«æå ±</pre><br/><span class='lineno'>00320</span><pre class='pre'>		$this-&gt;svname = &quot;&quot;;							// ä¿å­ãã¡ã¤ã«åä½æåï¼YmdHis999ï¼</pre><br/><span class='lineno'>00321</span><pre class='pre'>		$this-&gt;uploadsize = 0;						// ã¢ããã­ã¼ããµã¤ãº</pre><br/><span class='lineno'>00322</span><pre class='pre'>		$this-&gt;ext = &quot;&quot;;							// æ¡å¼µå­</pre><br/><span class='lineno'>00323</span><pre class='pre'>		$this-&gt;font_name = &quot;&quot;;						// ãã©ã³ãå</pre><br/><span class='lineno'>00324</span><pre class='pre'>		$this-&gt;dirno = 0;							// uploadããã³thumbãã©ã«ãä»¥ä¸ã®ãã£ã¬ã¯ããªå</pre><br/><span class='lineno'>00325</span><pre class='pre'>		$this-&gt;credit = &quot;&quot;;							// ã¯ã¬ã¸ãã</pre><br/><span class='lineno'>00326</span><pre class='pre'></pre><br/><span class='lineno'>00327</span><pre class='pre'>		$this-&gt;img_width = array();					// ã¤ã¡ã¼ã¸ãµã¤ãºï¼æ¨ªï¼			0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00328</span><pre class='pre'>		$this-&gt;img_height = array();				// ã¤ã¡ã¼ã¸ãµã¤ãºï¼æ¨ªï¼			0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00329</span><pre class='pre'>		$this-&gt;write_ok = array();					// ã¯ã¬ã¸ãããæ¸ãè¾¼ããã©ãã		0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00330</span><pre class='pre'>		$this-&gt;flwidth = array();					// ãµã ãã¤ã«ãä½æããã¨ãã®æ¨ªå¹	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00331</span><pre class='pre'>		$this-&gt;thumbdir = array();					// ãµã ãã¤ã«ãä¿å­ãããã©ã«ã		0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00332</span><pre class='pre'>		$this-&gt;up_url = array();					// ã¢ããã­ã¼ãURL				0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00333</span><pre class='pre'>		$this-&gt;svfullpath = array();				// ä¿å­ãã¡ã¤ã«åï¼ãã«ãã¹ï¼		0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>00334</span><pre class='pre'></pre><br/><span class='lineno'>00335</span><pre class='pre'>		// ãã¡ã¤ã«æå ±ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>00336</span><pre class='pre'>		$this-&gt;file = $fl;</pre><br/><span class='lineno'>00337</span><pre class='pre'></pre><br/><span class='lineno'>00338</span><pre class='pre'>		// å®ç¾©æå ±ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>00339</span><pre class='pre'>		if (empty($cf))</pre><br/><span class='lineno'>00340</span><pre class='pre'>		{</pre><br/><span class='lineno'>00341</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«å®ç¾©æå ±ãè¨­å®ããã¦ããªãå ´åã§ã</pre><br/><span class='lineno'>00342</span><pre class='pre'>			if (!empty($upload_conf))</pre><br/><span class='lineno'>00343</span><pre class='pre'>			{</pre><br/><span class='lineno'>00344</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããã°ã</pre><br/><span class='lineno'>00345</span><pre class='pre'>				// ãã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>00346</span><pre class='pre'>				$this-&gt;uploadconf = $upload_conf;</pre><br/><span class='lineno'>00347</span><pre class='pre'>			}</pre><br/><span class='lineno'>00348</span><pre class='pre'>			else</pre><br/><span class='lineno'>00349</span><pre class='pre'>			{</pre><br/><span class='lineno'>00350</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããªããã°ã</pre><br/><span class='lineno'>00351</span><pre class='pre'>				// ã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>00352</span><pre class='pre'>				$this-&gt;result = false;</pre><br/><span class='lineno'>00353</span><pre class='pre'>				$this-&gt;message = &quot;ã¢ããã­ã¼ãç¨å®ç¾©ãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00354</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00355</span><pre class='pre'>			}</pre><br/><span class='lineno'>00356</span><pre class='pre'>		}</pre><br/><span class='lineno'>00357</span><pre class='pre'>		else</pre><br/><span class='lineno'>00358</span><pre class='pre'>		{</pre><br/><span class='lineno'>00359</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«å®ç¾©æå ±ãè¨­å®ããã¦ããå ´åã¯ããã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>00360</span><pre class='pre'>			$this-&gt;uploadconf = $cf;</pre><br/><span class='lineno'>00361</span><pre class='pre'>		}</pre><br/><span class='lineno'>00362</span><pre class='pre'></pre><br/><span class='lineno'>00363</span><pre class='pre'>		// å®ç¾©ãã¡ã¤ã«ã®åå®¹ããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00364</span><pre class='pre'>		if (empty($this-&gt;uploadconf['dir']))</pre><br/><span class='lineno'>00365</span><pre class='pre'>		{</pre><br/><span class='lineno'>00366</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00367</span><pre class='pre'>			$this-&gt;message = &quot;ä¿å­ç¨ãã£ã¬ã¯ããªãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00368</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00369</span><pre class='pre'>		}</pre><br/><span class='lineno'>00370</span><pre class='pre'></pre><br/><span class='lineno'>00371</span><pre class='pre'>		if (empty($this-&gt;uploadconf['temp_dir']))</pre><br/><span class='lineno'>00372</span><pre class='pre'>		{</pre><br/><span class='lineno'>00373</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00374</span><pre class='pre'>			$this-&gt;message = &quot;ãã³ãã©ãªã¼ãã£ã¬ã¯ããªãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00375</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00376</span><pre class='pre'>		}</pre><br/><span class='lineno'>00377</span><pre class='pre'></pre><br/><span class='lineno'>00378</span><pre class='pre'>		if (empty($this-&gt;uploadconf['maxsize']))</pre><br/><span class='lineno'>00379</span><pre class='pre'>		{</pre><br/><span class='lineno'>00380</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00381</span><pre class='pre'>			$this-&gt;message = &quot;ã¢ããã­ã¼ãæå¤§ãµã¤ãºãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00382</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00383</span><pre class='pre'>		}</pre><br/><span class='lineno'>00384</span><pre class='pre'></pre><br/><span class='lineno'>00385</span><pre class='pre'>		if (empty($this-&gt;uploadconf['site_url']))</pre><br/><span class='lineno'>00386</span><pre class='pre'>		{</pre><br/><span class='lineno'>00387</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00388</span><pre class='pre'>			$this-&gt;message = &quot;URLãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00389</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00390</span><pre class='pre'>		}</pre><br/><span class='lineno'>00391</span><pre class='pre'></pre><br/><span class='lineno'>00392</span><pre class='pre'>		// ãµã ãã¤ã«ä¿å­ç¨ãã©ã«ããè¨­å®ãã¾ãã</pre><br/><span class='lineno'>00393</span><pre class='pre'>		if (empty($thdir))</pre><br/><span class='lineno'>00394</span><pre class='pre'>		{</pre><br/><span class='lineno'>00395</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ãµã ãã¤ã«ä¿å­ç¨ãã©ã«ããè¨­å®ããã¦ããªãå ´åã§ã</pre><br/><span class='lineno'>00396</span><pre class='pre'>			if (!empty($thumb_dir))</pre><br/><span class='lineno'>00397</span><pre class='pre'>			{</pre><br/><span class='lineno'>00398</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããã°ã</pre><br/><span class='lineno'>00399</span><pre class='pre'>				// ãã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>00400</span><pre class='pre'>				$this-&gt;thumbdir = $thumb_dir;</pre><br/><span class='lineno'>00401</span><pre class='pre'>			}</pre><br/><span class='lineno'>00402</span><pre class='pre'>			else</pre><br/><span class='lineno'>00403</span><pre class='pre'>			{</pre><br/><span class='lineno'>00404</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããªããã°ã</pre><br/><span class='lineno'>00405</span><pre class='pre'>				// ã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>00406</span><pre class='pre'>				$this-&gt;result = false;</pre><br/><span class='lineno'>00407</span><pre class='pre'>				$this-&gt;message = &quot;ãµã ãã¤ã«ä¿å­ç¨ãã©ã«ããè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00408</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00409</span><pre class='pre'>			}</pre><br/><span class='lineno'>00410</span><pre class='pre'>		}</pre><br/><span class='lineno'>00411</span><pre class='pre'>		else</pre><br/><span class='lineno'>00412</span><pre class='pre'>		{</pre><br/><span class='lineno'>00413</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ãµã ãã¤ã«ä¿å­ç¨ãã©ã«ããè¨­å®ããã¦ããå ´åã¯ããã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>00414</span><pre class='pre'>			$this-&gt;thumbdir = $thdir;</pre><br/><span class='lineno'>00415</span><pre class='pre'>		}</pre><br/><span class='lineno'>00416</span><pre class='pre'></pre><br/><span class='lineno'>00417</span><pre class='pre'>		// ãµã ãã¤ã«ä½ææã®æ¨ªå¹ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>00418</span><pre class='pre'>		if (empty($flw))</pre><br/><span class='lineno'>00419</span><pre class='pre'>		{</pre><br/><span class='lineno'>00420</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ãµã ãã¤ã«ä½ææã®æ¨ªå¹ãè¨­å®ããã¦ããªãå ´åã§ã</pre><br/><span class='lineno'>00421</span><pre class='pre'>			if (!empty($thumb_width))</pre><br/><span class='lineno'>00422</span><pre class='pre'>			{</pre><br/><span class='lineno'>00423</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããã°ã</pre><br/><span class='lineno'>00424</span><pre class='pre'>				// ãã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>00425</span><pre class='pre'>				$this-&gt;flwidth = $thumb_width;</pre><br/><span class='lineno'>00426</span><pre class='pre'>			}</pre><br/><span class='lineno'>00427</span><pre class='pre'>			else</pre><br/><span class='lineno'>00428</span><pre class='pre'>			{</pre><br/><span class='lineno'>00429</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããªããã°ã</pre><br/><span class='lineno'>00430</span><pre class='pre'>				// ã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>00431</span><pre class='pre'>				$this-&gt;result = false;</pre><br/><span class='lineno'>00432</span><pre class='pre'>				$this-&gt;message = &quot;ãµã ãã¤ã«ä½ææã®æ¨ªå¹ãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00433</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00434</span><pre class='pre'>			}</pre><br/><span class='lineno'>00435</span><pre class='pre'>		}</pre><br/><span class='lineno'>00436</span><pre class='pre'>		else</pre><br/><span class='lineno'>00437</span><pre class='pre'>		{</pre><br/><span class='lineno'>00438</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ãµã ãã¤ã«ä½ææã®æ¨ªå¹ãè¨­å®ããã¦ããå ´åã¯ããã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>00439</span><pre class='pre'>			$this-&gt;flwidth = $flw;</pre><br/><span class='lineno'>00440</span><pre class='pre'>		}</pre><br/><span class='lineno'>00441</span><pre class='pre'></pre><br/><span class='lineno'>00442</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸è¾¼ç¨ã®ãã©ã³ããè¨­å®ãã¾ãã</pre><br/><span class='lineno'>00443</span><pre class='pre'>		if (empty($fname))</pre><br/><span class='lineno'>00444</span><pre class='pre'>		{</pre><br/><span class='lineno'>00445</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ã¯ã¬ã¸ããæ¸è¾¼ç¨ã®ãã©ã³ããè¨­å®ããã¦ããªãå ´åã§ã</pre><br/><span class='lineno'>00446</span><pre class='pre'>			if (!empty($font_name))</pre><br/><span class='lineno'>00447</span><pre class='pre'>			{</pre><br/><span class='lineno'>00448</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããã°ã</pre><br/><span class='lineno'>00449</span><pre class='pre'>				// ãã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>00450</span><pre class='pre'>				$this-&gt;font_name = $font_name;</pre><br/><span class='lineno'>00451</span><pre class='pre'>			}</pre><br/><span class='lineno'>00452</span><pre class='pre'>			else</pre><br/><span class='lineno'>00453</span><pre class='pre'>			{</pre><br/><span class='lineno'>00454</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããªããã°ã</pre><br/><span class='lineno'>00455</span><pre class='pre'>				// ã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>00456</span><pre class='pre'>				$this-&gt;result = false;</pre><br/><span class='lineno'>00457</span><pre class='pre'>				$this-&gt;message = &quot;ãã©ã³ããè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00458</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00459</span><pre class='pre'>			}</pre><br/><span class='lineno'>00460</span><pre class='pre'>		}</pre><br/><span class='lineno'>00461</span><pre class='pre'>		else</pre><br/><span class='lineno'>00462</span><pre class='pre'>		{</pre><br/><span class='lineno'>00463</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ãã©ã³ããè¨­å®ããã¦ããå ´åã¯ããã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>00464</span><pre class='pre'>			$this-&gt;font_name = $fname;</pre><br/><span class='lineno'>00465</span><pre class='pre'>		}</pre><br/><span class='lineno'>00466</span><pre class='pre'></pre><br/><span class='lineno'>00467</span><pre class='pre'>		// ã¯ã¬ã¸ãããæ¸ãè¾¼ããã©ããã®è¨­å®ãã¾ãã</pre><br/><span class='lineno'>00468</span><pre class='pre'>		if (empty($wcredit))</pre><br/><span class='lineno'>00469</span><pre class='pre'>		{</pre><br/><span class='lineno'>00470</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ã¯ã¬ã¸ãããæ¸ãè¾¼ããã©ãããè¨­å®ããã¦ããªãå ´åã§ã</pre><br/><span class='lineno'>00471</span><pre class='pre'>			if (!empty($write_credit))</pre><br/><span class='lineno'>00472</span><pre class='pre'>			{</pre><br/><span class='lineno'>00473</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããã°ã</pre><br/><span class='lineno'>00474</span><pre class='pre'>				// ãã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>00475</span><pre class='pre'>				$this-&gt;write_ok = $write_credit;</pre><br/><span class='lineno'>00476</span><pre class='pre'>			}</pre><br/><span class='lineno'>00477</span><pre class='pre'>			else</pre><br/><span class='lineno'>00478</span><pre class='pre'>			{</pre><br/><span class='lineno'>00479</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããªããã°ã</pre><br/><span class='lineno'>00480</span><pre class='pre'>				// ã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>00481</span><pre class='pre'>				$this-&gt;result = false;</pre><br/><span class='lineno'>00482</span><pre class='pre'>				$this-&gt;message = &quot;ã¯ã¬ã¸ãããæ¸ãè¾¼ããã©ãããè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00483</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00484</span><pre class='pre'>			}</pre><br/><span class='lineno'>00485</span><pre class='pre'>		}</pre><br/><span class='lineno'>00486</span><pre class='pre'>		else</pre><br/><span class='lineno'>00487</span><pre class='pre'>		{</pre><br/><span class='lineno'>00488</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ãã©ã³ããè¨­å®ããã¦ããå ´åã¯ããã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>00489</span><pre class='pre'>			$this-&gt;write_ok  = $wcredit;</pre><br/><span class='lineno'>00490</span><pre class='pre'>		}</pre><br/><span class='lineno'>00491</span><pre class='pre'></pre><br/><span class='lineno'>00492</span><pre class='pre'>		// ã¯ã¬ã¸ãããè¨­å®ãã¾ãã</pre><br/><span class='lineno'>00493</span><pre class='pre'>		$this-&gt;credit = $cre;										// ã¯ã¬ã¸ãã</pre><br/><span class='lineno'>00494</span><pre class='pre'></pre><br/><span class='lineno'>00495</span><pre class='pre'>		// æå®ãããã¢ããã­ã¼ããã¡ã¤ã«åãåå¾ãã¾ãã</pre><br/><span class='lineno'>00496</span><pre class='pre'>		$this-&gt;upfile = $fl['name'];								// ã¢ããã­ã¼ããã¡ã¤ã«å</pre><br/><span class='lineno'>00497</span><pre class='pre'></pre><br/><span class='lineno'>00498</span><pre class='pre'>		// ã¢ããã­ã¼ããããã¡ã¤ã«ãµã¤ãºãåå¾ãã¾ãã</pre><br/><span class='lineno'>00499</span><pre class='pre'>		$this-&gt;uploadsize = $fl['size'];							// ã¢ããã­ã¼ããµã¤ãº</pre><br/><span class='lineno'>00500</span><pre class='pre'></pre><br/><span class='lineno'>00501</span><pre class='pre'>		// ã¢ããã­ã¼ããããã¡ã¤ã«åããæ¡å¼µå­ãæåºãã¾ãã</pre><br/><span class='lineno'>00502</span><pre class='pre'>		preg_match(&quot;/\.[^.]*$/i&quot;, $this-&gt;upfile, $ext_tmp);			// extã«æ¡å¼µå­</pre><br/><span class='lineno'>00503</span><pre class='pre'></pre><br/><span class='lineno'>00504</span><pre class='pre'>		// æ¡å¼µå­ãå°æå­ã«å¤æãã¾ãã</pre><br/><span class='lineno'>00505</span><pre class='pre'>		$this-&gt;ext = strtolower($ext_tmp[0]);</pre><br/><span class='lineno'>00506</span><pre class='pre'></pre><br/><span class='lineno'>00507</span><pre class='pre'>		// æ¡å¼µå­ã®ã¨ã©ã¼ãã§ãã¯ããã¾ãã</pre><br/><span class='lineno'>00508</span><pre class='pre'>		if (empty($this-&gt;ext))</pre><br/><span class='lineno'>00509</span><pre class='pre'>		{</pre><br/><span class='lineno'>00510</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00511</span><pre class='pre'>			$this-&gt;message = &quot;ãã¡ã¤ã«ã®æ¡å¼µå­ãä»ãã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00512</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00513</span><pre class='pre'>		}</pre><br/><span class='lineno'>00514</span><pre class='pre'></pre><br/><span class='lineno'>00515</span><pre class='pre'>		// æ¡å¼µå­ãç³è«ã§ããæ¡å¼µå­ãã©ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00516</span><pre class='pre'>		if ($this-&gt;ext != &quot;.jpg&quot; &amp;&amp; $this-&gt;ext != &quot;.jpeg&quot; &amp;&amp; $this-&gt;ext != &quot;.png&quot; &amp;&amp; $this-&gt;ext != &quot;.gif&quot;)</pre><br/><span class='lineno'>00517</span><pre class='pre'>		{</pre><br/><span class='lineno'>00518</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00519</span><pre class='pre'>			$this-&gt;message = &quot;ç³è«ã§ããªãç¨®é¡ã®ãã¡ã¤ã«ã§ããï¼æ¡å¼µå­.jpegã.jpgã.pngã.gifã®ã¿ç³è«å¯è½ã§ããï¼&quot;;</pre><br/><span class='lineno'>00520</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00521</span><pre class='pre'>		}</pre><br/><span class='lineno'>00522</span><pre class='pre'></pre><br/><span class='lineno'>00523</span><pre class='pre'>		// ã¢ããã­ã¼ããããã¡ã¤ã«åãæå®ããã¦ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00524</span><pre class='pre'>		if (empty($this-&gt;upfile))</pre><br/><span class='lineno'>00525</span><pre class='pre'>		{</pre><br/><span class='lineno'>00526</span><pre class='pre'>			// ã¢ããã­ã¼ããããã¡ã¤ã«åãç©ºã®å ´åã¯ãã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>00527</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00528</span><pre class='pre'>			$this-&gt;message = &quot;ã¢ããã­ã¼ããããã¡ã¤ã«ãæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00529</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00530</span><pre class='pre'>		}</pre><br/><span class='lineno'>00531</span><pre class='pre'></pre><br/><span class='lineno'>00532</span><pre class='pre'>		// ã¢ããã­ã¼ãæã®ã¨ã©ã¼ããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00533</span><pre class='pre'>		$err_no =$fl['error'];</pre><br/><span class='lineno'>00534</span><pre class='pre'>		if ($err_no != UPLOAD_ERR_OK)</pre><br/><span class='lineno'>00535</span><pre class='pre'>		{</pre><br/><span class='lineno'>00536</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00537</span><pre class='pre'>			// FILES ERRORããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00538</span><pre class='pre'>			if ($err_no == 1)</pre><br/><span class='lineno'>00539</span><pre class='pre'>			{</pre><br/><span class='lineno'>00540</span><pre class='pre'>				$this-&gt;message = $this-&gt;upfile . &quot;ã¯php.ini ã® upload_max_filesize ãã£ã¬ã¯ãã£ãã®å¤ãè¶ãã¦ãã¾ãã&quot;;</pre><br/><span class='lineno'>00541</span><pre class='pre'>			}</pre><br/><span class='lineno'>00542</span><pre class='pre'>			elseif ($err_no == 2)</pre><br/><span class='lineno'>00543</span><pre class='pre'>			{</pre><br/><span class='lineno'>00544</span><pre class='pre'>				$this-&gt;message = $this-&gt;upfile . &quot;ã¯ HTMLãã©ã¼ã  ã§æå®ããã MAX_FILE_SIZE ãè¶ãã¦ãã¾ãã&quot;;</pre><br/><span class='lineno'>00545</span><pre class='pre'>			}</pre><br/><span class='lineno'>00546</span><pre class='pre'>			elseif ($err_no == 3)</pre><br/><span class='lineno'>00547</span><pre class='pre'>			{</pre><br/><span class='lineno'>00548</span><pre class='pre'>				$this-&gt;message = $this-&gt;upfile . &quot;ã®ã¢ããã­ã¼ãã«å¤±æãã¾ããã(Errno=3)&quot;;</pre><br/><span class='lineno'>00549</span><pre class='pre'>			}</pre><br/><span class='lineno'>00550</span><pre class='pre'>			elseif ($err_no == 4)</pre><br/><span class='lineno'>00551</span><pre class='pre'>			{</pre><br/><span class='lineno'>00552</span><pre class='pre'>				$this-&gt;message = $this-&gt;upfile . &quot;ã®ã¢ããã­ã¼ãã«å¤±æãã¾ããã(Errno=4)&quot;;</pre><br/><span class='lineno'>00553</span><pre class='pre'>			}</pre><br/><span class='lineno'>00554</span><pre class='pre'>			else</pre><br/><span class='lineno'>00555</span><pre class='pre'>			{</pre><br/><span class='lineno'>00556</span><pre class='pre'>				$this-&gt;message = &quot;ãã¡ã¤ã«ã®åå ã«ããã¢ããã­ã¼ãã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>00557</span><pre class='pre'>			}</pre><br/><span class='lineno'>00558</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00559</span><pre class='pre'>		}</pre><br/><span class='lineno'>00560</span><pre class='pre'></pre><br/><span class='lineno'>00561</span><pre class='pre'>		// ãã¡ã¤ã«ãµã¤ãºãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00562</span><pre class='pre'>		if ($this-&gt;uploadsize == 0)</pre><br/><span class='lineno'>00563</span><pre class='pre'>		{</pre><br/><span class='lineno'>00564</span><pre class='pre'>			// ãã¡ã¤ã«ãµã¤ãºãï¼ã®å ´åã¯ãã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>00565</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00566</span><pre class='pre'>			$this-&gt;message = &quot;ãã¡ã¤ã«ãµã¤ãºãï¼ã§ãã&quot;;</pre><br/><span class='lineno'>00567</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00568</span><pre class='pre'>		}</pre><br/><span class='lineno'>00569</span><pre class='pre'></pre><br/><span class='lineno'>00570</span><pre class='pre'>		// ãã¡ã¤ã«ãµã¤ãºãè¨­å®ããæå¤§å¤ãè¶ãã¦ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00571</span><pre class='pre'>		if ($this-&gt;uploadsize &gt; $this-&gt;uploadconf['maxsize'])</pre><br/><span class='lineno'>00572</span><pre class='pre'>		{</pre><br/><span class='lineno'>00573</span><pre class='pre'>			// è¨­å®ããæå¤§å¤ãè¶ããå ´åã¯ãã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>00574</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00575</span><pre class='pre'>			$this-&gt;message = &quot;ãã¡ã¤ã«ãµã¤ãºãè¨­å®ããæå¤§å¤ãè¶ãã¦ãã¾ãã&quot;;</pre><br/><span class='lineno'>00576</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00577</span><pre class='pre'>		}</pre><br/><span class='lineno'>00578</span><pre class='pre'>	}</pre><br/><span class='lineno'>00579</span><pre class='pre'></pre><br/><span class='lineno'>00580</span><pre class='pre'>	function write_credit($img, $cre_str, $fsize, $width_i, $height_i)</pre><br/><span class='lineno'>00581</span><pre class='pre'>	{</pre><br/><span class='lineno'>00582</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸ãè¾¼ã¿ç¨ã®è¨­å®ãè¡ãã¾ãã</pre><br/><span class='lineno'>00583</span><pre class='pre'>		// æ¸ãè¾¼ã¿è§åº¦ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>00584</span><pre class='pre'>		$font_angle = 0;</pre><br/><span class='lineno'>00585</span><pre class='pre'></pre><br/><span class='lineno'>00586</span><pre class='pre'>		//GDç°å¢æå ±ãåå¾ãã¾ãã</pre><br/><span class='lineno'>00587</span><pre class='pre'>		$arrInfo = gd_info();</pre><br/><span class='lineno'>00588</span><pre class='pre'></pre><br/><span class='lineno'>00589</span><pre class='pre'>		// æ¸ãè¾¼ãã¯ã¬ã¸ãããè¨­å®ãã¾ãã</pre><br/><span class='lineno'>00590</span><pre class='pre'>		$telop_text = &quot;&quot;;</pre><br/><span class='lineno'>00591</span><pre class='pre'>		if ($arrInfo['JIS-mapped Japanese Font Support']) {</pre><br/><span class='lineno'>00592</span><pre class='pre'>			// GDãå¯¾å¿ãã¦ããå ´åã¯UTF-8ã¸ã®å¤æã¯ä¸è¦ã§ãã</pre><br/><span class='lineno'>00593</span><pre class='pre'>			$telop_text = $cre_str;</pre><br/><span class='lineno'>00594</span><pre class='pre'>		}</pre><br/><span class='lineno'>00595</span><pre class='pre'>		else</pre><br/><span class='lineno'>00596</span><pre class='pre'>		{</pre><br/><span class='lineno'>00597</span><pre class='pre'>			// çµè¾¼ã¿ãã­ã¹ã</pre><br/><span class='lineno'>00598</span><pre class='pre'>			// GDãå¯¾å¿ãã¦ããªãå ´åã¯UTF-8ã¸å¤æãã¾ããï¼UTF-8ã«å¤æããªãå ´åãæå­åããã¾ããï¼</pre><br/><span class='lineno'>00599</span><pre class='pre'>			$telop_text =  mb_convert_encoding($cre_str, &quot;UTF-8&quot;, &quot;auto&quot;);</pre><br/><span class='lineno'>00600</span><pre class='pre'>		}</pre><br/><span class='lineno'>00601</span><pre class='pre'>		$telop_texts = explode('=_=',$telop_text);</pre><br/><span class='lineno'>00602</span><pre class='pre'>		//yupengbo add 20101208 start</pre><br/><span class='lineno'>00603</span><pre class='pre'>		$str_len = count($telop_texts);</pre><br/><span class='lineno'>00604</span><pre class='pre'>		if(strlen($telop_texts[0])&gt;0 &amp;&amp; count($telop_texts) &gt;=2 &amp;&amp; strlen($telop_texts[1])&gt;0)</pre><br/><span class='lineno'>00605</span><pre class='pre'>		{</pre><br/><span class='lineno'>00606</span><pre class='pre'>			for($i=2;$i&gt;0;$i--)</pre><br/><span class='lineno'>00607</span><pre class='pre'>			{</pre><br/><span class='lineno'>00608</span><pre class='pre'>				// åéæã®ã°ã¬ã¼ããã¯è¡¨ç¤ºä½ç½®</pre><br/><span class='lineno'>00609</span><pre class='pre'>				$alpha_x1 = 0;</pre><br/><span class='lineno'>00610</span><pre class='pre'>				$alpha_x2 = $width_i;</pre><br/><span class='lineno'>00611</span><pre class='pre'></pre><br/><span class='lineno'>00612</span><pre class='pre'>				$alpha_y1 = $height_i - ($fsize + 10) + 4;</pre><br/><span class='lineno'>00613</span><pre class='pre'>				$alpha_y2 = $height_i;</pre><br/><span class='lineno'>00614</span><pre class='pre'></pre><br/><span class='lineno'>00615</span><pre class='pre'>				if($i==2) {</pre><br/><span class='lineno'>00616</span><pre class='pre'>				    $alpha_y1 = $height_i - ($fsize * 2) - 10;</pre><br/><span class='lineno'>00617</span><pre class='pre'>				    $alpha_y2 = $height_i;</pre><br/><span class='lineno'>00618</span><pre class='pre'>				}</pre><br/><span class='lineno'>00619</span><pre class='pre'></pre><br/><span class='lineno'>00620</span><pre class='pre'>				// ã¯ã¬ã¸ããæ¸ãè¾¼ã¿ä½ç½®</pre><br/><span class='lineno'>00621</span><pre class='pre'>				$tx = $alpha_x1 + 5;</pre><br/><span class='lineno'>00622</span><pre class='pre'>				$ty = $alpha_y1 + $fsize + 2;</pre><br/><span class='lineno'>00623</span><pre class='pre'></pre><br/><span class='lineno'>00624</span><pre class='pre'>				// ãã­ã¹ãã«ã©ã¼ï¼é»ï¼</pre><br/><span class='lineno'>00625</span><pre class='pre'>				$font_color_b = ImageColorAllocate ($img, 0, 0, 0);</pre><br/><span class='lineno'>00626</span><pre class='pre'>				// ãã­ã¹ãã«ã©ã¼ï¼ç½ï¼</pre><br/><span class='lineno'>00627</span><pre class='pre'>				$font_color_w = ImageColorAllocate ($img, 255, 255, 255);</pre><br/><span class='lineno'>00628</span><pre class='pre'>				// ã¢ã«ãã¡ãã£ã³ãã«ï¼ã°ã¬ã¼ï¼</pre><br/><span class='lineno'>00629</span><pre class='pre'>				if($i==2) $alpha = imagecolorallocatealpha($img, 0, 0, 0, 70);</pre><br/><span class='lineno'>00630</span><pre class='pre'>				if($i==1) $alpha = imagecolorallocatealpha($img, 0, 0, 0, 127);</pre><br/><span class='lineno'>00631</span><pre class='pre'></pre><br/><span class='lineno'>00632</span><pre class='pre'>				// ç»åã®ä¸é¨ãéããã¤ã¡ã¼ã¸ã«ãã¾ãã</pre><br/><span class='lineno'>00633</span><pre class='pre'>				imagefilledrectangle ($img , $alpha_x1 , $alpha_y1, $alpha_x2, $alpha_y2, $alpha);</pre><br/><span class='lineno'>00634</span><pre class='pre'></pre><br/><span class='lineno'>00635</span><pre class='pre'>				if($i==2) $tmp_telop_text = mb_substr($telop_texts[0],0,42,&quot;utf-8&quot;);</pre><br/><span class='lineno'>00636</span><pre class='pre'>				if($i==1) $tmp_telop_text = mb_substr($telop_texts[1],0,42,&quot;utf-8&quot;);</pre><br/><span class='lineno'>00637</span><pre class='pre'>				//ãã­ã¹ãæç»</pre><br/><span class='lineno'>00638</span><pre class='pre'>				ImageTTFText($img, $fsize, $font_angle, $tx, $ty, $font_color_w, $this-&gt;font_name, $tmp_telop_text);</pre><br/><span class='lineno'>00639</span><pre class='pre'>				ImageTTFText($img, $fsize, $font_angle, $tx, $ty, $font_color_w, $this-&gt;font_name, $tmp_telop_text);</pre><br/><span class='lineno'>00640</span><pre class='pre'>			}</pre><br/><span class='lineno'>00641</span><pre class='pre'>			  //wangtongchao 2011/08/23 change start tianjiaif()puanduan</pre><br/><span class='lineno'>00642</span><pre class='pre'>		} elseif($telop_text!='=_=') {</pre><br/><span class='lineno'>00643</span><pre class='pre'>			  //wangtongchao 2011/08/23 change end</pre><br/><span class='lineno'>00644</span><pre class='pre'>		//yupengbo add 20101208 end</pre><br/><span class='lineno'>00645</span><pre class='pre'>			// åéæã®ã°ã¬ã¼ããã¯è¡¨ç¤ºä½ç½®</pre><br/><span class='lineno'>00646</span><pre class='pre'>			$telop_text = str_replace(&quot;=_=&quot;,&quot;&quot;,$telop_text);</pre><br/><span class='lineno'>00647</span><pre class='pre'>			$alpha_x1 = 0;</pre><br/><span class='lineno'>00648</span><pre class='pre'>			$alpha_x2 = $width_i;</pre><br/><span class='lineno'>00649</span><pre class='pre'></pre><br/><span class='lineno'>00650</span><pre class='pre'>			$alpha_y1 = $height_i - ($fsize + 10) + 4;</pre><br/><span class='lineno'>00651</span><pre class='pre'>			$alpha_y2 = $height_i;</pre><br/><span class='lineno'>00652</span><pre class='pre'></pre><br/><span class='lineno'>00653</span><pre class='pre'>			// ã¯ã¬ã¸ããæ¸ãè¾¼ã¿ä½ç½®</pre><br/><span class='lineno'>00654</span><pre class='pre'>			$tx = $alpha_x1 + 5;</pre><br/><span class='lineno'>00655</span><pre class='pre'>			$ty = $alpha_y1 + $fsize + 2;</pre><br/><span class='lineno'>00656</span><pre class='pre'></pre><br/><span class='lineno'>00657</span><pre class='pre'>			// ãã­ã¹ãã«ã©ã¼ï¼é»ï¼</pre><br/><span class='lineno'>00658</span><pre class='pre'>			$font_color_b = ImageColorAllocate ($img, 0, 0, 0);</pre><br/><span class='lineno'>00659</span><pre class='pre'>			// ãã­ã¹ãã«ã©ã¼ï¼ç½ï¼</pre><br/><span class='lineno'>00660</span><pre class='pre'>			$font_color_w = ImageColorAllocate ($img, 255, 255, 255);</pre><br/><span class='lineno'>00661</span><pre class='pre'>			// ã¢ã«ãã¡ãã£ã³ãã«ï¼ã°ã¬ã¼ï¼</pre><br/><span class='lineno'>00662</span><pre class='pre'>			$alpha = imagecolorallocatealpha($img, 0, 0, 0, 70);</pre><br/><span class='lineno'>00663</span><pre class='pre'></pre><br/><span class='lineno'>00664</span><pre class='pre'>			// ç»åã®ä¸é¨ãéããã¤ã¡ã¼ã¸ã«ãã¾ãã</pre><br/><span class='lineno'>00665</span><pre class='pre'>			imagefilledrectangle ($img , $alpha_x1 , $alpha_y1, $alpha_x2, $alpha_y2, $alpha);</pre><br/><span class='lineno'>00666</span><pre class='pre'></pre><br/><span class='lineno'>00667</span><pre class='pre'>			//ãã­ã¹ãæç»</pre><br/><span class='lineno'>00668</span><pre class='pre'>			//ImageTTFText($img, $font_size, $font_angle, $tx+2 , $ty+2, $font_color_b, $this-&gt;font_name, $telop_text);</pre><br/><span class='lineno'>00669</span><pre class='pre'>			//ImageTTFText($img, $font_size, $font_angle, $tx+2 , $ty+2, $font_color_b, $this-&gt;font_name, $telop_text);</pre><br/><span class='lineno'>00670</span><pre class='pre'>			ImageTTFText($img, $fsize, $font_angle, $tx, $ty, $font_color_w, $this-&gt;font_name, $telop_text);</pre><br/><span class='lineno'>00671</span><pre class='pre'>			ImageTTFText($img, $fsize, $font_angle, $tx, $ty, $font_color_w, $this-&gt;font_name, $telop_text);</pre><br/><span class='lineno'>00672</span><pre class='pre'>		}</pre><br/><span class='lineno'>00673</span><pre class='pre'>		return $img;</pre><br/><span class='lineno'>00674</span><pre class='pre'>	}</pre><br/><span class='lineno'>00675</span><pre class='pre'></pre><br/><span class='lineno'>00676</span><pre class='pre'>	/**</pre><br/><span class='lineno'>00677</span><pre class='pre'>	 * ãã¡ã¤ã«ãã¢ããã­ã¼ããã¾ãã</pre><br/><span class='lineno'>00678</span><pre class='pre'>	 */</pre><br/><span class='lineno'>00679</span><pre class='pre'>	function upload()</pre><br/><span class='lineno'>00680</span><pre class='pre'>	{</pre><br/><span class='lineno'>00681</span><pre class='pre'>		// ãã§ãã¯ã§ã¨ã©ã¼ãçºçãã¦ããå ´åã¯ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>00682</span><pre class='pre'>		if ($this-&gt;result == false)</pre><br/><span class='lineno'>00683</span><pre class='pre'>		{</pre><br/><span class='lineno'>00684</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00685</span><pre class='pre'>		}</pre><br/><span class='lineno'>00686</span><pre class='pre'></pre><br/><span class='lineno'>00687</span><pre class='pre'>		// ä¿å­ç¨ãã¡ã¤ã«åãYmdHis999.xxxï¼åãæ¡å¼µå­ï¼ã§çæãã¾ãã</pre><br/><span class='lineno'>00688</span><pre class='pre'>		$reg_time = time();												// ç»é²æ¥æ</pre><br/><span class='lineno'>00689</span><pre class='pre'>		$rnd = rand(100, 999);											// ä¹±æ°100-999</pre><br/><span class='lineno'>00690</span><pre class='pre'>		$this-&gt;dirno = rand(0, 9);											// ãã£ã¬ã¯ããªåï¼0-9ï¼ãã©ã³ãã ã§æ±ºå®ãã¾ãã</pre><br/><span class='lineno'>00691</span><pre class='pre'>		$this-&gt;dirno .= &quot;/&quot;;</pre><br/><span class='lineno'>00692</span><pre class='pre'>		$this-&gt;svname = date(&quot;YmdHis&quot;, $reg_time) . $rnd;				// ä¿å­ãã¡ã¤ã«åï¼åï¼</pre><br/><span class='lineno'>00693</span><pre class='pre'></pre><br/><span class='lineno'>00694</span><pre class='pre'>		// ç»åãã¼ã¿ãåå¾ãã¾ããï¼ãã¼ã¿ãã¼ã¹ä¿å­ç¨ã®ã¤ã¡ã¼ã¸ï¼</pre><br/><span class='lineno'>00695</span><pre class='pre'>		// $imgdat = file_get_contents($this-&gt;file['tmp_name']);</pre><br/><span class='lineno'>00696</span><pre class='pre'></pre><br/><span class='lineno'>00697</span><pre class='pre'>		// ä¸æ¦ããã³ãã©ãªã¼ã«ã¢ãããããã¡ã¤ã«ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>00698</span><pre class='pre'>		$tmppath = $this-&gt;uploadconf['temp_dir'].$this-&gt;svname. $this-&gt;ext;</pre><br/><span class='lineno'>00699</span><pre class='pre'>		if (move_uploaded_file($this-&gt;file['tmp_name'], $tmppath) == true)</pre><br/><span class='lineno'>00700</span><pre class='pre'>		{</pre><br/><span class='lineno'>00701</span><pre class='pre'>			// ä¿å­ãããã¡ã¤ã«ã®ã¿ã¤ããåå¾ãã¾ãã</pre><br/><span class='lineno'>00702</span><pre class='pre'>			$type = exif_imagetype($this-&gt;uploadconf['temp_dir'].$this-&gt;svname . $this-&gt;ext);</pre><br/><span class='lineno'>00703</span><pre class='pre'>			if ($type == IMAGETYPE_GIF || $type == IMAGETYPE_JPEG || $type == IMAGETYPE_PNG)</pre><br/><span class='lineno'>00704</span><pre class='pre'>			{</pre><br/><span class='lineno'>00705</span><pre class='pre'>				// ãã¡ã¤ã«ã¿ã¤ããGIFãJPEGãPNGã ã£ãå ´åã¯ãã³ãã©ãªã¼&rarr;ã¢ããã­ã¼ããã£ã¬ã¯ããªã«ãã¡ã¤ã«ãç§»åãã¾ãã</pre><br/><span class='lineno'>00706</span><pre class='pre'>				$this-&gt;svfullpath = array();</pre><br/><span class='lineno'>00707</span><pre class='pre'>				$this-&gt;svfullpath[] = $this-&gt;uploadconf['dir']. $this-&gt;dirno . $this-&gt;svname . $this-&gt;ext;</pre><br/><span class='lineno'>00708</span><pre class='pre'>				rename($tmppath, $this-&gt;svfullpath[0]);</pre><br/><span class='lineno'>00709</span><pre class='pre'></pre><br/><span class='lineno'>00710</span><pre class='pre'>				// ç»åã®ãµã¤ãºãåå¾ãã¾ãã</pre><br/><span class='lineno'>00711</span><pre class='pre'>				$this-&gt;img_width = array();</pre><br/><span class='lineno'>00712</span><pre class='pre'>				$this-&gt;img_height = array();</pre><br/><span class='lineno'>00713</span><pre class='pre'>				$size = @getimagesize($this-&gt;svfullpath[0]);</pre><br/><span class='lineno'>00714</span><pre class='pre'>				list($width, $height, $type, $attr) = $size;</pre><br/><span class='lineno'>00715</span><pre class='pre'>				$this-&gt;img_width[] = $width;</pre><br/><span class='lineno'>00716</span><pre class='pre'>				$this-&gt;img_height[] = $height;</pre><br/><span class='lineno'>00717</span><pre class='pre'></pre><br/><span class='lineno'>00718</span><pre class='pre'>				// ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>00719</span><pre class='pre'>				/*</pre><br/><span class='lineno'>00720</span><pre class='pre'>				if (!empty($this-&gt;credit))</pre><br/><span class='lineno'>00721</span><pre class='pre'>				{</pre><br/><span class='lineno'>00722</span><pre class='pre'>					// ç»åãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>00723</span><pre class='pre'>					$image = imagecreatefromjpeg($this-&gt;svfullpath[0]);</pre><br/><span class='lineno'>00724</span><pre class='pre'></pre><br/><span class='lineno'>00725</span><pre class='pre'>					// ã¯ã¬ã¸ããæ¸è¾¼ç¨ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>00726</span><pre class='pre'>					$font_size = 6+(int)($width/80);</pre><br/><span class='lineno'>00727</span><pre class='pre'>					if ($font_size &gt;= 40)</pre><br/><span class='lineno'>00728</span><pre class='pre'>					{</pre><br/><span class='lineno'>00729</span><pre class='pre'>						$font_size=40;</pre><br/><span class='lineno'>00730</span><pre class='pre'>					}</pre><br/><span class='lineno'>00731</span><pre class='pre'></pre><br/><span class='lineno'>00732</span><pre class='pre'>					// ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>00733</span><pre class='pre'>					$this-&gt;write_credit($image, $this-&gt;credit, $font_size, $width, $height);</pre><br/><span class='lineno'>00734</span><pre class='pre'></pre><br/><span class='lineno'>00735</span><pre class='pre'>					imageJPEG($image, $this-&gt;svfullpath[0], 100);</pre><br/><span class='lineno'>00736</span><pre class='pre'>					imagedestroy($image);</pre><br/><span class='lineno'>00737</span><pre class='pre'>				}</pre><br/><span class='lineno'>00738</span><pre class='pre'>				*/</pre><br/><span class='lineno'>00739</span><pre class='pre'></pre><br/><span class='lineno'>00740</span><pre class='pre'>				// ã¢ããã­ã¼ãããããã¡ã¤ã«åãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>00741</span><pre class='pre'>				$this-&gt;up_url = array();</pre><br/><span class='lineno'>00742</span><pre class='pre'>				$this-&gt;up_url[] = $this-&gt;uploadconf['site_url'] . $this-&gt;svfullpath[0];</pre><br/><span class='lineno'>00743</span><pre class='pre'>			}</pre><br/><span class='lineno'>00744</span><pre class='pre'>			else</pre><br/><span class='lineno'>00745</span><pre class='pre'>			{</pre><br/><span class='lineno'>00746</span><pre class='pre'>				// ãã¡ã¤ã«ã¿ã¤ããããä»¥å¤ã®å ´åã¯ãã®ãã¡ã¤ã«ãåé¤ãã¾ãã</pre><br/><span class='lineno'>00747</span><pre class='pre'>				unlink($tmppath);</pre><br/><span class='lineno'>00748</span><pre class='pre'>				$this-&gt;result = false;</pre><br/><span class='lineno'>00749</span><pre class='pre'>				$this-&gt;message = &quot;ã¢ããã­ã¼ããããã¡ã¤ã«ã¿ã¤ããjpg,gif,pngä»¥å¤ã§ãã&quot;;</pre><br/><span class='lineno'>00750</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00751</span><pre class='pre'>			}</pre><br/><span class='lineno'>00752</span><pre class='pre'>		}</pre><br/><span class='lineno'>00753</span><pre class='pre'>		else</pre><br/><span class='lineno'>00754</span><pre class='pre'>		{</pre><br/><span class='lineno'>00755</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00756</span><pre class='pre'>			$this-&gt;message = &quot;ãã¡ã¤ã«ã®ã¢ããã­ã¼ãã«å¤±æãã¾ãããï¼move_upload_fileã¨ã©ã¼)&quot;;</pre><br/><span class='lineno'>00757</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00758</span><pre class='pre'>		}</pre><br/><span class='lineno'>00759</span><pre class='pre'>	}</pre><br/><span class='lineno'>00760</span><pre class='pre'></pre><br/><span class='lineno'>00761</span><pre class='pre'>	/**</pre><br/><span class='lineno'>00762</span><pre class='pre'>	 * ã¢ããã­ã¼ããããã¡ã¤ã«ãå¨ã¦åé¤ãã¾ãã</pre><br/><span class='lineno'>00763</span><pre class='pre'>	 */</pre><br/><span class='lineno'>00764</span><pre class='pre'>	function delete_upfile()</pre><br/><span class='lineno'>00765</span><pre class='pre'>	{</pre><br/><span class='lineno'>00766</span><pre class='pre'>		$ed = count($this-&gt;svfullpath);</pre><br/><span class='lineno'>00767</span><pre class='pre'>		for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>00768</span><pre class='pre'>		{</pre><br/><span class='lineno'>00769</span><pre class='pre'>			if (!empty($this-&gt;svfullpath[$i]))</pre><br/><span class='lineno'>00770</span><pre class='pre'>			{</pre><br/><span class='lineno'>00771</span><pre class='pre'>				unlink($this-&gt;svfullpath[$i]);</pre><br/><span class='lineno'>00772</span><pre class='pre'>			}</pre><br/><span class='lineno'>00773</span><pre class='pre'>		}</pre><br/><span class='lineno'>00774</span><pre class='pre'>	}</pre><br/><span class='lineno'>00775</span><pre class='pre'></pre><br/><span class='lineno'>00776</span><pre class='pre'>	/**</pre><br/><span class='lineno'>00777</span><pre class='pre'>	 * ã¯ã¬ã¸ããæ¸ãè¾¼ã¿ç¨ã®ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>00778</span><pre class='pre'>	 */</pre><br/><span class='lineno'>00779</span><pre class='pre'>	private function decide_fontsize($thwidth)</pre><br/><span class='lineno'>00780</span><pre class='pre'>	{</pre><br/><span class='lineno'>00781</span><pre class='pre'>		global $credit_fontsize;</pre><br/><span class='lineno'>00782</span><pre class='pre'></pre><br/><span class='lineno'>00783</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸è¾¼ç¨ãã©ã³ããµã¤ãºãè¨­å®ããã¦ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00784</span><pre class='pre'>		if (count($credit_fontsize)&lt;6)</pre><br/><span class='lineno'>00785</span><pre class='pre'>		{</pre><br/><span class='lineno'>00786</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00787</span><pre class='pre'>			$this-&gt;message = &quot;ã¯ã¬ã¸ããæ¸è¾¼ç¨ãã©ã³ããµã¤ãºãæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00788</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00789</span><pre class='pre'>		}</pre><br/><span class='lineno'>00790</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸è¾¼ç¨ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>00791</span><pre class='pre'>		if ($thwidth &lt;= 160)</pre><br/><span class='lineno'>00792</span><pre class='pre'>		{</pre><br/><span class='lineno'>00793</span><pre class='pre'>			$font_size = $credit_fontsize[0];</pre><br/><span class='lineno'>00794</span><pre class='pre'>		}</pre><br/><span class='lineno'>00795</span><pre class='pre'>		else if ($thwidth &lt;= 320)</pre><br/><span class='lineno'>00796</span><pre class='pre'>		{</pre><br/><span class='lineno'>00797</span><pre class='pre'>			$font_size = $credit_fontsize[1];</pre><br/><span class='lineno'>00798</span><pre class='pre'>		}</pre><br/><span class='lineno'>00799</span><pre class='pre'>		else if ($thwidth &lt;= 480)</pre><br/><span class='lineno'>00800</span><pre class='pre'>		{</pre><br/><span class='lineno'>00801</span><pre class='pre'>			$font_size = $credit_fontsize[2];</pre><br/><span class='lineno'>00802</span><pre class='pre'>		}</pre><br/><span class='lineno'>00803</span><pre class='pre'>		else if ($thwidth &lt;= 640)</pre><br/><span class='lineno'>00804</span><pre class='pre'>		{</pre><br/><span class='lineno'>00805</span><pre class='pre'>			$font_size = $credit_fontsize[3];</pre><br/><span class='lineno'>00806</span><pre class='pre'>		}</pre><br/><span class='lineno'>00807</span><pre class='pre'>		else if ($thwidth &lt;= 800)</pre><br/><span class='lineno'>00808</span><pre class='pre'>		{</pre><br/><span class='lineno'>00809</span><pre class='pre'>			$font_size = $credit_fontsize[4];</pre><br/><span class='lineno'>00810</span><pre class='pre'>		}</pre><br/><span class='lineno'>00811</span><pre class='pre'>		else</pre><br/><span class='lineno'>00812</span><pre class='pre'>		{</pre><br/><span class='lineno'>00813</span><pre class='pre'>			$font_size = $credit_fontsize[5];</pre><br/><span class='lineno'>00814</span><pre class='pre'>		}</pre><br/><span class='lineno'>00815</span><pre class='pre'></pre><br/><span class='lineno'>00816</span><pre class='pre'>		return $font_size;</pre><br/><span class='lineno'>00817</span><pre class='pre'>	}</pre><br/><span class='lineno'>00818</span><pre class='pre'></pre><br/><span class='lineno'>00819</span><pre class='pre'></pre><br/><span class='lineno'>00820</span><pre class='pre'>    /**</pre><br/><span class='lineno'>00821</span><pre class='pre'>     * è·åå­ç¬¦ä¸²ä¸­çæ°å­</pre><br/><span class='lineno'>00822</span><pre class='pre'>     *</pre><br/><span class='lineno'>00823</span><pre class='pre'>     * @param string $str</pre><br/><span class='lineno'>00824</span><pre class='pre'>     *            åå­ç¬¦ä¸²</pre><br/><span class='lineno'>00825</span><pre class='pre'>     * @return string $result</pre><br/><span class='lineno'>00826</span><pre class='pre'>     *            ä»å«æ°å­çå­ç¬¦ä¸²</pre><br/><span class='lineno'>00827</span><pre class='pre'>     */</pre><br/><span class='lineno'>00828</span><pre class='pre'>    function findNum($str = '')</pre><br/><span class='lineno'>00829</span><pre class='pre'>    {</pre><br/><span class='lineno'>00830</span><pre class='pre'>        $str = trim($str);</pre><br/><span class='lineno'>00831</span><pre class='pre'>        if (empty($str)) {</pre><br/><span class='lineno'>00832</span><pre class='pre'>            return '';</pre><br/><span class='lineno'>00833</span><pre class='pre'>        }</pre><br/><span class='lineno'>00834</span><pre class='pre'>        $result = '';</pre><br/><span class='lineno'>00835</span><pre class='pre'>        for ($i = 0; $i &lt; strlen($str); $i ++) {</pre><br/><span class='lineno'>00836</span><pre class='pre'>            if (is_numeric($str[$i])) {</pre><br/><span class='lineno'>00837</span><pre class='pre'>                $result .= $str[$i];</pre><br/><span class='lineno'>00838</span><pre class='pre'>            }</pre><br/><span class='lineno'>00839</span><pre class='pre'>        }</pre><br/><span class='lineno'>00840</span><pre class='pre'>        return $result;</pre><br/><span class='lineno'>00841</span><pre class='pre'>    }</pre><br/><span class='lineno'>00842</span><pre class='pre'>	/**</pre><br/><span class='lineno'>00843</span><pre class='pre'>	 * ãµã ãã¤ã«ãä½æãã¾ãã</pre><br/><span class='lineno'>00844</span><pre class='pre'>	 *  åãã¡ã¤ã«ã¨ç¸¦ã»æ¨ªåãæ¯çã§ä½æãã¾ãã</pre><br/><span class='lineno'>00845</span><pre class='pre'>	 *    â» bmpã¯GDé¢æ°ç¡ãããä½æã§ãã¾ããã</pre><br/><span class='lineno'>00846</span><pre class='pre'>	 */</pre><br/><span class='lineno'>00847</span><pre class='pre'>	function make_thumbfile()</pre><br/><span class='lineno'>00848</span><pre class='pre'>	{</pre><br/><span class='lineno'>00849</span><pre class='pre'>		// ãã§ãã¯ã§ã¨ã©ã¼ãçºçãã¦ããå ´åã¯ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>00850</span><pre class='pre'>		if ($this-&gt;result == false)</pre><br/><span class='lineno'>00851</span><pre class='pre'>		{</pre><br/><span class='lineno'>00852</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00853</span><pre class='pre'>		}</pre><br/><span class='lineno'>00854</span><pre class='pre'></pre><br/><span class='lineno'>00855</span><pre class='pre'>		// ãµã ãã¤ã«ãä½æããã¨ãã®åãã¡ã¤ã«ãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>00856</span><pre class='pre'>		$srcfilename = &quot;&quot;;</pre><br/><span class='lineno'>00857</span><pre class='pre'>		if (!empty($this-&gt;svfullpath[0]))</pre><br/><span class='lineno'>00858</span><pre class='pre'>		{</pre><br/><span class='lineno'>00859</span><pre class='pre'>			$srcfilename = $this-&gt;svfullpath[0];</pre><br/><span class='lineno'>00860</span><pre class='pre'>		}</pre><br/><span class='lineno'>00861</span><pre class='pre'>		else</pre><br/><span class='lineno'>00862</span><pre class='pre'>		{</pre><br/><span class='lineno'>00863</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00864</span><pre class='pre'>			$this-&gt;message = &quot;ãµã ãã¤ã«ãä½æããåãã¡ã¤ã«ãæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00865</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00866</span><pre class='pre'>		}</pre><br/><span class='lineno'>00867</span><pre class='pre'></pre><br/><span class='lineno'>00868</span><pre class='pre'>		// ãµã ãã¤ã«ãä½æããã¨ãã®æ¨ªå¹ãè¨­å®ããã¦ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00869</span><pre class='pre'>		if (empty($this-&gt;flwidth))</pre><br/><span class='lineno'>00870</span><pre class='pre'>		{</pre><br/><span class='lineno'>00871</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00872</span><pre class='pre'>			$this-&gt;message = &quot;ãµã ãã¤ã«ãä½æããã¨ãã®æ¨ªå¹ãæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00873</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00874</span><pre class='pre'>		}</pre><br/><span class='lineno'>00875</span><pre class='pre'></pre><br/><span class='lineno'>00876</span><pre class='pre'>		// ãµã ãã¤ã«ãä½æãããã©ã«ããè¨­å®ããã¦ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00877</span><pre class='pre'>		if (empty($this-&gt;thumbdir))</pre><br/><span class='lineno'>00878</span><pre class='pre'>		{</pre><br/><span class='lineno'>00879</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00880</span><pre class='pre'>			$this-&gt;message = &quot;ãµã ãã¤ã«ãä½æãããã©ã«ããæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00881</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00882</span><pre class='pre'>		}</pre><br/><span class='lineno'>00883</span><pre class='pre'></pre><br/><span class='lineno'>00884</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸è¾¼ç¨ãã©ã³ãåãè¨­å®ããã¦ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00885</span><pre class='pre'>		if (empty($this-&gt;font_name))</pre><br/><span class='lineno'>00886</span><pre class='pre'>		{</pre><br/><span class='lineno'>00887</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00888</span><pre class='pre'>			$this-&gt;message = &quot;ã¯ã¬ã¸ããæ¸è¾¼ç¨ãã©ã³ãåãæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00889</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00890</span><pre class='pre'>		}</pre><br/><span class='lineno'>00891</span><pre class='pre'></pre><br/><span class='lineno'>00892</span><pre class='pre'>		// ã¯ã¬ã¸ãããæ¸ãè¾¼ããã©ãããè¨­å®ããã¦ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>00893</span><pre class='pre'>		if (empty($this-&gt;write_ok))</pre><br/><span class='lineno'>00894</span><pre class='pre'>		{</pre><br/><span class='lineno'>00895</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00896</span><pre class='pre'>			$this-&gt;message = &quot;ã¯ã¬ã¸ãããæ¸ãè¾¼ããã©ãããæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>00897</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00898</span><pre class='pre'>		}</pre><br/><span class='lineno'>00899</span><pre class='pre'></pre><br/><span class='lineno'>00900</span><pre class='pre'>		// ç»åã®ãµã¤ãºãåå¾ãã¾ãã</pre><br/><span class='lineno'>00901</span><pre class='pre'>		$size = @getimagesize($srcfilename);</pre><br/><span class='lineno'>00902</span><pre class='pre'>		list($width, $height, $type, $attr) = $size;</pre><br/><span class='lineno'>00903</span><pre class='pre'>		// è¨­å®ããã¦ãããµã ãã¤ã«ã®ãµã¤ãºã¨ãã©ã«ãã®æ°ãæ¯è¼ãã¾ãã</pre><br/><span class='lineno'>00904</span><pre class='pre'>		$szmax = count($this-&gt;flwidth);</pre><br/><span class='lineno'>00905</span><pre class='pre'>		$dirmax = count($this-&gt;thumbdir);</pre><br/><span class='lineno'>00906</span><pre class='pre'>		if ($dirmax &lt; $szmax)</pre><br/><span class='lineno'>00907</span><pre class='pre'>		{</pre><br/><span class='lineno'>00908</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>00909</span><pre class='pre'>			$this-&gt;message = &quot;ãµã ãã¤ã«ãä¿å­ãããã©ã«ãã®æ°ãè¶³ãã¾ããã&quot;;</pre><br/><span class='lineno'>00910</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>00911</span><pre class='pre'>		}</pre><br/><span class='lineno'>00912</span><pre class='pre'></pre><br/><span class='lineno'>00913</span><pre class='pre'>		// ãµã ãã¤ã«ãä½æããã¨ãã®æ¨ªå¹ãè¨­å®ããã¦ããåã ãããµã ãã¤ã«ãä½æãã¾ãã</pre><br/><span class='lineno'>00914</span><pre class='pre'>		for ($i = 0 ; $i &lt; $szmax ; $i++)</pre><br/><span class='lineno'>00915</span><pre class='pre'>		{</pre><br/><span class='lineno'>00916</span><pre class='pre'>			if((int)$i == 3 || (int)$i == 2 || (int)$i == 5)</pre><br/><span class='lineno'>00917</span><pre class='pre'>			{</pre><br/><span class='lineno'>00918</span><pre class='pre'>				//thumb4</pre><br/><span class='lineno'>00919</span><pre class='pre'>				if((int)$i == 3)</pre><br/><span class='lineno'>00920</span><pre class='pre'>				{</pre><br/><span class='lineno'>00921</span><pre class='pre'>					$photo_filename_th1 = $this-&gt;up_url[1];</pre><br/><span class='lineno'>00922</span><pre class='pre'>					$tmp = substr($photo_filename_th1,strpos($photo_filename_th1,&quot;./&quot;));</pre><br/><span class='lineno'>00923</span><pre class='pre'>					$tmp1 = str_replace(&quot;th1&quot;,&quot;th4&quot;,$tmp);</pre><br/><span class='lineno'>00924</span><pre class='pre'>					$tmp2 = str_replace(&quot;thumb1&quot;,&quot;thumb4&quot;,$tmp1);</pre><br/><span class='lineno'>00925</span><pre class='pre'>				} elseif((int)$i == 2) {//thumb3</pre><br/><span class='lineno'>00926</span><pre class='pre'>					$photo_filename_th2 = $this-&gt;up_url[2];</pre><br/><span class='lineno'>00927</span><pre class='pre'>					$tmp = substr($photo_filename_th2,strpos($photo_filename_th2,&quot;./&quot;));</pre><br/><span class='lineno'>00928</span><pre class='pre'>					$tmp1 = str_replace(&quot;th2&quot;,&quot;th3&quot;,$tmp);</pre><br/><span class='lineno'>00929</span><pre class='pre'>					$tmp2 = str_replace(&quot;thumb2&quot;,&quot;thumb3&quot;,$tmp1);</pre><br/><span class='lineno'>00930</span><pre class='pre'>				}</pre><br/><span class='lineno'>00931</span><pre class='pre'>				elseif((int)$i == 5) {//thumb6</pre><br/><span class='lineno'>00932</span><pre class='pre'>				    $photo_filename_th5 = $this-&gt;up_url[5];</pre><br/><span class='lineno'>00933</span><pre class='pre'>				    $tmp = substr($photo_filename_th5,strpos($photo_filename_th5,&quot;./&quot;));</pre><br/><span class='lineno'>00934</span><pre class='pre'>				    $tmp1 = str_replace(&quot;th5&quot;,&quot;th6&quot;,$tmp);</pre><br/><span class='lineno'>00935</span><pre class='pre'>				    $tmp2 = str_replace(&quot;thumb5&quot;,&quot;thumb6&quot;,$tmp1);</pre><br/><span class='lineno'>00936</span><pre class='pre'>				}</pre><br/><span class='lineno'>00937</span><pre class='pre'></pre><br/><span class='lineno'>00938</span><pre class='pre'>				$size = @getimagesize($tmp);</pre><br/><span class='lineno'>00939</span><pre class='pre'>				list($width, $height, $type, $attr) = $size;</pre><br/><span class='lineno'>00940</span><pre class='pre'></pre><br/><span class='lineno'>00941</span><pre class='pre'>				// ç¸¦ã»æ¨ªã®æ¯çãåããã¦ããµã ãã¤ã«ç¨ã®ç¸¦ãæ¨ªãè¨ç®ãã¾ãã</pre><br/><span class='lineno'>00942</span><pre class='pre'>				$thumb_width = $this-&gt;flwidth[$i];</pre><br/><span class='lineno'>00943</span><pre class='pre'>				if($thumb_width == 0 || (int)$width &lt; $thumb_width)</pre><br/><span class='lineno'>00944</span><pre class='pre'>				{</pre><br/><span class='lineno'>00945</span><pre class='pre'>					$thumb_width = $width;</pre><br/><span class='lineno'>00946</span><pre class='pre'>				}</pre><br/><span class='lineno'>00947</span><pre class='pre'>				$thumb_height = ($thumb_width / $width) * $height;</pre><br/><span class='lineno'>00948</span><pre class='pre'>				// ç»åãµã¤ãºãã»ãããã¾ãã</pre><br/><span class='lineno'>00949</span><pre class='pre'>				$this-&gt;img_width[] = $thumb_width;</pre><br/><span class='lineno'>00950</span><pre class='pre'>				$this-&gt;img_height[] = $thumb_height;</pre><br/><span class='lineno'>00951</span><pre class='pre'>				// ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>00952</span><pre class='pre'>				if((int)$i == 3)</pre><br/><span class='lineno'>00953</span><pre class='pre'>				{</pre><br/><span class='lineno'>00954</span><pre class='pre'>					if($width == 400)</pre><br/><span class='lineno'>00955</span><pre class='pre'>					{</pre><br/><span class='lineno'>00956</span><pre class='pre'>						$font_size = 88;</pre><br/><span class='lineno'>00957</span><pre class='pre'>					} elseif($width == 800) {</pre><br/><span class='lineno'>00958</span><pre class='pre'>						$font_size = 168;</pre><br/><span class='lineno'>00959</span><pre class='pre'>					} elseif($width == 200) {</pre><br/><span class='lineno'>00960</span><pre class='pre'>						$font_size = 38;</pre><br/><span class='lineno'>00961</span><pre class='pre'>					}</pre><br/><span class='lineno'>00962</span><pre class='pre'>				} elseif((int)$i == 2) {//thumb3</pre><br/><span class='lineno'>00963</span><pre class='pre'>					$font_size = 38;</pre><br/><span class='lineno'>00964</span><pre class='pre'>				}</pre><br/><span class='lineno'>00965</span><pre class='pre'>				elseif((int)$i == 5) {//thumb6</pre><br/><span class='lineno'>00966</span><pre class='pre'>				    $font_size = 168;</pre><br/><span class='lineno'>00967</span><pre class='pre'>				}</pre><br/><span class='lineno'>00968</span><pre class='pre'></pre><br/><span class='lineno'>00969</span><pre class='pre'>				// ç»åã®ã¿ã¤ãã«åããã¦ããµã ãã¤ã«ãä½æãã¾ãã</pre><br/><span class='lineno'>00970</span><pre class='pre'>				if ($type == IMAGETYPE_JPEG)</pre><br/><span class='lineno'>00971</span><pre class='pre'>				{</pre><br/><span class='lineno'>00972</span><pre class='pre'>					// ã¢ããã­ã¼ããããã¡ã¤ã«ãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>00973</span><pre class='pre'>					$ufimage = @ImageCreateFromJPEG($tmp);</pre><br/><span class='lineno'>00974</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åãä½æãã¾ãã</pre><br/><span class='lineno'>00975</span><pre class='pre'>					$thumb = @ImageCreateTrueColor($thumb_width, $thumb_height);</pre><br/><span class='lineno'>00976</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åã«ã¢ããã­ã¼ããããã¡ã¤ã«ãã³ãã¼ãã¾ãã</pre><br/><span class='lineno'>00977</span><pre class='pre'>					@imagecopyresampled($thumb, $ufimage, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);</pre><br/><span class='lineno'>00978</span><pre class='pre'>					// ç»åã«ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>00979</span><pre class='pre'>					$thumb = $this-&gt;write_credit2($thumb, &quot;SAMPLE&quot;, $font_size, $thumb_width, $thumb_height);</pre><br/><span class='lineno'>00980</span><pre class='pre'>					@imagejpeg($thumb, $tmp2);</pre><br/><span class='lineno'>00981</span><pre class='pre'>				}</pre><br/><span class='lineno'>00982</span><pre class='pre'>				else if ($type == IMAGETYPE_GIF)</pre><br/><span class='lineno'>00983</span><pre class='pre'>				{</pre><br/><span class='lineno'>00984</span><pre class='pre'>					// ã¢ããã­ã¼ããããã¡ã¤ã«ãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>00985</span><pre class='pre'>					$ufimage = @ImageCreateFromGIF($tmp);</pre><br/><span class='lineno'>00986</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åãä½æãã¾ãã</pre><br/><span class='lineno'>00987</span><pre class='pre'>					$thumb = @ImageCreateTrueColor($thumb_width, $thumb_height);</pre><br/><span class='lineno'>00988</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åã«ã¢ããã­ã¼ããããã¡ã¤ã«ãã³ãã¼ãã¾ãã</pre><br/><span class='lineno'>00989</span><pre class='pre'>					@imagecopyresampled($thumb, $ufimage, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);</pre><br/><span class='lineno'>00990</span><pre class='pre'>					// ç»åã«ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>00991</span><pre class='pre'>					$thumb = $this-&gt;write_credit2($thumb, &quot;SAMPLE&quot;, $font_size, $thumb_width, $thumb_height);</pre><br/><span class='lineno'>00992</span><pre class='pre'>					@imagegif($thumb, $tmp2);</pre><br/><span class='lineno'>00993</span><pre class='pre'>				}</pre><br/><span class='lineno'>00994</span><pre class='pre'>				else if ($type == IMAGETYPE_PNG)</pre><br/><span class='lineno'>00995</span><pre class='pre'>				{</pre><br/><span class='lineno'>00996</span><pre class='pre'>					// ã¢ããã­ã¼ããããã¡ã¤ã«ãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>00997</span><pre class='pre'>					$ufimage = @ImageCreateFromPNG($tmp);</pre><br/><span class='lineno'>00998</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åãä½æãã¾ãã</pre><br/><span class='lineno'>00999</span><pre class='pre'>					$thumb = @ImageCreateTrueColor($thumb_width, $thumb_height);</pre><br/><span class='lineno'>01000</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åã«ã¢ããã­ã¼ããããã¡ã¤ã«ãã³ãã¼ãã¾ãã</pre><br/><span class='lineno'>01001</span><pre class='pre'>					@imagecopyresampled($thumb, $ufimage, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);</pre><br/><span class='lineno'>01002</span><pre class='pre'>					// ç»åã«ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01003</span><pre class='pre'>					$thumb = $this-&gt;write_credit2($thumb, &quot;SAMPLE&quot;, $font_size, $thumb_width, $thumb_height);</pre><br/><span class='lineno'>01004</span><pre class='pre'>					@imagepng($thumb, $tmp2);</pre><br/><span class='lineno'>01005</span><pre class='pre'>				}</pre><br/><span class='lineno'>01006</span><pre class='pre'></pre><br/><span class='lineno'>01007</span><pre class='pre'>				// ã¢ããã­ã¼ãããããã¡ã¤ã«åãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01008</span><pre class='pre'>				$this-&gt;svfullpath[] = $tmp2;</pre><br/><span class='lineno'>01009</span><pre class='pre'>				$this-&gt;up_url[] = $this-&gt;uploadconf['site_url'] . $tmp2;</pre><br/><span class='lineno'>01010</span><pre class='pre'></pre><br/><span class='lineno'>01011</span><pre class='pre'>				// ç»åãç ´æ£ãã¾ãã</pre><br/><span class='lineno'>01012</span><pre class='pre'>				@imagedestroy($ufimage);</pre><br/><span class='lineno'>01013</span><pre class='pre'>				@imagedestroy($thumb);</pre><br/><span class='lineno'>01014</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>01015</span><pre class='pre'>			    // ç»åã®ãµã¤ãºãåå¾ãã¾ãã</pre><br/><span class='lineno'>01016</span><pre class='pre'>			    $size = @getimagesize($srcfilename);</pre><br/><span class='lineno'>01017</span><pre class='pre'>			    list($width, $height, $type, $attr) = $size;</pre><br/><span class='lineno'>01018</span><pre class='pre'></pre><br/><span class='lineno'>01019</span><pre class='pre'>				// ç¸¦ã»æ¨ªã®æ¯çãåããã¦ããµã ãã¤ã«ç¨ã®ç¸¦ãæ¨ªãè¨ç®ãã¾ãã</pre><br/><span class='lineno'>01020</span><pre class='pre'>				$thumb_width = $this-&gt;flwidth[$i];</pre><br/><span class='lineno'>01021</span><pre class='pre'>				if($thumb_width == 0 || (int)$width &lt; $thumb_width)</pre><br/><span class='lineno'>01022</span><pre class='pre'>				{</pre><br/><span class='lineno'>01023</span><pre class='pre'>					$thumb_width = $width;</pre><br/><span class='lineno'>01024</span><pre class='pre'>				}</pre><br/><span class='lineno'>01025</span><pre class='pre'></pre><br/><span class='lineno'>01026</span><pre class='pre'>				//thç¼å·</pre><br/><span class='lineno'>01027</span><pre class='pre'>				$thNum = $this-&gt;findNum($this-&gt;thumbdir[$i]);</pre><br/><span class='lineno'>01028</span><pre class='pre'>				if (empty($thNum)) {</pre><br/><span class='lineno'>01029</span><pre class='pre'>				    $thNum = strval($i + 1);</pre><br/><span class='lineno'>01030</span><pre class='pre'>				}</pre><br/><span class='lineno'>01031</span><pre class='pre'></pre><br/><span class='lineno'>01032</span><pre class='pre'>				$thumb_height = ($thumb_width / $width) * $height;</pre><br/><span class='lineno'>01033</span><pre class='pre'>				// ç»åãµã¤ãºãã»ãããã¾ãã</pre><br/><span class='lineno'>01034</span><pre class='pre'>				$this-&gt;img_width[] = $thumb_width;</pre><br/><span class='lineno'>01035</span><pre class='pre'>				$this-&gt;img_height[] = $thumb_height;</pre><br/><span class='lineno'>01036</span><pre class='pre'></pre><br/><span class='lineno'>01037</span><pre class='pre'>				// ç»åã®ã¿ã¤ãã«åããã¦ããµã ãã¤ã«ãä½æãã¾ãã</pre><br/><span class='lineno'>01038</span><pre class='pre'>				if ($type == IMAGETYPE_JPEG)</pre><br/><span class='lineno'>01039</span><pre class='pre'>				{</pre><br/><span class='lineno'>01040</span><pre class='pre'>					// ã¢ããã­ã¼ããããã¡ã¤ã«ãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01041</span><pre class='pre'>					$ufimage = @ImageCreateFromJPEG($srcfilename);</pre><br/><span class='lineno'>01042</span><pre class='pre'></pre><br/><span class='lineno'>01043</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åãä½æãã¾ãã</pre><br/><span class='lineno'>01044</span><pre class='pre'>					$thumb = @ImageCreateTrueColor($thumb_width, $thumb_height);</pre><br/><span class='lineno'>01045</span><pre class='pre'></pre><br/><span class='lineno'>01046</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åã«ã¢ããã­ã¼ããããã¡ã¤ã«ãã³ãã¼ãã¾ãã</pre><br/><span class='lineno'>01047</span><pre class='pre'>					@imagecopyresampled($thumb, $ufimage, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);</pre><br/><span class='lineno'>01048</span><pre class='pre'></pre><br/><span class='lineno'>01049</span><pre class='pre'>					// ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01050</span><pre class='pre'>					//if ($this-&gt;write_ok[$i] == true)</pre><br/><span class='lineno'>01051</span><pre class='pre'>					if ($this-&gt;write_ok[$i] == true &amp;&amp; !empty($this-&gt;credit) &amp;&amp; strlen($this-&gt;credit) &gt; 0)</pre><br/><span class='lineno'>01052</span><pre class='pre'>					{</pre><br/><span class='lineno'>01053</span><pre class='pre'>						// ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>01054</span><pre class='pre'>						$font_size = $this-&gt;decide_fontsize($thumb_width);</pre><br/><span class='lineno'>01055</span><pre class='pre'></pre><br/><span class='lineno'>01056</span><pre class='pre'>						// ç»åã«ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01057</span><pre class='pre'>						$thumb = $this-&gt;write_credit($thumb, $this-&gt;credit, $font_size, $thumb_width, $thumb_height);</pre><br/><span class='lineno'>01058</span><pre class='pre'>					}</pre><br/><span class='lineno'>01059</span><pre class='pre'></pre><br/><span class='lineno'>01060</span><pre class='pre'>					// ãã¡ã¤ã«ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>01061</span><pre class='pre'>					$thfilename = $this-&gt;thumbdir[$i] . $this-&gt;dirno . $this-&gt;svname . &quot;th&quot; . $thNum . $this-&gt;ext;</pre><br/><span class='lineno'>01062</span><pre class='pre'>					@imagejpeg($thumb, $thfilename);</pre><br/><span class='lineno'>01063</span><pre class='pre'>				}</pre><br/><span class='lineno'>01064</span><pre class='pre'>				else if ($type == IMAGETYPE_GIF)</pre><br/><span class='lineno'>01065</span><pre class='pre'>				{</pre><br/><span class='lineno'>01066</span><pre class='pre'>					// ã¢ããã­ã¼ããããã¡ã¤ã«ãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01067</span><pre class='pre'>					$ufimage = @ImageCreateFromGIF($srcfilename);</pre><br/><span class='lineno'>01068</span><pre class='pre'></pre><br/><span class='lineno'>01069</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åãä½æãã¾ãã</pre><br/><span class='lineno'>01070</span><pre class='pre'>					$thumb = @ImageCreateTrueColor($thumb_width, $thumb_height);</pre><br/><span class='lineno'>01071</span><pre class='pre'></pre><br/><span class='lineno'>01072</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åã«ã¢ããã­ã¼ããããã¡ã¤ã«ãã³ãã¼ãã¾ãã</pre><br/><span class='lineno'>01073</span><pre class='pre'>					@imagecopyresampled($thumb, $ufimage, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);</pre><br/><span class='lineno'>01074</span><pre class='pre'></pre><br/><span class='lineno'>01075</span><pre class='pre'>					// ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01076</span><pre class='pre'>					//if ($this-&gt;write_ok[$i] == true)</pre><br/><span class='lineno'>01077</span><pre class='pre'>					if ($this-&gt;write_ok[$i] == true &amp;&amp; !empty($this-&gt;credit) &amp;&amp; strlen($this-&gt;credit) &gt; 0)</pre><br/><span class='lineno'>01078</span><pre class='pre'>					{</pre><br/><span class='lineno'>01079</span><pre class='pre'>						// ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>01080</span><pre class='pre'>						$font_size = $this-&gt;decide_fontsize($thumb_width);</pre><br/><span class='lineno'>01081</span><pre class='pre'></pre><br/><span class='lineno'>01082</span><pre class='pre'>						// ç»åã«ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01083</span><pre class='pre'>						$thumb = $this-&gt;write_credit($thumb, $this-&gt;credit, $font_size, $thumb_width, $thumb_height);</pre><br/><span class='lineno'>01084</span><pre class='pre'>					}</pre><br/><span class='lineno'>01085</span><pre class='pre'></pre><br/><span class='lineno'>01086</span><pre class='pre'>					// ãã¡ã¤ã«ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>01087</span><pre class='pre'>					$thfilename = $this-&gt;thumbdir[$i] . $this-&gt;dirno . $this-&gt;svname . &quot;th&quot; . $thNum . $this-&gt;ext;</pre><br/><span class='lineno'>01088</span><pre class='pre'>					@imagegif($thumb, $thfilename);</pre><br/><span class='lineno'>01089</span><pre class='pre'>				}</pre><br/><span class='lineno'>01090</span><pre class='pre'>				else if ($type == IMAGETYPE_PNG)</pre><br/><span class='lineno'>01091</span><pre class='pre'>				{</pre><br/><span class='lineno'>01092</span><pre class='pre'>					// ã¢ããã­ã¼ããããã¡ã¤ã«ãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01093</span><pre class='pre'>					$ufimage = @ImageCreateFromPNG($srcfilename);</pre><br/><span class='lineno'>01094</span><pre class='pre'></pre><br/><span class='lineno'>01095</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åãä½æãã¾ãã</pre><br/><span class='lineno'>01096</span><pre class='pre'>					$thumb = @ImageCreateTrueColor($thumb_width, $thumb_height);</pre><br/><span class='lineno'>01097</span><pre class='pre'></pre><br/><span class='lineno'>01098</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åã«ã¢ããã­ã¼ããããã¡ã¤ã«ãã³ãã¼ãã¾ãã</pre><br/><span class='lineno'>01099</span><pre class='pre'>					@imagecopyresampled($thumb, $ufimage, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);</pre><br/><span class='lineno'>01100</span><pre class='pre'></pre><br/><span class='lineno'>01101</span><pre class='pre'>					// ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01102</span><pre class='pre'>					//if ($this-&gt;write_ok[$i] == true)</pre><br/><span class='lineno'>01103</span><pre class='pre'>					if ($this-&gt;write_ok[$i] == true &amp;&amp; !empty($this-&gt;credit) &amp;&amp; strlen($this-&gt;credit) &gt; 0)</pre><br/><span class='lineno'>01104</span><pre class='pre'>					{</pre><br/><span class='lineno'>01105</span><pre class='pre'>						// ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>01106</span><pre class='pre'>						$font_size = $this-&gt;decide_fontsize($thumb_width);</pre><br/><span class='lineno'>01107</span><pre class='pre'></pre><br/><span class='lineno'>01108</span><pre class='pre'>						// ç»åã«ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01109</span><pre class='pre'>						$thumb = $this-&gt;write_credit($thumb, $this-&gt;credit, $font_size, $thumb_width, $thumb_height);</pre><br/><span class='lineno'>01110</span><pre class='pre'>					}</pre><br/><span class='lineno'>01111</span><pre class='pre'></pre><br/><span class='lineno'>01112</span><pre class='pre'>					// ãã¡ã¤ã«ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>01113</span><pre class='pre'>					$thfilename = $this-&gt;thumbdir[$i] . $this-&gt;dirno . $this-&gt;svname . &quot;th&quot; . $thNum . $this-&gt;ext;</pre><br/><span class='lineno'>01114</span><pre class='pre'>					@imagepng($thumb, $thfilename);</pre><br/><span class='lineno'>01115</span><pre class='pre'>				}</pre><br/><span class='lineno'>01116</span><pre class='pre'></pre><br/><span class='lineno'>01117</span><pre class='pre'>				// ã¢ããã­ã¼ãããããã¡ã¤ã«åãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01118</span><pre class='pre'>				$this-&gt;svfullpath[] = $thfilename;</pre><br/><span class='lineno'>01119</span><pre class='pre'>				$this-&gt;up_url[intval($thNum)] = $this-&gt;uploadconf['site_url'] . $thfilename;</pre><br/><span class='lineno'>01120</span><pre class='pre'></pre><br/><span class='lineno'>01121</span><pre class='pre'>				// ç»åãç ´æ£ãã¾ãã</pre><br/><span class='lineno'>01122</span><pre class='pre'>				@imagedestroy($ufimage);</pre><br/><span class='lineno'>01123</span><pre class='pre'>				@imagedestroy($thumb);</pre><br/><span class='lineno'>01124</span><pre class='pre'>			}</pre><br/><span class='lineno'>01125</span><pre class='pre'>		}</pre><br/><span class='lineno'>01126</span><pre class='pre'>	}</pre><br/><span class='lineno'>01127</span><pre class='pre'></pre><br/><span class='lineno'>01128</span><pre class='pre'>	function write_credit2($img, $cre_str, $fsize, $width_i, $height_i)</pre><br/><span class='lineno'>01129</span><pre class='pre'>	{</pre><br/><span class='lineno'>01130</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸ãè¾¼ã¿ç¨ã®è¨­å®ãè¡ãã¾ãã</pre><br/><span class='lineno'>01131</span><pre class='pre'>		// æ¸ãè¾¼ã¿è§åº¦ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01132</span><pre class='pre'>		$font_angle = 0;</pre><br/><span class='lineno'>01133</span><pre class='pre'></pre><br/><span class='lineno'>01134</span><pre class='pre'>		//GDç°å¢æå ±ãåå¾ãã¾ãã</pre><br/><span class='lineno'>01135</span><pre class='pre'>		$arrInfo = gd_info();</pre><br/><span class='lineno'>01136</span><pre class='pre'></pre><br/><span class='lineno'>01137</span><pre class='pre'>		// æ¸ãè¾¼ãã¯ã¬ã¸ãããè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01138</span><pre class='pre'>		$telop_text = &quot;&quot;;</pre><br/><span class='lineno'>01139</span><pre class='pre'>		if ($arrInfo['JIS-mapped Japanese Font Support']) {</pre><br/><span class='lineno'>01140</span><pre class='pre'>			// GDãå¯¾å¿ãã¦ããå ´åã¯UTF-8ã¸ã®å¤æã¯ä¸è¦ã§ãã</pre><br/><span class='lineno'>01141</span><pre class='pre'>			$telop_text = $cre_str;</pre><br/><span class='lineno'>01142</span><pre class='pre'>		}</pre><br/><span class='lineno'>01143</span><pre class='pre'>		else</pre><br/><span class='lineno'>01144</span><pre class='pre'>		{</pre><br/><span class='lineno'>01145</span><pre class='pre'>			// çµè¾¼ã¿ãã­ã¹ã</pre><br/><span class='lineno'>01146</span><pre class='pre'>			// GDãå¯¾å¿ãã¦ããªãå ´åã¯UTF-8ã¸å¤æãã¾ããï¼UTF-8ã«å¤æããªãå ´åãæå­åããã¾ããï¼</pre><br/><span class='lineno'>01147</span><pre class='pre'>			$telop_text =  mb_convert_encoding($cre_str, &quot;UTF-8&quot;, &quot;auto&quot;);</pre><br/><span class='lineno'>01148</span><pre class='pre'>		}</pre><br/><span class='lineno'>01149</span><pre class='pre'></pre><br/><span class='lineno'>01150</span><pre class='pre'>		// åéæã®ã°ã¬ã¼ããã¯è¡¨ç¤ºä½ç½®</pre><br/><span class='lineno'>01151</span><pre class='pre'>		$alpha_x1 = 5;</pre><br/><span class='lineno'>01152</span><pre class='pre'>		$alpha_x2 = $width_i - 5;</pre><br/><span class='lineno'>01153</span><pre class='pre'></pre><br/><span class='lineno'>01154</span><pre class='pre'>		$alpha_y1 = $height_i - ($fsize + 10) - 5;</pre><br/><span class='lineno'>01155</span><pre class='pre'>		$alpha_y2 = $height_i - 5;</pre><br/><span class='lineno'>01156</span><pre class='pre'></pre><br/><span class='lineno'>01157</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸ãè¾¼ã¿ä½ç½®</pre><br/><span class='lineno'>01158</span><pre class='pre'>		if($width_i == 200)</pre><br/><span class='lineno'>01159</span><pre class='pre'>		{</pre><br/><span class='lineno'>01160</span><pre class='pre'>			$tx = $alpha_x1 + 22;</pre><br/><span class='lineno'>01161</span><pre class='pre'>			$ty = 92;</pre><br/><span class='lineno'>01162</span><pre class='pre'>		}</pre><br/><span class='lineno'>01163</span><pre class='pre'>		if($width_i == 400)</pre><br/><span class='lineno'>01164</span><pre class='pre'>		{</pre><br/><span class='lineno'>01165</span><pre class='pre'>			$tx = $width_i/2-170;</pre><br/><span class='lineno'>01166</span><pre class='pre'>			$ty = $height_i/2+35;</pre><br/><span class='lineno'>01167</span><pre class='pre'>		}</pre><br/><span class='lineno'>01168</span><pre class='pre'>		if($width_i == 800)</pre><br/><span class='lineno'>01169</span><pre class='pre'>		{</pre><br/><span class='lineno'>01170</span><pre class='pre'>			$tx = $width_i/2-334;</pre><br/><span class='lineno'>01171</span><pre class='pre'>			$ty = $height_i/2+65;</pre><br/><span class='lineno'>01172</span><pre class='pre'>		}</pre><br/><span class='lineno'>01173</span><pre class='pre'></pre><br/><span class='lineno'>01174</span><pre class='pre'>		// ã¢ã«ãã¡ãã£ã³ãã«ï¼ã°ã¬ã¼ï¼</pre><br/><span class='lineno'>01175</span><pre class='pre'>		$alpha = imagecolorallocatealpha($img, 255, 255, 255, 100);</pre><br/><span class='lineno'>01176</span><pre class='pre'></pre><br/><span class='lineno'>01177</span><pre class='pre'>		//ãã­ã¹ãæç»</pre><br/><span class='lineno'>01178</span><pre class='pre'>		ImageTTFText($img, $fsize, $font_angle, $tx, $ty, $alpha, &quot;./sazanami-gothic.ttf&quot;, $telop_text);</pre><br/><span class='lineno'>01179</span><pre class='pre'>		ImageTTFText($img, $fsize, $font_angle, $tx, $ty, $alpha, &quot;./sazanami-gothic.ttf&quot;, $telop_text);</pre><br/><span class='lineno'>01180</span><pre class='pre'></pre><br/><span class='lineno'>01181</span><pre class='pre'>		return $img;</pre><br/><span class='lineno'>01182</span><pre class='pre'>	}</pre><br/><span class='lineno'>01183</span><pre class='pre'>}</pre><br/><span class='lineno'>01184</span><pre class='pre'></pre><br/><span class='lineno'>01185</span><pre class='pre'>/**</pre><br/><span class='lineno'>01186</span><pre class='pre'> * ãã¡ã¤ã«ãã¢ããã­ã¼ããã¾ãã</pre><br/><span class='lineno'>01187</span><pre class='pre'> *</pre><br/><span class='lineno'>01188</span><pre class='pre'> * 	ãã³ã³ã¹ãã©ã¯ã¿ã¼ã</pre><br/><span class='lineno'>01189</span><pre class='pre'> * 		FileUpload($fl, $cf, $thdir, $flw, $fname, $cre, $wcredit)</pre><br/><span class='lineno'>01190</span><pre class='pre'> * 			@param array $cf 		å®ç¾©æå ±				ï¼æå®ãªãï¼config.phpã®$upload_confï¼</pre><br/><span class='lineno'>01191</span><pre class='pre'> * 										$cf['dir'] 			ï¼ã¢ããã­ã¼ããã©ã«ã</pre><br/><span class='lineno'>01192</span><pre class='pre'> * 										$cf['temp_dir']		ï¼ãã³ãã©ãªã¼ãã©ã«ã</pre><br/><span class='lineno'>01193</span><pre class='pre'> * 										$cf['maxsize']		ï¼ã¢ããã­ã¼ããã¡ã¤ã«ã®ä¸éãµã¤ãº</pre><br/><span class='lineno'>01194</span><pre class='pre'> * 										$cf['site_url']		ï¼ãµã¤ãURL</pre><br/><span class='lineno'>01195</span><pre class='pre'> * 			@param array $thdir		ãµã ãã¤ã«ãã©ã«ãæå ±	ï¼æå®ãªãï¼config.phpã®$thumb_dirï¼</pre><br/><span class='lineno'>01196</span><pre class='pre'> * 			@param array $flw		ãµã ãã¤ã«æ¨ªå¹			ï¼æå®ãªãï¼config.phpã®$thumb_widthï¼</pre><br/><span class='lineno'>01197</span><pre class='pre'> * 			@param string $fname	ãã©ã³ãå				ï¼æå®ãªãï¼config.phpã®$font_nameï¼</pre><br/><span class='lineno'>01198</span><pre class='pre'> * 			@param string $cre		ã¯ã¬ã¸ãã</pre><br/><span class='lineno'>01199</span><pre class='pre'> * 			@param array $wcredit	ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ãã©ãã	ï¼æå®ãªãï¼config.phpã®$write_creditï¼</pre><br/><span class='lineno'>01200</span><pre class='pre'> *</pre><br/><span class='lineno'>01201</span><pre class='pre'> * 	ãã¡ã³ãã¼ã</pre><br/><span class='lineno'>01202</span><pre class='pre'> * 		var $message;				ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>01203</span><pre class='pre'> * 		var $result;				ã¢ããã­ã¼ãçµæ</pre><br/><span class='lineno'>01204</span><pre class='pre'> * 		var $img_width;				ã¤ã¡ã¼ã¸ãµã¤ãºï¼æ¨ªï¼	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01205</span><pre class='pre'> * 		var $img_height;			ã¤ã¡ã¼ã¸ãµã¤ãºï¼ç¸¦ï¼	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01206</span><pre class='pre'> * 		var $up_url;				ã¢ããã­ã¼ãURLï¼æçµçã«ã¢ããã­ã¼ããããURLï¼</pre><br/><span class='lineno'>01207</span><pre class='pre'> * 													0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01208</span><pre class='pre'> *		var $ext;					æ¡å¼µå­ï¼åãã¡ã¤ã«åï¼</pre><br/><span class='lineno'>01209</span><pre class='pre'> *</pre><br/><span class='lineno'>01210</span><pre class='pre'> * 	$fileï¼ã¢ããã­ã¼ããã¡ã¤ã«å¨æå ±ï¼	&rarr;	$upfileï¼åã®ãã¡ã¤ã«åï¼+$extï¼æ¡å¼µå­ï¼</pre><br/><span class='lineno'>01211</span><pre class='pre'> * 										&darr;ã¦ãã¼ã¯ãªãã¡ã¤ã«åã¸</pre><br/><span class='lineno'>01212</span><pre class='pre'> * 									$svnameï¼ã¦ãã¼ã¯ãªãã¡ã¤ã«åï¼YmdHis999ï¼+$extï¼æ¡å¼µå­ï¼</pre><br/><span class='lineno'>01213</span><pre class='pre'> * 										&darr;ãã³ãã©ãªã¼ã¸</pre><br/><span class='lineno'>01214</span><pre class='pre'> * 									$uploadconf['temp_dir'] + $svname + $ext</pre><br/><span class='lineno'>01215</span><pre class='pre'> * 										&darr;ãã§ãã¯OK</pre><br/><span class='lineno'>01216</span><pre class='pre'> * 									$uploadconf['dir'] + dirnoï¼0ï½9ã¾ã§ã®ãã©ã«ãï¼ + $svname + $extãï¼$svfullpath[0]ï¼</pre><br/><span class='lineno'>01217</span><pre class='pre'> * 										&darr;URLã«å¤æ</pre><br/><span class='lineno'>01218</span><pre class='pre'> * 									$uploadconf['site_url'] + $svfullpath[0]ãï¼$up_urlï¼</pre><br/><span class='lineno'>01219</span><pre class='pre'> */</pre><br/><span class='lineno'>01220</span><pre class='pre'>class FileUploadBatch</pre><br/><span class='lineno'>01221</span><pre class='pre'>{</pre><br/><span class='lineno'>01222</span><pre class='pre'>	var $message;									// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>01223</span><pre class='pre'>	var $result;									// ã¢ããã­ã¼ãçµæ</pre><br/><span class='lineno'>01224</span><pre class='pre'>	var $img_width;									// ã¤ã¡ã¼ã¸ãµã¤ãºï¼æ¨ªï¼	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01225</span><pre class='pre'>	var $img_height;								// ã¤ã¡ã¼ã¸ãµã¤ãºï¼ç¸¦ï¼	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01226</span><pre class='pre'>	var $up_url;									// ã¢ããã­ã¼ãURLï¼æçµçã«ã¢ããã­ã¼ããããURLï¼</pre><br/><span class='lineno'>01227</span><pre class='pre'>													//					0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01228</span><pre class='pre'>	var $ext;										// æ¡å¼µå­ï¼åãã¡ã¤ã«åï¼</pre><br/><span class='lineno'>01229</span><pre class='pre'></pre><br/><span class='lineno'>01230</span><pre class='pre'>	private $filename;								// ãã¡ã¤ã«æå ±</pre><br/><span class='lineno'>01231</span><pre class='pre'>	private $dirno;									// uploadããã³thumbãã©ã«ãä»¥ä¸0-9ã®ã©ã®ãã©ã«ãã«å¥ããã</pre><br/><span class='lineno'>01232</span><pre class='pre'>	private $svname;								// ä¿å­ãã¡ã¤ã«åä½æåï¼YmdHis999ï¼</pre><br/><span class='lineno'>01233</span><pre class='pre'>	private $svfullpath;							// ä¿å­ãã¡ã¤ã«åï¼ãã«ãã¹:./$uploadconf['dir']/YmdHis999/dirno/svname.extï¼</pre><br/><span class='lineno'>01234</span><pre class='pre'>	private $upfile;								// ã¢ããã­ã¼ããã¡ã¤ã«å</pre><br/><span class='lineno'>01235</span><pre class='pre'>	private $uploadsize;							// ã¢ããã­ã¼ããµã¤ãº</pre><br/><span class='lineno'>01236</span><pre class='pre'>	private $uploadconf;							// ã¢ããã­ã¼ãç¨å®ç¾©</pre><br/><span class='lineno'>01237</span><pre class='pre'>													//	$uploadconf['dir'] = &quot;./uploads/&quot;;			ã¢ããã­ã¼ããã©ã«ã</pre><br/><span class='lineno'>01238</span><pre class='pre'>													//	$uploadconf['temp_dir'] = &quot;./temporary/&quot;;	ãã³ãã©ãªã¼ãã©ã«ã</pre><br/><span class='lineno'>01239</span><pre class='pre'>													//	$uploadconf['maxsize'] = 1000000;			 ã¢ããã­ã¼ããã¡ã¤ã«ã®å¶éãµã¤ãº</pre><br/><span class='lineno'>01240</span><pre class='pre'>													//	$uploadconf['site_url'] = 'http:			ãµã¤ãURL</pre><br/><span class='lineno'>01241</span><pre class='pre'>	private $flwidth;								// ãµã ãã¤ã«ãä½æããã¨ãã®æ¨ªå¹</pre><br/><span class='lineno'>01242</span><pre class='pre'>	private $thumbdir;								// ãµã ãã¤ã«ãä¿å­ãããã©ã«ã</pre><br/><span class='lineno'>01243</span><pre class='pre'>	private $font_name;								// ãã©ã³ãå</pre><br/><span class='lineno'>01244</span><pre class='pre'>	private $credit;								// ã¯ã¬ã¸ãã</pre><br/><span class='lineno'>01245</span><pre class='pre'>	private $write_ok;								// ãã©ã³ããæ¸ãè¾¼ããã©ãã</pre><br/><span class='lineno'>01246</span><pre class='pre'></pre><br/><span class='lineno'>01247</span><pre class='pre'>	/**</pre><br/><span class='lineno'>01248</span><pre class='pre'>	 * ã³ã³ã¹ãã©ã¯ã¿ã¼</pre><br/><span class='lineno'>01249</span><pre class='pre'>	 */</pre><br/><span class='lineno'>01250</span><pre class='pre'>	function __construct($fln,$cf, $thdir, $flw, $fname, $cre, $wcredit)</pre><br/><span class='lineno'>01251</span><pre class='pre'>	{</pre><br/><span class='lineno'>01252</span><pre class='pre'>		// config.phpããããã©ã«ãå¤ãèª­ã¿è¾¼ãããã®globalã§ãã</pre><br/><span class='lineno'>01253</span><pre class='pre'>		global $upload_conf, $thumb_dir, $thumb_width, $font_name, $write_credit;</pre><br/><span class='lineno'>01254</span><pre class='pre'>		global $credit_fontsize;</pre><br/><span class='lineno'>01255</span><pre class='pre'></pre><br/><span class='lineno'>01256</span><pre class='pre'>		// ã¡ã³ãã¼ãåæåãã¾ãã</pre><br/><span class='lineno'>01257</span><pre class='pre'>		$this-&gt;message = &quot;&quot;;						// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>01258</span><pre class='pre'>		$this-&gt;result = true;						// çµæï¼æåï¼trueï¼</pre><br/><span class='lineno'>01259</span><pre class='pre'>		$this-&gt;file = &quot;&quot;;							// ãã¡ã¤ã«æå ±</pre><br/><span class='lineno'>01260</span><pre class='pre'>		$this-&gt;svname = &quot;&quot;;							// ä¿å­ãã¡ã¤ã«åä½æåï¼YmdHis999ï¼</pre><br/><span class='lineno'>01261</span><pre class='pre'>		$this-&gt;uploadsize = 0;						// ã¢ããã­ã¼ããµã¤ãº</pre><br/><span class='lineno'>01262</span><pre class='pre'>		$this-&gt;ext = &quot;&quot;;							// æ¡å¼µå­</pre><br/><span class='lineno'>01263</span><pre class='pre'>		$this-&gt;font_name = &quot;&quot;;						// ãã©ã³ãå</pre><br/><span class='lineno'>01264</span><pre class='pre'>		$this-&gt;dirno = 0;							// uploadããã³thumbãã©ã«ãä»¥ä¸ã®ãã£ã¬ã¯ããªå</pre><br/><span class='lineno'>01265</span><pre class='pre'>		$this-&gt;credit = &quot;&quot;;							// ã¯ã¬ã¸ãã</pre><br/><span class='lineno'>01266</span><pre class='pre'></pre><br/><span class='lineno'>01267</span><pre class='pre'>		$this-&gt;img_width = array();					// ã¤ã¡ã¼ã¸ãµã¤ãºï¼æ¨ªï¼			0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01268</span><pre class='pre'>		$this-&gt;img_height = array();				// ã¤ã¡ã¼ã¸ãµã¤ãºï¼æ¨ªï¼			0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01269</span><pre class='pre'>		$this-&gt;write_ok = array();					// ã¯ã¬ã¸ãããæ¸ãè¾¼ããã©ãã		0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01270</span><pre class='pre'>		$this-&gt;flwidth = array();					// ãµã ãã¤ã«ãä½æããã¨ãã®æ¨ªå¹	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01271</span><pre class='pre'>		$this-&gt;thumbdir = array();					// ãµã ãã¤ã«ãä¿å­ãããã©ã«ã		0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01272</span><pre class='pre'>		$this-&gt;up_url = array();					// ã¢ããã­ã¼ãURL				0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01273</span><pre class='pre'>		$this-&gt;svfullpath = array();				// ä¿å­ãã¡ã¤ã«åï¼ãã«ãã¹ï¼		0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>01274</span><pre class='pre'></pre><br/><span class='lineno'>01275</span><pre class='pre'>		// ãã¡ã¤ã«æå ±ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01276</span><pre class='pre'>		$this-&gt;filename = $fln;</pre><br/><span class='lineno'>01277</span><pre class='pre'></pre><br/><span class='lineno'>01278</span><pre class='pre'>		// å®ç¾©æå ±ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01279</span><pre class='pre'>		if (empty($cf))</pre><br/><span class='lineno'>01280</span><pre class='pre'>		{</pre><br/><span class='lineno'>01281</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«å®ç¾©æå ±ãè¨­å®ããã¦ããªãå ´åã§ã</pre><br/><span class='lineno'>01282</span><pre class='pre'>			if (!empty($upload_conf))</pre><br/><span class='lineno'>01283</span><pre class='pre'>			{</pre><br/><span class='lineno'>01284</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããã°ã</pre><br/><span class='lineno'>01285</span><pre class='pre'>				// ãã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>01286</span><pre class='pre'>				$this-&gt;uploadconf = $upload_conf;</pre><br/><span class='lineno'>01287</span><pre class='pre'>			}</pre><br/><span class='lineno'>01288</span><pre class='pre'>			else</pre><br/><span class='lineno'>01289</span><pre class='pre'>			{</pre><br/><span class='lineno'>01290</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããªããã°ã</pre><br/><span class='lineno'>01291</span><pre class='pre'>				// ã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>01292</span><pre class='pre'>				$this-&gt;result = false;</pre><br/><span class='lineno'>01293</span><pre class='pre'>				$this-&gt;message = &quot;ã¢ããã­ã¼ãç¨å®ç¾©ãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01294</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01295</span><pre class='pre'>			}</pre><br/><span class='lineno'>01296</span><pre class='pre'>		}</pre><br/><span class='lineno'>01297</span><pre class='pre'>		else</pre><br/><span class='lineno'>01298</span><pre class='pre'>		{</pre><br/><span class='lineno'>01299</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«å®ç¾©æå ±ãè¨­å®ããã¦ããå ´åã¯ããã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>01300</span><pre class='pre'>			$this-&gt;uploadconf = $cf;</pre><br/><span class='lineno'>01301</span><pre class='pre'>		}</pre><br/><span class='lineno'>01302</span><pre class='pre'></pre><br/><span class='lineno'>01303</span><pre class='pre'>		// å®ç¾©ãã¡ã¤ã«ã®åå®¹ããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>01304</span><pre class='pre'>		if (empty($this-&gt;uploadconf['dir']))</pre><br/><span class='lineno'>01305</span><pre class='pre'>		{</pre><br/><span class='lineno'>01306</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>01307</span><pre class='pre'>			$this-&gt;message = &quot;ä¿å­ç¨ãã£ã¬ã¯ããªãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01308</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01309</span><pre class='pre'>		}</pre><br/><span class='lineno'>01310</span><pre class='pre'></pre><br/><span class='lineno'>01311</span><pre class='pre'>		if (empty($this-&gt;uploadconf['temp_dir']))</pre><br/><span class='lineno'>01312</span><pre class='pre'>		{</pre><br/><span class='lineno'>01313</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>01314</span><pre class='pre'>			$this-&gt;message = &quot;ãã³ãã©ãªã¼ãã£ã¬ã¯ããªãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01315</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01316</span><pre class='pre'>		}</pre><br/><span class='lineno'>01317</span><pre class='pre'></pre><br/><span class='lineno'>01318</span><pre class='pre'>		if (empty($this-&gt;uploadconf['maxsize']))</pre><br/><span class='lineno'>01319</span><pre class='pre'>		{</pre><br/><span class='lineno'>01320</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>01321</span><pre class='pre'>			$this-&gt;message = &quot;ã¢ããã­ã¼ãæå¤§ãµã¤ãºãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01322</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01323</span><pre class='pre'>		}</pre><br/><span class='lineno'>01324</span><pre class='pre'></pre><br/><span class='lineno'>01325</span><pre class='pre'>		if (empty($this-&gt;uploadconf['site_url']))</pre><br/><span class='lineno'>01326</span><pre class='pre'>		{</pre><br/><span class='lineno'>01327</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>01328</span><pre class='pre'>			$this-&gt;message = &quot;URLãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01329</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01330</span><pre class='pre'>		}</pre><br/><span class='lineno'>01331</span><pre class='pre'></pre><br/><span class='lineno'>01332</span><pre class='pre'>		// ãµã ãã¤ã«ä¿å­ç¨ãã©ã«ããè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01333</span><pre class='pre'>		if (empty($thdir))</pre><br/><span class='lineno'>01334</span><pre class='pre'>		{</pre><br/><span class='lineno'>01335</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ãµã ãã¤ã«ä¿å­ç¨ãã©ã«ããè¨­å®ããã¦ããªãå ´åã§ã</pre><br/><span class='lineno'>01336</span><pre class='pre'>			if (!empty($thumb_dir))</pre><br/><span class='lineno'>01337</span><pre class='pre'>			{</pre><br/><span class='lineno'>01338</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããã°ã</pre><br/><span class='lineno'>01339</span><pre class='pre'>				// ãã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>01340</span><pre class='pre'>				$this-&gt;thumbdir = $thumb_dir;</pre><br/><span class='lineno'>01341</span><pre class='pre'>			}</pre><br/><span class='lineno'>01342</span><pre class='pre'>			else</pre><br/><span class='lineno'>01343</span><pre class='pre'>			{</pre><br/><span class='lineno'>01344</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããªããã°ã</pre><br/><span class='lineno'>01345</span><pre class='pre'>				// ã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>01346</span><pre class='pre'>				$this-&gt;result = false;</pre><br/><span class='lineno'>01347</span><pre class='pre'>				$this-&gt;message = &quot;ãµã ãã¤ã«ä¿å­ç¨ãã©ã«ããè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01348</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01349</span><pre class='pre'>			}</pre><br/><span class='lineno'>01350</span><pre class='pre'>		}</pre><br/><span class='lineno'>01351</span><pre class='pre'>		else</pre><br/><span class='lineno'>01352</span><pre class='pre'>		{</pre><br/><span class='lineno'>01353</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ãµã ãã¤ã«ä¿å­ç¨ãã©ã«ããè¨­å®ããã¦ããå ´åã¯ããã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>01354</span><pre class='pre'>			$this-&gt;thumbdir = $thdir;</pre><br/><span class='lineno'>01355</span><pre class='pre'>		}</pre><br/><span class='lineno'>01356</span><pre class='pre'></pre><br/><span class='lineno'>01357</span><pre class='pre'>		// ãµã ãã¤ã«ä½ææã®æ¨ªå¹ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01358</span><pre class='pre'>		if (empty($flw))</pre><br/><span class='lineno'>01359</span><pre class='pre'>		{</pre><br/><span class='lineno'>01360</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ãµã ãã¤ã«ä½ææã®æ¨ªå¹ãè¨­å®ããã¦ããªãå ´åã§ã</pre><br/><span class='lineno'>01361</span><pre class='pre'>			if (!empty($thumb_width))</pre><br/><span class='lineno'>01362</span><pre class='pre'>			{</pre><br/><span class='lineno'>01363</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããã°ã</pre><br/><span class='lineno'>01364</span><pre class='pre'>				// ãã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>01365</span><pre class='pre'>				$this-&gt;flwidth = $thumb_width;</pre><br/><span class='lineno'>01366</span><pre class='pre'>			}</pre><br/><span class='lineno'>01367</span><pre class='pre'>			else</pre><br/><span class='lineno'>01368</span><pre class='pre'>			{</pre><br/><span class='lineno'>01369</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããªããã°ã</pre><br/><span class='lineno'>01370</span><pre class='pre'>				// ã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>01371</span><pre class='pre'>				$this-&gt;result = false;</pre><br/><span class='lineno'>01372</span><pre class='pre'>				$this-&gt;message = &quot;ãµã ãã¤ã«ä½ææã®æ¨ªå¹ãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01373</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01374</span><pre class='pre'>			}</pre><br/><span class='lineno'>01375</span><pre class='pre'>		}</pre><br/><span class='lineno'>01376</span><pre class='pre'>		else</pre><br/><span class='lineno'>01377</span><pre class='pre'>		{</pre><br/><span class='lineno'>01378</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ãµã ãã¤ã«ä½ææã®æ¨ªå¹ãè¨­å®ããã¦ããå ´åã¯ããã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>01379</span><pre class='pre'>			$this-&gt;flwidth = $flw;</pre><br/><span class='lineno'>01380</span><pre class='pre'>		}</pre><br/><span class='lineno'>01381</span><pre class='pre'></pre><br/><span class='lineno'>01382</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸è¾¼ç¨ã®ãã©ã³ããè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01383</span><pre class='pre'>		if (empty($fname))</pre><br/><span class='lineno'>01384</span><pre class='pre'>		{</pre><br/><span class='lineno'>01385</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ã¯ã¬ã¸ããæ¸è¾¼ç¨ã®ãã©ã³ããè¨­å®ããã¦ããªãå ´åã§ã</pre><br/><span class='lineno'>01386</span><pre class='pre'>			if (!empty($font_name))</pre><br/><span class='lineno'>01387</span><pre class='pre'>			{</pre><br/><span class='lineno'>01388</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããã°ã</pre><br/><span class='lineno'>01389</span><pre class='pre'>				// ãã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>01390</span><pre class='pre'>				$this-&gt;font_name = $font_name;</pre><br/><span class='lineno'>01391</span><pre class='pre'>			}</pre><br/><span class='lineno'>01392</span><pre class='pre'>			else</pre><br/><span class='lineno'>01393</span><pre class='pre'>			{</pre><br/><span class='lineno'>01394</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããªããã°ã</pre><br/><span class='lineno'>01395</span><pre class='pre'>				// ã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>01396</span><pre class='pre'>				$this-&gt;result = false;</pre><br/><span class='lineno'>01397</span><pre class='pre'>				$this-&gt;message = &quot;ãã©ã³ããè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01398</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01399</span><pre class='pre'>			}</pre><br/><span class='lineno'>01400</span><pre class='pre'>		}</pre><br/><span class='lineno'>01401</span><pre class='pre'>		else</pre><br/><span class='lineno'>01402</span><pre class='pre'>		{</pre><br/><span class='lineno'>01403</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ãã©ã³ããè¨­å®ããã¦ããå ´åã¯ããã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>01404</span><pre class='pre'>			$this-&gt;font_name = $fname;</pre><br/><span class='lineno'>01405</span><pre class='pre'>		}</pre><br/><span class='lineno'>01406</span><pre class='pre'></pre><br/><span class='lineno'>01407</span><pre class='pre'>		// ã¯ã¬ã¸ãããæ¸ãè¾¼ããã©ããã®è¨­å®ãã¾ãã</pre><br/><span class='lineno'>01408</span><pre class='pre'>		if (empty($wcredit))</pre><br/><span class='lineno'>01409</span><pre class='pre'>		{</pre><br/><span class='lineno'>01410</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ã¯ã¬ã¸ãããæ¸ãè¾¼ããã©ãããè¨­å®ããã¦ããªãå ´åã§ã</pre><br/><span class='lineno'>01411</span><pre class='pre'>			if (!empty($write_credit))</pre><br/><span class='lineno'>01412</span><pre class='pre'>			{</pre><br/><span class='lineno'>01413</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããã°ã</pre><br/><span class='lineno'>01414</span><pre class='pre'>				// ãã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>01415</span><pre class='pre'>				$this-&gt;write_ok = $write_credit;</pre><br/><span class='lineno'>01416</span><pre class='pre'>			}</pre><br/><span class='lineno'>01417</span><pre class='pre'>			else</pre><br/><span class='lineno'>01418</span><pre class='pre'>			{</pre><br/><span class='lineno'>01419</span><pre class='pre'>				// config.phpã«ããã©ã«ãå¤ãè¨­å®ããã¦ããªããã°ã</pre><br/><span class='lineno'>01420</span><pre class='pre'>				// ã¨ã©ã¼ã¨ãã¾ãã</pre><br/><span class='lineno'>01421</span><pre class='pre'>				$this-&gt;result = false;</pre><br/><span class='lineno'>01422</span><pre class='pre'>				$this-&gt;message = &quot;ã¯ã¬ã¸ãããæ¸ãè¾¼ããã©ãããè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01423</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01424</span><pre class='pre'>			}</pre><br/><span class='lineno'>01425</span><pre class='pre'>		}</pre><br/><span class='lineno'>01426</span><pre class='pre'>		else</pre><br/><span class='lineno'>01427</span><pre class='pre'>		{</pre><br/><span class='lineno'>01428</span><pre class='pre'>			// ã¤ã³ã¹ã¿ã³ã¹çææã«ãã©ã³ããè¨­å®ããã¦ããå ´åã¯ããã®å¤ãä½¿ç¨ãã¾ãã</pre><br/><span class='lineno'>01429</span><pre class='pre'>			$this-&gt;write_ok  = $wcredit;</pre><br/><span class='lineno'>01430</span><pre class='pre'>		}</pre><br/><span class='lineno'>01431</span><pre class='pre'></pre><br/><span class='lineno'>01432</span><pre class='pre'>		// ã¯ã¬ã¸ãããè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01433</span><pre class='pre'>		$this-&gt;credit = $cre;										// ã¯ã¬ã¸ãã</pre><br/><span class='lineno'>01434</span><pre class='pre'></pre><br/><span class='lineno'>01435</span><pre class='pre'>		// æå®ãããã¢ããã­ã¼ããã¡ã¤ã«åãåå¾ãã¾ãã</pre><br/><span class='lineno'>01436</span><pre class='pre'>		$this-&gt;upfile = $fln;										// ã¢ããã­ã¼ããã¡ã¤ã«å</pre><br/><span class='lineno'>01437</span><pre class='pre'></pre><br/><span class='lineno'>01438</span><pre class='pre'>		// ã¢ããã­ã¼ããããã¡ã¤ã«ãµã¤ãºãåå¾ãã¾ãã</pre><br/><span class='lineno'>01439</span><pre class='pre'>		//$this-&gt;uploadsize = filesize($this-&gt;uploadconf['temp_dir'].$this-&gt;upfile);							// ã¢ããã­ã¼ããµã¤ãº</pre><br/><span class='lineno'>01440</span><pre class='pre'>		//echo &quot;upfilesize-&gt;&quot;.$this-&gt;uploadsize;</pre><br/><span class='lineno'>01441</span><pre class='pre'>		// ã¢ããã­ã¼ããããã¡ã¤ã«åããæ¡å¼µå­ãæåºãã¾ãã</pre><br/><span class='lineno'>01442</span><pre class='pre'>		preg_match(&quot;/\.[^.]*$/i&quot;, $this-&gt;upfile, $ext_tmp);			// extã«æ¡å¼µå­</pre><br/><span class='lineno'>01443</span><pre class='pre'></pre><br/><span class='lineno'>01444</span><pre class='pre'>		// æ¡å¼µå­ãå°æå­ã«å¤æãã¾ãã</pre><br/><span class='lineno'>01445</span><pre class='pre'>		$this-&gt;ext = strtolower($ext_tmp[0]);</pre><br/><span class='lineno'>01446</span><pre class='pre'>	}</pre><br/><span class='lineno'>01447</span><pre class='pre'></pre><br/><span class='lineno'>01448</span><pre class='pre'>	function write_credit($img, $cre_str, $fsize, $width_i, $height_i)</pre><br/><span class='lineno'>01449</span><pre class='pre'>	{</pre><br/><span class='lineno'>01450</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸ãè¾¼ã¿ç¨ã®è¨­å®ãè¡ãã¾ãã</pre><br/><span class='lineno'>01451</span><pre class='pre'>		// æ¸ãè¾¼ã¿è§åº¦ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01452</span><pre class='pre'>		$font_angle = 0;</pre><br/><span class='lineno'>01453</span><pre class='pre'></pre><br/><span class='lineno'>01454</span><pre class='pre'>		//GDç°å¢æå ±ãåå¾ãã¾ãã</pre><br/><span class='lineno'>01455</span><pre class='pre'>		$arrInfo = gd_info();</pre><br/><span class='lineno'>01456</span><pre class='pre'></pre><br/><span class='lineno'>01457</span><pre class='pre'>		// æ¸ãè¾¼ãã¯ã¬ã¸ãããè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01458</span><pre class='pre'>		$telop_text = &quot;&quot;;</pre><br/><span class='lineno'>01459</span><pre class='pre'>		if ($arrInfo['JIS-mapped Japanese Font Support']) {</pre><br/><span class='lineno'>01460</span><pre class='pre'>			// GDãå¯¾å¿ãã¦ããå ´åã¯UTF-8ã¸ã®å¤æã¯ä¸è¦ã§ãã</pre><br/><span class='lineno'>01461</span><pre class='pre'>			$telop_text = $cre_str;</pre><br/><span class='lineno'>01462</span><pre class='pre'>		}</pre><br/><span class='lineno'>01463</span><pre class='pre'>		else</pre><br/><span class='lineno'>01464</span><pre class='pre'>		{</pre><br/><span class='lineno'>01465</span><pre class='pre'>			// çµè¾¼ã¿ãã­ã¹ã</pre><br/><span class='lineno'>01466</span><pre class='pre'>			// GDãå¯¾å¿ãã¦ããªãå ´åã¯UTF-8ã¸å¤æãã¾ããï¼UTF-8ã«å¤æããªãå ´åãæå­åããã¾ããï¼</pre><br/><span class='lineno'>01467</span><pre class='pre'>			$telop_text =  mb_convert_encoding($cre_str, &quot;UTF-8&quot;, &quot;auto&quot;);</pre><br/><span class='lineno'>01468</span><pre class='pre'>		}</pre><br/><span class='lineno'>01469</span><pre class='pre'></pre><br/><span class='lineno'>01470</span><pre class='pre'>		//yupengbo add 20101208 start</pre><br/><span class='lineno'>01471</span><pre class='pre'>		$str_len = mb_strlen($telop_text);</pre><br/><span class='lineno'>01472</span><pre class='pre'>		if($str_len &gt; 16)</pre><br/><span class='lineno'>01473</span><pre class='pre'>		{</pre><br/><span class='lineno'>01474</span><pre class='pre'>			for($i=2;$i&gt;0;$i--)</pre><br/><span class='lineno'>01475</span><pre class='pre'>			{</pre><br/><span class='lineno'>01476</span><pre class='pre'>				// åéæã®ã°ã¬ã¼ããã¯è¡¨ç¤ºä½ç½®</pre><br/><span class='lineno'>01477</span><pre class='pre'>				$alpha_x1 = 5;</pre><br/><span class='lineno'>01478</span><pre class='pre'>				$alpha_x2 = $width_i - 5;</pre><br/><span class='lineno'>01479</span><pre class='pre'></pre><br/><span class='lineno'>01480</span><pre class='pre'>				$alpha_y1 = $height_i - ($fsize + 10) - 5;</pre><br/><span class='lineno'>01481</span><pre class='pre'>				if($i==2) $alpha_y1 = $height_i - ($fsize + 10) - 25;</pre><br/><span class='lineno'>01482</span><pre class='pre'>				$alpha_y2 = $height_i - 5;</pre><br/><span class='lineno'>01483</span><pre class='pre'></pre><br/><span class='lineno'>01484</span><pre class='pre'>				// ã¯ã¬ã¸ããæ¸ãè¾¼ã¿ä½ç½®</pre><br/><span class='lineno'>01485</span><pre class='pre'>				$tx = $alpha_x1 + 5;</pre><br/><span class='lineno'>01486</span><pre class='pre'>				$ty = $alpha_y1 + $fsize + 5;</pre><br/><span class='lineno'>01487</span><pre class='pre'></pre><br/><span class='lineno'>01488</span><pre class='pre'>				// ãã­ã¹ãã«ã©ã¼ï¼é»ï¼</pre><br/><span class='lineno'>01489</span><pre class='pre'>				$font_color_b = ImageColorAllocate ($img, 0, 0, 0);</pre><br/><span class='lineno'>01490</span><pre class='pre'>				// ãã­ã¹ãã«ã©ã¼ï¼ç½ï¼</pre><br/><span class='lineno'>01491</span><pre class='pre'>				$font_color_w = ImageColorAllocate ($img, 255, 255, 255);</pre><br/><span class='lineno'>01492</span><pre class='pre'>				// ã¢ã«ãã¡ãã£ã³ãã«ï¼ã°ã¬ã¼ï¼</pre><br/><span class='lineno'>01493</span><pre class='pre'>				$alpha = imagecolorallocatealpha($img, 0, 0, 0, 90);</pre><br/><span class='lineno'>01494</span><pre class='pre'></pre><br/><span class='lineno'>01495</span><pre class='pre'>				// ç»åã®ä¸é¨ãéããã¤ã¡ã¼ã¸ã«ãã¾ãã</pre><br/><span class='lineno'>01496</span><pre class='pre'>				imagefilledrectangle ($img , $alpha_x1 , $alpha_y1, $alpha_x2, $alpha_y2, $alpha);</pre><br/><span class='lineno'>01497</span><pre class='pre'></pre><br/><span class='lineno'>01498</span><pre class='pre'>				if($i==2) $tmp_telop_text = mb_substr($telop_text,0,16,&quot;utf-8&quot;);</pre><br/><span class='lineno'>01499</span><pre class='pre'>				if($i==1) $tmp_telop_text = mb_substr($telop_text,16,16,&quot;utf-8&quot;);</pre><br/><span class='lineno'>01500</span><pre class='pre'></pre><br/><span class='lineno'>01501</span><pre class='pre'>				//ãã­ã¹ãæç»</pre><br/><span class='lineno'>01502</span><pre class='pre'>				ImageTTFText($img, $fsize, $font_angle, $tx, $ty, $font_color_w, $this-&gt;font_name, $tmp_telop_text);</pre><br/><span class='lineno'>01503</span><pre class='pre'>				ImageTTFText($img, $fsize, $font_angle, $tx, $ty, $font_color_w, $this-&gt;font_name, $tmp_telop_text);</pre><br/><span class='lineno'>01504</span><pre class='pre'>			}</pre><br/><span class='lineno'>01505</span><pre class='pre'>			  //wangtongchao 2011/08/23 change start tianjiaif()puanduan</pre><br/><span class='lineno'>01506</span><pre class='pre'>		} elseif($str_len &gt; 0) {</pre><br/><span class='lineno'>01507</span><pre class='pre'>			  //wangtongchao 2011/08/23 change end</pre><br/><span class='lineno'>01508</span><pre class='pre'>		//yupengbo add 20101209 end</pre><br/><span class='lineno'>01509</span><pre class='pre'>			// åéæã®ã°ã¬ã¼ããã¯è¡¨ç¤ºä½ç½®</pre><br/><span class='lineno'>01510</span><pre class='pre'>			$alpha_x1 = 5;</pre><br/><span class='lineno'>01511</span><pre class='pre'>			$alpha_x2 = $width_i - 5;</pre><br/><span class='lineno'>01512</span><pre class='pre'></pre><br/><span class='lineno'>01513</span><pre class='pre'>			$alpha_y1 = $height_i - ($fsize + 10) - 5;</pre><br/><span class='lineno'>01514</span><pre class='pre'>			$alpha_y2 = $height_i - 5;</pre><br/><span class='lineno'>01515</span><pre class='pre'></pre><br/><span class='lineno'>01516</span><pre class='pre'>			// ã¯ã¬ã¸ããæ¸ãè¾¼ã¿ä½ç½®</pre><br/><span class='lineno'>01517</span><pre class='pre'>			$tx = $alpha_x1 + 5;</pre><br/><span class='lineno'>01518</span><pre class='pre'>			$ty = $alpha_y1 + $fsize + 5;</pre><br/><span class='lineno'>01519</span><pre class='pre'></pre><br/><span class='lineno'>01520</span><pre class='pre'>			// ãã­ã¹ãã«ã©ã¼ï¼é»ï¼</pre><br/><span class='lineno'>01521</span><pre class='pre'>			$font_color_b = ImageColorAllocate ($img, 0, 0, 0);</pre><br/><span class='lineno'>01522</span><pre class='pre'>			// ãã­ã¹ãã«ã©ã¼ï¼ç½ï¼</pre><br/><span class='lineno'>01523</span><pre class='pre'>			$font_color_w = ImageColorAllocate ($img, 255, 255, 255);</pre><br/><span class='lineno'>01524</span><pre class='pre'>			// ã¢ã«ãã¡ãã£ã³ãã«ï¼ã°ã¬ã¼ï¼</pre><br/><span class='lineno'>01525</span><pre class='pre'>			$alpha = imagecolorallocatealpha($img, 0, 0, 0, 90);</pre><br/><span class='lineno'>01526</span><pre class='pre'></pre><br/><span class='lineno'>01527</span><pre class='pre'>			// ç»åã®ä¸é¨ãéããã¤ã¡ã¼ã¸ã«ãã¾ãã</pre><br/><span class='lineno'>01528</span><pre class='pre'>			imagefilledrectangle ($img , $alpha_x1 , $alpha_y1, $alpha_x2, $alpha_y2, $alpha);</pre><br/><span class='lineno'>01529</span><pre class='pre'></pre><br/><span class='lineno'>01530</span><pre class='pre'>			//ãã­ã¹ãæç»</pre><br/><span class='lineno'>01531</span><pre class='pre'>			ImageTTFText($img, $fsize, $font_angle, $tx, $ty, $font_color_w, $this-&gt;font_name, $telop_text);</pre><br/><span class='lineno'>01532</span><pre class='pre'>			ImageTTFText($img, $fsize, $font_angle, $tx, $ty, $font_color_w, $this-&gt;font_name, $telop_text);</pre><br/><span class='lineno'>01533</span><pre class='pre'>		}</pre><br/><span class='lineno'>01534</span><pre class='pre'>		return $img;</pre><br/><span class='lineno'>01535</span><pre class='pre'>	}</pre><br/><span class='lineno'>01536</span><pre class='pre'></pre><br/><span class='lineno'>01537</span><pre class='pre'>	/**</pre><br/><span class='lineno'>01538</span><pre class='pre'>	 * ãã¡ã¤ã«ãã¢ããã­ã¼ããã¾ãã</pre><br/><span class='lineno'>01539</span><pre class='pre'>	 */</pre><br/><span class='lineno'>01540</span><pre class='pre'>	function upload($imagedir)</pre><br/><span class='lineno'>01541</span><pre class='pre'>	{</pre><br/><span class='lineno'>01542</span><pre class='pre'>		// ãã§ãã¯ã§ã¨ã©ã¼ãçºçãã¦ããå ´åã¯ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>01543</span><pre class='pre'>		if ($this-&gt;result == false)</pre><br/><span class='lineno'>01544</span><pre class='pre'>		{</pre><br/><span class='lineno'>01545</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01546</span><pre class='pre'>		}</pre><br/><span class='lineno'>01547</span><pre class='pre'></pre><br/><span class='lineno'>01548</span><pre class='pre'>		// ä¿å­ç¨ãã¡ã¤ã«åãYmdHis999.xxxï¼åãæ¡å¼µå­ï¼ã§çæãã¾ãã</pre><br/><span class='lineno'>01549</span><pre class='pre'>		$reg_time = time();												// ç»é²æ¥æ</pre><br/><span class='lineno'>01550</span><pre class='pre'>		$rnd = rand(1, 10000);											// ä¹±æ°1-10000</pre><br/><span class='lineno'>01551</span><pre class='pre'>		$this-&gt;dirno = rand(0, 9);										// ãã£ã¬ã¯ããªåï¼0-9ï¼ãã©ã³ãã ã§æ±ºå®ãã¾ãã</pre><br/><span class='lineno'>01552</span><pre class='pre'>		$this-&gt;dirno .= &quot;/&quot;;</pre><br/><span class='lineno'>01553</span><pre class='pre'>		$this-&gt;svname = date(&quot;YmdHis&quot;, $reg_time) . $rnd;				// ä¿å­ãã¡ã¤ã«åï¼åï¼</pre><br/><span class='lineno'>01554</span><pre class='pre'></pre><br/><span class='lineno'>01555</span><pre class='pre'>		// ä¸æ¦ããã³ãã©ãªã¼ã«ã¢ãããããã¡ã¤ã«ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>01556</span><pre class='pre'>		$tmppath = $this-&gt;uploadconf['temp_dir'].$this-&gt;svname.$this-&gt;ext;</pre><br/><span class='lineno'>01557</span><pre class='pre'>		//$cmdstr = &quot;cp ./temporary/&quot;.$this-&gt;filename.&quot; &quot;.$tmppath;</pre><br/><span class='lineno'>01558</span><pre class='pre'>		$cmdstr = &quot;cp &quot;.$imagedir.$this-&gt;filename.&quot; &quot;.$tmppath;</pre><br/><span class='lineno'>01559</span><pre class='pre'></pre><br/><span class='lineno'>01560</span><pre class='pre'>		echo exec( $cmdstr );</pre><br/><span class='lineno'>01561</span><pre class='pre'></pre><br/><span class='lineno'>01562</span><pre class='pre'>		// ä¿å­ãããã¡ã¤ã«ã®ã¿ã¤ããåå¾ãã¾ãã</pre><br/><span class='lineno'>01563</span><pre class='pre'>		$type = exif_imagetype($this-&gt;uploadconf['temp_dir'].$this-&gt;svname . $this-&gt;ext);</pre><br/><span class='lineno'>01564</span><pre class='pre'></pre><br/><span class='lineno'>01565</span><pre class='pre'>		if ($type == IMAGETYPE_GIF || $type == IMAGETYPE_JPEG || $type == IMAGETYPE_PNG)</pre><br/><span class='lineno'>01566</span><pre class='pre'>		{</pre><br/><span class='lineno'>01567</span><pre class='pre'>			// ãã¡ã¤ã«ã¿ã¤ããGIFãJPEGãPNGã ã£ãå ´åã¯ãã³ãã©ãªã¼&rarr;ã¢ããã­ã¼ããã£ã¬ã¯ããªã«ãã¡ã¤ã«ãç§»åãã¾ãã</pre><br/><span class='lineno'>01568</span><pre class='pre'>			$this-&gt;svfullpath = array();</pre><br/><span class='lineno'>01569</span><pre class='pre'>			$this-&gt;svfullpath[] = $this-&gt;uploadconf['dir']. $this-&gt;dirno . $this-&gt;svname . $this-&gt;ext;</pre><br/><span class='lineno'>01570</span><pre class='pre'></pre><br/><span class='lineno'>01571</span><pre class='pre'>			$cmdstr = &quot;mv &quot;.$tmppath.&quot; &quot;.$this-&gt;svfullpath[0];</pre><br/><span class='lineno'>01572</span><pre class='pre'>			echo exec( $cmdstr );</pre><br/><span class='lineno'>01573</span><pre class='pre'></pre><br/><span class='lineno'>01574</span><pre class='pre'>			// ç»åã®ãµã¤ãºãåå¾ãã¾ãã</pre><br/><span class='lineno'>01575</span><pre class='pre'>			$this-&gt;img_width = array();</pre><br/><span class='lineno'>01576</span><pre class='pre'>			$this-&gt;img_height = array();</pre><br/><span class='lineno'>01577</span><pre class='pre'>			$size = @getimagesize($this-&gt;svfullpath[0]);</pre><br/><span class='lineno'>01578</span><pre class='pre'>			list($width, $height, $type, $attr) = $size;</pre><br/><span class='lineno'>01579</span><pre class='pre'>			$this-&gt;img_width[] = $width;</pre><br/><span class='lineno'>01580</span><pre class='pre'>			$this-&gt;img_height[] = $height;</pre><br/><span class='lineno'>01581</span><pre class='pre'></pre><br/><span class='lineno'>01582</span><pre class='pre'>			// ã¢ããã­ã¼ãããããã¡ã¤ã«åãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01583</span><pre class='pre'>			$this-&gt;up_url = array();</pre><br/><span class='lineno'>01584</span><pre class='pre'>			$this-&gt;up_url[] = $this-&gt;uploadconf['site_url'] . $this-&gt;svfullpath[0];</pre><br/><span class='lineno'>01585</span><pre class='pre'>		}</pre><br/><span class='lineno'>01586</span><pre class='pre'>		else</pre><br/><span class='lineno'>01587</span><pre class='pre'>		{</pre><br/><span class='lineno'>01588</span><pre class='pre'>			// ãã¡ã¤ã«ã¿ã¤ããããä»¥å¤ã®å ´åã¯ãã®ãã¡ã¤ã«ãåé¤ãã¾ãã</pre><br/><span class='lineno'>01589</span><pre class='pre'>			unlink($tmppath);</pre><br/><span class='lineno'>01590</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>01591</span><pre class='pre'>			$this-&gt;message = &quot;ã¢ããã­ã¼ããããã¡ã¤ã«ã¿ã¤ããjpg,gif,pngä»¥å¤ã§ãã&quot;;</pre><br/><span class='lineno'>01592</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01593</span><pre class='pre'>		}</pre><br/><span class='lineno'>01594</span><pre class='pre'>	}</pre><br/><span class='lineno'>01595</span><pre class='pre'></pre><br/><span class='lineno'>01596</span><pre class='pre'>	/**</pre><br/><span class='lineno'>01597</span><pre class='pre'>	 * ã¯ã¬ã¸ããæ¸ãè¾¼ã¿ç¨ã®ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>01598</span><pre class='pre'>	 */</pre><br/><span class='lineno'>01599</span><pre class='pre'>	function decide_fontsize($thwidth)</pre><br/><span class='lineno'>01600</span><pre class='pre'>	{</pre><br/><span class='lineno'>01601</span><pre class='pre'>		global $credit_fontsize;</pre><br/><span class='lineno'>01602</span><pre class='pre'></pre><br/><span class='lineno'>01603</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸è¾¼ç¨ãã©ã³ããµã¤ãºãè¨­å®ããã¦ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>01604</span><pre class='pre'>		if (count($credit_fontsize)&lt;6)</pre><br/><span class='lineno'>01605</span><pre class='pre'>		{</pre><br/><span class='lineno'>01606</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>01607</span><pre class='pre'>			$this-&gt;message = &quot;ã¯ã¬ã¸ããæ¸è¾¼ç¨ãã©ã³ããµã¤ãºãæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01608</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01609</span><pre class='pre'>		}</pre><br/><span class='lineno'>01610</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸è¾¼ç¨ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>01611</span><pre class='pre'>		if ($thwidth &lt;= 160)</pre><br/><span class='lineno'>01612</span><pre class='pre'>		{</pre><br/><span class='lineno'>01613</span><pre class='pre'>			$font_size = $credit_fontsize[0];</pre><br/><span class='lineno'>01614</span><pre class='pre'>		}</pre><br/><span class='lineno'>01615</span><pre class='pre'>		else if ($thwidth &lt;= 320)</pre><br/><span class='lineno'>01616</span><pre class='pre'>		{</pre><br/><span class='lineno'>01617</span><pre class='pre'>			$font_size = $credit_fontsize[1];</pre><br/><span class='lineno'>01618</span><pre class='pre'>		}</pre><br/><span class='lineno'>01619</span><pre class='pre'>		else if ($thwidth &lt;= 480)</pre><br/><span class='lineno'>01620</span><pre class='pre'>		{</pre><br/><span class='lineno'>01621</span><pre class='pre'>			$font_size = $credit_fontsize[2];</pre><br/><span class='lineno'>01622</span><pre class='pre'>		}</pre><br/><span class='lineno'>01623</span><pre class='pre'>		else if ($thwidth &lt;= 640)</pre><br/><span class='lineno'>01624</span><pre class='pre'>		{</pre><br/><span class='lineno'>01625</span><pre class='pre'>			$font_size = $credit_fontsize[3];</pre><br/><span class='lineno'>01626</span><pre class='pre'>		}</pre><br/><span class='lineno'>01627</span><pre class='pre'>		else if ($thwidth &lt;= 800)</pre><br/><span class='lineno'>01628</span><pre class='pre'>		{</pre><br/><span class='lineno'>01629</span><pre class='pre'>			$font_size = $credit_fontsize[4];</pre><br/><span class='lineno'>01630</span><pre class='pre'>		}</pre><br/><span class='lineno'>01631</span><pre class='pre'>		else</pre><br/><span class='lineno'>01632</span><pre class='pre'>		{</pre><br/><span class='lineno'>01633</span><pre class='pre'>			$font_size = $credit_fontsize[5];</pre><br/><span class='lineno'>01634</span><pre class='pre'>		}</pre><br/><span class='lineno'>01635</span><pre class='pre'></pre><br/><span class='lineno'>01636</span><pre class='pre'>		return $font_size;</pre><br/><span class='lineno'>01637</span><pre class='pre'>	}</pre><br/><span class='lineno'>01638</span><pre class='pre'></pre><br/><span class='lineno'>01639</span><pre class='pre'>	/**</pre><br/><span class='lineno'>01640</span><pre class='pre'>	 * ãµã ãã¤ã«ãä½æãã¾ãã</pre><br/><span class='lineno'>01641</span><pre class='pre'>	 *  åãã¡ã¤ã«ã¨ç¸¦ã»æ¨ªåãæ¯çã§ä½æãã¾ãã</pre><br/><span class='lineno'>01642</span><pre class='pre'>	 *    â» bmpã¯GDé¢æ°ç¡ãããä½æã§ãã¾ããã</pre><br/><span class='lineno'>01643</span><pre class='pre'>	 */</pre><br/><span class='lineno'>01644</span><pre class='pre'>	function make_thumbfile()</pre><br/><span class='lineno'>01645</span><pre class='pre'>	{</pre><br/><span class='lineno'>01646</span><pre class='pre'>		// ãã§ãã¯ã§ã¨ã©ã¼ãçºçãã¦ããå ´åã¯ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>01647</span><pre class='pre'>		if ($this-&gt;result == false)</pre><br/><span class='lineno'>01648</span><pre class='pre'>		{</pre><br/><span class='lineno'>01649</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01650</span><pre class='pre'>		}</pre><br/><span class='lineno'>01651</span><pre class='pre'></pre><br/><span class='lineno'>01652</span><pre class='pre'>		// ãµã ãã¤ã«ãä½æããã¨ãã®åãã¡ã¤ã«ãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>01653</span><pre class='pre'>		$srcfilename = &quot;&quot;;</pre><br/><span class='lineno'>01654</span><pre class='pre'>		if (!empty($this-&gt;svfullpath[0]))</pre><br/><span class='lineno'>01655</span><pre class='pre'>		{</pre><br/><span class='lineno'>01656</span><pre class='pre'>			$srcfilename = $this-&gt;svfullpath[0];</pre><br/><span class='lineno'>01657</span><pre class='pre'>		}</pre><br/><span class='lineno'>01658</span><pre class='pre'>		else</pre><br/><span class='lineno'>01659</span><pre class='pre'>		{</pre><br/><span class='lineno'>01660</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>01661</span><pre class='pre'>			$this-&gt;message = &quot;ãµã ãã¤ã«ãä½æããåãã¡ã¤ã«ãæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01662</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01663</span><pre class='pre'>		}</pre><br/><span class='lineno'>01664</span><pre class='pre'></pre><br/><span class='lineno'>01665</span><pre class='pre'>		// ãµã ãã¤ã«ãä½æããã¨ãã®æ¨ªå¹ãè¨­å®ããã¦ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>01666</span><pre class='pre'>		if (empty($this-&gt;flwidth))</pre><br/><span class='lineno'>01667</span><pre class='pre'>		{</pre><br/><span class='lineno'>01668</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>01669</span><pre class='pre'>			$this-&gt;message = &quot;ãµã ãã¤ã«ãä½æããã¨ãã®æ¨ªå¹ãæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01670</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01671</span><pre class='pre'>		}</pre><br/><span class='lineno'>01672</span><pre class='pre'></pre><br/><span class='lineno'>01673</span><pre class='pre'>		// ãµã ãã¤ã«ãä½æãããã©ã«ããè¨­å®ããã¦ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>01674</span><pre class='pre'>		if (empty($this-&gt;thumbdir))</pre><br/><span class='lineno'>01675</span><pre class='pre'>		{</pre><br/><span class='lineno'>01676</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>01677</span><pre class='pre'>			$this-&gt;message = &quot;ãµã ãã¤ã«ãä½æãããã©ã«ããæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01678</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01679</span><pre class='pre'>		}</pre><br/><span class='lineno'>01680</span><pre class='pre'></pre><br/><span class='lineno'>01681</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸è¾¼ç¨ãã©ã³ãåãè¨­å®ããã¦ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>01682</span><pre class='pre'>		if (empty($this-&gt;font_name))</pre><br/><span class='lineno'>01683</span><pre class='pre'>		{</pre><br/><span class='lineno'>01684</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>01685</span><pre class='pre'>			$this-&gt;message = &quot;ã¯ã¬ã¸ããæ¸è¾¼ç¨ãã©ã³ãåãæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01686</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01687</span><pre class='pre'>		}</pre><br/><span class='lineno'>01688</span><pre class='pre'></pre><br/><span class='lineno'>01689</span><pre class='pre'>		// ã¯ã¬ã¸ãããæ¸ãè¾¼ããã©ãããè¨­å®ããã¦ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>01690</span><pre class='pre'>		if (empty($this-&gt;write_ok))</pre><br/><span class='lineno'>01691</span><pre class='pre'>		{</pre><br/><span class='lineno'>01692</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>01693</span><pre class='pre'>			$this-&gt;message = &quot;ã¯ã¬ã¸ãããæ¸ãè¾¼ããã©ãããæå®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>01694</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01695</span><pre class='pre'>		}</pre><br/><span class='lineno'>01696</span><pre class='pre'></pre><br/><span class='lineno'>01697</span><pre class='pre'>		// ç»åã®ãµã¤ãºãåå¾ãã¾ãã</pre><br/><span class='lineno'>01698</span><pre class='pre'>		$size = @getimagesize($srcfilename);</pre><br/><span class='lineno'>01699</span><pre class='pre'>		list($width, $height, $type, $attr) = $size;</pre><br/><span class='lineno'>01700</span><pre class='pre'></pre><br/><span class='lineno'>01701</span><pre class='pre'>		// è¨­å®ããã¦ãããµã ãã¤ã«ã®ãµã¤ãºã¨ãã©ã«ãã®æ°ãæ¯è¼ãã¾ãã</pre><br/><span class='lineno'>01702</span><pre class='pre'>		$szmax = count($this-&gt;flwidth);</pre><br/><span class='lineno'>01703</span><pre class='pre'>		$dirmax = count($this-&gt;thumbdir);</pre><br/><span class='lineno'>01704</span><pre class='pre'>		if ($dirmax &lt; $szmax)</pre><br/><span class='lineno'>01705</span><pre class='pre'>		{</pre><br/><span class='lineno'>01706</span><pre class='pre'>			$this-&gt;result = false;</pre><br/><span class='lineno'>01707</span><pre class='pre'>			$this-&gt;message = &quot;ãµã ãã¤ã«ãä¿å­ãããã©ã«ãã®æ°ãè¶³ãã¾ããã&quot;;</pre><br/><span class='lineno'>01708</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>01709</span><pre class='pre'>		}</pre><br/><span class='lineno'>01710</span><pre class='pre'></pre><br/><span class='lineno'>01711</span><pre class='pre'>		// ãµã ãã¤ã«ãä½æããã¨ãã®æ¨ªå¹ãè¨­å®ããã¦ããåã ãããµã ãã¤ã«ãä½æãã¾ãã</pre><br/><span class='lineno'>01712</span><pre class='pre'>		for ($i = 0 ; $i &lt; $szmax ; $i++)</pre><br/><span class='lineno'>01713</span><pre class='pre'>		{</pre><br/><span class='lineno'>01714</span><pre class='pre'>			if((int)$i == (int)($szmax - 1) || (int)$i == (int)($szmax - 2))</pre><br/><span class='lineno'>01715</span><pre class='pre'>			{</pre><br/><span class='lineno'>01716</span><pre class='pre'>				//thumb4</pre><br/><span class='lineno'>01717</span><pre class='pre'>				if((int)$i == (int)($szmax - 1))</pre><br/><span class='lineno'>01718</span><pre class='pre'>				{</pre><br/><span class='lineno'>01719</span><pre class='pre'>					$photo_filename_th1 = $this-&gt;up_url[1];</pre><br/><span class='lineno'>01720</span><pre class='pre'>					$tmp = substr($photo_filename_th1,strpos($photo_filename_th1,&quot;./&quot;));</pre><br/><span class='lineno'>01721</span><pre class='pre'>					$tmp1 = str_replace(&quot;th1&quot;,&quot;th4&quot;,$tmp);</pre><br/><span class='lineno'>01722</span><pre class='pre'>					$tmp2 = str_replace(&quot;thumb1&quot;,&quot;thumb4&quot;,$tmp1);</pre><br/><span class='lineno'>01723</span><pre class='pre'>				} elseif((int)$i == (int)($szmax - 2)) {//thumb3</pre><br/><span class='lineno'>01724</span><pre class='pre'>					$photo_filename_th2 = $this-&gt;up_url[2];</pre><br/><span class='lineno'>01725</span><pre class='pre'>					$tmp = substr($photo_filename_th2,strpos($photo_filename_th2,&quot;./&quot;));</pre><br/><span class='lineno'>01726</span><pre class='pre'>					$tmp1 = str_replace(&quot;th2&quot;,&quot;th3&quot;,$tmp);</pre><br/><span class='lineno'>01727</span><pre class='pre'>					$tmp2 = str_replace(&quot;thumb2&quot;,&quot;thumb3&quot;,$tmp1);</pre><br/><span class='lineno'>01728</span><pre class='pre'>				}</pre><br/><span class='lineno'>01729</span><pre class='pre'></pre><br/><span class='lineno'>01730</span><pre class='pre'>				$size = @getimagesize($tmp);</pre><br/><span class='lineno'>01731</span><pre class='pre'>				list($width, $height, $type, $attr) = $size;</pre><br/><span class='lineno'>01732</span><pre class='pre'></pre><br/><span class='lineno'>01733</span><pre class='pre'>				// ç¸¦ã»æ¨ªã®æ¯çãåããã¦ããµã ãã¤ã«ç¨ã®ç¸¦ãæ¨ªãè¨ç®ãã¾ãã</pre><br/><span class='lineno'>01734</span><pre class='pre'>				$thumb_width = $this-&gt;flwidth[$i];</pre><br/><span class='lineno'>01735</span><pre class='pre'>				if((int)$width &lt; $thumb_width)</pre><br/><span class='lineno'>01736</span><pre class='pre'>				{</pre><br/><span class='lineno'>01737</span><pre class='pre'>					$thumb_width = $width;</pre><br/><span class='lineno'>01738</span><pre class='pre'>				}</pre><br/><span class='lineno'>01739</span><pre class='pre'>				$thumb_height = ($thumb_width / $width) * $height;</pre><br/><span class='lineno'>01740</span><pre class='pre'>				// ç»åãµã¤ãºãã»ãããã¾ãã</pre><br/><span class='lineno'>01741</span><pre class='pre'>				$this-&gt;img_width[] = $thumb_width;</pre><br/><span class='lineno'>01742</span><pre class='pre'>				$this-&gt;img_height[] = $thumb_height;</pre><br/><span class='lineno'>01743</span><pre class='pre'></pre><br/><span class='lineno'>01744</span><pre class='pre'>				// ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>01745</span><pre class='pre'>				if((int)$i == (int)($szmax - 1))</pre><br/><span class='lineno'>01746</span><pre class='pre'>				{</pre><br/><span class='lineno'>01747</span><pre class='pre'>					if($width == 400)</pre><br/><span class='lineno'>01748</span><pre class='pre'>					{</pre><br/><span class='lineno'>01749</span><pre class='pre'>						$font_size = 88;</pre><br/><span class='lineno'>01750</span><pre class='pre'>					} elseif($width == 800) {</pre><br/><span class='lineno'>01751</span><pre class='pre'>						$font_size = 168;</pre><br/><span class='lineno'>01752</span><pre class='pre'>					} elseif($width == 200) {</pre><br/><span class='lineno'>01753</span><pre class='pre'>						$font_size = 38;</pre><br/><span class='lineno'>01754</span><pre class='pre'>					}</pre><br/><span class='lineno'>01755</span><pre class='pre'>				} elseif((int)$i == (int)($szmax - 2)) {//thumb3</pre><br/><span class='lineno'>01756</span><pre class='pre'>					$font_size = 38;</pre><br/><span class='lineno'>01757</span><pre class='pre'>				}</pre><br/><span class='lineno'>01758</span><pre class='pre'>				// ç»åã®ã¿ã¤ãã«åããã¦ããµã ãã¤ã«ãä½æãã¾ãã</pre><br/><span class='lineno'>01759</span><pre class='pre'>				if ($type == IMAGETYPE_JPEG)</pre><br/><span class='lineno'>01760</span><pre class='pre'>				{</pre><br/><span class='lineno'>01761</span><pre class='pre'>					// ã¢ããã­ã¼ããããã¡ã¤ã«ãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01762</span><pre class='pre'>					$ufimage = @ImageCreateFromJPEG($tmp);</pre><br/><span class='lineno'>01763</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åãä½æãã¾ãã</pre><br/><span class='lineno'>01764</span><pre class='pre'>					$thumb = @ImageCreateTrueColor($thumb_width, $thumb_height);</pre><br/><span class='lineno'>01765</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åã«ã¢ããã­ã¼ããããã¡ã¤ã«ãã³ãã¼ãã¾ãã</pre><br/><span class='lineno'>01766</span><pre class='pre'>					@imagecopyresampled($thumb, $ufimage, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);</pre><br/><span class='lineno'>01767</span><pre class='pre'>					// ç»åã«ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01768</span><pre class='pre'>					$thumb = $this-&gt;write_credit2($thumb, &quot;SAMPLE&quot;, $font_size, $thumb_width, $thumb_height);</pre><br/><span class='lineno'>01769</span><pre class='pre'>					@imagejpeg($thumb, $tmp2);</pre><br/><span class='lineno'>01770</span><pre class='pre'>				}</pre><br/><span class='lineno'>01771</span><pre class='pre'>				else if ($type == IMAGETYPE_GIF)</pre><br/><span class='lineno'>01772</span><pre class='pre'>				{</pre><br/><span class='lineno'>01773</span><pre class='pre'>					// ã¢ããã­ã¼ããããã¡ã¤ã«ãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01774</span><pre class='pre'>					$ufimage = @ImageCreateFromGIF($tmp);</pre><br/><span class='lineno'>01775</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åãä½æãã¾ãã</pre><br/><span class='lineno'>01776</span><pre class='pre'>					$thumb = @ImageCreateTrueColor($thumb_width, $thumb_height);</pre><br/><span class='lineno'>01777</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åã«ã¢ããã­ã¼ããããã¡ã¤ã«ãã³ãã¼ãã¾ãã</pre><br/><span class='lineno'>01778</span><pre class='pre'>					@imagecopyresampled($thumb, $ufimage, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);</pre><br/><span class='lineno'>01779</span><pre class='pre'>					// ç»åã«ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01780</span><pre class='pre'>					$thumb = $this-&gt;write_credit2($thumb, &quot;SAMPLE&quot;, $font_size, $thumb_width, $thumb_height);</pre><br/><span class='lineno'>01781</span><pre class='pre'>					@imagegif($thumb, $tmp2);</pre><br/><span class='lineno'>01782</span><pre class='pre'>				}</pre><br/><span class='lineno'>01783</span><pre class='pre'>				else if ($type == IMAGETYPE_PNG)</pre><br/><span class='lineno'>01784</span><pre class='pre'>				{</pre><br/><span class='lineno'>01785</span><pre class='pre'>					// ã¢ããã­ã¼ããããã¡ã¤ã«ãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01786</span><pre class='pre'>					$ufimage = @ImageCreateFromPNG($tmp);</pre><br/><span class='lineno'>01787</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åãä½æãã¾ãã</pre><br/><span class='lineno'>01788</span><pre class='pre'>					$thumb = @ImageCreateTrueColor($thumb_width, $thumb_height);</pre><br/><span class='lineno'>01789</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åã«ã¢ããã­ã¼ããããã¡ã¤ã«ãã³ãã¼ãã¾ãã</pre><br/><span class='lineno'>01790</span><pre class='pre'>					@imagecopyresampled($thumb, $ufimage, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);</pre><br/><span class='lineno'>01791</span><pre class='pre'>					// ç»åã«ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01792</span><pre class='pre'>					$thumb = $this-&gt;write_credit2($thumb, &quot;SAMPLE&quot;, $font_size, $thumb_width, $thumb_height);</pre><br/><span class='lineno'>01793</span><pre class='pre'>					@imagepng($thumb, $tmp2);</pre><br/><span class='lineno'>01794</span><pre class='pre'>				}</pre><br/><span class='lineno'>01795</span><pre class='pre'></pre><br/><span class='lineno'>01796</span><pre class='pre'>				// ã¢ããã­ã¼ãããããã¡ã¤ã«åãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01797</span><pre class='pre'>				$this-&gt;svfullpath[] = $tmp2;</pre><br/><span class='lineno'>01798</span><pre class='pre'>				$this-&gt;up_url[] = $this-&gt;uploadconf['site_url'] . $tmp2;</pre><br/><span class='lineno'>01799</span><pre class='pre'></pre><br/><span class='lineno'>01800</span><pre class='pre'>				// ç»åãç ´æ£ãã¾ãã</pre><br/><span class='lineno'>01801</span><pre class='pre'>				@imagedestroy($ufimage);</pre><br/><span class='lineno'>01802</span><pre class='pre'>				@imagedestroy($thumb);</pre><br/><span class='lineno'>01803</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>01804</span><pre class='pre'>				// ç¸¦ã»æ¨ªã®æ¯çãåããã¦ããµã ãã¤ã«ç¨ã®ç¸¦ãæ¨ªãè¨ç®ãã¾ãã</pre><br/><span class='lineno'>01805</span><pre class='pre'>				$thumb_width = $this-&gt;flwidth[$i];</pre><br/><span class='lineno'>01806</span><pre class='pre'>				if((int)$width &lt; $thumb_width)</pre><br/><span class='lineno'>01807</span><pre class='pre'>				{</pre><br/><span class='lineno'>01808</span><pre class='pre'>					$thumb_width = $width;</pre><br/><span class='lineno'>01809</span><pre class='pre'>				}</pre><br/><span class='lineno'>01810</span><pre class='pre'>				$thumb_height = ($thumb_width / $width) * $height;</pre><br/><span class='lineno'>01811</span><pre class='pre'>				// ç»åãµã¤ãºãã»ãããã¾ãã</pre><br/><span class='lineno'>01812</span><pre class='pre'>				$this-&gt;img_width[] = $thumb_width;</pre><br/><span class='lineno'>01813</span><pre class='pre'>				$this-&gt;img_height[] = $thumb_height;</pre><br/><span class='lineno'>01814</span><pre class='pre'></pre><br/><span class='lineno'>01815</span><pre class='pre'>				// ç»åã®ã¿ã¤ãã«åããã¦ããµã ãã¤ã«ãä½æãã¾ãã</pre><br/><span class='lineno'>01816</span><pre class='pre'>				if ($type == IMAGETYPE_JPEG)</pre><br/><span class='lineno'>01817</span><pre class='pre'>				{</pre><br/><span class='lineno'>01818</span><pre class='pre'>					// ã¢ããã­ã¼ããããã¡ã¤ã«ãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01819</span><pre class='pre'>					$ufimage = @ImageCreateFromJPEG($srcfilename);</pre><br/><span class='lineno'>01820</span><pre class='pre'></pre><br/><span class='lineno'>01821</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åãä½æãã¾ãã</pre><br/><span class='lineno'>01822</span><pre class='pre'>					$thumb = @ImageCreateTrueColor($thumb_width, $thumb_height);</pre><br/><span class='lineno'>01823</span><pre class='pre'></pre><br/><span class='lineno'>01824</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åã«ã¢ããã­ã¼ããããã¡ã¤ã«ãã³ãã¼ãã¾ãã</pre><br/><span class='lineno'>01825</span><pre class='pre'>					@imagecopyresampled($thumb, $ufimage, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);</pre><br/><span class='lineno'>01826</span><pre class='pre'></pre><br/><span class='lineno'>01827</span><pre class='pre'>					// ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01828</span><pre class='pre'>					//if ($this-&gt;write_ok[$i] == true)</pre><br/><span class='lineno'>01829</span><pre class='pre'>					if ($this-&gt;write_ok[$i] == true &amp;&amp; !empty($this-&gt;credit) &amp;&amp; strlen($this-&gt;credit) &gt; 0)</pre><br/><span class='lineno'>01830</span><pre class='pre'>					{</pre><br/><span class='lineno'>01831</span><pre class='pre'>						// ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>01832</span><pre class='pre'>						$font_size = $this-&gt;decide_fontsize($thumb_width);</pre><br/><span class='lineno'>01833</span><pre class='pre'></pre><br/><span class='lineno'>01834</span><pre class='pre'>						// ç»åã«ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01835</span><pre class='pre'>						$thumb = $this-&gt;write_credit($thumb, $this-&gt;credit, $font_size, $thumb_width, $thumb_height);</pre><br/><span class='lineno'>01836</span><pre class='pre'>					}</pre><br/><span class='lineno'>01837</span><pre class='pre'></pre><br/><span class='lineno'>01838</span><pre class='pre'>					// ãã¡ã¤ã«ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>01839</span><pre class='pre'>					$thfilename = $this-&gt;thumbdir[$i] . $this-&gt;dirno . $this-&gt;svname . &quot;th&quot; . ($i + 1) . $this-&gt;ext;</pre><br/><span class='lineno'>01840</span><pre class='pre'>					@imagejpeg($thumb, $thfilename);</pre><br/><span class='lineno'>01841</span><pre class='pre'>				}</pre><br/><span class='lineno'>01842</span><pre class='pre'>				else if ($type == IMAGETYPE_GIF)</pre><br/><span class='lineno'>01843</span><pre class='pre'>				{</pre><br/><span class='lineno'>01844</span><pre class='pre'>					// ã¢ããã­ã¼ããããã¡ã¤ã«ãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01845</span><pre class='pre'>					$ufimage = @ImageCreateFromGIF($srcfilename);</pre><br/><span class='lineno'>01846</span><pre class='pre'></pre><br/><span class='lineno'>01847</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åãä½æãã¾ãã</pre><br/><span class='lineno'>01848</span><pre class='pre'>					$thumb = @ImageCreateTrueColor($thumb_width, $thumb_height);</pre><br/><span class='lineno'>01849</span><pre class='pre'></pre><br/><span class='lineno'>01850</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åã«ã¢ããã­ã¼ããããã¡ã¤ã«ãã³ãã¼ãã¾ãã</pre><br/><span class='lineno'>01851</span><pre class='pre'>					@imagecopyresampled($thumb, $ufimage, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);</pre><br/><span class='lineno'>01852</span><pre class='pre'></pre><br/><span class='lineno'>01853</span><pre class='pre'>					// ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01854</span><pre class='pre'>					//if ($this-&gt;write_ok[$i] == true)</pre><br/><span class='lineno'>01855</span><pre class='pre'>					if ($this-&gt;write_ok[$i] == true &amp;&amp; !empty($this-&gt;credit) &amp;&amp; strlen($this-&gt;credit) &gt; 0)</pre><br/><span class='lineno'>01856</span><pre class='pre'>					{</pre><br/><span class='lineno'>01857</span><pre class='pre'>						// ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>01858</span><pre class='pre'>						$font_size = $this-&gt;decide_fontsize($thumb_width);</pre><br/><span class='lineno'>01859</span><pre class='pre'></pre><br/><span class='lineno'>01860</span><pre class='pre'>						// ç»åã«ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01861</span><pre class='pre'>						$thumb = $this-&gt;write_credit($thumb, $this-&gt;credit, $font_size, $thumb_width, $thumb_height);</pre><br/><span class='lineno'>01862</span><pre class='pre'>					}</pre><br/><span class='lineno'>01863</span><pre class='pre'></pre><br/><span class='lineno'>01864</span><pre class='pre'>					// ãã¡ã¤ã«ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>01865</span><pre class='pre'>					$thfilename = $this-&gt;thumbdir[$i] . $this-&gt;dirno . $this-&gt;svname . &quot;th&quot; . ($i + 1) . $this-&gt;ext;</pre><br/><span class='lineno'>01866</span><pre class='pre'>					@imagegif($thumb, $thfilename);</pre><br/><span class='lineno'>01867</span><pre class='pre'>				}</pre><br/><span class='lineno'>01868</span><pre class='pre'>				else if ($type == IMAGETYPE_PNG)</pre><br/><span class='lineno'>01869</span><pre class='pre'>				{</pre><br/><span class='lineno'>01870</span><pre class='pre'>					// ã¢ããã­ã¼ããããã¡ã¤ã«ãèª­ã¿è¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01871</span><pre class='pre'>					$ufimage = @ImageCreateFromPNG($srcfilename);</pre><br/><span class='lineno'>01872</span><pre class='pre'></pre><br/><span class='lineno'>01873</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åãä½æãã¾ãã</pre><br/><span class='lineno'>01874</span><pre class='pre'>					$thumb = @ImageCreateTrueColor($thumb_width, $thumb_height);</pre><br/><span class='lineno'>01875</span><pre class='pre'></pre><br/><span class='lineno'>01876</span><pre class='pre'>					// ç©ºã®ãµã ãã¤ã«ç»åã«ã¢ããã­ã¼ããããã¡ã¤ã«ãã³ãã¼ãã¾ãã</pre><br/><span class='lineno'>01877</span><pre class='pre'>					@imagecopyresampled($thumb, $ufimage, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);</pre><br/><span class='lineno'>01878</span><pre class='pre'></pre><br/><span class='lineno'>01879</span><pre class='pre'>					// ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01880</span><pre class='pre'>					//if ($this-&gt;write_ok[$i] == true)</pre><br/><span class='lineno'>01881</span><pre class='pre'>					if ($this-&gt;write_ok[$i] == true &amp;&amp; !empty($this-&gt;credit) &amp;&amp; strlen($this-&gt;credit) &gt; 0)</pre><br/><span class='lineno'>01882</span><pre class='pre'>					{</pre><br/><span class='lineno'>01883</span><pre class='pre'>						// ãã©ã³ããµã¤ãºãæ±ºå®ãã¾ãã</pre><br/><span class='lineno'>01884</span><pre class='pre'>						$font_size = $this-&gt;decide_fontsize($thumb_width);</pre><br/><span class='lineno'>01885</span><pre class='pre'></pre><br/><span class='lineno'>01886</span><pre class='pre'>						// ç»åã«ã¯ã¬ã¸ãããæ¸ãè¾¼ã¿ã¾ãã</pre><br/><span class='lineno'>01887</span><pre class='pre'>						$thumb = $this-&gt;write_credit($thumb, $this-&gt;credit, $font_size, $thumb_width, $thumb_height);</pre><br/><span class='lineno'>01888</span><pre class='pre'>					}</pre><br/><span class='lineno'>01889</span><pre class='pre'></pre><br/><span class='lineno'>01890</span><pre class='pre'>					// ãã¡ã¤ã«ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>01891</span><pre class='pre'>					$thfilename = $this-&gt;thumbdir[$i] . $this-&gt;dirno . $this-&gt;svname . &quot;th&quot; . ($i + 1) . $this-&gt;ext;</pre><br/><span class='lineno'>01892</span><pre class='pre'>					@imagepng($thumb, $thfilename);</pre><br/><span class='lineno'>01893</span><pre class='pre'>				}</pre><br/><span class='lineno'>01894</span><pre class='pre'></pre><br/><span class='lineno'>01895</span><pre class='pre'>				// ã¢ããã­ã¼ãããããã¡ã¤ã«åãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01896</span><pre class='pre'>				$this-&gt;svfullpath[] = $thfilename;</pre><br/><span class='lineno'>01897</span><pre class='pre'>				$this-&gt;up_url[] = $this-&gt;uploadconf['site_url'] . $thfilename;</pre><br/><span class='lineno'>01898</span><pre class='pre'></pre><br/><span class='lineno'>01899</span><pre class='pre'>				// ç»åãç ´æ£ãã¾ãã</pre><br/><span class='lineno'>01900</span><pre class='pre'>				@imagedestroy($ufimage);</pre><br/><span class='lineno'>01901</span><pre class='pre'>				@imagedestroy($thumb);</pre><br/><span class='lineno'>01902</span><pre class='pre'>			}</pre><br/><span class='lineno'>01903</span><pre class='pre'>		}</pre><br/><span class='lineno'>01904</span><pre class='pre'>		return true;</pre><br/><span class='lineno'>01905</span><pre class='pre'>	}</pre><br/><span class='lineno'>01906</span><pre class='pre'></pre><br/><span class='lineno'>01907</span><pre class='pre'>	function write_credit2($img, $cre_str, $fsize, $width_i, $height_i)</pre><br/><span class='lineno'>01908</span><pre class='pre'>	{</pre><br/><span class='lineno'>01909</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸ãè¾¼ã¿ç¨ã®è¨­å®ãè¡ãã¾ãã</pre><br/><span class='lineno'>01910</span><pre class='pre'>		// æ¸ãè¾¼ã¿è§åº¦ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01911</span><pre class='pre'>		$font_angle = 0;</pre><br/><span class='lineno'>01912</span><pre class='pre'></pre><br/><span class='lineno'>01913</span><pre class='pre'>		//GDç°å¢æå ±ãåå¾ãã¾ãã</pre><br/><span class='lineno'>01914</span><pre class='pre'>		$arrInfo = gd_info();</pre><br/><span class='lineno'>01915</span><pre class='pre'></pre><br/><span class='lineno'>01916</span><pre class='pre'>		// æ¸ãè¾¼ãã¯ã¬ã¸ãããè¨­å®ãã¾ãã</pre><br/><span class='lineno'>01917</span><pre class='pre'>		$telop_text = &quot;&quot;;</pre><br/><span class='lineno'>01918</span><pre class='pre'>		if ($arrInfo['JIS-mapped Japanese Font Support']) {</pre><br/><span class='lineno'>01919</span><pre class='pre'>			// GDãå¯¾å¿ãã¦ããå ´åã¯UTF-8ã¸ã®å¤æã¯ä¸è¦ã§ãã</pre><br/><span class='lineno'>01920</span><pre class='pre'>			$telop_text = $cre_str;</pre><br/><span class='lineno'>01921</span><pre class='pre'>		}</pre><br/><span class='lineno'>01922</span><pre class='pre'>		else</pre><br/><span class='lineno'>01923</span><pre class='pre'>		{</pre><br/><span class='lineno'>01924</span><pre class='pre'>			// çµè¾¼ã¿ãã­ã¹ã</pre><br/><span class='lineno'>01925</span><pre class='pre'>			// GDãå¯¾å¿ãã¦ããªãå ´åã¯UTF-8ã¸å¤æãã¾ããï¼UTF-8ã«å¤æããªãå ´åãæå­åããã¾ããï¼</pre><br/><span class='lineno'>01926</span><pre class='pre'>			$telop_text =  mb_convert_encoding($cre_str, &quot;UTF-8&quot;, &quot;auto&quot;);</pre><br/><span class='lineno'>01927</span><pre class='pre'>		}</pre><br/><span class='lineno'>01928</span><pre class='pre'></pre><br/><span class='lineno'>01929</span><pre class='pre'>		// åéæã®ã°ã¬ã¼ããã¯è¡¨ç¤ºä½ç½®</pre><br/><span class='lineno'>01930</span><pre class='pre'>		$alpha_x1 = 5;</pre><br/><span class='lineno'>01931</span><pre class='pre'>		$alpha_x2 = $width_i - 5;</pre><br/><span class='lineno'>01932</span><pre class='pre'></pre><br/><span class='lineno'>01933</span><pre class='pre'>		$alpha_y1 = $height_i - ($fsize + 10) - 5;</pre><br/><span class='lineno'>01934</span><pre class='pre'>		$alpha_y2 = $height_i - 5;</pre><br/><span class='lineno'>01935</span><pre class='pre'></pre><br/><span class='lineno'>01936</span><pre class='pre'>		// ã¯ã¬ã¸ããæ¸ãè¾¼ã¿ä½ç½®</pre><br/><span class='lineno'>01937</span><pre class='pre'>		if($width_i == 200)</pre><br/><span class='lineno'>01938</span><pre class='pre'>		{</pre><br/><span class='lineno'>01939</span><pre class='pre'>			$tx = $alpha_x1 + 22;</pre><br/><span class='lineno'>01940</span><pre class='pre'>			$ty = 92;</pre><br/><span class='lineno'>01941</span><pre class='pre'>		}</pre><br/><span class='lineno'>01942</span><pre class='pre'>		if($width_i == 400)</pre><br/><span class='lineno'>01943</span><pre class='pre'>		{</pre><br/><span class='lineno'>01944</span><pre class='pre'>			$tx = $width_i/2-170;</pre><br/><span class='lineno'>01945</span><pre class='pre'>			$ty = $height_i/2+35;</pre><br/><span class='lineno'>01946</span><pre class='pre'>		}</pre><br/><span class='lineno'>01947</span><pre class='pre'>		if($width_i == 800)</pre><br/><span class='lineno'>01948</span><pre class='pre'>		{</pre><br/><span class='lineno'>01949</span><pre class='pre'>			$tx = $width_i/2-334;</pre><br/><span class='lineno'>01950</span><pre class='pre'>			$ty = $height_i/2+65;</pre><br/><span class='lineno'>01951</span><pre class='pre'>		}</pre><br/><span class='lineno'>01952</span><pre class='pre'></pre><br/><span class='lineno'>01953</span><pre class='pre'>		// ã¢ã«ãã¡ãã£ã³ãã«ï¼ã°ã¬ã¼ï¼</pre><br/><span class='lineno'>01954</span><pre class='pre'>		$alpha = imagecolorallocatealpha($img, 255, 255, 255, 100);</pre><br/><span class='lineno'>01955</span><pre class='pre'></pre><br/><span class='lineno'>01956</span><pre class='pre'>		//ãã­ã¹ãæç»</pre><br/><span class='lineno'>01957</span><pre class='pre'>		ImageTTFText($img, $fsize, $font_angle, $tx, $ty, $alpha, &quot;./sazanami-gothic.ttf&quot;, $telop_text);</pre><br/><span class='lineno'>01958</span><pre class='pre'>		ImageTTFText($img, $fsize, $font_angle, $tx, $ty, $alpha, &quot;./sazanami-gothic.ttf&quot;, $telop_text);</pre><br/><span class='lineno'>01959</span><pre class='pre'></pre><br/><span class='lineno'>01960</span><pre class='pre'>		return $img;</pre><br/><span class='lineno'>01961</span><pre class='pre'>	}</pre><br/><span class='lineno'>01962</span><pre class='pre'>}</pre><br/><span class='lineno'>01963</span><pre class='pre'></pre><br/><span class='lineno'>01964</span><pre class='pre'>class RegistrationClassifications</pre><br/><span class='lineno'>01965</span><pre class='pre'>{</pre><br/><span class='lineno'>01966</span><pre class='pre'>	var $message;											// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>01967</span><pre class='pre'>	var $error;												// ã¨ã©ã¼</pre><br/><span class='lineno'>01968</span><pre class='pre'>	var $registration_classification_id;					// ç»é²åé¡ID</pre><br/><span class='lineno'>01969</span><pre class='pre'>	var $photo_id;											// åçID</pre><br/><span class='lineno'>01970</span><pre class='pre'></pre><br/><span class='lineno'>01971</span><pre class='pre'>	var $classification_id;									// åé¡ID</pre><br/><span class='lineno'>01972</span><pre class='pre'>	var $classification_name;								// åé¡</pre><br/><span class='lineno'>01973</span><pre class='pre'></pre><br/><span class='lineno'>01974</span><pre class='pre'>	var $direction_id;										// æ¹é¢ID</pre><br/><span class='lineno'>01975</span><pre class='pre'>	var $direction_name;									// æ¹é¢</pre><br/><span class='lineno'>01976</span><pre class='pre'></pre><br/><span class='lineno'>01977</span><pre class='pre'>	var $country_prefecture_id;								// å½ã»é½éåºçID</pre><br/><span class='lineno'>01978</span><pre class='pre'>	var $country_prefecture_name;							// å½ã»é½éåºç</pre><br/><span class='lineno'>01979</span><pre class='pre'></pre><br/><span class='lineno'>01980</span><pre class='pre'>	var $place_id;											// å°åID</pre><br/><span class='lineno'>01981</span><pre class='pre'>	var $place_name;										// å°å</pre><br/><span class='lineno'>01982</span><pre class='pre'></pre><br/><span class='lineno'>01983</span><pre class='pre'>	var $state;												// ç¶æ</pre><br/><span class='lineno'>01984</span><pre class='pre'>	var $count;												// æ°</pre><br/><span class='lineno'>01985</span><pre class='pre'></pre><br/><span class='lineno'>01986</span><pre class='pre'>	function __construct()</pre><br/><span class='lineno'>01987</span><pre class='pre'>	{</pre><br/><span class='lineno'>01988</span><pre title='' class='pre covered'>		$this-&gt;init_data();</pre><br/><span class='lineno'>01989</span><pre class='pre'>	}</pre><br/><span class='lineno'>01990</span><pre class='pre'></pre><br/><span class='lineno'>01991</span><pre class='pre'>	function init_data()</pre><br/><span class='lineno'>01992</span><pre class='pre'>	{</pre><br/><span class='lineno'>01993</span><pre class='pre'>		// åæåãã¾ãã</pre><br/><span class='lineno'>01994</span><pre title='' class='pre covered'>		$this-&gt;message = &quot;&quot;;</pre>								// ã¡ãã»ã¼ã¸<br/><span class='lineno'>01995</span><pre class='pre'>		$this-&gt;error = &quot;&quot;;</pre>									// ã¨ã©ã¼<br/><span class='lineno'>01996</span><pre class='pre'></pre><br/><span class='lineno'>01997</span><pre title='' class='pre covered'>		$this-&gt;registration_classification_id = array();</pre>	// ç»é²åé¡ID<br/><span class='lineno'>01998</span><pre class='pre'>		$this-&gt;photo_id = -1;</pre>								// åçID<br/><span class='lineno'>01999</span><pre class='pre'></pre><br/><span class='lineno'>02000</span><pre title='' class='pre covered'>		$this-&gt;classification_id = array();</pre>					// åé¡ID<br/><span class='lineno'>02001</span><pre class='pre'>		$this-&gt;classification_name = array();</pre>				// åé¡<br/><span class='lineno'>02002</span><pre class='pre'></pre><br/><span class='lineno'>02003</span><pre title='' class='pre covered'>		$this-&gt;direction_id = array();</pre>						// æ¹é¢ID<br/><span class='lineno'>02004</span><pre class='pre'>		$this-&gt;direction_name = array();</pre>					// æ¹é¢<br/><span class='lineno'>02005</span><pre class='pre'></pre><br/><span class='lineno'>02006</span><pre title='' class='pre covered'>		$this-&gt;country_prefecture_id = array();</pre>				// å½ã»é½éåºçID<br/><span class='lineno'>02007</span><pre class='pre'>		$this-&gt;country_prefecture_name = array();</pre>			// å½ã»é½éåºç<br/><span class='lineno'>02008</span><pre class='pre'></pre><br/><span class='lineno'>02009</span><pre title='' class='pre covered'>		$this-&gt;place_id = array();</pre>							// å°åID<br/><span class='lineno'>02010</span><pre class='pre'>		$this-&gt;place_name = array();</pre>						// å°å<br/><span class='lineno'>02011</span><pre class='pre'></pre><br/><span class='lineno'>02012</span><pre title='' class='pre covered'>		$this-&gt;state = array();</pre>								// ç¶æ<br/><span class='lineno'>02013</span><pre class='pre'>		$this-&gt;count = 0;</pre>									// æ°<br/><span class='lineno'>02014</span><pre class='pre'>	}</pre><br/><span class='lineno'>02015</span><pre class='pre'></pre><br/><span class='lineno'>02016</span><pre class='pre'>	function set_data($rcdata)</pre><br/><span class='lineno'>02017</span><pre class='pre'>	{</pre><br/><span class='lineno'>02018</span><pre class='pre'>		$this-&gt;registration_classification_id[] = $rcdata['registration_classification_id'];</pre><br/><span class='lineno'>02019</span><pre class='pre'></pre><br/><span class='lineno'>02020</span><pre class='pre'>		$this-&gt;classification_id[] = $rcdata['classification_id'];</pre><br/><span class='lineno'>02021</span><pre class='pre'>		$this-&gt;classification_name[] = $rcdata['classification_name'];</pre><br/><span class='lineno'>02022</span><pre class='pre'></pre><br/><span class='lineno'>02023</span><pre class='pre'>		$this-&gt;direction_id[] = $rcdata['direction_id'];</pre><br/><span class='lineno'>02024</span><pre class='pre'>		$this-&gt;direction_name[] = $rcdata['direction_name'];</pre><br/><span class='lineno'>02025</span><pre class='pre'></pre><br/><span class='lineno'>02026</span><pre class='pre'>		$this-&gt;country_prefecture_id[] = $rcdata['country_prefecture_id'];</pre><br/><span class='lineno'>02027</span><pre class='pre'>		$this-&gt;country_prefecture_name[] = $rcdata['country_prefecture_name'];</pre><br/><span class='lineno'>02028</span><pre class='pre'></pre><br/><span class='lineno'>02029</span><pre class='pre'>		$this-&gt;place_id[] = $rcdata['place_id'];</pre><br/><span class='lineno'>02030</span><pre class='pre'>		$this-&gt;place_name[] = $rcdata['place_name'];</pre><br/><span class='lineno'>02031</span><pre class='pre'></pre><br/><span class='lineno'>02032</span><pre class='pre'>		$this-&gt;state[] = $rcdata['state'];</pre><br/><span class='lineno'>02033</span><pre class='pre'>		$this-&gt;count++;</pre><br/><span class='lineno'>02034</span><pre class='pre'>	}</pre><br/><span class='lineno'>02035</span><pre class='pre'></pre><br/><span class='lineno'>02036</span><pre class='pre'>	// $no:1ï½</pre><br/><span class='lineno'>02037</span><pre class='pre'>	// ã¨ã©ã¼ã®å ´åã¯ç»åIDãå«ããã¹ã¦åæåãã¾ãã</pre><br/><span class='lineno'>02038</span><pre class='pre'>	function get_data(&amp;$pid, &amp;$c_id, &amp;$c_name, &amp;$d_id, &amp;$d_name, &amp;$cp_id, &amp;$cp_name, &amp;$p_id, &amp;$p_name, $no)</pre><br/><span class='lineno'>02039</span><pre class='pre'>	{</pre><br/><span class='lineno'>02040</span><pre class='pre'>		if ($no &lt;= 0 || $no &gt; $this-&gt;count)</pre><br/><span class='lineno'>02041</span><pre class='pre'>		{</pre><br/><span class='lineno'>02042</span><pre class='pre'>			$pid = -1;</pre><br/><span class='lineno'>02043</span><pre class='pre'></pre><br/><span class='lineno'>02044</span><pre class='pre'>			$c_id = -1;</pre><br/><span class='lineno'>02045</span><pre class='pre'>			$c_name = &quot;&quot;;</pre><br/><span class='lineno'>02046</span><pre class='pre'></pre><br/><span class='lineno'>02047</span><pre class='pre'>			$d_id = -1;</pre><br/><span class='lineno'>02048</span><pre class='pre'>			$d_name = &quot;&quot;;</pre><br/><span class='lineno'>02049</span><pre class='pre'></pre><br/><span class='lineno'>02050</span><pre class='pre'>			$cp_id = -1;</pre><br/><span class='lineno'>02051</span><pre class='pre'>			$cp_name = &quot;&quot;;</pre><br/><span class='lineno'>02052</span><pre class='pre'></pre><br/><span class='lineno'>02053</span><pre class='pre'>			$p_id = -1;</pre><br/><span class='lineno'>02054</span><pre class='pre'>			$p_name = &quot;&quot;;</pre><br/><span class='lineno'>02055</span><pre class='pre'></pre><br/><span class='lineno'>02056</span><pre class='pre'>			return;</pre><br/><span class='lineno'>02057</span><pre class='pre'>			//$this-&gt;message = &quot;ç»é²åé¡ãã¼ã¿ãåå¾ã§ãã¾ããã§ãããï¼no&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>02058</span><pre class='pre'>			//throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02059</span><pre class='pre'>		}</pre><br/><span class='lineno'>02060</span><pre class='pre'>		$no--;</pre><br/><span class='lineno'>02061</span><pre class='pre'>		$c_id = $this-&gt;classification_id[$no];</pre><br/><span class='lineno'>02062</span><pre class='pre'>		$c_name = $this-&gt;classification_name[$no];</pre><br/><span class='lineno'>02063</span><pre class='pre'></pre><br/><span class='lineno'>02064</span><pre class='pre'>		$d_id = $this-&gt;direction_id[$no];</pre><br/><span class='lineno'>02065</span><pre class='pre'>		$d_name = $this-&gt;direction_name[$no];</pre><br/><span class='lineno'>02066</span><pre class='pre'></pre><br/><span class='lineno'>02067</span><pre class='pre'>		$cp_id = $this-&gt;country_prefecture_id[$no];</pre><br/><span class='lineno'>02068</span><pre class='pre'>		$cp_name = $this-&gt;country_prefecture_name[$no];</pre><br/><span class='lineno'>02069</span><pre class='pre'></pre><br/><span class='lineno'>02070</span><pre class='pre'>		$p_id = $this-&gt;place_id[$no];</pre><br/><span class='lineno'>02071</span><pre class='pre'>		$p_name = $this-&gt;place_name[$no];</pre><br/><span class='lineno'>02072</span><pre class='pre'></pre><br/><span class='lineno'>02073</span><pre class='pre'>		$pid = $this-&gt;photo_id;</pre><br/><span class='lineno'>02074</span><pre class='pre'>	}</pre><br/><span class='lineno'>02075</span><pre class='pre'></pre><br/><span class='lineno'>02076</span><pre class='pre'>	// $no:1ï½</pre><br/><span class='lineno'>02077</span><pre class='pre'>	// ã¨ã©ã¼ã®å ´åã¯ãã¹ã¦åæåãã¾ãã</pre><br/><span class='lineno'>02078</span><pre class='pre'>	function get_id(&amp;$c_id, &amp;$d_id, &amp;$cp_id, &amp;$p_id, $no)</pre><br/><span class='lineno'>02079</span><pre class='pre'>	{</pre><br/><span class='lineno'>02080</span><pre class='pre'>		if ($no &lt;= 0 || $no &gt; $this-&gt;count)</pre><br/><span class='lineno'>02081</span><pre class='pre'>		{</pre><br/><span class='lineno'>02082</span><pre class='pre'>			$c_id = -1;</pre><br/><span class='lineno'>02083</span><pre class='pre'>			$d_id = -1;</pre><br/><span class='lineno'>02084</span><pre class='pre'>			$cp_id = -1;</pre><br/><span class='lineno'>02085</span><pre class='pre'>			$p_id = -1;</pre><br/><span class='lineno'>02086</span><pre class='pre'>			return;</pre><br/><span class='lineno'>02087</span><pre class='pre'>			//$this-&gt;message = &quot;ç»é²åé¡ãã¼ã¿ãåå¾ã§ãã¾ããã§ãããï¼no&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>02088</span><pre class='pre'>			//throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02089</span><pre class='pre'>		}</pre><br/><span class='lineno'>02090</span><pre class='pre'>		$no--;</pre><br/><span class='lineno'>02091</span><pre class='pre'>		$c_id = $this-&gt;classification_id[$no];</pre><br/><span class='lineno'>02092</span><pre class='pre'>		$d_id = $this-&gt;direction_id[$no];</pre><br/><span class='lineno'>02093</span><pre class='pre'>		$cp_id = $this-&gt;country_prefecture_id[$no];</pre><br/><span class='lineno'>02094</span><pre class='pre'>		$p_id = $this-&gt;place_id[$no];</pre><br/><span class='lineno'>02095</span><pre class='pre'>	}</pre><br/><span class='lineno'>02096</span><pre class='pre'></pre><br/><span class='lineno'>02097</span><pre class='pre'>	// $no:1ï½</pre><br/><span class='lineno'>02098</span><pre class='pre'>	// ã¨ã©ã¼ã®å ´åã¯ãã¹ã¦åæåãã¾ãã</pre><br/><span class='lineno'>02099</span><pre class='pre'>	function get_name(&amp;$c_name, &amp;$d_name, &amp;$cp_name, &amp;$p_name, $no)</pre><br/><span class='lineno'>02100</span><pre class='pre'>	{</pre><br/><span class='lineno'>02101</span><pre class='pre'>		if ($no &lt;= 0 || $no &gt; $this-&gt;count)</pre><br/><span class='lineno'>02102</span><pre class='pre'>		{</pre><br/><span class='lineno'>02103</span><pre class='pre'>			$c_name = &quot;&quot;;</pre><br/><span class='lineno'>02104</span><pre class='pre'>			$d_name = &quot;&quot;;</pre><br/><span class='lineno'>02105</span><pre class='pre'>			$cp_name = &quot;&quot;;</pre><br/><span class='lineno'>02106</span><pre class='pre'>			$p_name = &quot;&quot;;</pre><br/><span class='lineno'>02107</span><pre class='pre'>			return;</pre><br/><span class='lineno'>02108</span><pre class='pre'>			//$this-&gt;message = &quot;ç»é²åé¡ãã¼ã¿ãåå¾ã§ãã¾ããã§ãããï¼no&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>02109</span><pre class='pre'>			//throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02110</span><pre class='pre'>		}</pre><br/><span class='lineno'>02111</span><pre class='pre'>		$no--;</pre><br/><span class='lineno'>02112</span><pre class='pre'>		$c_name = $this-&gt;classification_name[$no];</pre><br/><span class='lineno'>02113</span><pre class='pre'>		$d_name = $this-&gt;direction_name[$no];</pre><br/><span class='lineno'>02114</span><pre class='pre'>		$cp_name = $this-&gt;country_prefecture_name[$no];</pre><br/><span class='lineno'>02115</span><pre class='pre'>		$p_name = $this-&gt;place_name[$no];</pre><br/><span class='lineno'>02116</span><pre class='pre'>	}</pre><br/><span class='lineno'>02117</span><pre class='pre'></pre><br/><span class='lineno'>02118</span><pre class='pre'>	function set_photo_id($pid)</pre><br/><span class='lineno'>02119</span><pre class='pre'>	{</pre><br/><span class='lineno'>02120</span><pre class='pre'>		if (!is_numeric($pid))</pre><br/><span class='lineno'>02121</span><pre class='pre'>		{</pre><br/><span class='lineno'>02122</span><pre class='pre'>			$this-&gt;photo_id = -1;</pre><br/><span class='lineno'>02123</span><pre class='pre'>		}</pre><br/><span class='lineno'>02124</span><pre class='pre'>		else</pre><br/><span class='lineno'>02125</span><pre class='pre'>		{</pre><br/><span class='lineno'>02126</span><pre class='pre'>			$this-&gt;photo_id = $pid;</pre><br/><span class='lineno'>02127</span><pre class='pre'>		}</pre><br/><span class='lineno'>02128</span><pre class='pre'>	}</pre><br/><span class='lineno'>02129</span><pre class='pre'></pre><br/><span class='lineno'>02130</span><pre class='pre'>	function set_id($c_id, $d_id, $cp_id, $p_id)</pre><br/><span class='lineno'>02131</span><pre class='pre'>	{</pre><br/><span class='lineno'>02132</span><pre class='pre'></pre><br/><span class='lineno'>02133</span><pre class='pre'>		if (is_numeric($c_id))</pre><br/><span class='lineno'>02134</span><pre class='pre'>		{</pre><br/><span class='lineno'>02135</span><pre class='pre'>			$this-&gt;classification_id[] = $c_id;</pre><br/><span class='lineno'>02136</span><pre class='pre'>		}</pre><br/><span class='lineno'>02137</span><pre class='pre'>		else</pre><br/><span class='lineno'>02138</span><pre class='pre'>		{</pre><br/><span class='lineno'>02139</span><pre class='pre'>			$this-&gt;classification_id[] = -1;</pre><br/><span class='lineno'>02140</span><pre class='pre'>		}</pre><br/><span class='lineno'>02141</span><pre class='pre'></pre><br/><span class='lineno'>02142</span><pre class='pre'>		if (is_numeric($d_id))</pre><br/><span class='lineno'>02143</span><pre class='pre'>		{</pre><br/><span class='lineno'>02144</span><pre class='pre'>			$this-&gt;direction_id[] = $d_id;</pre><br/><span class='lineno'>02145</span><pre class='pre'>		}</pre><br/><span class='lineno'>02146</span><pre class='pre'>		else</pre><br/><span class='lineno'>02147</span><pre class='pre'>		{</pre><br/><span class='lineno'>02148</span><pre class='pre'>			$this-&gt;direction_id[] = -1;</pre><br/><span class='lineno'>02149</span><pre class='pre'>		}</pre><br/><span class='lineno'>02150</span><pre class='pre'></pre><br/><span class='lineno'>02151</span><pre class='pre'>		if (is_numeric($cp_id))</pre><br/><span class='lineno'>02152</span><pre class='pre'>		{</pre><br/><span class='lineno'>02153</span><pre class='pre'>			$this-&gt;country_prefecture_id[] = $cp_id;</pre><br/><span class='lineno'>02154</span><pre class='pre'>		}</pre><br/><span class='lineno'>02155</span><pre class='pre'>		else</pre><br/><span class='lineno'>02156</span><pre class='pre'>		{</pre><br/><span class='lineno'>02157</span><pre class='pre'>			$this-&gt;country_prefecture_id[] = -1;</pre><br/><span class='lineno'>02158</span><pre class='pre'>		}</pre><br/><span class='lineno'>02159</span><pre class='pre'></pre><br/><span class='lineno'>02160</span><pre class='pre'>		if (is_numeric($p_id))</pre><br/><span class='lineno'>02161</span><pre class='pre'>		{</pre><br/><span class='lineno'>02162</span><pre class='pre'>			$this-&gt;place_id[] = $p_id;</pre><br/><span class='lineno'>02163</span><pre class='pre'>		}</pre><br/><span class='lineno'>02164</span><pre class='pre'>		else</pre><br/><span class='lineno'>02165</span><pre class='pre'>		{</pre><br/><span class='lineno'>02166</span><pre class='pre'>			$this-&gt;place_id[] = -1;</pre><br/><span class='lineno'>02167</span><pre class='pre'>		}</pre><br/><span class='lineno'>02168</span><pre class='pre'></pre><br/><span class='lineno'>02169</span><pre class='pre'>		$this-&gt;count++;</pre><br/><span class='lineno'>02170</span><pre class='pre'>	}</pre><br/><span class='lineno'>02171</span><pre class='pre'></pre><br/><span class='lineno'>02172</span><pre class='pre'>	function select_data($db_link, $p_photo_id)</pre><br/><span class='lineno'>02173</span><pre class='pre'>	{</pre><br/><span class='lineno'>02174</span><pre class='pre'>		// ç»åIDãæ°å¤ã§ãªãå ´åã¯ãã¨ã©ã¼æå ±ãã»ãããã¦ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>02175</span><pre class='pre'>		if (!is_numeric($p_photo_id))</pre><br/><span class='lineno'>02176</span><pre class='pre'>		{</pre><br/><span class='lineno'>02177</span><pre class='pre'>			$this-&gt;message = &quot;ç»é²åé¡ãåå¾ã§ãã¾ããã§ãããï¼photo_idãæ°å¤ã§ã¯ããã¾ãããï¼&quot;;</pre><br/><span class='lineno'>02178</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02179</span><pre class='pre'>		}</pre><br/><span class='lineno'>02180</span><pre class='pre'></pre><br/><span class='lineno'>02181</span><pre class='pre'>		// ãã¼ã¿ãåæåãã¾ãã</pre><br/><span class='lineno'>02182</span><pre class='pre'>		$this-&gt;init_data();</pre><br/><span class='lineno'>02183</span><pre class='pre'></pre><br/><span class='lineno'>02184</span><pre class='pre'>		// ç»é²åé¡ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>02185</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>02186</span><pre class='pre'>		$sql = &quot;SELECT registration_classification.registration_classification_id, registration_classification.photo_id, registration_classification.state, &quot;;</pre><br/><span class='lineno'>02187</span><pre class='pre'>		$sql .= &quot; registration_classification.classification_id, registration_classification.direction_id, registration_classification.country_prefecture_id, registration_classification.place_id, &quot;;</pre><br/><span class='lineno'>02188</span><pre class='pre'>		$sql .= &quot; classification.classification_name, direction.direction_name, country_prefecture.country_prefecture_name, place.place_name FROM registration_classification &quot;;</pre><br/><span class='lineno'>02189</span><pre class='pre'>		$sql .= &quot; LEFT JOIN classification on classification.classification_id = registration_classification.classification_id &quot;;</pre><br/><span class='lineno'>02190</span><pre class='pre'>		$sql .= &quot; LEFT JOIN direction on direction.direction_id = registration_classification.direction_id &quot;;</pre><br/><span class='lineno'>02191</span><pre class='pre'>		$sql .= &quot; LEFT JOIN country_prefecture on country_prefecture.country_prefecture_id = registration_classification.country_prefecture_id &quot;;</pre><br/><span class='lineno'>02192</span><pre class='pre'>		$sql .= &quot; LEFT JOIN place on place.place_id = registration_classification.place_id &quot;;</pre><br/><span class='lineno'>02193</span><pre class='pre'>		$sql .= &quot;WHERE photo_id=&quot; . $p_photo_id . &quot; order by registration_classification_id&quot;;</pre><br/><span class='lineno'>02194</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>02195</span><pre class='pre'></pre><br/><span class='lineno'>02196</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>02197</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>02198</span><pre class='pre'></pre><br/><span class='lineno'>02199</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>02200</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>02201</span><pre class='pre'>		{</pre><br/><span class='lineno'>02202</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>02203</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>02204</span><pre class='pre'>			if ($icount &gt;= 0)</pre><br/><span class='lineno'>02205</span><pre class='pre'>			{</pre><br/><span class='lineno'>02206</span><pre class='pre'>				while ($registration_classification = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>02207</span><pre class='pre'>				{</pre><br/><span class='lineno'>02208</span><pre class='pre'>					// åé¡IDãªã©ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>02209</span><pre class='pre'>					$this-&gt;set_data($registration_classification);</pre><br/><span class='lineno'>02210</span><pre class='pre'>				}</pre><br/><span class='lineno'>02211</span><pre class='pre'>			}</pre><br/><span class='lineno'>02212</span><pre class='pre'>			else</pre><br/><span class='lineno'>02213</span><pre class='pre'>			{</pre><br/><span class='lineno'>02214</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>02215</span><pre class='pre'>				$this-&gt;message = &quot;ç»é²åé¡ãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>02216</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02217</span><pre class='pre'>			}</pre><br/><span class='lineno'>02218</span><pre class='pre'>		}</pre><br/><span class='lineno'>02219</span><pre class='pre'>		else</pre><br/><span class='lineno'>02220</span><pre class='pre'>		{</pre><br/><span class='lineno'>02221</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>02222</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>02223</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>02224</span><pre class='pre'>			$this-&gt;message = &quot;ç»é²åé¡ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>02225</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02226</span><pre class='pre'>		}</pre><br/><span class='lineno'>02227</span><pre class='pre'>	}</pre><br/><span class='lineno'>02228</span><pre class='pre'></pre><br/><span class='lineno'>02229</span><pre class='pre'>	// ãã¼ã¿è¿½å æã®photo_idã¯$this-&gt;photo_idã§ã¯ãªãã$pidã§ãã</pre><br/><span class='lineno'>02230</span><pre class='pre'>	function insert_data($db_link, $pid)</pre><br/><span class='lineno'>02231</span><pre class='pre'>	{</pre><br/><span class='lineno'>02232</span><pre class='pre'>		// ç»åIDãæ°å¤ã®å ´åã¯ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>02233</span><pre class='pre'>		if (!is_numeric($pid))</pre><br/><span class='lineno'>02234</span><pre class='pre'>		{</pre><br/><span class='lineno'>02235</span><pre class='pre'>			$this-&gt;photo_id = $pid;</pre><br/><span class='lineno'>02236</span><pre class='pre'>		}</pre><br/><span class='lineno'>02237</span><pre class='pre'></pre><br/><span class='lineno'>02238</span><pre class='pre'>		// ãã¼ã¿ãå¨ã¦è¿½å ç»é²ãã¾ãã</pre><br/><span class='lineno'>02239</span><pre class='pre'>		for($i = 0 ; $i &lt; $this-&gt;count ; $i++)</pre><br/><span class='lineno'>02240</span><pre class='pre'>		{</pre><br/><span class='lineno'>02241</span><pre class='pre'>			// åIDããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>02242</span><pre class='pre'>			if (!is_numeric($this-&gt;classification_id[$i]))</pre><br/><span class='lineno'>02243</span><pre class='pre'>			{</pre><br/><span class='lineno'>02244</span><pre class='pre'>				$this-&gt;classification_id[$i] = -1;</pre><br/><span class='lineno'>02245</span><pre class='pre'>			}</pre><br/><span class='lineno'>02246</span><pre class='pre'></pre><br/><span class='lineno'>02247</span><pre class='pre'>			if (!is_numeric($this-&gt;direction_id[$i]))</pre><br/><span class='lineno'>02248</span><pre class='pre'>			{</pre><br/><span class='lineno'>02249</span><pre class='pre'>				$this-&gt;direction_id[$i] = -1;</pre><br/><span class='lineno'>02250</span><pre class='pre'>			}</pre><br/><span class='lineno'>02251</span><pre class='pre'></pre><br/><span class='lineno'>02252</span><pre class='pre'>			if (!is_numeric($this-&gt;country_prefecture_id[$i]))</pre><br/><span class='lineno'>02253</span><pre class='pre'>			{</pre><br/><span class='lineno'>02254</span><pre class='pre'>				$this-&gt;country_prefecture_id[$i] = -1;</pre><br/><span class='lineno'>02255</span><pre class='pre'>			}</pre><br/><span class='lineno'>02256</span><pre class='pre'></pre><br/><span class='lineno'>02257</span><pre class='pre'>			if (!is_numeric($this-&gt;place_id[$i]))</pre><br/><span class='lineno'>02258</span><pre class='pre'>			{</pre><br/><span class='lineno'>02259</span><pre class='pre'>				$this-&gt;place_id[$i] = -1;</pre><br/><span class='lineno'>02260</span><pre class='pre'>			}</pre><br/><span class='lineno'>02261</span><pre class='pre'></pre><br/><span class='lineno'>02262</span><pre class='pre'>			// å¨ã¦ãæå®ããã¦ããªããã°ãè¿½å ãã¾ããã</pre><br/><span class='lineno'>02263</span><pre class='pre'>			if ($this-&gt;classification_id[$i] == -1 &amp;&amp; $this-&gt;direction_id[$i] == -1 &amp;&amp; $this-&gt;country_prefecture_id[$i] == -1 &amp;&amp; $this-&gt;place_id[$i] == -1)</pre><br/><span class='lineno'>02264</span><pre class='pre'>			{</pre><br/><span class='lineno'>02265</span><pre class='pre'>				continue;</pre><br/><span class='lineno'>02266</span><pre class='pre'>			}</pre><br/><span class='lineno'>02267</span><pre class='pre'>			$sql = &quot;INSERT INTO registration_classification (photo_id, classification_id, direction_id, country_prefecture_id, place_id) VALUES ( &quot;;</pre><br/><span class='lineno'>02268</span><pre class='pre'>			$sql .= $pid . &quot;,&quot;;										// ç»åID</pre><br/><span class='lineno'>02269</span><pre class='pre'>			$sql .= $this-&gt;classification_id[$i] . &quot;,&quot;;				// åé¡å</pre><br/><span class='lineno'>02270</span><pre class='pre'>			$sql .= $this-&gt;direction_id[$i] . &quot;,&quot;;					// æ¹é¢</pre><br/><span class='lineno'>02271</span><pre class='pre'>			$sql .= $this-&gt;country_prefecture_id[$i] . &quot;,&quot;;			// å½ã»é½éåºç</pre><br/><span class='lineno'>02272</span><pre class='pre'>			$sql .= $this-&gt;place_id[$i];							// å°å</pre><br/><span class='lineno'>02273</span><pre class='pre'>			$sql .= &quot;);&quot;;</pre><br/><span class='lineno'>02274</span><pre class='pre'></pre><br/><span class='lineno'>02275</span><pre class='pre'>			$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>02276</span><pre class='pre'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>02277</span><pre class='pre'>			if ($result == true)</pre><br/><span class='lineno'>02278</span><pre class='pre'>			{</pre><br/><span class='lineno'>02279</span><pre class='pre'>				// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>02280</span><pre class='pre'>				$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>02281</span><pre class='pre'>				if ($icount != 1)</pre><br/><span class='lineno'>02282</span><pre class='pre'>				{</pre><br/><span class='lineno'>02283</span><pre class='pre'>					$this-&gt;message = &quot;ç»é²åé¡ãDBã«ç»é²ã§ãã¾ããã§ãããï¼å¦çæ°!=1ï¼ No=&quot; . $i;</pre><br/><span class='lineno'>02284</span><pre class='pre'>					throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02285</span><pre class='pre'>				}</pre><br/><span class='lineno'>02286</span><pre class='pre'>			}</pre><br/><span class='lineno'>02287</span><pre class='pre'>			else</pre><br/><span class='lineno'>02288</span><pre class='pre'>			{</pre><br/><span class='lineno'>02289</span><pre class='pre'>				$this-&gt;message = &quot;ç»é²åé¡ãDBã«ç»é²ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼ No=&quot; . $i;</pre><br/><span class='lineno'>02290</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02291</span><pre class='pre'>			}</pre><br/><span class='lineno'>02292</span><pre class='pre'>		}</pre><br/><span class='lineno'>02293</span><pre class='pre'>	}</pre><br/><span class='lineno'>02294</span><pre class='pre'></pre><br/><span class='lineno'>02295</span><pre class='pre'>	// ãã¼ã¿åé¤æã®photo_idã¯$this-&gt;photo_idã§ã¯ãªãã$pidã§ãã</pre><br/><span class='lineno'>02296</span><pre class='pre'>	function delete_data($db_link, $pid)</pre><br/><span class='lineno'>02297</span><pre class='pre'>	{</pre><br/><span class='lineno'>02298</span><pre class='pre'>		// ç»åIDãæ°å¤ã®å ´åã¯ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>02299</span><pre class='pre'>		if (!is_numeric($pid))</pre><br/><span class='lineno'>02300</span><pre class='pre'>		{</pre><br/><span class='lineno'>02301</span><pre class='pre'>			$this-&gt;photo_id = $pid;</pre><br/><span class='lineno'>02302</span><pre class='pre'>		}</pre><br/><span class='lineno'>02303</span><pre class='pre'></pre><br/><span class='lineno'>02304</span><pre class='pre'>		$sql = &quot;delete FROM registration_classification WHERE photo_id=&quot; . $pid;</pre><br/><span class='lineno'>02305</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>02306</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>02307</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>02308</span><pre class='pre'>		{</pre><br/><span class='lineno'>02309</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>02310</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>02311</span><pre class='pre'></pre><br/><span class='lineno'>02312</span><pre class='pre'>			// å¦çæ°ãè¿ãã¾ãã</pre><br/><span class='lineno'>02313</span><pre class='pre'>			return $icount;</pre><br/><span class='lineno'>02314</span><pre class='pre'>		}</pre><br/><span class='lineno'>02315</span><pre class='pre'>		else</pre><br/><span class='lineno'>02316</span><pre class='pre'>		{</pre><br/><span class='lineno'>02317</span><pre class='pre'>			$this-&gt;message = &quot;ç»é²åé¡ãDBããåé¤ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼ &quot;;</pre><br/><span class='lineno'>02318</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02319</span><pre class='pre'>		}</pre><br/><span class='lineno'>02320</span><pre class='pre'>	}</pre><br/><span class='lineno'>02321</span><pre class='pre'>}</pre><br/><span class='lineno'>02322</span><pre class='pre'></pre><br/><span class='lineno'>02323</span><pre class='pre'>class PhotoImageData</pre><br/><span class='lineno'>02324</span><pre class='pre'>{</pre><br/><span class='lineno'>02325</span><pre class='pre'>	var $message;									// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>02326</span><pre class='pre'>	var $error;										// ã¨ã©ã¼</pre><br/><span class='lineno'>02327</span><pre class='pre'></pre><br/><span class='lineno'>02328</span><pre class='pre'>	var $img_width;									// ã¤ã¡ã¼ã¸ãµã¤ãºï¼æ¨ªï¼	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>02329</span><pre class='pre'>	var $img_height;								// ã¤ã¡ã¼ã¸ãµã¤ãºï¼ç¸¦ï¼	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>02330</span><pre class='pre'>	var $up_url;									// ã¢ããã­ã¼ãURLï¼æçµçã«ã¢ããã­ã¼ããããURLï¼</pre><br/><span class='lineno'>02331</span><pre class='pre'>													//					0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>02332</span><pre class='pre'>	var $photo_id;									// åçID</pre><br/><span class='lineno'>02333</span><pre class='pre'>	var $photo_mno;									// ç»åçªå·</pre><br/><span class='lineno'>02334</span><pre class='pre'>	var $publishing_situation_id;					// æ²è¼ç¶æ³</pre><br/><span class='lineno'>02335</span><pre class='pre'>	var $registration_division_id;					// ç»é²åºå</pre><br/><span class='lineno'>02336</span><pre class='pre'>	var $source_image_no;							// åç»åç®¡ççªå·</pre><br/><span class='lineno'>02337</span><pre class='pre'>	var $bud_photo_no;								// BUD_PHOTOçªå·</pre><br/><span class='lineno'>02338</span><pre class='pre'>	var $photo_name;								// åçåï¼ã¿ã¤ãã«ï¼</pre><br/><span class='lineno'>02339</span><pre class='pre'>	var $photo_explanation;							// åçèª¬æ</pre><br/><span class='lineno'>02340</span><pre class='pre'>	var $take_picture_time_id;						// æ®å½±ææï¼</pre><br/><span class='lineno'>02341</span><pre class='pre'>	var $take_picture_time2_id;						// æ®å½±ææï¼</pre><br/><span class='lineno'>02342</span><pre class='pre'>	var $dfrom;										// æ²è¼æéï¼Fromï¼</pre><br/><span class='lineno'>02343</span><pre class='pre'>	var $dto;										// æ²è¼æéï¼Toï¼</pre><br/><span class='lineno'>02344</span><pre class='pre'>	var $kikan;										// æé</pre><br/><span class='lineno'>02345</span><pre class='pre'>	var $borrowing_ahead_id;						// åçå¥æå</pre><br/><span class='lineno'>02346</span><pre class='pre'>	var $content_borrowing_ahead;					// åçå¥æååå®¹</pre><br/><span class='lineno'>02347</span><pre class='pre'>	var $range_of_use_id;							// ä½¿ç¨ç¯å²</pre><br/><span class='lineno'>02348</span><pre class='pre'>	var $use_condition;								// åºç¨¿æ¡ä»¶</pre><br/><span class='lineno'>02349</span><pre class='pre'>	var $additional_constraints1;					// ä»å æ¡ä»¶ï¼ã¯ã¬ã¸ããï¼</pre><br/><span class='lineno'>02350</span><pre class='pre'>	var $additional_constraints2;					// ä»å æ¡ä»¶ï¼è¦ç¢ºèªï¼</pre><br/><span class='lineno'>02351</span><pre class='pre'>	var $monopoly_use;								// ç¬å ä½¿ç¨</pre><br/><span class='lineno'>02352</span><pre class='pre'>	var $copyright_owner;							// çæ¨©ææè</pre><br/><span class='lineno'>02353</span><pre class='pre'>	var $photo_filename;							// åçãã¡ã¤ã«å</pre><br/><span class='lineno'>02354</span><pre class='pre'>	var $photo_filename_th1;						// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«1ï¼</pre><br/><span class='lineno'>02355</span><pre class='pre'>	var $photo_filename_th2;						// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«2ï¼</pre><br/><span class='lineno'>02356</span><pre class='pre'>	var $photo_filename_th3;						// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«3ï¼</pre><br/><span class='lineno'>02357</span><pre class='pre'>	var $photo_filename_th4;						// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«4ï¼</pre><br/><span class='lineno'>02358</span><pre class='pre'>	var $photo_filename_th5;						// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«5ï¼</pre><br/><span class='lineno'>02359</span><pre class='pre'>	var $photo_filename_th6;						// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«6ï¼</pre><br/><span class='lineno'>02360</span><pre class='pre'>	var $photo_filename_th7;						// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«7ï¼</pre><br/><span class='lineno'>02361</span><pre class='pre'>	var $photo_filename_th8;						// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«8ï¼</pre><br/><span class='lineno'>02362</span><pre class='pre'>	var $photo_filename_th9;						// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«9ï¼</pre><br/><span class='lineno'>02363</span><pre class='pre'>	var $photo_filename_th10;						// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«10ï¼</pre><br/><span class='lineno'>02364</span><pre class='pre'>	var $ext;										// æ¡å¼µå­</pre><br/><span class='lineno'>02365</span><pre class='pre'>	var $customer_section;							// ãå®¢æ§é¨ç½²</pre><br/><span class='lineno'>02366</span><pre class='pre'>	var $customer_name;								// ãå®¢æ§å</pre><br/><span class='lineno'>02367</span><pre class='pre'>	var $registration_account;						// ç»é²ç³è«ã¢ã«ã¦ã³ã</pre><br/><span class='lineno'>02368</span><pre class='pre'>	var $registration_person;						// ç»é²ç³è«è</pre><br/><span class='lineno'>02369</span><pre class='pre'>	var $permission_account;						// ç»é²è¨±å¯ã¢ã«ã¦ã³ã</pre><br/><span class='lineno'>02370</span><pre class='pre'>	var $permission_person;							// ç»é²è¨±å¯è</pre><br/><span class='lineno'>02371</span><pre class='pre'>	var $permission_date;							// ç»é²è¨±å¯æ¥</pre><br/><span class='lineno'>02372</span><pre class='pre'>	var $image_size_x;								// ç»åãµã¤ãºï¼æ¨ªï¼</pre><br/><span class='lineno'>02373</span><pre class='pre'>	var $image_size_y;								// ç»åãµã¤ãºï¼ç¸¦ï¼</pre><br/><span class='lineno'>02374</span><pre class='pre'>	var $note;										// åè</pre><br/><span class='lineno'>02375</span><pre class='pre'>	var $nopermis;		                        	//nopermit for no permission selection</pre><br/><span class='lineno'>02376</span><pre class='pre'>	var $nopermis_date;								//nopermit date</pre><br/><span class='lineno'>02377</span><pre class='pre'>	var $nopermis_personid;							//nopermit person id add by jinxin 2012/02/09</pre><br/><span class='lineno'>02378</span><pre class='pre'>	var $viewableue;								// è¡¨ç¤ºå¯å¦</pre><br/><span class='lineno'>02379</span><pre class='pre'>	var $register_date;								// ç»é²æ¥</pre><br/><span class='lineno'>02380</span><pre class='pre'>	var $state;										// ç¶æ</pre><br/><span class='lineno'>02381</span><pre class='pre'>	var $keyword_str;								// ã­ã¼ã¯ã¼ã</pre><br/><span class='lineno'>02382</span><pre class='pre'>	var $registration_classifications;				// ç»é²åé¡</pre><br/><span class='lineno'>02383</span><pre class='pre'>	var $image1;									// ãã¤ããªãå¤æããã¤ã¡ã¼ã¸ï¼ã¢ããã­ã¼ãï¼</pre><br/><span class='lineno'>02384</span><pre class='pre'>	var $image2;									// ãã¤ããªãå¤æããã¤ã¡ã¼ã¸ï¼ãµã ãã¤ã«1ï¼</pre><br/><span class='lineno'>02385</span><pre class='pre'>	var $image3;									// ãã¤ããªãå¤æããã¤ã¡ã¼ã¸ï¼ãµã ãã¤ã«2ï¼</pre><br/><span class='lineno'>02386</span><pre class='pre'>	var $image4;									// ãã¤ããªãå¤æããã¤ã¡ã¼ã¸ï¼ãµã ãã¤ã«3ï¼</pre><br/><span class='lineno'>02387</span><pre class='pre'>	var $image5;									// ãã¤ããªãå¤æããã¤ã¡ã¼ã¸ï¼ãµã ãã¤ã«4ï¼</pre><br/><span class='lineno'>02388</span><pre class='pre'>	var $comp_code;									// ã¦ã¼ã¶ã¼ç®¡ççªå·</pre><br/><span class='lineno'>02389</span><pre class='pre'></pre><br/><span class='lineno'>02390</span><pre class='pre'>	function __construct()</pre><br/><span class='lineno'>02391</span><pre class='pre'>	{</pre><br/><span class='lineno'>02392</span><pre class='pre'>		// ã¿ã¤ã ã¾ã¼ã³ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>02393</span><pre title='' class='pre covered'>		date_default_timezone_set(&quot;Asia/Tokyo&quot;);</pre><br/><span class='lineno'>02394</span><pre class='pre'></pre><br/><span class='lineno'>02395</span><pre class='pre'>		// ã¡ã³ãã¼ãåæåãã¾ãã</pre><br/><span class='lineno'>02396</span><pre title='' class='pre covered'>		$this-&gt;init_data();</pre><br/><span class='lineno'>02397</span><pre class='pre'></pre><br/><span class='lineno'>02398</span><pre class='pre'>		// ã¡ãã»ã¼ã¸ãåæåãã¾ãã</pre><br/><span class='lineno'>02399</span><pre title='' class='pre covered'>		$this-&gt;message = &quot;&quot;;</pre><br/><span class='lineno'>02400</span><pre title='' class='pre covered'>		$this-&gt;error = false;</pre><br/><span class='lineno'>02401</span><pre class='pre'>	}</pre><br/><span class='lineno'>02402</span><pre class='pre'></pre><br/><span class='lineno'>02403</span><pre class='pre'>	/**</pre><br/><span class='lineno'>02404</span><pre class='pre'>	 * ãã¼ã¿ãåæåãã¾ãã</pre><br/><span class='lineno'>02405</span><pre class='pre'>	 */</pre><br/><span class='lineno'>02406</span><pre class='pre'>	function init_data()</pre><br/><span class='lineno'>02407</span><pre class='pre'>	{</pre><br/><span class='lineno'>02408</span><pre class='pre'>		// åæåãã¾ãã</pre><br/><span class='lineno'>02409</span><pre title='' class='pre covered'>		$this-&gt;message = &quot;&quot;;</pre>						// ã¡ãã»ã¼ã¸<br/><span class='lineno'>02410</span><pre class='pre'>		$this-&gt;error = &quot;&quot;;</pre>							// ã¨ã©ã¼<br/><span class='lineno'>02411</span><pre class='pre'></pre><br/><span class='lineno'>02412</span><pre title='' class='pre covered'>		$this-&gt;img_width = array();</pre>					// ã¤ã¡ã¼ã¸ãµã¤ãºï¼æ¨ªï¼	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»<br/><span class='lineno'>02413</span><pre class='pre'>		$this-&gt;img_height = array();</pre>				// ã¤ã¡ã¼ã¸ãµã¤ãºï¼ç¸¦ï¼	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»<br/><span class='lineno'>02414</span><pre class='pre'>		$this-&gt;up_url = array();</pre>					// ã¢ããã­ã¼ãURLï¼æçµçã«ã¢ããã­ã¼ããããURLï¼<br/><span class='lineno'>02415</span><pre class='pre'>													//					0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>02416</span><pre class='pre'>		$this-&gt;ext = &quot;&quot;;</pre>							// æ¡å¼µå­ï¼åãã¡ã¤ã«åï¼<br/><span class='lineno'>02417</span><pre class='pre'>		$this-&gt;photo_id = -1;</pre>						// åçID<br/><span class='lineno'>02418</span><pre class='pre'>		$this-&gt;photo_mno = &quot;&quot;;</pre>						// ç»åçªå·<br/><span class='lineno'>02419</span><pre class='pre'>		$this-&gt;publishnig_situation_id = -1;</pre>		// æ²è¼ç¶æ³<br/><span class='lineno'>02420</span><pre class='pre'>		$this-&gt;registration_division_id = -1;</pre>		// ç»é²åºå<br/><span class='lineno'>02421</span><pre class='pre'>		$this-&gt;source_image_no = &quot;&quot;;</pre>				// åç»åç®¡ççªå·<br/><span class='lineno'>02422</span><pre class='pre'>		$this-&gt;bud_photo_no = &quot;&quot;;</pre>					// BUD_PHOTOçªå·<br/><span class='lineno'>02423</span><pre class='pre'>		$this-&gt;photo_name = &quot;&quot;;</pre>						// åçåï¼ã¿ã¤ãã«ï¼<br/><span class='lineno'>02424</span><pre class='pre'>		$this-&gt;photo_explanation = &quot;&quot;;</pre>				// åçèª¬æ<br/><span class='lineno'>02425</span><pre class='pre'>		$this-&gt;take_picture_time_id = -1;</pre>			// æ®å½±ææï¼<br/><span class='lineno'>02426</span><pre class='pre'>		$this-&gt;take_picture_time2_id = -1;</pre>			// æ®å½±ææï¼<br/><span class='lineno'>02427</span><pre class='pre'>		$this-&gt;dfrom = &quot;0000-00-00&quot;;</pre>				// æ²è¼æéï¼Fromï¼<br/><span class='lineno'>02428</span><pre class='pre'>		$this-&gt;dto = &quot;0000-00-00&quot;;</pre>					// æ²è¼æéï¼Toï¼<br/><span class='lineno'>02429</span><pre class='pre'>		$this-&gt;kikan = &quot;&quot;;</pre>							// æé<br/><span class='lineno'>02430</span><pre class='pre'>		$this-&gt;borrowing_ahead_id = -1;</pre>				// åçå¥æå<br/><span class='lineno'>02431</span><pre class='pre'>		$this-&gt;content_borrowing_ahead = &quot;&quot;;</pre>		// åçå¥æååå®¹<br/><span class='lineno'>02432</span><pre class='pre'>		$this-&gt;range_of_use_id = -1;</pre>				// ä½¿ç¨ç¯å²<br/><span class='lineno'>02433</span><pre class='pre'>		$this-&gt;use_condition = &quot;&quot;;</pre>					// åºç¨¿æ¡ä»¶<br/><span class='lineno'>02434</span><pre class='pre'>		$this-&gt;additional_constraints1 = &quot;&quot;;</pre>		// ä»å æ¡ä»¶ï¼ã¯ã¬ã¸ããï¼<br/><span class='lineno'>02435</span><pre class='pre'>		$this-&gt;additional_constraints2 = &quot;&quot;;</pre>		// ä»å æ¡ä»¶ï¼è¦ç¢ºèªï¼<br/><span class='lineno'>02436</span><pre class='pre'>		$this-&gt;monopoly_use = &quot;&quot;;</pre>					// ç¬å ä½¿ç¨<br/><span class='lineno'>02437</span><pre class='pre'>		$this-&gt;copyright_owner = &quot;&quot;;</pre>				// çæ¨©ææè<br/><span class='lineno'>02438</span><pre class='pre'>		$this-&gt;photo_filename = &quot;&quot;;</pre>					// åçãã¡ã¤ã«å<br/><span class='lineno'>02439</span><pre class='pre'>		$this-&gt;photo_filename_th1 = &quot;&quot;;</pre>				// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«1ï¼<br/><span class='lineno'>02440</span><pre class='pre'>		$this-&gt;photo_filename_th2 = &quot;&quot;;</pre>				// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«2ï¼<br/><span class='lineno'>02441</span><pre class='pre'>		$this-&gt;photo_filename_th3 = &quot;&quot;;</pre>				// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«3ï¼<br/><span class='lineno'>02442</span><pre class='pre'>		$this-&gt;photo_filename_th4 = &quot;&quot;;</pre>				// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«4ï¼<br/><span class='lineno'>02443</span><pre class='pre'>		$this-&gt;photo_filename_th5 = &quot;&quot;;</pre>				// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«5ï¼<br/><span class='lineno'>02444</span><pre class='pre'>		$this-&gt;photo_filename_th6 = &quot;&quot;;</pre>				// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«6ï¼<br/><span class='lineno'>02445</span><pre class='pre'>		$this-&gt;photo_filename_th7 = &quot;&quot;;</pre>				// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«7ï¼<br/><span class='lineno'>02446</span><pre class='pre'>		$this-&gt;photo_filename_th8 = &quot;&quot;;</pre>				// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«8ï¼<br/><span class='lineno'>02447</span><pre class='pre'>		$this-&gt;photo_filename_th9 = &quot;&quot;;</pre>				// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«9ï¼<br/><span class='lineno'>02448</span><pre class='pre'>		$this-&gt;photo_filename_th10 = &quot;&quot;;</pre>			// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«10ï¼<br/><span class='lineno'>02449</span><pre class='pre'>		$this-&gt;ext = &quot;&quot;;</pre>							// æ¡å¼µå­<br/><span class='lineno'>02450</span><pre class='pre'>		$this-&gt;customer_section = &quot;&quot;;</pre>				// ãå®¢æ§é¨ç½²<br/><span class='lineno'>02451</span><pre class='pre'>		$this-&gt;customer_name = &quot;&quot;;</pre>					// ãå®¢æ§å<br/><span class='lineno'>02452</span><pre class='pre'>		$this-&gt;registration_account = &quot;&quot;;</pre>			// ç»é²ç³è«ã¢ã«ã¦ã³ã<br/><span class='lineno'>02453</span><pre class='pre'>		$this-&gt;registration_person = &quot;&quot;;</pre>			// ç»é²ç³è«è<br/><span class='lineno'>02454</span><pre class='pre'>		$this-&gt;permission_account = &quot;&quot;;</pre>				// ç»é²è¨±å¯ã¢ã«ã¦ã³ã<br/><span class='lineno'>02455</span><pre class='pre'>		$this-&gt;permission_person = &quot;&quot;;</pre>				// ç»é²è¨±å¯è<br/><span class='lineno'>02456</span><pre class='pre'>		$this-&gt;permission_date = &quot;&quot;;</pre>				// ç»é²è¨±å¯æ¥<br/><span class='lineno'>02457</span><pre class='pre'>		$this-&gt;image_size_x = 0;</pre>					// ç»åãµã¤ãºï¼æ¨ªï¼<br/><span class='lineno'>02458</span><pre class='pre'>		$this-&gt;image_size_y = 0;</pre>					// ç»åãµã¤ãºï¼ç¸¦ï¼<br/><span class='lineno'>02459</span><pre class='pre'>		$this-&gt;note = &quot;&quot;;</pre>							// åè<br/><span class='lineno'>02460</span><pre class='pre'>		$this-&gt;nopermis = &quot;&quot;;</pre>						// permission<br/><span class='lineno'>02461</span><pre class='pre'>		$this-&gt;nopermis_date = &quot;0000-00-00&quot;;</pre>		// no permit date<br/><span class='lineno'>02462</span><pre class='pre'>		$this-&gt;nopermis_personid = &quot;&quot;;</pre>				// no permit person id add by jinxin 2012/02/09<br/><span class='lineno'>02463</span><pre class='pre'>		$this-&gt;viewableue = true;</pre>					// è¡¨ç¤ºå¯å¦<br/><span class='lineno'>02464</span><pre class='pre'>		$this-&gt;register_date = &quot;0000-00-00&quot;;</pre>		// ç»é²æ¥<br/><span class='lineno'>02465</span><pre class='pre'>		$this-&gt;state = 0;</pre>							// ç¶æ<br/><span class='lineno'>02466</span><pre class='pre'>		$this-&gt;keyword_str = &quot;&quot;;</pre>					// ã­ã¼ã¯ã¼ã<br/><span class='lineno'>02467</span><pre class='pre'>		$this-&gt;registration_classifications = new RegistrationClassifications();</pre><br/><span class='lineno'>02468</span><pre class='pre'>													// ç»é²åé¡</pre><br/><span class='lineno'>02469</span><pre class='pre'>	}</pre><br/><span class='lineno'>02470</span><pre class='pre'></pre><br/><span class='lineno'>02471</span><pre class='pre'>	/**</pre><br/><span class='lineno'>02472</span><pre class='pre'>	 * ãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>02473</span><pre class='pre'>	 */</pre><br/><span class='lineno'>02474</span><pre class='pre'>	function set_data($imgdata)</pre><br/><span class='lineno'>02475</span><pre class='pre'>	{</pre><br/><span class='lineno'>02476</span><pre class='pre'>		$this-&gt;up_url = array();																					// ã¢ããã­ã¼ãURLï¼æçµçã«ã¢ããã­ã¼ããããURLï¼</pre><br/><span class='lineno'>02477</span><pre class='pre'>		$this-&gt;up_url[0] = $imgdata['photo_filename'];																//	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>02478</span><pre class='pre'>		$this-&gt;up_url[1] = $imgdata['photo_filename_th1'];</pre><br/><span class='lineno'>02479</span><pre class='pre'>		$this-&gt;up_url[2] = $imgdata['photo_filename_th2'];</pre><br/><span class='lineno'>02480</span><pre class='pre'>		$this-&gt;up_url[3] = $imgdata['photo_filename_th3'];</pre><br/><span class='lineno'>02481</span><pre class='pre'>		$this-&gt;up_url[4] = $imgdata['photo_filename_th4'];</pre><br/><span class='lineno'>02482</span><pre class='pre'>		$this-&gt;up_url[5] = $imgdata['photo_filename_th5'];</pre><br/><span class='lineno'>02483</span><pre class='pre'>		$this-&gt;up_url[6] = $imgdata['photo_filename_th6'];</pre><br/><span class='lineno'>02484</span><pre class='pre'>		$this-&gt;up_url[7] = $imgdata['photo_filename_th7'];</pre><br/><span class='lineno'>02485</span><pre class='pre'>		$this-&gt;up_url[8] = $imgdata['photo_filename_th8'];</pre><br/><span class='lineno'>02486</span><pre class='pre'>		$this-&gt;up_url[9] = $imgdata['photo_filename_th9'];</pre><br/><span class='lineno'>02487</span><pre class='pre'>		$this-&gt;up_url[10] = $imgdata['photo_filename_th10'];</pre><br/><span class='lineno'>02488</span><pre class='pre'>		$this-&gt;ext = $imgdata['ext'];																				// æ¡å¼µå­ï¼åãã¡ã¤ã«åï¼</pre><br/><span class='lineno'>02489</span><pre class='pre'>		$this-&gt;photo_id = $imgdata['photo_id'];																		// åçID</pre><br/><span class='lineno'>02490</span><pre class='pre'>		$this-&gt;photo_mno = $imgdata['photo_mno'];																	// åçç®¡ççªå·</pre><br/><span class='lineno'>02491</span><pre class='pre'>		$this-&gt;publishing_situation_id = $imgdata['publishing_situation_id'];										// æ²è¼ç¶æ³</pre><br/><span class='lineno'>02492</span><pre class='pre'>		$this-&gt;registration_division_id = $imgdata['registration_division_id'];										// ç»é²åºå</pre><br/><span class='lineno'>02493</span><pre class='pre'>		$this-&gt;source_image_no = $imgdata['source_image_no'];														// åç»åç®¡ççªå·</pre><br/><span class='lineno'>02494</span><pre class='pre'>		$this-&gt;bud_photo_no = $imgdata['bud_photo_no'];																// BUD_PHOTOçªå·</pre><br/><span class='lineno'>02495</span><pre class='pre'>		$this-&gt;photo_name = $imgdata['photo_name'];																	// åçåï¼ã¿ã¤ãã«ï¼</pre><br/><span class='lineno'>02496</span><pre class='pre'>		$this-&gt;photo_explanation = $imgdata['photo_explanation'];													// åçèª¬æ</pre><br/><span class='lineno'>02497</span><pre class='pre'>		$this-&gt;take_picture_time_id = $imgdata['take_picture_time_id'];												// æ®å½±ææï¼</pre><br/><span class='lineno'>02498</span><pre class='pre'>		$this-&gt;take_picture_time2_id = $imgdata['take_picture_time2_id'];											// æ®å½±ææï¼</pre><br/><span class='lineno'>02499</span><pre class='pre'>		$this-&gt;dfrom = $imgdata['dfrom'];																			// æ²è¼æéï¼Fromï¼</pre><br/><span class='lineno'>02500</span><pre class='pre'>		$this-&gt;dto = $imgdata['dto'];																				// æ²è¼æéï¼Toï¼</pre><br/><span class='lineno'>02501</span><pre class='pre'>		$this-&gt;kikan = $imgdata['kikan'];																			// æé</pre><br/><span class='lineno'>02502</span><pre class='pre'>		$this-&gt;borrowing_ahead_id = $imgdata['borrowing_ahead_id'];													// åçå¥æå</pre><br/><span class='lineno'>02503</span><pre class='pre'>		$this-&gt;content_borrowing_ahead = $imgdata['content_borrowing_ahead'];										// åçå¥æååå®¹</pre><br/><span class='lineno'>02504</span><pre class='pre'>		$this-&gt;range_of_use_id = $imgdata['range_of_use_id'];														// ä½¿ç¨ç¯å²</pre><br/><span class='lineno'>02505</span><pre class='pre'>		$this-&gt;use_condition = $imgdata['use_condition'];															// åºç¨¿æ¡ä»¶</pre><br/><span class='lineno'>02506</span><pre class='pre'>		$this-&gt;additional_constraints1 = $imgdata['additional_constraints1'];										// ä»å æ¡ä»¶ï¼ã¯ã¬ã¸ããï¼</pre><br/><span class='lineno'>02507</span><pre class='pre'>		$this-&gt;additional_constraints2 = $imgdata['additional_constraints2'];										// ä»å æ¡ä»¶ï¼è¦ç¢ºèªï¼</pre><br/><span class='lineno'>02508</span><pre class='pre'>		$this-&gt;monopoly_use = $imgdata['monopoly_use'];																// ç¬å ä½¿ç¨</pre><br/><span class='lineno'>02509</span><pre class='pre'>		$this-&gt;copyright_owner = $imgdata['copyright_owner'];														// çæ¨©ææè</pre><br/><span class='lineno'>02510</span><pre class='pre'>		$this-&gt;photo_filename = $imgdata['photo_filename'];															// åçãã¡ã¤ã«å</pre><br/><span class='lineno'>02511</span><pre class='pre'>		$this-&gt;photo_filename_th1 = $imgdata['photo_filename_th1'];													// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«1ï¼</pre><br/><span class='lineno'>02512</span><pre class='pre'>		$this-&gt;photo_filename_th2 = $imgdata['photo_filename_th2'];													// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«2ï¼</pre><br/><span class='lineno'>02513</span><pre class='pre'>		$this-&gt;photo_filename_th3 = $imgdata['photo_filename_th3'];													// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«3ï¼</pre><br/><span class='lineno'>02514</span><pre class='pre'>		$this-&gt;photo_filename_th4 = $imgdata['photo_filename_th4'];													// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«4ï¼</pre><br/><span class='lineno'>02515</span><pre class='pre'>		$this-&gt;photo_filename_th5 = $imgdata['photo_filename_th5'];													// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«5ï¼</pre><br/><span class='lineno'>02516</span><pre class='pre'>		$this-&gt;photo_filename_th6 = $imgdata['photo_filename_th6'];													// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«6ï¼</pre><br/><span class='lineno'>02517</span><pre class='pre'>		$this-&gt;photo_filename_th7 = $imgdata['photo_filename_th7'];													// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«7ï¼</pre><br/><span class='lineno'>02518</span><pre class='pre'>		$this-&gt;photo_filename_th8 = $imgdata['photo_filename_th8'];													// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«8ï¼</pre><br/><span class='lineno'>02519</span><pre class='pre'>		$this-&gt;photo_filename_th9 = $imgdata['photo_filename_th9'];													// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«9ï¼</pre><br/><span class='lineno'>02520</span><pre class='pre'>		$this-&gt;photo_filename_th10 = $imgdata['photo_filename_th10'];												// åçãã¡ã¤ã«åï¼ãµã ãã¤ã«10ï¼</pre><br/><span class='lineno'>02521</span><pre class='pre'>		$this-&gt;ext = $imgdata['ext'];																				// æ¡å¼µå­</pre><br/><span class='lineno'>02522</span><pre class='pre'>		$this-&gt;customer_section = $imgdata['customer_section'];														// ãå®¢æ§é¨ç½²</pre><br/><span class='lineno'>02523</span><pre class='pre'>		$this-&gt;customer_name = $imgdata['customer_name'];															// ãå®¢æ§å</pre><br/><span class='lineno'>02524</span><pre class='pre'>		$this-&gt;registration_account = $imgdata['registration_account'];												// ç»é²ç³è«ã¢ã«ã¦ã³ã</pre><br/><span class='lineno'>02525</span><pre class='pre'>		$this-&gt;registration_person = $imgdata['registration_person'];												// ç»é²ç³è«è</pre><br/><span class='lineno'>02526</span><pre class='pre'>		$this-&gt;permission_account = $imgdata['permission_account'];													// ç»é²è¨±å¯ã¢ã«ã¦ã³ã</pre><br/><span class='lineno'>02527</span><pre class='pre'>		$this-&gt;permission_person = $imgdata['permission_person'];													// ç»é²è¨±å¯è</pre><br/><span class='lineno'>02528</span><pre class='pre'>		$this-&gt;permission_date = $imgdata['permission_date'];														// ç»é²è¨±å¯æ¥</pre><br/><span class='lineno'>02529</span><pre class='pre'>		$this-&gt;image_size_x = $imgdata['image_size_x'];																// ç»åãµã¤ãºï¼æ¨ªï¼</pre><br/><span class='lineno'>02530</span><pre class='pre'>		$this-&gt;image_size_y = $imgdata['image_size_y'];																// ç»åãµã¤ãºï¼ç¸¦ï¼</pre><br/><span class='lineno'>02531</span><pre class='pre'>		$this-&gt;note = $imgdata['note'];																				// åè</pre><br/><span class='lineno'>02532</span><pre class='pre'>		$this-&gt;viewableue = true;																					// è¡¨ç¤ºå¯å¦</pre><br/><span class='lineno'>02533</span><pre class='pre'>		$this-&gt;register_date = $imgdata['register_date'];															// ç»é²æ¥</pre><br/><span class='lineno'>02534</span><pre class='pre'>		$this-&gt;state = $imgdata['state'];																			// ç¶æ</pre><br/><span class='lineno'>02535</span><pre class='pre'>		$this-&gt;image1 = $imgdata['image1'];																			// ãã¤ããªãå¤æããã¤ã¡ã¼ã¸ï¼ã¢ããã­ã¼ãï¼</pre><br/><span class='lineno'>02536</span><pre class='pre'>		$this-&gt;image2 = $imgdata['image2'];																			// ãã¤ããªãå¤æããã¤ã¡ã¼ã¸ï¼ãµã ãã¤ã«1ï¼</pre><br/><span class='lineno'>02537</span><pre class='pre'>		$this-&gt;image3 = $imgdata['image3'];																			// ãã¤ããªãå¤æããã¤ã¡ã¼ã¸ï¼ãµã ãã¤ã«2ï¼</pre><br/><span class='lineno'>02538</span><pre class='pre'>		$this-&gt;image4 = $imgdata['image4'];																			// ãã¤ããªãå¤æããã¤ã¡ã¼ã¸ï¼ãµã ãã¤ã«3ï¼</pre><br/><span class='lineno'>02539</span><pre class='pre'>		$this-&gt;image5 = $imgdata['image5'];																			// ãã¤ããªãå¤æããã¤ã¡ã¼ã¸ï¼ãµã ãã¤ã«4ï¼</pre><br/><span class='lineno'>02540</span><pre class='pre'></pre><br/><span class='lineno'>02541</span><pre class='pre'>	}</pre><br/><span class='lineno'>02542</span><pre class='pre'>}</pre><br/><span class='lineno'>02543</span><pre class='pre'></pre><br/><span class='lineno'>02544</span><pre class='pre'>class PhotoImageDB extends PhotoImageData</pre><br/><span class='lineno'>02545</span><pre class='pre'>{</pre><br/><span class='lineno'>02546</span><pre class='pre'>	function __construct()</pre><br/><span class='lineno'>02547</span><pre class='pre'>	{</pre><br/><span class='lineno'>02548</span><pre title='' class='pre covered'>		PhotoImageData::__construct();</pre><br/><span class='lineno'>02549</span><pre class='pre'>	}</pre><br/><span class='lineno'>02550</span><pre class='pre'></pre><br/><span class='lineno'>02551</span><pre class='pre'>	function check_adjust_param($act)</pre><br/><span class='lineno'>02552</span><pre class='pre'>	{</pre><br/><span class='lineno'>02553</span><pre class='pre'>		// ãã©ã¡ã¼ã¿ã®èª¿æ´ããã¾ãã</pre><br/><span class='lineno'>02554</span><pre class='pre'>		if ($this-&gt;kikan == &quot;mukigen&quot;)</pre><br/><span class='lineno'>02555</span><pre class='pre'>		{</pre><br/><span class='lineno'>02556</span><pre class='pre'>			$this-&gt;dfrom = &quot;2000/01/01&quot;;</pre><br/><span class='lineno'>02557</span><pre class='pre'>			$this-&gt;dto = &quot;2100/01/01&quot;;</pre><br/><span class='lineno'>02558</span><pre class='pre'>		}</pre><br/><span class='lineno'>02559</span><pre class='pre'></pre><br/><span class='lineno'>02560</span><pre class='pre'>		// æ²è¼æéï¼Fromï¼</pre><br/><span class='lineno'>02561</span><pre class='pre'>		if (empty($this-&gt;dfrom))</pre><br/><span class='lineno'>02562</span><pre class='pre'>		{</pre><br/><span class='lineno'>02563</span><pre class='pre'>			$this-&gt;dfrom = &quot;2000/01/01&quot;;</pre><br/><span class='lineno'>02564</span><pre class='pre'>		}</pre><br/><span class='lineno'>02565</span><pre class='pre'></pre><br/><span class='lineno'>02566</span><pre class='pre'>		// æ²è¼æéï¼Toï¼</pre><br/><span class='lineno'>02567</span><pre class='pre'>		if (empty($this-&gt;dto))</pre><br/><span class='lineno'>02568</span><pre class='pre'>		{</pre><br/><span class='lineno'>02569</span><pre class='pre'>			$this-&gt;dto = &quot;2100/01/01&quot;;</pre><br/><span class='lineno'>02570</span><pre class='pre'>		}</pre><br/><span class='lineno'>02571</span><pre class='pre'></pre><br/><span class='lineno'>02572</span><pre class='pre'>		// è¡¨ç¤ºå¯å¦</pre><br/><span class='lineno'>02573</span><pre class='pre'>		if (empty($this-&gt;viewable))</pre><br/><span class='lineno'>02574</span><pre class='pre'>		{</pre><br/><span class='lineno'>02575</span><pre class='pre'>			$this-&gt;viewable = true;</pre><br/><span class='lineno'>02576</span><pre class='pre'>		}</pre><br/><span class='lineno'>02577</span><pre class='pre'></pre><br/><span class='lineno'>02578</span><pre class='pre'>		// ç¬å ä½¿ç¨</pre><br/><span class='lineno'>02579</span><pre class='pre'>		if (!is_numeric($this-&gt;monopoly_use) || empty($this-&gt;monopoly_use))</pre><br/><span class='lineno'>02580</span><pre class='pre'>		{</pre><br/><span class='lineno'>02581</span><pre class='pre'>			// ç¬å ä½¿ç¨ããªãã«è¨­å®ãã¾ãã</pre><br/><span class='lineno'>02582</span><pre class='pre'>			$this-&gt;monopoly_use = 0;</pre><br/><span class='lineno'>02583</span><pre class='pre'>		}</pre><br/><span class='lineno'>02584</span><pre class='pre'></pre><br/><span class='lineno'>02585</span><pre class='pre'>		// æ®å½±ææ(1)</pre><br/><span class='lineno'>02586</span><pre class='pre'>		if (!is_numeric($this-&gt;take_picture_time_id) || empty($this-&gt;take_picture_time_id))</pre><br/><span class='lineno'>02587</span><pre class='pre'>		{</pre><br/><span class='lineno'>02588</span><pre class='pre'>			$this-&gt;take_picture_time_id = -1;</pre><br/><span class='lineno'>02589</span><pre class='pre'>		}</pre><br/><span class='lineno'>02590</span><pre class='pre'></pre><br/><span class='lineno'>02591</span><pre class='pre'>		// æ®å½±ææ(2)</pre><br/><span class='lineno'>02592</span><pre class='pre'>		if (!is_numeric($this-&gt;take_picture_time2_id) || empty($this-&gt;take_picture_time2_id))</pre><br/><span class='lineno'>02593</span><pre class='pre'>		{</pre><br/><span class='lineno'>02594</span><pre class='pre'>			$this-&gt;take_picture_time2_id = -1;</pre><br/><span class='lineno'>02595</span><pre class='pre'>		}</pre><br/><span class='lineno'>02596</span><pre class='pre'></pre><br/><span class='lineno'>02597</span><pre class='pre'>		// åçå¥æå</pre><br/><span class='lineno'>02598</span><pre class='pre'>		if (empty($this-&gt;content_borrowing_ahead))</pre><br/><span class='lineno'>02599</span><pre class='pre'>		{</pre><br/><span class='lineno'>02600</span><pre class='pre'>			$this-&gt;content_borrowing_ahead = &quot;&quot;;</pre><br/><span class='lineno'>02601</span><pre class='pre'>		}</pre><br/><span class='lineno'>02602</span><pre class='pre'></pre><br/><span class='lineno'>02603</span><pre class='pre'>		// åºç¨¿æ¡ä»¶</pre><br/><span class='lineno'>02604</span><pre class='pre'>		if (empty($this-&gt;use_condition))</pre><br/><span class='lineno'>02605</span><pre class='pre'>		{</pre><br/><span class='lineno'>02606</span><pre class='pre'>			$this-&gt;use_condition = &quot;&quot;;</pre><br/><span class='lineno'>02607</span><pre class='pre'>		}</pre><br/><span class='lineno'>02608</span><pre class='pre'></pre><br/><span class='lineno'>02609</span><pre class='pre'>		// ã¨ã©ã¼ãã§ãã¯ããã¾ãã</pre><br/><span class='lineno'>02610</span><pre class='pre'>		// æ²è¼ç¶æ³ID</pre><br/><span class='lineno'>02611</span><pre class='pre'>		if (!is_numeric($this-&gt;publishing_situation_id))</pre><br/><span class='lineno'>02612</span><pre class='pre'>		{</pre><br/><span class='lineno'>02613</span><pre class='pre'>			$this-&gt;message = &quot;æ²è¼ç¶æ³ID(publishing_situation_id)ãæ°å¤ã§ã¯ããã¾ããã&quot;;</pre><br/><span class='lineno'>02614</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02615</span><pre class='pre'>		}</pre><br/><span class='lineno'>02616</span><pre class='pre'></pre><br/><span class='lineno'>02617</span><pre class='pre'>		// ç»é²åºåID</pre><br/><span class='lineno'>02618</span><pre class='pre'>		if (!is_numeric($this-&gt;registration_division_id))</pre><br/><span class='lineno'>02619</span><pre class='pre'>		{</pre><br/><span class='lineno'>02620</span><pre class='pre'>			$this-&gt;message = &quot;ç»é²åºåID(registration_division_id)ãæ°å¤ã§ã¯ããã¾ããã&quot;;</pre><br/><span class='lineno'>02621</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02622</span><pre class='pre'>		}</pre><br/><span class='lineno'>02623</span><pre class='pre'></pre><br/><span class='lineno'>02624</span><pre class='pre'>		// æ²è¼æé</pre><br/><span class='lineno'>02625</span><pre class='pre'>		if (empty($this-&gt;kikan))</pre><br/><span class='lineno'>02626</span><pre class='pre'>		{</pre><br/><span class='lineno'>02627</span><pre class='pre'>			$this-&gt;message = &quot;æ²è¼æé(kikan)ãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>02628</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02629</span><pre class='pre'>		}</pre><br/><span class='lineno'>02630</span><pre class='pre'></pre><br/><span class='lineno'>02631</span><pre class='pre'>		// åçå¥æå</pre><br/><span class='lineno'>02632</span><pre class='pre'>		if (!is_numeric($this-&gt;borrowing_ahead_id))</pre><br/><span class='lineno'>02633</span><pre class='pre'>		{</pre><br/><span class='lineno'>02634</span><pre class='pre'>			$this-&gt;message = &quot;åçå¥æåID(borrowing_ahead_id)ãæ°å¤ã§ã¯ããã¾ããã&quot;;</pre><br/><span class='lineno'>02635</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02636</span><pre class='pre'>		}</pre><br/><span class='lineno'>02637</span><pre class='pre'></pre><br/><span class='lineno'>02638</span><pre class='pre'>		// ä½¿ç¨ç¯å²</pre><br/><span class='lineno'>02639</span><pre class='pre'>		if (!is_numeric($this-&gt;range_of_use_id))</pre><br/><span class='lineno'>02640</span><pre class='pre'>		{</pre><br/><span class='lineno'>02641</span><pre class='pre'>			$this-&gt;message = &quot;ä½¿ç¨ç¯å²ID(range_of_use_id)ãæ°å¤ã§ã¯ããã¾ããã&quot;;</pre><br/><span class='lineno'>02642</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02643</span><pre class='pre'>		}</pre><br/><span class='lineno'>02644</span><pre class='pre'></pre><br/><span class='lineno'>02645</span><pre class='pre'>		// Insertç¨ã®ãã§ãã¯ã®å ´åã§ãã</pre><br/><span class='lineno'>02646</span><pre class='pre'>		if ($act == &quot;I&quot;)</pre><br/><span class='lineno'>02647</span><pre class='pre'>		{</pre><br/><span class='lineno'>02648</span><pre class='pre'>			// ãã¡ã¤ã«åããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>02649</span><pre class='pre'>			if (empty($this-&gt;up_url))</pre><br/><span class='lineno'>02650</span><pre class='pre'>			{</pre><br/><span class='lineno'>02651</span><pre class='pre'>				$this-&gt;message = &quot;ç»åãã¡ã¤ã«(up_url)ãè¨­å®ããã¦ãã¾ããã&quot;;</pre><br/><span class='lineno'>02652</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02653</span><pre class='pre'>			}</pre><br/><span class='lineno'>02654</span><pre class='pre'></pre><br/><span class='lineno'>02655</span><pre class='pre'>			// ç»é²æ¥</pre><br/><span class='lineno'>02656</span><pre class='pre'>			if (empty($this-&gt;register_date))</pre><br/><span class='lineno'>02657</span><pre class='pre'>			{</pre><br/><span class='lineno'>02658</span><pre class='pre'>				$this-&gt;register_date = date(&quot;Y/m/d H:i:s&quot;);</pre><br/><span class='lineno'>02659</span><pre class='pre'>			}</pre><br/><span class='lineno'>02660</span><pre class='pre'></pre><br/><span class='lineno'>02661</span><pre class='pre'>			// ç»é²è¨±å¯</pre><br/><span class='lineno'>02662</span><pre class='pre'>			$this-&gt;permission_account = &quot;&quot;;</pre><br/><span class='lineno'>02663</span><pre class='pre'>			$this-&gt;permission_person = &quot;&quot;;</pre><br/><span class='lineno'>02664</span><pre class='pre'>			$this-&gt;permission_date = &quot;0000-00-00 00:00:00&quot;;</pre><br/><span class='lineno'>02665</span><pre class='pre'>		}</pre><br/><span class='lineno'>02666</span><pre class='pre'></pre><br/><span class='lineno'>02667</span><pre class='pre'>		// Updateç¨ã®ãã§ãã¯ã®å ´åã§ãã</pre><br/><span class='lineno'>02668</span><pre class='pre'>		if ($act == &quot;U&quot;)</pre><br/><span class='lineno'>02669</span><pre class='pre'>		{</pre><br/><span class='lineno'>02670</span><pre class='pre'>			if (!is_numeric($this-&gt;photo_id))</pre><br/><span class='lineno'>02671</span><pre class='pre'>			{</pre><br/><span class='lineno'>02672</span><pre class='pre'>				$this-&gt;message = &quot;åçID(photo_id)ãæ°å¤ã§ã¯ããã¾ããã&quot;;</pre><br/><span class='lineno'>02673</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02674</span><pre class='pre'>			}</pre><br/><span class='lineno'>02675</span><pre class='pre'></pre><br/><span class='lineno'>02676</span><pre class='pre'>			// ç»é²è¨±å¯æ¥</pre><br/><span class='lineno'>02677</span><pre class='pre'>			if ($this-&gt;publishing_situation_id &gt; 1)</pre><br/><span class='lineno'>02678</span><pre class='pre'>			{</pre><br/><span class='lineno'>02679</span><pre class='pre'>				// æ²è¼ç¶æ³ãç³è«ä¸­ä»¥å¤ã®å ´åã¯ãç»é²è¨±å¯æ¥ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>02680</span><pre class='pre'>				$this-&gt;permission_date = date(&quot;Y/m/d&quot;);</pre><br/><span class='lineno'>02681</span><pre class='pre'>			}</pre><br/><span class='lineno'>02682</span><pre class='pre'>			else</pre><br/><span class='lineno'>02683</span><pre class='pre'>			{</pre><br/><span class='lineno'>02684</span><pre class='pre'>				// æ²è¼ç¶æ³ãç³è«ä¸­ã®å ´åã¯ãç»é²è¨±å¯æ¥ã»ç»é²è¨±å¯ã¢ã«ã¦ã³ããç»é²è¨±å¯åããã¹ã¦æªè¨­å®ã«ãã¾ãã</pre><br/><span class='lineno'>02685</span><pre class='pre'>				$this-&gt;permission_date = &quot;0000-00-00&quot;;</pre><br/><span class='lineno'>02686</span><pre class='pre'>				$this-&gt;permission_account = &quot;&quot;;</pre><br/><span class='lineno'>02687</span><pre class='pre'>				$this-&gt;permission_person = &quot;&quot;;</pre><br/><span class='lineno'>02688</span><pre class='pre'>			}</pre><br/><span class='lineno'>02689</span><pre class='pre'>		}</pre><br/><span class='lineno'>02690</span><pre class='pre'>	}</pre><br/><span class='lineno'>02691</span><pre class='pre'></pre><br/><span class='lineno'>02692</span><pre class='pre'>	function get_keyword_str($db_link, $p_photo_id)</pre><br/><span class='lineno'>02693</span><pre class='pre'>	{</pre><br/><span class='lineno'>02694</span><pre class='pre'>		if (!is_numeric($p_photo_id))</pre><br/><span class='lineno'>02695</span><pre class='pre'>		{</pre><br/><span class='lineno'>02696</span><pre class='pre'>			$this-&gt;message = &quot;ç»åID(å¼æ°ï¼p_photo_id)ã«æ°å¤ä»¥å¤ãè¨­å®ããã¦ãã¾ãã&quot;;</pre><br/><span class='lineno'>02697</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02698</span><pre class='pre'>		}</pre><br/><span class='lineno'>02699</span><pre class='pre'></pre><br/><span class='lineno'>02700</span><pre class='pre'>		$sql = &quot;SELECT * FROM keyword WHERE photo_id = ?&quot;;</pre><br/><span class='lineno'>02701</span><pre class='pre'></pre><br/><span class='lineno'>02702</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>02703</span><pre class='pre'>		$stmt-&gt;bindParam(1, $p_photo_id);</pre><br/><span class='lineno'>02704</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>02705</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>02706</span><pre class='pre'>		{</pre><br/><span class='lineno'>02707</span><pre class='pre'>			$this-&gt;keyword_str = &quot;&quot;;</pre><br/><span class='lineno'>02708</span><pre class='pre'></pre><br/><span class='lineno'>02709</span><pre class='pre'>			while ($keyword = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>02710</span><pre class='pre'>			{</pre><br/><span class='lineno'>02711</span><pre class='pre'>				if (strlen($this-&gt;keyword_str)!=0)</pre><br/><span class='lineno'>02712</span><pre class='pre'>				{</pre><br/><span class='lineno'>02713</span><pre class='pre'>					$this-&gt;keyword_str .= &quot; &quot;;</pre><br/><span class='lineno'>02714</span><pre class='pre'>				}</pre><br/><span class='lineno'>02715</span><pre class='pre'>				$this-&gt;keyword_str .= $keyword['keyword_name'];</pre><br/><span class='lineno'>02716</span><pre class='pre'>			}</pre><br/><span class='lineno'>02717</span><pre class='pre'>		}</pre><br/><span class='lineno'>02718</span><pre class='pre'>		else</pre><br/><span class='lineno'>02719</span><pre class='pre'>		{</pre><br/><span class='lineno'>02720</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>02721</span><pre class='pre'>			$this-&gt;message = &quot;ã­ã¼ã¯ã¼ãã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>02722</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02723</span><pre class='pre'>		}</pre><br/><span class='lineno'>02724</span><pre class='pre'>	}</pre><br/><span class='lineno'>02725</span><pre class='pre'></pre><br/><span class='lineno'>02726</span><pre class='pre'>	function delete_keyword($db_link, $p_photo_id)</pre><br/><span class='lineno'>02727</span><pre class='pre'>	{</pre><br/><span class='lineno'>02728</span><pre class='pre'>		if (!is_numeric($p_photo_id))</pre><br/><span class='lineno'>02729</span><pre class='pre'>		{</pre><br/><span class='lineno'>02730</span><pre class='pre'>			$this-&gt;message = &quot;ç»åID(å¼æ°ï¼p_photo_id)ã«æ°å¤ä»¥å¤ãè¨­å®ããã¦ãã¾ãã&quot;;</pre><br/><span class='lineno'>02731</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02732</span><pre class='pre'>		}</pre><br/><span class='lineno'>02733</span><pre class='pre'></pre><br/><span class='lineno'>02734</span><pre class='pre'>		$sql = &quot;delete FROM keyword WHERE photo_id=&quot; . $p_photo_id;</pre><br/><span class='lineno'>02735</span><pre class='pre'></pre><br/><span class='lineno'>02736</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>02737</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>02738</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>02739</span><pre class='pre'>		{</pre><br/><span class='lineno'>02740</span><pre class='pre'>			// å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>02741</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>02742</span><pre class='pre'>			return $icount;</pre><br/><span class='lineno'>02743</span><pre class='pre'>		}</pre><br/><span class='lineno'>02744</span><pre class='pre'>		else</pre><br/><span class='lineno'>02745</span><pre class='pre'>		{</pre><br/><span class='lineno'>02746</span><pre class='pre'>			$this-&gt;message = &quot;ã­ã¼ã¯ã¼ãã®åé¤ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>02747</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02748</span><pre class='pre'>		}</pre><br/><span class='lineno'>02749</span><pre class='pre'>	}</pre><br/><span class='lineno'>02750</span><pre class='pre'></pre><br/><span class='lineno'>02751</span><pre class='pre'>	function select_data($db_link, $p_photo_id)</pre><br/><span class='lineno'>02752</span><pre class='pre'>	{</pre><br/><span class='lineno'>02753</span><pre class='pre'>		if (!is_numeric($p_photo_id))</pre><br/><span class='lineno'>02754</span><pre class='pre'>		{</pre><br/><span class='lineno'>02755</span><pre class='pre'>			$this-&gt;message = &quot;ç»åID(å¼æ°ï¼p_photo_id)ã«æ°å¤ä»¥å¤ãè¨­å®ããã¦ãã¾ãã&quot;;</pre><br/><span class='lineno'>02756</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02757</span><pre class='pre'>		}</pre><br/><span class='lineno'>02758</span><pre class='pre'></pre><br/><span class='lineno'>02759</span><pre class='pre'>		$sql = &quot;SELECT * FROM photoimg WHERE photo_id = ?&quot;;</pre><br/><span class='lineno'>02760</span><pre class='pre'></pre><br/><span class='lineno'>02761</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>02762</span><pre class='pre'>		$stmt-&gt;bindParam(1, $p_photo_id);</pre><br/><span class='lineno'>02763</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>02764</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>02765</span><pre class='pre'>		{</pre><br/><span class='lineno'>02766</span><pre class='pre'>			// å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>02767</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>02768</span><pre class='pre'></pre><br/><span class='lineno'>02769</span><pre class='pre'>			// é¸æããããã¼ã¿æ°ãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>02770</span><pre class='pre'>			if ($icount == 1)</pre><br/><span class='lineno'>02771</span><pre class='pre'>			{</pre><br/><span class='lineno'>02772</span><pre class='pre'>				// ç»åãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>02773</span><pre class='pre'>				$image_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>02774</span><pre class='pre'>				$this-&gt;set_data($image_data);</pre><br/><span class='lineno'>02775</span><pre class='pre'></pre><br/><span class='lineno'>02776</span><pre class='pre'>				// åé¡ãªã©ãã»ãããã¾ãã</pre><br/><span class='lineno'>02777</span><pre class='pre'>				$this-&gt;registration_classifications-&gt;select_data($db_link, $this-&gt;photo_id);</pre><br/><span class='lineno'>02778</span><pre class='pre'>			}</pre><br/><span class='lineno'>02779</span><pre class='pre'>			else</pre><br/><span class='lineno'>02780</span><pre class='pre'>			{</pre><br/><span class='lineno'>02781</span><pre class='pre'>				$this-&gt;message = &quot;ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼å¦çæ°!=1ï¼&quot;;</pre><br/><span class='lineno'>02782</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02783</span><pre class='pre'>			}</pre><br/><span class='lineno'>02784</span><pre class='pre'>		}</pre><br/><span class='lineno'>02785</span><pre class='pre'>		else</pre><br/><span class='lineno'>02786</span><pre class='pre'>		{</pre><br/><span class='lineno'>02787</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>02788</span><pre class='pre'>			$this-&gt;message = &quot;ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>02789</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02790</span><pre class='pre'>		}</pre><br/><span class='lineno'>02791</span><pre class='pre'>	}</pre><br/><span class='lineno'>02792</span><pre class='pre'></pre><br/><span class='lineno'>02793</span><pre class='pre'>	function get_dfrom(&amp;$p_year, &amp;$p_month, &amp;$p_day)</pre><br/><span class='lineno'>02794</span><pre class='pre'>	{</pre><br/><span class='lineno'>02795</span><pre class='pre'>		// æ²è¼æéï¼Fromï¼ããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>02796</span><pre class='pre'>		if (empty($this-&gt;dfrom) || $this-&gt;dfrom == &quot;0000-00-00&quot;)</pre><br/><span class='lineno'>02797</span><pre class='pre'>		{</pre><br/><span class='lineno'>02798</span><pre class='pre'>			// ç©ºãããã¯åæå¤ã ã£ãå ´åã§ãã</pre><br/><span class='lineno'>02799</span><pre class='pre'>			$p_year = &quot;&quot;;</pre><br/><span class='lineno'>02800</span><pre class='pre'>			$p_month = &quot;&quot;;</pre><br/><span class='lineno'>02801</span><pre class='pre'>			$p_day = &quot;&quot;;</pre><br/><span class='lineno'>02802</span><pre class='pre'></pre><br/><span class='lineno'>02803</span><pre class='pre'>			return &quot;&quot;;</pre><br/><span class='lineno'>02804</span><pre class='pre'>		}</pre><br/><span class='lineno'>02805</span><pre class='pre'>		else</pre><br/><span class='lineno'>02806</span><pre class='pre'>		{</pre><br/><span class='lineno'>02807</span><pre class='pre'>			// å¤ãå¥ã£ã¦ããå ´åã§ãã</pre><br/><span class='lineno'>02808</span><pre class='pre'>			$p_year = substr($this-&gt;dfrom, 0 , 4);</pre><br/><span class='lineno'>02809</span><pre class='pre'>			$p_month = substr($this-&gt;dfrom, 5 , 2);</pre><br/><span class='lineno'>02810</span><pre class='pre'>			$p_day = substr($this-&gt;dfrom, 8 , 2);</pre><br/><span class='lineno'>02811</span><pre class='pre'></pre><br/><span class='lineno'>02812</span><pre class='pre'>			return $this-&gt;dfrom;</pre><br/><span class='lineno'>02813</span><pre class='pre'>		}</pre><br/><span class='lineno'>02814</span><pre class='pre'>	}</pre><br/><span class='lineno'>02815</span><pre class='pre'></pre><br/><span class='lineno'>02816</span><pre class='pre'>	function get_dto(&amp;$p_year, &amp;$p_month, &amp;$p_day)</pre><br/><span class='lineno'>02817</span><pre class='pre'>	{</pre><br/><span class='lineno'>02818</span><pre class='pre'>		// æ²è¼æéï¼toï¼ããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>02819</span><pre class='pre'>		if (empty($this-&gt;dto) || $this-&gt;dto == &quot;0000-00-00&quot;)</pre><br/><span class='lineno'>02820</span><pre class='pre'>		{</pre><br/><span class='lineno'>02821</span><pre class='pre'>			// ç©ºãããã¯åæå¤ã ã£ãå ´åã§ãã</pre><br/><span class='lineno'>02822</span><pre class='pre'>			$p_year = &quot;&quot;;</pre><br/><span class='lineno'>02823</span><pre class='pre'>			$p_month = &quot;&quot;;</pre><br/><span class='lineno'>02824</span><pre class='pre'>			$p_day = &quot;&quot;;</pre><br/><span class='lineno'>02825</span><pre class='pre'></pre><br/><span class='lineno'>02826</span><pre class='pre'>			return &quot;&quot;;</pre><br/><span class='lineno'>02827</span><pre class='pre'>		}</pre><br/><span class='lineno'>02828</span><pre class='pre'>		else</pre><br/><span class='lineno'>02829</span><pre class='pre'>		{</pre><br/><span class='lineno'>02830</span><pre class='pre'>			// å¤ãå¥ã£ã¦ããå ´åã§ãã</pre><br/><span class='lineno'>02831</span><pre class='pre'>			$p_year = substr($this-&gt;dto, 0 , 4);</pre><br/><span class='lineno'>02832</span><pre class='pre'>			$p_month = substr($this-&gt;dto, 5 , 2);</pre><br/><span class='lineno'>02833</span><pre class='pre'>			$p_day = substr($this-&gt;dto, 8 , 2);</pre><br/><span class='lineno'>02834</span><pre class='pre'></pre><br/><span class='lineno'>02835</span><pre class='pre'>			return $this-&gt;dto;</pre><br/><span class='lineno'>02836</span><pre class='pre'>		}</pre><br/><span class='lineno'>02837</span><pre class='pre'>	}</pre><br/><span class='lineno'>02838</span><pre class='pre'></pre><br/><span class='lineno'>02839</span><pre class='pre'>	/*</pre><br/><span class='lineno'>02840</span><pre class='pre'>	 * é¢æ°åï¼write_imagetodb</pre><br/><span class='lineno'>02841</span><pre class='pre'>	 * é¢æ°èª¬æï¼ç»åããã¤ããªã«ãªã£ã¦ãDBã«ä¿å­ãã</pre><br/><span class='lineno'>02842</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼db_linkï¼ï¼¤ï¼¢ãªã³ã¯</pre><br/><span class='lineno'>02843</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>02844</span><pre class='pre'>	 */</pre><br/><span class='lineno'>02845</span><pre class='pre'>	function write_imagetodb($db_link,$p_photo_id)</pre><br/><span class='lineno'>02846</span><pre class='pre'>	{</pre><br/><span class='lineno'>02847</span><pre class='pre'>		if (empty($p_photo_id) || $p_photo_id == &quot;-1&quot; || $p_photo_id &lt;= 0) return;</pre><br/><span class='lineno'>02848</span><pre class='pre'></pre><br/><span class='lineno'>02849</span><pre class='pre'>		$sql_exists = &quot;SELECT COUNT(*) cnt FROM photo_imgdata WHERE photo_id = &quot;.$p_photo_id;</pre><br/><span class='lineno'>02850</span><pre class='pre'>		// SQLææ³ã®ãã§ãã¯</pre><br/><span class='lineno'>02851</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql_exists);</pre><br/><span class='lineno'>02852</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>02853</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>02854</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>02855</span><pre class='pre'>		{</pre><br/><span class='lineno'>02856</span><pre class='pre'>			// ç»åããã¤ããªããªã</pre><br/><span class='lineno'>02857</span><pre class='pre'>			$tmp = substr($this-&gt;photo_filename,strpos($this-&gt;photo_filename,&quot;./&quot;));</pre><br/><span class='lineno'>02858</span><pre class='pre'>			$b_image1 = file_get_contents($tmp);</pre><br/><span class='lineno'>02859</span><pre class='pre'></pre><br/><span class='lineno'>02860</span><pre class='pre'>			$tmp = substr($this-&gt;photo_filename_th1,strpos($this-&gt;photo_filename_th1,&quot;./&quot;));</pre><br/><span class='lineno'>02861</span><pre class='pre'>			$b_image2 = file_get_contents($tmp);</pre><br/><span class='lineno'>02862</span><pre class='pre'></pre><br/><span class='lineno'>02863</span><pre class='pre'>			$tmp = substr($this-&gt;photo_filename_th2,strpos($this-&gt;photo_filename_th2,&quot;./&quot;));</pre><br/><span class='lineno'>02864</span><pre class='pre'>			$b_image3 = file_get_contents($tmp);</pre><br/><span class='lineno'>02865</span><pre class='pre'></pre><br/><span class='lineno'>02866</span><pre class='pre'>			$tmp = substr($this-&gt;photo_filename_th4,strpos($this-&gt;photo_filename_th4,&quot;./&quot;));</pre><br/><span class='lineno'>02867</span><pre class='pre'>			$b_image5 = file_get_contents($tmp);</pre><br/><span class='lineno'>02868</span><pre class='pre'></pre><br/><span class='lineno'>02869</span><pre class='pre'>			$pcnt = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>02870</span><pre class='pre'>			$tmpcnt = $pcnt['cnt'];</pre><br/><span class='lineno'>02871</span><pre class='pre'></pre><br/><span class='lineno'>02872</span><pre class='pre'>			//æ¢ã«å­å¨ã®å ´åã«æ´æ°ãã</pre><br/><span class='lineno'>02873</span><pre class='pre'>			if ((int)$tmpcnt &gt; 0)</pre><br/><span class='lineno'>02874</span><pre class='pre'>			{</pre><br/><span class='lineno'>02875</span><pre class='pre'>				// SQLæã®ä½æ</pre><br/><span class='lineno'>02876</span><pre class='pre'>				$sql = &quot;UPDATE photo_imgdata SET &quot;;</pre><br/><span class='lineno'>02877</span><pre class='pre'>				$sql .= &quot;image1= ?,&quot;;</pre><br/><span class='lineno'>02878</span><pre class='pre'>				$sql .= &quot;image2= ?,&quot;;</pre><br/><span class='lineno'>02879</span><pre class='pre'>				$sql .= &quot;image3= ?,&quot;;</pre><br/><span class='lineno'>02880</span><pre class='pre'>				$sql .= &quot;image5= ?&quot;;</pre><br/><span class='lineno'>02881</span><pre class='pre'></pre><br/><span class='lineno'>02882</span><pre class='pre'>				// æ´æ°æ¡ä»¶ã®è¨­å®</pre><br/><span class='lineno'>02883</span><pre class='pre'>				$sql .= &quot; WHERE photo_id=&quot; . $p_photo_id;</pre><br/><span class='lineno'>02884</span><pre class='pre'>				// SQLææ³ã®ãã§ãã¯</pre><br/><span class='lineno'>02885</span><pre class='pre'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>02886</span><pre class='pre'>				// ãã©ã¡ã¼ã¿ã®è¨­å®</pre><br/><span class='lineno'>02887</span><pre class='pre'>				$stmt-&gt;bindValue(1, $b_image1, PDO::PARAM_LOB);</pre><br/><span class='lineno'>02888</span><pre class='pre'>				$stmt-&gt;bindValue(2, $b_image2, PDO::PARAM_LOB);</pre><br/><span class='lineno'>02889</span><pre class='pre'>				$stmt-&gt;bindValue(3, $b_image3, PDO::PARAM_LOB);</pre><br/><span class='lineno'>02890</span><pre class='pre'>				$stmt-&gt;bindValue(4, $b_image5, PDO::PARAM_LOB);</pre><br/><span class='lineno'>02891</span><pre class='pre'></pre><br/><span class='lineno'>02892</span><pre class='pre'>							// ãã©ã³ã¶ã¯ã·ã§ã³ãéå§ãã¾ããï¼ãªã¼ãã³ãããããªãã«ãªãã¾ããï¼</pre><br/><span class='lineno'>02893</span><pre class='pre'>				$db_link-&gt;beginTransaction();</pre><br/><span class='lineno'>02894</span><pre class='pre'>				try</pre><br/><span class='lineno'>02895</span><pre class='pre'>				{</pre><br/><span class='lineno'>02896</span><pre class='pre'>					$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>02897</span><pre class='pre'>					if ($result == true)</pre><br/><span class='lineno'>02898</span><pre class='pre'>					{</pre><br/><span class='lineno'>02899</span><pre class='pre'>						// ã³ããããã¾ãã</pre><br/><span class='lineno'>02900</span><pre class='pre'>						$db_link-&gt;commit();</pre><br/><span class='lineno'>02901</span><pre class='pre'>					} else {</pre><br/><span class='lineno'>02902</span><pre class='pre'>						// ã­ã¼ã«ããã¯ãã¾ãã</pre><br/><span class='lineno'>02903</span><pre class='pre'>						$db_link-&gt;rollBack();</pre><br/><span class='lineno'>02904</span><pre class='pre'>						// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>02905</span><pre class='pre'>						$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>02906</span><pre class='pre'>						$this-&gt;message = &quot;ç»åãã¼ã¿ã®æ´æ°ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>02907</span><pre class='pre'>						//throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02908</span><pre class='pre'>						throw new Exception($err[2]);</pre><br/><span class='lineno'>02909</span><pre class='pre'>					}</pre><br/><span class='lineno'>02910</span><pre class='pre'>				} catch(Exception $e) {</pre><br/><span class='lineno'>02911</span><pre class='pre'>					// ã­ã¼ã«ããã¯ãã¾ãã</pre><br/><span class='lineno'>02912</span><pre class='pre'>					//$db_link-&gt;rollBack();</pre><br/><span class='lineno'>02913</span><pre class='pre'>					// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>02914</span><pre class='pre'>					$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>02915</span><pre class='pre'>					throw new Exception($msg);</pre><br/><span class='lineno'>02916</span><pre class='pre'>				}</pre><br/><span class='lineno'>02917</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>02918</span><pre class='pre'>			//å­å¨ããªãå ´åã«æ°è¦ãã</pre><br/><span class='lineno'>02919</span><pre class='pre'>				// SQLæã®ä½æ</pre><br/><span class='lineno'>02920</span><pre class='pre'>				$sql = &quot;INSERT INTO photo_imgdata (  photo_id,</pre><br/><span class='lineno'>02921</span><pre class='pre'>													 image1,</pre><br/><span class='lineno'>02922</span><pre class='pre'>													 image2,</pre><br/><span class='lineno'>02923</span><pre class='pre'>													 image3,</pre><br/><span class='lineno'>02924</span><pre class='pre'>													 image5</pre><br/><span class='lineno'>02925</span><pre class='pre'>									 	 		  ) VALUES ($p_photo_id,?,?,?,?)&quot;;</pre><br/><span class='lineno'>02926</span><pre class='pre'>				// SQLææ³ã®ãã§ãã¯</pre><br/><span class='lineno'>02927</span><pre class='pre'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>02928</span><pre class='pre'>				// ãã©ã¡ã¼ã¿ã®è¨­å®</pre><br/><span class='lineno'>02929</span><pre class='pre'>				$stmt-&gt;bindValue(1, $b_image1, PDO::PARAM_LOB);</pre><br/><span class='lineno'>02930</span><pre class='pre'>				$stmt-&gt;bindValue(2, $b_image2, PDO::PARAM_LOB);</pre><br/><span class='lineno'>02931</span><pre class='pre'>				$stmt-&gt;bindValue(3, $b_image3, PDO::PARAM_LOB);</pre><br/><span class='lineno'>02932</span><pre class='pre'>				$stmt-&gt;bindValue(4, $b_image5, PDO::PARAM_LOB);</pre><br/><span class='lineno'>02933</span><pre class='pre'></pre><br/><span class='lineno'>02934</span><pre class='pre'>							// ãã©ã³ã¶ã¯ã·ã§ã³ãéå§ãã¾ããï¼ãªã¼ãã³ãããããªãã«ãªãã¾ããï¼</pre><br/><span class='lineno'>02935</span><pre class='pre'>				$db_link-&gt;beginTransaction();</pre><br/><span class='lineno'>02936</span><pre class='pre'>				try</pre><br/><span class='lineno'>02937</span><pre class='pre'>				{</pre><br/><span class='lineno'>02938</span><pre class='pre'>					$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>02939</span><pre class='pre'>					if ($result == true)</pre><br/><span class='lineno'>02940</span><pre class='pre'>					{</pre><br/><span class='lineno'>02941</span><pre class='pre'>						// ã³ããããã¾ãã</pre><br/><span class='lineno'>02942</span><pre class='pre'>						$db_link-&gt;commit();</pre><br/><span class='lineno'>02943</span><pre class='pre'>					} else {</pre><br/><span class='lineno'>02944</span><pre class='pre'>						// ã­ã¼ã«ããã¯ãã¾ãã</pre><br/><span class='lineno'>02945</span><pre class='pre'>						$db_link-&gt;rollBack();</pre><br/><span class='lineno'>02946</span><pre class='pre'>						// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>02947</span><pre class='pre'>						$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>02948</span><pre class='pre'>						$this-&gt;message = &quot;ç»åãã¼ã¿ã®æ´æ°ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>02949</span><pre class='pre'>						//throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02950</span><pre class='pre'>						throw new Exception($err[2]);</pre><br/><span class='lineno'>02951</span><pre class='pre'>					}</pre><br/><span class='lineno'>02952</span><pre class='pre'>				} catch(Exception $e) {</pre><br/><span class='lineno'>02953</span><pre class='pre'>					// ã­ã¼ã«ããã¯ãã¾ãã</pre><br/><span class='lineno'>02954</span><pre class='pre'>					//$db_link-&gt;rollBack();</pre><br/><span class='lineno'>02955</span><pre class='pre'>					// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>02956</span><pre class='pre'>					$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>02957</span><pre class='pre'>					throw new Exception($msg);</pre><br/><span class='lineno'>02958</span><pre class='pre'>				}</pre><br/><span class='lineno'>02959</span><pre class='pre'>			}</pre><br/><span class='lineno'>02960</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>02961</span><pre class='pre'>			$this-&gt;message = &quot;ç»åãã¼ã¿ã®æ´æ°ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>02962</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>02963</span><pre class='pre'>		}</pre><br/><span class='lineno'>02964</span><pre class='pre'>	}</pre><br/><span class='lineno'>02965</span><pre class='pre'></pre><br/><span class='lineno'>02966</span><pre class='pre'></pre><br/><span class='lineno'>02967</span><pre class='pre'>	/*</pre><br/><span class='lineno'>02968</span><pre class='pre'>	 * é¢æ°åï¼update_data</pre><br/><span class='lineno'>02969</span><pre class='pre'>	 * é¢æ°èª¬æï¼ï¼¤ï¼¢ã®æ´æ°</pre><br/><span class='lineno'>02970</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼db_linkï¼ï¼¤ï¼¢ãªã³ã¯</pre><br/><span class='lineno'>02971</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>02972</span><pre class='pre'>	 */</pre><br/><span class='lineno'>02973</span><pre class='pre'>	function update_data($db_link)</pre><br/><span class='lineno'>02974</span><pre class='pre'>	{</pre><br/><span class='lineno'>02975</span><pre class='pre'>		// ãã©ã¡ã¼ã¿ã®ãã§ãã¯ã¨èª¿æ´ããã¾ãã</pre><br/><span class='lineno'>02976</span><pre class='pre'>		$this-&gt;check_adjust_param(&quot;U&quot;);</pre><br/><span class='lineno'>02977</span><pre class='pre'></pre><br/><span class='lineno'>02978</span><pre class='pre'>		// åçãã¼ã¿ãæ´æ°ãã¾ãã</pre><br/><span class='lineno'>02979</span><pre class='pre'>		$sql = &quot;UPDATE photoimg SET &quot;;</pre><br/><span class='lineno'>02980</span><pre class='pre'>		//yupengbo modify 2011/12/15 start</pre><br/><span class='lineno'>02981</span><pre class='pre'>		$sql .= &quot;publishing_situation_id=&quot; . $this-&gt;publishing_situation_id . &quot;,&quot;;</pre><br/><span class='lineno'>02982</span><pre class='pre'>		$sql .= &quot;registration_division_id=&quot; . $this-&gt;registration_division_id . &quot;,&quot;;</pre><br/><span class='lineno'>02983</span><pre class='pre'>		$sql .= &quot;take_picture_time_id=&quot; . $this-&gt;take_picture_time_id . &quot;,&quot;;</pre><br/><span class='lineno'>02984</span><pre class='pre'>		$sql .= &quot;take_picture_time2_id=&quot; . $this-&gt;take_picture_time2_id . &quot;,&quot;;</pre><br/><span class='lineno'>02985</span><pre class='pre'>		$sql .= &quot;borrowing_ahead_id=&quot; . $this-&gt;borrowing_ahead_id . &quot;,&quot;;</pre><br/><span class='lineno'>02986</span><pre class='pre'>		$sql .= &quot;range_of_use_id=&quot; . $this-&gt;range_of_use_id . &quot;,&quot;;</pre><br/><span class='lineno'>02987</span><pre class='pre'>		$sql .= &quot;monopoly_use=&quot; . $this-&gt;monopoly_use . &quot;,&quot;;</pre><br/><span class='lineno'>02988</span><pre class='pre'>//		$sql .= &quot;photo_mno=\&quot;&quot;.$this-&gt;photo_mno. &quot;\&quot;,&quot;;</pre><br/><span class='lineno'>02989</span><pre class='pre'>//		$sql .= &quot;source_image_no=\&quot;&quot;.$this-&gt;source_image_no.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>02990</span><pre class='pre'>//		$sql .= &quot;bud_photo_no=\&quot;&quot;.$this-&gt;bud_photo_no.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>02991</span><pre class='pre'>//		$sql .= &quot;photo_name=\&quot;&quot;.$this-&gt;photo_name.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>02992</span><pre class='pre'>//		$sql .= &quot;photo_explanation=\&quot;&quot;.$this-&gt;photo_explanation.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>02993</span><pre class='pre'>//		$sql .= &quot;dfrom=\&quot;&quot;.$this-&gt;dfrom.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>02994</span><pre class='pre'>//		$sql .= &quot;dto=\&quot;&quot;.$this-&gt;dto.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>02995</span><pre class='pre'>//		$sql .= &quot;kikan=\&quot;&quot;.$this-&gt;kikan.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>02996</span><pre class='pre'>//		$sql .= &quot;content_borrowing_ahead=\&quot;&quot;.$this-&gt;content_borrowing_ahead.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>02997</span><pre class='pre'>//		$sql .= &quot;use_condition=\&quot;&quot;.$this-&gt;use_condition.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>02998</span><pre class='pre'>//		$sql .= &quot;additional_constraints1=\&quot;&quot;.$this-&gt;additional_constraints1.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>02999</span><pre class='pre'>//		$sql .= &quot;additional_constraints2=\&quot;&quot;.$this-&gt;additional_constraints2.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>03000</span><pre class='pre'>//		$sql .= &quot;copyright_owner=\&quot;&quot;.$this-&gt;copyright_owner.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>03001</span><pre class='pre'>//		$sql .= &quot;customer_section=\&quot;&quot;.$this-&gt;customer_section.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>03002</span><pre class='pre'>//		$sql .= &quot;customer_name=\&quot;&quot;.$this-&gt;customer_name.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>03003</span><pre class='pre'>//		$sql .= &quot;permission_account=\&quot;&quot;.$this-&gt;permission_account.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>03004</span><pre class='pre'>//		$sql .= &quot;permission_person=\&quot;&quot;.$this-&gt;permission_person.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>03005</span><pre class='pre'>//		$sql .= &quot;permission_date=\&quot;&quot;.$this-&gt;permission_date.&quot;\&quot;,&quot;;</pre><br/><span class='lineno'>03006</span><pre class='pre'>//		$sql .= &quot;note=\&quot;&quot;.$this-&gt;note.&quot;\&quot;&quot;;</pre><br/><span class='lineno'>03007</span><pre class='pre'>//		$sql .= &quot; WHERE photo_id=&quot; . $this-&gt;photo_id;</pre><br/><span class='lineno'>03008</span><pre class='pre'></pre><br/><span class='lineno'>03009</span><pre class='pre'>		$sql .= &quot;photo_mno=?,&quot;;</pre><br/><span class='lineno'>03010</span><pre class='pre'>		$sql .= &quot;source_image_no=?,&quot;;</pre><br/><span class='lineno'>03011</span><pre class='pre'>		$sql .= &quot;bud_photo_no=?,&quot;;</pre><br/><span class='lineno'>03012</span><pre class='pre'>		$sql .= &quot;photo_name=?,&quot;;</pre><br/><span class='lineno'>03013</span><pre class='pre'>		$sql .= &quot;photo_explanation=?,&quot;;</pre><br/><span class='lineno'>03014</span><pre class='pre'>		$sql .= &quot;dfrom=?,&quot;;</pre><br/><span class='lineno'>03015</span><pre class='pre'>		$sql .= &quot;dto=?,&quot;;</pre><br/><span class='lineno'>03016</span><pre class='pre'>		$sql .= &quot;kikan=?,&quot;;</pre><br/><span class='lineno'>03017</span><pre class='pre'>		$sql .= &quot;content_borrowing_ahead=?,&quot;;</pre><br/><span class='lineno'>03018</span><pre class='pre'>		$sql .= &quot;use_condition=?,&quot;;</pre><br/><span class='lineno'>03019</span><pre class='pre'>		$sql .= &quot;additional_constraints1=?,&quot;;</pre><br/><span class='lineno'>03020</span><pre class='pre'>		$sql .= &quot;additional_constraints2=?,&quot;;</pre><br/><span class='lineno'>03021</span><pre class='pre'>		$sql .= &quot;copyright_owner=?,&quot;;</pre><br/><span class='lineno'>03022</span><pre class='pre'>		$sql .= &quot;customer_section=?,&quot;;</pre><br/><span class='lineno'>03023</span><pre class='pre'>		$sql .= &quot;customer_name=?,&quot;;</pre><br/><span class='lineno'>03024</span><pre class='pre'>		$sql .= &quot;permission_account=?,&quot;;</pre><br/><span class='lineno'>03025</span><pre class='pre'>		$sql .= &quot;permission_person=?,&quot;;</pre><br/><span class='lineno'>03026</span><pre class='pre'>		$sql .= &quot;permission_date=?,&quot;;</pre><br/><span class='lineno'>03027</span><pre class='pre'>		$sql .= &quot;note=?,&quot;;</pre><br/><span class='lineno'>03028</span><pre class='pre'>		//jinxin 2012/02/09 modify start</pre><br/><span class='lineno'>03029</span><pre class='pre'>		$sql .= &quot;nopermit_note=?,&quot;;</pre><br/><span class='lineno'>03030</span><pre class='pre'>		$sql .= &quot;nopermit_date=?,&quot;;</pre><br/><span class='lineno'>03031</span><pre class='pre'>		$sql .= &quot;nopermit_personid=?&quot;;</pre><br/><span class='lineno'>03032</span><pre class='pre'>		$sql .= &quot; WHERE photo_id=?&quot;;</pre><br/><span class='lineno'>03033</span><pre class='pre'>		//yupengbo modify 2011/12/15 end</pre><br/><span class='lineno'>03034</span><pre class='pre'>		//jinxin modify 2012/02/07 end</pre><br/><span class='lineno'>03035</span><pre class='pre'></pre><br/><span class='lineno'>03036</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>03037</span><pre class='pre'>		//yupengbo add 2011/12/15 start</pre><br/><span class='lineno'>03038</span><pre class='pre'>		$stmt-&gt;bindParam(1,$this-&gt;photo_mno);</pre><br/><span class='lineno'>03039</span><pre class='pre'>		if(!empty($this-&gt;source_image_no))</pre><br/><span class='lineno'>03040</span><pre class='pre'>		{</pre><br/><span class='lineno'>03041</span><pre class='pre'>			$stmt-&gt;bindParam(2,$this-&gt;source_image_no);</pre><br/><span class='lineno'>03042</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03043</span><pre class='pre'>			$stmt-&gt;bindValue(2,null);</pre><br/><span class='lineno'>03044</span><pre class='pre'>		}</pre><br/><span class='lineno'>03045</span><pre class='pre'>		if(!empty($this-&gt;bud_photo_no))</pre><br/><span class='lineno'>03046</span><pre class='pre'>		{</pre><br/><span class='lineno'>03047</span><pre class='pre'>			$stmt-&gt;bindParam(3,$this-&gt;bud_photo_no);</pre><br/><span class='lineno'>03048</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03049</span><pre class='pre'>			$stmt-&gt;bindValue(3,null);</pre><br/><span class='lineno'>03050</span><pre class='pre'>		}</pre><br/><span class='lineno'>03051</span><pre class='pre'>		if(!empty($this-&gt;photo_name))</pre><br/><span class='lineno'>03052</span><pre class='pre'>		{</pre><br/><span class='lineno'>03053</span><pre class='pre'>			$stmt-&gt;bindParam(4,$this-&gt;photo_name);</pre><br/><span class='lineno'>03054</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03055</span><pre class='pre'>			$stmt-&gt;bindValue(4,null);</pre><br/><span class='lineno'>03056</span><pre class='pre'>		}</pre><br/><span class='lineno'>03057</span><pre class='pre'>		if(!empty($this-&gt;photo_explanation))</pre><br/><span class='lineno'>03058</span><pre class='pre'>		{</pre><br/><span class='lineno'>03059</span><pre class='pre'>			$stmt-&gt;bindParam(5,$this-&gt;photo_explanation);</pre><br/><span class='lineno'>03060</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03061</span><pre class='pre'>			$stmt-&gt;bindValue(5,null);</pre><br/><span class='lineno'>03062</span><pre class='pre'>		}</pre><br/><span class='lineno'>03063</span><pre class='pre'>		if(!empty($this-&gt;dfrom))</pre><br/><span class='lineno'>03064</span><pre class='pre'>		{</pre><br/><span class='lineno'>03065</span><pre class='pre'>			$stmt-&gt;bindParam(6,$this-&gt;dfrom);</pre><br/><span class='lineno'>03066</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03067</span><pre class='pre'>			$stmt-&gt;bindValue(6,null);</pre><br/><span class='lineno'>03068</span><pre class='pre'>		}</pre><br/><span class='lineno'>03069</span><pre class='pre'>		if(!empty($this-&gt;dto))</pre><br/><span class='lineno'>03070</span><pre class='pre'>		{</pre><br/><span class='lineno'>03071</span><pre class='pre'>			$stmt-&gt;bindParam(7,$this-&gt;dto);</pre><br/><span class='lineno'>03072</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03073</span><pre class='pre'>			$stmt-&gt;bindValue(7,null);</pre><br/><span class='lineno'>03074</span><pre class='pre'>		}</pre><br/><span class='lineno'>03075</span><pre class='pre'>		if(!empty($this-&gt;kikan))</pre><br/><span class='lineno'>03076</span><pre class='pre'>		{</pre><br/><span class='lineno'>03077</span><pre class='pre'>			$stmt-&gt;bindParam(8,$this-&gt;kikan);</pre><br/><span class='lineno'>03078</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03079</span><pre class='pre'>			$stmt-&gt;bindValue(8,null);</pre><br/><span class='lineno'>03080</span><pre class='pre'>		}</pre><br/><span class='lineno'>03081</span><pre class='pre'>		if(!empty($this-&gt;content_borrowing_ahead))</pre><br/><span class='lineno'>03082</span><pre class='pre'>		{</pre><br/><span class='lineno'>03083</span><pre class='pre'>			$stmt-&gt;bindParam(9,$this-&gt;content_borrowing_ahead);</pre><br/><span class='lineno'>03084</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03085</span><pre class='pre'>			$stmt-&gt;bindValue(9,null);</pre><br/><span class='lineno'>03086</span><pre class='pre'>		}</pre><br/><span class='lineno'>03087</span><pre class='pre'>		if(!empty($this-&gt;use_condition))</pre><br/><span class='lineno'>03088</span><pre class='pre'>		{</pre><br/><span class='lineno'>03089</span><pre class='pre'>			$stmt-&gt;bindParam(10,$this-&gt;use_condition);</pre><br/><span class='lineno'>03090</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03091</span><pre class='pre'>			$stmt-&gt;bindValue(10,null);</pre><br/><span class='lineno'>03092</span><pre class='pre'>		}</pre><br/><span class='lineno'>03093</span><pre class='pre'>		if(!empty($this-&gt;additional_constraints1))</pre><br/><span class='lineno'>03094</span><pre class='pre'>		{</pre><br/><span class='lineno'>03095</span><pre class='pre'>			$stmt-&gt;bindParam(11,$this-&gt;additional_constraints1);</pre><br/><span class='lineno'>03096</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03097</span><pre class='pre'>			$stmt-&gt;bindValue(11,null);</pre><br/><span class='lineno'>03098</span><pre class='pre'>		}</pre><br/><span class='lineno'>03099</span><pre class='pre'>		if(!empty($this-&gt;additional_constraints2))</pre><br/><span class='lineno'>03100</span><pre class='pre'>		{</pre><br/><span class='lineno'>03101</span><pre class='pre'>			$stmt-&gt;bindParam(12,$this-&gt;additional_constraints2);</pre><br/><span class='lineno'>03102</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03103</span><pre class='pre'>			$stmt-&gt;bindValue(12,null);</pre><br/><span class='lineno'>03104</span><pre class='pre'>		}</pre><br/><span class='lineno'>03105</span><pre class='pre'>		if(!empty($this-&gt;copyright_owner))</pre><br/><span class='lineno'>03106</span><pre class='pre'>		{</pre><br/><span class='lineno'>03107</span><pre class='pre'>			$stmt-&gt;bindParam(13,$this-&gt;copyright_owner);</pre><br/><span class='lineno'>03108</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03109</span><pre class='pre'>			$stmt-&gt;bindValue(13,null);</pre><br/><span class='lineno'>03110</span><pre class='pre'>		}</pre><br/><span class='lineno'>03111</span><pre class='pre'>		if(!empty($this-&gt;customer_section))</pre><br/><span class='lineno'>03112</span><pre class='pre'>		{</pre><br/><span class='lineno'>03113</span><pre class='pre'>			$stmt-&gt;bindParam(14,$this-&gt;customer_section);</pre><br/><span class='lineno'>03114</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03115</span><pre class='pre'>			$stmt-&gt;bindValue(14,null);</pre><br/><span class='lineno'>03116</span><pre class='pre'>		}</pre><br/><span class='lineno'>03117</span><pre class='pre'>		if(!empty($this-&gt;customer_name))</pre><br/><span class='lineno'>03118</span><pre class='pre'>		{</pre><br/><span class='lineno'>03119</span><pre class='pre'>			$stmt-&gt;bindParam(15,$this-&gt;customer_name);</pre><br/><span class='lineno'>03120</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03121</span><pre class='pre'>			$stmt-&gt;bindValue(15,null);</pre><br/><span class='lineno'>03122</span><pre class='pre'>		}</pre><br/><span class='lineno'>03123</span><pre class='pre'>		if(!empty($this-&gt;permission_account))</pre><br/><span class='lineno'>03124</span><pre class='pre'>		{</pre><br/><span class='lineno'>03125</span><pre class='pre'>			$stmt-&gt;bindParam(16,$this-&gt;permission_account);</pre><br/><span class='lineno'>03126</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03127</span><pre class='pre'>			$stmt-&gt;bindValue(16,null);</pre><br/><span class='lineno'>03128</span><pre class='pre'>		}</pre><br/><span class='lineno'>03129</span><pre class='pre'>		if(!empty($this-&gt;permission_person))</pre><br/><span class='lineno'>03130</span><pre class='pre'>		{</pre><br/><span class='lineno'>03131</span><pre class='pre'>			$stmt-&gt;bindParam(17,$this-&gt;permission_person);</pre><br/><span class='lineno'>03132</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03133</span><pre class='pre'>			$stmt-&gt;bindValue(17,null);</pre><br/><span class='lineno'>03134</span><pre class='pre'>		}</pre><br/><span class='lineno'>03135</span><pre class='pre'>		if(!empty($this-&gt;permission_date))</pre><br/><span class='lineno'>03136</span><pre class='pre'>		{</pre><br/><span class='lineno'>03137</span><pre class='pre'>			$stmt-&gt;bindParam(18,$this-&gt;permission_date);</pre><br/><span class='lineno'>03138</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03139</span><pre class='pre'>			$stmt-&gt;bindValue(18,null);</pre><br/><span class='lineno'>03140</span><pre class='pre'>		}</pre><br/><span class='lineno'>03141</span><pre class='pre'>		if(!empty($this-&gt;note))</pre><br/><span class='lineno'>03142</span><pre class='pre'>		{</pre><br/><span class='lineno'>03143</span><pre class='pre'>			$stmt-&gt;bindParam(19,$this-&gt;note);</pre><br/><span class='lineno'>03144</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03145</span><pre class='pre'>			$stmt-&gt;bindValue(19,null);</pre><br/><span class='lineno'>03146</span><pre class='pre'>		}</pre><br/><span class='lineno'>03147</span><pre class='pre'>		//jinxin 2012/02/09 modify start</pre><br/><span class='lineno'>03148</span><pre class='pre'>		if(!empty($this-&gt;nopermis))</pre><br/><span class='lineno'>03149</span><pre class='pre'>		{</pre><br/><span class='lineno'>03150</span><pre class='pre'>			$stmt-&gt;bindParam(20,$this-&gt;nopermis);</pre><br/><span class='lineno'>03151</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03152</span><pre class='pre'>			$stmt-&gt;bindValue(20,null);</pre><br/><span class='lineno'>03153</span><pre class='pre'>		}</pre><br/><span class='lineno'>03154</span><pre class='pre'>		if(!empty($this-&gt;nopermis_date))</pre><br/><span class='lineno'>03155</span><pre class='pre'>		{</pre><br/><span class='lineno'>03156</span><pre class='pre'>			$stmt-&gt;bindParam(21,$this-&gt;nopermis_date);</pre><br/><span class='lineno'>03157</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03158</span><pre class='pre'>			$stmt-&gt;bindValue(21,null);</pre><br/><span class='lineno'>03159</span><pre class='pre'>		}</pre><br/><span class='lineno'>03160</span><pre class='pre'>		if(!empty($this-&gt;nopermis_personid))</pre><br/><span class='lineno'>03161</span><pre class='pre'>		{</pre><br/><span class='lineno'>03162</span><pre class='pre'>			$stmt-&gt;bindParam(22,$this-&gt;nopermis_personid);</pre><br/><span class='lineno'>03163</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03164</span><pre class='pre'>			$stmt-&gt;bindValue(22,null);</pre><br/><span class='lineno'>03165</span><pre class='pre'>		}</pre><br/><span class='lineno'>03166</span><pre class='pre'>		//jinxin 2012/02/09 modify end</pre><br/><span class='lineno'>03167</span><pre class='pre'>		if(!empty($this-&gt;photo_id))</pre><br/><span class='lineno'>03168</span><pre class='pre'>		{</pre><br/><span class='lineno'>03169</span><pre class='pre'>			$stmt-&gt;bindParam(23,$this-&gt;photo_id);</pre><br/><span class='lineno'>03170</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>03171</span><pre class='pre'>			$stmt-&gt;bindValue(23,null);</pre><br/><span class='lineno'>03172</span><pre class='pre'>		}</pre><br/><span class='lineno'>03173</span><pre class='pre'>		//yupengbo add 2011/12/15 end</pre><br/><span class='lineno'>03174</span><pre class='pre'></pre><br/><span class='lineno'>03175</span><pre class='pre'>		// ãã©ã³ã¶ã¯ã·ã§ã³ãéå§ãã¾ããï¼ãªã¼ãã³ãããããªãã«ãªãã¾ããï¼</pre><br/><span class='lineno'>03176</span><pre class='pre'>		$db_link-&gt;beginTransaction();</pre><br/><span class='lineno'>03177</span><pre class='pre'></pre><br/><span class='lineno'>03178</span><pre class='pre'>		try</pre><br/><span class='lineno'>03179</span><pre class='pre'>		{</pre><br/><span class='lineno'>03180</span><pre class='pre'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>03181</span><pre class='pre'>			if ($result == true)</pre><br/><span class='lineno'>03182</span><pre class='pre'>			{</pre><br/><span class='lineno'>03183</span><pre class='pre'>				// ã­ã¼ã¯ã¼ããå¥ãã¼ãã«ã«ç»é²ãã¾ãã</pre><br/><span class='lineno'>03184</span><pre class='pre'>				$this-&gt;delete_keyword($db_link, $this-&gt;photo_id);</pre><br/><span class='lineno'>03185</span><pre class='pre'>				$this-&gt;insert_keyword($db_link, $this-&gt;photo_id, $this-&gt;keyword_str);</pre><br/><span class='lineno'>03186</span><pre class='pre'></pre><br/><span class='lineno'>03187</span><pre class='pre'>				// åé¡ãå¥ãã¼ãã«ã«ç»é²ãã¾ãã</pre><br/><span class='lineno'>03188</span><pre class='pre'>				// â»ãã§ã«photo_idä»¥å¤ã¯ãã¹ã¦ãã¼ã¿ã»ããæ¸ã¿ã§ã</pre><br/><span class='lineno'>03189</span><pre class='pre'>				$this-&gt;registration_classifications-&gt;delete_data($db_link, $this-&gt;photo_id);</pre><br/><span class='lineno'>03190</span><pre class='pre'>				$this-&gt;registration_classifications-&gt;insert_data($db_link, $this-&gt;photo_id);</pre><br/><span class='lineno'>03191</span><pre class='pre'>				$this-&gt;update_keyword($db_link);</pre><br/><span class='lineno'>03192</span><pre class='pre'></pre><br/><span class='lineno'>03193</span><pre class='pre'>				// ã³ããããã¾ãã</pre><br/><span class='lineno'>03194</span><pre class='pre'>				$db_link-&gt;commit();</pre><br/><span class='lineno'>03195</span><pre class='pre'>			}</pre><br/><span class='lineno'>03196</span><pre class='pre'>			else</pre><br/><span class='lineno'>03197</span><pre class='pre'>			{</pre><br/><span class='lineno'>03198</span><pre class='pre'>				$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>03199</span><pre class='pre'>				$this-&gt;message = &quot;ç»åãã¼ã¿ã®æ´æ°ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>03200</span><pre class='pre'>				//throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03201</span><pre class='pre'>				throw new Exception($err[2]);</pre><br/><span class='lineno'>03202</span><pre class='pre'>			}</pre><br/><span class='lineno'>03203</span><pre class='pre'>		}</pre><br/><span class='lineno'>03204</span><pre class='pre'>		catch(Exception $e)</pre><br/><span class='lineno'>03205</span><pre class='pre'>		{</pre><br/><span class='lineno'>03206</span><pre class='pre'>			// ã­ã¼ã«ããã¯ãã¾ãã</pre><br/><span class='lineno'>03207</span><pre class='pre'>			$db_link-&gt;rollBack();</pre><br/><span class='lineno'>03208</span><pre class='pre'></pre><br/><span class='lineno'>03209</span><pre class='pre'>			// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03210</span><pre class='pre'>			$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>03211</span><pre class='pre'>			throw new Exception($msg);</pre><br/><span class='lineno'>03212</span><pre class='pre'>		}</pre><br/><span class='lineno'>03213</span><pre class='pre'></pre><br/><span class='lineno'>03214</span><pre class='pre'>	}</pre><br/><span class='lineno'>03215</span><pre class='pre'></pre><br/><span class='lineno'>03216</span><pre class='pre'>	/**</pre><br/><span class='lineno'>03217</span><pre class='pre'>	 * é¢æ°åï¼batch_update_data</pre><br/><span class='lineno'>03218</span><pre class='pre'>	 * é¢æ°èª¬æï¼ä¸æ¬æ´æ°</pre><br/><span class='lineno'>03219</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼db_linkï¼ï¼¤ï¼¢ãªã³ã¯</pre><br/><span class='lineno'>03220</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>03221</span><pre class='pre'>	 */</pre><br/><span class='lineno'>03222</span><pre class='pre'>	function batch_update_data($db_link)</pre><br/><span class='lineno'>03223</span><pre class='pre'>	{</pre><br/><span class='lineno'>03224</span><pre class='pre'>	    // ãã©ã¡ã¼ã¿ã®ãã§ãã¯ã¨èª¿æ´ããã¾ãã</pre><br/><span class='lineno'>03225</span><pre class='pre'>	    $this-&gt;check_adjust_param(&quot;U&quot;);</pre><br/><span class='lineno'>03226</span><pre class='pre'></pre><br/><span class='lineno'>03227</span><pre class='pre'>	    // åçãã¼ã¿ãæ´æ°ãã¾ãã</pre><br/><span class='lineno'>03228</span><pre class='pre'>	    $sql = &quot;UPDATE photoimg SET &quot;;</pre><br/><span class='lineno'>03229</span><pre class='pre'>	    //yupengbo modify 2011/12/15 start</pre><br/><span class='lineno'>03230</span><pre class='pre'>	    $sql .= &quot;publishing_situation_id=&quot; . $this-&gt;publishing_situation_id . &quot;,&quot;;</pre><br/><span class='lineno'>03231</span><pre class='pre'>	    $sql .= &quot;registration_division_id=&quot; . $this-&gt;registration_division_id . &quot;,&quot;;</pre><br/><span class='lineno'>03232</span><pre class='pre'>	    $sql .= &quot;take_picture_time_id=&quot; . $this-&gt;take_picture_time_id . &quot;,&quot;;</pre><br/><span class='lineno'>03233</span><pre class='pre'>	    $sql .= &quot;take_picture_time2_id=&quot; . $this-&gt;take_picture_time2_id . &quot;,&quot;;</pre><br/><span class='lineno'>03234</span><pre class='pre'>	    $sql .= &quot;borrowing_ahead_id=&quot; . $this-&gt;borrowing_ahead_id . &quot;,&quot;;</pre><br/><span class='lineno'>03235</span><pre class='pre'>	    $sql .= &quot;range_of_use_id=&quot; . $this-&gt;range_of_use_id . &quot;,&quot;;</pre><br/><span class='lineno'>03236</span><pre class='pre'>	    $sql .= &quot;monopoly_use=&quot; . $this-&gt;monopoly_use . &quot;,&quot;;</pre><br/><span class='lineno'>03237</span><pre class='pre'></pre><br/><span class='lineno'>03238</span><pre class='pre'>	    $sql .= &quot;photo_mno=?,&quot;;</pre><br/><span class='lineno'>03239</span><pre class='pre'>	    $sql .= &quot;source_image_no=?,&quot;;</pre><br/><span class='lineno'>03240</span><pre class='pre'>	    $sql .= &quot;bud_photo_no=?,&quot;;</pre><br/><span class='lineno'>03241</span><pre class='pre'>	    $sql .= &quot;photo_name=?,&quot;;</pre><br/><span class='lineno'>03242</span><pre class='pre'>	    $sql .= &quot;photo_explanation=?,&quot;;</pre><br/><span class='lineno'>03243</span><pre class='pre'>	    $sql .= &quot;dfrom=?,&quot;;</pre><br/><span class='lineno'>03244</span><pre class='pre'>	    $sql .= &quot;dto=?,&quot;;</pre><br/><span class='lineno'>03245</span><pre class='pre'>	    $sql .= &quot;kikan=?,&quot;;</pre><br/><span class='lineno'>03246</span><pre class='pre'>	    $sql .= &quot;content_borrowing_ahead=?,&quot;;</pre><br/><span class='lineno'>03247</span><pre class='pre'>	    $sql .= &quot;use_condition=?,&quot;;</pre><br/><span class='lineno'>03248</span><pre class='pre'>	    $sql .= &quot;additional_constraints1=?,&quot;;</pre><br/><span class='lineno'>03249</span><pre class='pre'>	    $sql .= &quot;additional_constraints2=?,&quot;;</pre><br/><span class='lineno'>03250</span><pre class='pre'>	    $sql .= &quot;copyright_owner=?,&quot;;</pre><br/><span class='lineno'>03251</span><pre class='pre'>	    $sql .= &quot;customer_section=?,&quot;;</pre><br/><span class='lineno'>03252</span><pre class='pre'>	    $sql .= &quot;customer_name=?,&quot;;</pre><br/><span class='lineno'>03253</span><pre class='pre'>	    $sql .= &quot;permission_account=?,&quot;;</pre><br/><span class='lineno'>03254</span><pre class='pre'>	    $sql .= &quot;permission_person=?,&quot;;</pre><br/><span class='lineno'>03255</span><pre class='pre'>	    $sql .= &quot;permission_date=?,&quot;;</pre><br/><span class='lineno'>03256</span><pre class='pre'>	    $sql .= &quot;note=?,&quot;;</pre><br/><span class='lineno'>03257</span><pre class='pre'>	    $sql .= &quot;photo_org_no=?,&quot;;</pre><br/><span class='lineno'>03258</span><pre class='pre'>	    $sql .= &quot;photo_url=?,&quot;;</pre><br/><span class='lineno'>03259</span><pre class='pre'>	    $sql .= &quot;nopermit_note=?,&quot;;</pre><br/><span class='lineno'>03260</span><pre class='pre'>	    $sql .= &quot;nopermit_date=?,&quot;;</pre><br/><span class='lineno'>03261</span><pre class='pre'>	    $sql .= &quot;nopermit_personid=?,&quot;;</pre><br/><span class='lineno'>03262</span><pre class='pre'></pre><br/><span class='lineno'>03263</span><pre class='pre'>	    $sql .= &quot;photo_filename=?,&quot;;</pre><br/><span class='lineno'>03264</span><pre class='pre'>	    $sql .= &quot;photo_filename_th1=?,&quot;;</pre><br/><span class='lineno'>03265</span><pre class='pre'>	    $sql .= &quot;photo_filename_th2=?,&quot;;</pre><br/><span class='lineno'>03266</span><pre class='pre'>	    $sql .= &quot;photo_filename_th3=?,&quot;;</pre><br/><span class='lineno'>03267</span><pre class='pre'>	    $sql .= &quot;photo_filename_th4=?,&quot;;</pre><br/><span class='lineno'>03268</span><pre class='pre'>	    $sql .= &quot;photo_filename_th5=?,&quot;;</pre><br/><span class='lineno'>03269</span><pre class='pre'>	    $sql .= &quot;photo_filename_th6=?,&quot;;</pre><br/><span class='lineno'>03270</span><pre class='pre'>	    $sql .= &quot;photo_filename_th7=?,&quot;;</pre><br/><span class='lineno'>03271</span><pre class='pre'>	    $sql .= &quot;photo_filename_th8=?,&quot;;</pre><br/><span class='lineno'>03272</span><pre class='pre'>	    $sql .= &quot;photo_filename_th9=?,&quot;;</pre><br/><span class='lineno'>03273</span><pre class='pre'>	    $sql .= &quot;photo_filename_th10=?,&quot;;</pre><br/><span class='lineno'>03274</span><pre class='pre'></pre><br/><span class='lineno'>03275</span><pre class='pre'>	    $sql .= &quot;ext=?,&quot;;</pre><br/><span class='lineno'>03276</span><pre class='pre'>	    $sql .= &quot;image_size_x=&quot; . $this-&gt;image_size_x . &quot;,&quot;;</pre><br/><span class='lineno'>03277</span><pre class='pre'>	    $sql .= &quot;image_size_y=&quot; . $this-&gt;image_size_y . &quot;,&quot;;</pre><br/><span class='lineno'>03278</span><pre class='pre'>	    $sql .= &quot;register_date=?&quot;;</pre><br/><span class='lineno'>03279</span><pre class='pre'></pre><br/><span class='lineno'>03280</span><pre class='pre'>	    $sql .= &quot; WHERE photo_id=?&quot;;</pre><br/><span class='lineno'>03281</span><pre class='pre'></pre><br/><span class='lineno'>03282</span><pre class='pre'>	    $stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>03283</span><pre class='pre'></pre><br/><span class='lineno'>03284</span><pre class='pre'>	    $stmt-&gt;bindParam(1,$this-&gt;photo_mno);</pre><br/><span class='lineno'>03285</span><pre class='pre'>	    if(!empty($this-&gt;source_image_no))</pre><br/><span class='lineno'>03286</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03287</span><pre class='pre'>	        $stmt-&gt;bindParam(2,$this-&gt;source_image_no);</pre><br/><span class='lineno'>03288</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03289</span><pre class='pre'>	        $stmt-&gt;bindValue(2,null);</pre><br/><span class='lineno'>03290</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03291</span><pre class='pre'>	    if(!empty($this-&gt;bud_photo_no))</pre><br/><span class='lineno'>03292</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03293</span><pre class='pre'>	        $stmt-&gt;bindParam(3,$this-&gt;bud_photo_no);</pre><br/><span class='lineno'>03294</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03295</span><pre class='pre'>	        $stmt-&gt;bindValue(3,null);</pre><br/><span class='lineno'>03296</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03297</span><pre class='pre'>	    if(!empty($this-&gt;photo_name))</pre><br/><span class='lineno'>03298</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03299</span><pre class='pre'>	        $stmt-&gt;bindParam(4,$this-&gt;photo_name);</pre><br/><span class='lineno'>03300</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03301</span><pre class='pre'>	        $stmt-&gt;bindValue(4,null);</pre><br/><span class='lineno'>03302</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03303</span><pre class='pre'>	    if(!empty($this-&gt;photo_explanation))</pre><br/><span class='lineno'>03304</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03305</span><pre class='pre'>	        $stmt-&gt;bindParam(5,$this-&gt;photo_explanation);</pre><br/><span class='lineno'>03306</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03307</span><pre class='pre'>	        $stmt-&gt;bindValue(5,null);</pre><br/><span class='lineno'>03308</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03309</span><pre class='pre'>	    if(!empty($this-&gt;dfrom))</pre><br/><span class='lineno'>03310</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03311</span><pre class='pre'>	        $stmt-&gt;bindParam(6,$this-&gt;dfrom);</pre><br/><span class='lineno'>03312</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03313</span><pre class='pre'>	        $stmt-&gt;bindValue(6,null);</pre><br/><span class='lineno'>03314</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03315</span><pre class='pre'>	    if(!empty($this-&gt;dto))</pre><br/><span class='lineno'>03316</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03317</span><pre class='pre'>	        $stmt-&gt;bindParam(7,$this-&gt;dto);</pre><br/><span class='lineno'>03318</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03319</span><pre class='pre'>	        $stmt-&gt;bindValue(7,null);</pre><br/><span class='lineno'>03320</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03321</span><pre class='pre'>	    if(!empty($this-&gt;kikan))</pre><br/><span class='lineno'>03322</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03323</span><pre class='pre'>	        $stmt-&gt;bindParam(8,$this-&gt;kikan);</pre><br/><span class='lineno'>03324</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03325</span><pre class='pre'>	        $stmt-&gt;bindValue(8,null);</pre><br/><span class='lineno'>03326</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03327</span><pre class='pre'>	    if(!empty($this-&gt;content_borrowing_ahead))</pre><br/><span class='lineno'>03328</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03329</span><pre class='pre'>	        $stmt-&gt;bindParam(9,$this-&gt;content_borrowing_ahead);</pre><br/><span class='lineno'>03330</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03331</span><pre class='pre'>	        $stmt-&gt;bindValue(9,null);</pre><br/><span class='lineno'>03332</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03333</span><pre class='pre'>	    if(!empty($this-&gt;use_condition))</pre><br/><span class='lineno'>03334</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03335</span><pre class='pre'>	        $stmt-&gt;bindParam(10,$this-&gt;use_condition);</pre><br/><span class='lineno'>03336</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03337</span><pre class='pre'>	        $stmt-&gt;bindValue(10,null);</pre><br/><span class='lineno'>03338</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03339</span><pre class='pre'>	    if(!empty($this-&gt;additional_constraints1))</pre><br/><span class='lineno'>03340</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03341</span><pre class='pre'>	        $stmt-&gt;bindParam(11,$this-&gt;additional_constraints1);</pre><br/><span class='lineno'>03342</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03343</span><pre class='pre'>	        $stmt-&gt;bindValue(11,null);</pre><br/><span class='lineno'>03344</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03345</span><pre class='pre'>	    if(!empty($this-&gt;additional_constraints2))</pre><br/><span class='lineno'>03346</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03347</span><pre class='pre'>	        $stmt-&gt;bindParam(12,$this-&gt;additional_constraints2);</pre><br/><span class='lineno'>03348</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03349</span><pre class='pre'>	        $stmt-&gt;bindValue(12,null);</pre><br/><span class='lineno'>03350</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03351</span><pre class='pre'>	    if(!empty($this-&gt;copyright_owner))</pre><br/><span class='lineno'>03352</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03353</span><pre class='pre'>	        $stmt-&gt;bindParam(13,$this-&gt;copyright_owner);</pre><br/><span class='lineno'>03354</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03355</span><pre class='pre'>	        $stmt-&gt;bindValue(13,null);</pre><br/><span class='lineno'>03356</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03357</span><pre class='pre'>	    if(!empty($this-&gt;customer_section))</pre><br/><span class='lineno'>03358</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03359</span><pre class='pre'>	        $stmt-&gt;bindParam(14,$this-&gt;customer_section);</pre><br/><span class='lineno'>03360</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03361</span><pre class='pre'>	        $stmt-&gt;bindValue(14,null);</pre><br/><span class='lineno'>03362</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03363</span><pre class='pre'>	    if(!empty($this-&gt;customer_name))</pre><br/><span class='lineno'>03364</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03365</span><pre class='pre'>	        $stmt-&gt;bindParam(15,$this-&gt;customer_name);</pre><br/><span class='lineno'>03366</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03367</span><pre class='pre'>	        $stmt-&gt;bindValue(15,null);</pre><br/><span class='lineno'>03368</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03369</span><pre class='pre'>	    if(!empty($this-&gt;permission_account))</pre><br/><span class='lineno'>03370</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03371</span><pre class='pre'>	        $stmt-&gt;bindParam(16,$this-&gt;permission_account);</pre><br/><span class='lineno'>03372</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03373</span><pre class='pre'>	        $stmt-&gt;bindValue(16,null);</pre><br/><span class='lineno'>03374</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03375</span><pre class='pre'>	    if(!empty($this-&gt;permission_person))</pre><br/><span class='lineno'>03376</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03377</span><pre class='pre'>	        $stmt-&gt;bindParam(17,$this-&gt;permission_person);</pre><br/><span class='lineno'>03378</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03379</span><pre class='pre'>	        $stmt-&gt;bindValue(17,null);</pre><br/><span class='lineno'>03380</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03381</span><pre class='pre'>	    if(!empty($this-&gt;permission_date))</pre><br/><span class='lineno'>03382</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03383</span><pre class='pre'>	        $stmt-&gt;bindParam(18,$this-&gt;permission_date);</pre><br/><span class='lineno'>03384</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03385</span><pre class='pre'>	        $stmt-&gt;bindValue(18,null);</pre><br/><span class='lineno'>03386</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03387</span><pre class='pre'>	    if(!empty($this-&gt;note))</pre><br/><span class='lineno'>03388</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03389</span><pre class='pre'>	        $stmt-&gt;bindParam(19,$this-&gt;note);</pre><br/><span class='lineno'>03390</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03391</span><pre class='pre'>	        $stmt-&gt;bindValue(19,null);</pre><br/><span class='lineno'>03392</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03393</span><pre class='pre'>	    if(!empty($this-&gt;photo_org_no))</pre><br/><span class='lineno'>03394</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03395</span><pre class='pre'>	        $stmt-&gt;bindParam(20,$this-&gt;photo_org_no);</pre><br/><span class='lineno'>03396</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03397</span><pre class='pre'>	        $stmt-&gt;bindValue(20,null);</pre><br/><span class='lineno'>03398</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03399</span><pre class='pre'>	    if(!empty($this-&gt;photo_url))</pre><br/><span class='lineno'>03400</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03401</span><pre class='pre'>	        $stmt-&gt;bindParam(21,$this-&gt;photo_url);</pre><br/><span class='lineno'>03402</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03403</span><pre class='pre'>	        $stmt-&gt;bindValue(21,null);</pre><br/><span class='lineno'>03404</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03405</span><pre class='pre'>	    //jinxin 2012/02/09 modify start</pre><br/><span class='lineno'>03406</span><pre class='pre'>	    if(!empty($this-&gt;nopermis))</pre><br/><span class='lineno'>03407</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03408</span><pre class='pre'>	        $stmt-&gt;bindParam(22,$this-&gt;nopermis);</pre><br/><span class='lineno'>03409</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03410</span><pre class='pre'>	        $stmt-&gt;bindValue(22,null);</pre><br/><span class='lineno'>03411</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03412</span><pre class='pre'>	    if(!empty($this-&gt;nopermis_date))</pre><br/><span class='lineno'>03413</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03414</span><pre class='pre'>	        $stmt-&gt;bindParam(23,$this-&gt;nopermis_date);</pre><br/><span class='lineno'>03415</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03416</span><pre class='pre'>	        $stmt-&gt;bindValue(23,null);</pre><br/><span class='lineno'>03417</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03418</span><pre class='pre'>	    if(!empty($this-&gt;nopermis_personid))</pre><br/><span class='lineno'>03419</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03420</span><pre class='pre'>	        $stmt-&gt;bindParam(24,$this-&gt;nopermis_personid);</pre><br/><span class='lineno'>03421</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>03422</span><pre class='pre'>	        $stmt-&gt;bindValue(24,null);</pre><br/><span class='lineno'>03423</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03424</span><pre class='pre'></pre><br/><span class='lineno'>03425</span><pre class='pre'>        //å¾çé¾æ¥</pre><br/><span class='lineno'>03426</span><pre class='pre'>        if (! empty($this-&gt;up_url[0])) {</pre><br/><span class='lineno'>03427</span><pre class='pre'>            $stmt-&gt;bindParam(25, $this-&gt;up_url[0]);</pre><br/><span class='lineno'>03428</span><pre class='pre'>        } else {</pre><br/><span class='lineno'>03429</span><pre class='pre'>            $stmt-&gt;bindValue(25, null);</pre><br/><span class='lineno'>03430</span><pre class='pre'>        }</pre><br/><span class='lineno'>03431</span><pre class='pre'></pre><br/><span class='lineno'>03432</span><pre class='pre'>        if (! empty($this-&gt;up_url[1])) {</pre><br/><span class='lineno'>03433</span><pre class='pre'>            $stmt-&gt;bindParam(26, $this-&gt;up_url[1]);</pre><br/><span class='lineno'>03434</span><pre class='pre'>        } else {</pre><br/><span class='lineno'>03435</span><pre class='pre'>            $stmt-&gt;bindValue(26, null);</pre><br/><span class='lineno'>03436</span><pre class='pre'>        }</pre><br/><span class='lineno'>03437</span><pre class='pre'></pre><br/><span class='lineno'>03438</span><pre class='pre'>        if (! empty($this-&gt;up_url[2])) {</pre><br/><span class='lineno'>03439</span><pre class='pre'>            $stmt-&gt;bindParam(27, $this-&gt;up_url[2]);</pre><br/><span class='lineno'>03440</span><pre class='pre'>        } else {</pre><br/><span class='lineno'>03441</span><pre class='pre'>            $stmt-&gt;bindValue(27, null);</pre><br/><span class='lineno'>03442</span><pre class='pre'>        }</pre><br/><span class='lineno'>03443</span><pre class='pre'></pre><br/><span class='lineno'>03444</span><pre class='pre'>        if (! empty($this-&gt;up_url[3])) {</pre><br/><span class='lineno'>03445</span><pre class='pre'>            $stmt-&gt;bindParam(28, $this-&gt;up_url[3]);</pre><br/><span class='lineno'>03446</span><pre class='pre'>        } else {</pre><br/><span class='lineno'>03447</span><pre class='pre'>            $stmt-&gt;bindValue(28, null);</pre><br/><span class='lineno'>03448</span><pre class='pre'>        }</pre><br/><span class='lineno'>03449</span><pre class='pre'></pre><br/><span class='lineno'>03450</span><pre class='pre'>        if (! empty($this-&gt;up_url[4])) {</pre><br/><span class='lineno'>03451</span><pre class='pre'>            $stmt-&gt;bindParam(29, $this-&gt;up_url[4]);</pre><br/><span class='lineno'>03452</span><pre class='pre'>        } else {</pre><br/><span class='lineno'>03453</span><pre class='pre'>            $stmt-&gt;bindValue(29, null);</pre><br/><span class='lineno'>03454</span><pre class='pre'>        }</pre><br/><span class='lineno'>03455</span><pre class='pre'></pre><br/><span class='lineno'>03456</span><pre class='pre'>        if (! empty($this-&gt;up_url[5])) {</pre><br/><span class='lineno'>03457</span><pre class='pre'>            $stmt-&gt;bindParam(30, $this-&gt;up_url[5]);</pre><br/><span class='lineno'>03458</span><pre class='pre'>        } else {</pre><br/><span class='lineno'>03459</span><pre class='pre'>            $stmt-&gt;bindValue(30, null);</pre><br/><span class='lineno'>03460</span><pre class='pre'>        }</pre><br/><span class='lineno'>03461</span><pre class='pre'></pre><br/><span class='lineno'>03462</span><pre class='pre'>        if (! empty($this-&gt;up_url[6])) {</pre><br/><span class='lineno'>03463</span><pre class='pre'>            $stmt-&gt;bindParam(31, $this-&gt;up_url[6]);</pre><br/><span class='lineno'>03464</span><pre class='pre'>        } else {</pre><br/><span class='lineno'>03465</span><pre class='pre'>            $stmt-&gt;bindValue(31, null);</pre><br/><span class='lineno'>03466</span><pre class='pre'>        }</pre><br/><span class='lineno'>03467</span><pre class='pre'></pre><br/><span class='lineno'>03468</span><pre class='pre'>        if (! empty($this-&gt;up_url[7])) {</pre><br/><span class='lineno'>03469</span><pre class='pre'>            $stmt-&gt;bindParam(32, $this-&gt;up_url[7]);</pre><br/><span class='lineno'>03470</span><pre class='pre'>        } else {</pre><br/><span class='lineno'>03471</span><pre class='pre'>            $stmt-&gt;bindValue(32, null);</pre><br/><span class='lineno'>03472</span><pre class='pre'>        }</pre><br/><span class='lineno'>03473</span><pre class='pre'></pre><br/><span class='lineno'>03474</span><pre class='pre'>        if (! empty($this-&gt;up_url[8])) {</pre><br/><span class='lineno'>03475</span><pre class='pre'>            $stmt-&gt;bindParam(33, $this-&gt;up_url[8]);</pre><br/><span class='lineno'>03476</span><pre class='pre'>        } else {</pre><br/><span class='lineno'>03477</span><pre class='pre'>            $stmt-&gt;bindValue(33, null);</pre><br/><span class='lineno'>03478</span><pre class='pre'>        }</pre><br/><span class='lineno'>03479</span><pre class='pre'></pre><br/><span class='lineno'>03480</span><pre class='pre'>        if (! empty($this-&gt;up_url[9])) {</pre><br/><span class='lineno'>03481</span><pre class='pre'>            $stmt-&gt;bindParam(34, $this-&gt;up_url[9]);</pre><br/><span class='lineno'>03482</span><pre class='pre'>        } else {</pre><br/><span class='lineno'>03483</span><pre class='pre'>            $stmt-&gt;bindValue(34, null);</pre><br/><span class='lineno'>03484</span><pre class='pre'>        }</pre><br/><span class='lineno'>03485</span><pre class='pre'></pre><br/><span class='lineno'>03486</span><pre class='pre'>        if (! empty($this-&gt;up_url[10])) {</pre><br/><span class='lineno'>03487</span><pre class='pre'>            $stmt-&gt;bindParam(35, $this-&gt;up_url[10]);</pre><br/><span class='lineno'>03488</span><pre class='pre'>        } else {</pre><br/><span class='lineno'>03489</span><pre class='pre'>            $stmt-&gt;bindValue(35, null);</pre><br/><span class='lineno'>03490</span><pre class='pre'>        }</pre><br/><span class='lineno'>03491</span><pre class='pre'></pre><br/><span class='lineno'>03492</span><pre class='pre'>        $stmt-&gt;bindParam(36, $this-&gt;ext);</pre><br/><span class='lineno'>03493</span><pre class='pre'>        if(!empty($this-&gt;register_date))</pre><br/><span class='lineno'>03494</span><pre class='pre'>        {</pre><br/><span class='lineno'>03495</span><pre class='pre'>            $stmt-&gt;bindParam(37,$this-&gt;register_date);</pre><br/><span class='lineno'>03496</span><pre class='pre'>        } else {</pre><br/><span class='lineno'>03497</span><pre class='pre'>            $stmt-&gt;bindValue(37,null);</pre><br/><span class='lineno'>03498</span><pre class='pre'>        }</pre><br/><span class='lineno'>03499</span><pre class='pre'></pre><br/><span class='lineno'>03500</span><pre class='pre'>	    $stmt-&gt;bindParam(38,$this-&gt;photo_id);</pre><br/><span class='lineno'>03501</span><pre class='pre'></pre><br/><span class='lineno'>03502</span><pre class='pre'>	    // ãã©ã³ã¶ã¯ã·ã§ã³ãéå§ãã¾ããï¼ãªã¼ãã³ãããããªãã«ãªãã¾ããï¼</pre><br/><span class='lineno'>03503</span><pre class='pre'>	    $db_link-&gt;beginTransaction();</pre><br/><span class='lineno'>03504</span><pre class='pre'></pre><br/><span class='lineno'>03505</span><pre class='pre'>	    try</pre><br/><span class='lineno'>03506</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03507</span><pre class='pre'>	        $result = $stmt-&gt;execute();</pre><br/><span class='lineno'>03508</span><pre class='pre'>	        if ($result == true)</pre><br/><span class='lineno'>03509</span><pre class='pre'>	        {</pre><br/><span class='lineno'>03510</span><pre class='pre'>	            // ã­ã¼ã¯ã¼ããå¥ãã¼ãã«ã«ç»é²ãã¾ãã</pre><br/><span class='lineno'>03511</span><pre class='pre'>	            $this-&gt;delete_keyword($db_link, $this-&gt;photo_id);</pre><br/><span class='lineno'>03512</span><pre class='pre'>	            $this-&gt;insert_keyword($db_link, $this-&gt;photo_id, $this-&gt;keyword_str);</pre><br/><span class='lineno'>03513</span><pre class='pre'></pre><br/><span class='lineno'>03514</span><pre class='pre'>	            // åé¡ãå¥ãã¼ãã«ã«ç»é²ãã¾ãã</pre><br/><span class='lineno'>03515</span><pre class='pre'>	            // â»ãã§ã«photo_idä»¥å¤ã¯ãã¹ã¦ãã¼ã¿ã»ããæ¸ã¿ã§ã</pre><br/><span class='lineno'>03516</span><pre class='pre'>	            $this-&gt;registration_classifications-&gt;delete_data($db_link, $this-&gt;photo_id);</pre><br/><span class='lineno'>03517</span><pre class='pre'>	            $this-&gt;registration_classifications-&gt;insert_data($db_link, $this-&gt;photo_id);</pre><br/><span class='lineno'>03518</span><pre class='pre'>	            $this-&gt;update_keyword($db_link);</pre><br/><span class='lineno'>03519</span><pre class='pre'></pre><br/><span class='lineno'>03520</span><pre class='pre'>	            // ã³ããããã¾ãã</pre><br/><span class='lineno'>03521</span><pre class='pre'>	            $db_link-&gt;commit();</pre><br/><span class='lineno'>03522</span><pre class='pre'>	        }</pre><br/><span class='lineno'>03523</span><pre class='pre'>	        else</pre><br/><span class='lineno'>03524</span><pre class='pre'>	        {</pre><br/><span class='lineno'>03525</span><pre class='pre'>	            $err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>03526</span><pre class='pre'>	            $this-&gt;message = &quot;ç»åãã¼ã¿ã®æ´æ°ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>03527</span><pre class='pre'>	            //throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03528</span><pre class='pre'>	            throw new Exception($err[2]);</pre><br/><span class='lineno'>03529</span><pre class='pre'>	        }</pre><br/><span class='lineno'>03530</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03531</span><pre class='pre'>	    catch(Exception $e)</pre><br/><span class='lineno'>03532</span><pre class='pre'>	    {</pre><br/><span class='lineno'>03533</span><pre class='pre'>	        // ã­ã¼ã«ããã¯ãã¾ãã</pre><br/><span class='lineno'>03534</span><pre class='pre'>	        $db_link-&gt;rollBack();</pre><br/><span class='lineno'>03535</span><pre class='pre'></pre><br/><span class='lineno'>03536</span><pre class='pre'>	        // ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03537</span><pre class='pre'>	        $msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>03538</span><pre class='pre'>	        throw new Exception($msg);</pre><br/><span class='lineno'>03539</span><pre class='pre'>	    }</pre><br/><span class='lineno'>03540</span><pre class='pre'></pre><br/><span class='lineno'>03541</span><pre class='pre'>	}</pre><br/><span class='lineno'>03542</span><pre class='pre'></pre><br/><span class='lineno'>03543</span><pre class='pre'>	//yupengbo add 2011/12/12 start</pre><br/><span class='lineno'>03544</span><pre class='pre'>	/*</pre><br/><span class='lineno'>03545</span><pre class='pre'>	 * é¢æ°åï¼update_data_batch</pre><br/><span class='lineno'>03546</span><pre class='pre'>	 * é¢æ°èª¬æï¼ï¼¤ï¼¢ã®æ´æ°</pre><br/><span class='lineno'>03547</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼db_linkï¼ï¼¤ï¼¢ãªã³ã¯</pre><br/><span class='lineno'>03548</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>03549</span><pre class='pre'>	 */</pre><br/><span class='lineno'>03550</span><pre class='pre'>	function update_data_batch($db_link)</pre><br/><span class='lineno'>03551</span><pre class='pre'>	{</pre><br/><span class='lineno'>03552</span><pre class='pre'>		// åçãã¼ã¿ãæ´æ°ãã¾ãã</pre><br/><span class='lineno'>03553</span><pre class='pre'>		$sql = &quot;UPDATE photoimg SET &quot;;</pre><br/><span class='lineno'>03554</span><pre class='pre'>		$sql .= &quot;publishing_situation_id=?,&quot;;</pre><br/><span class='lineno'>03555</span><pre class='pre'>		$sql .= &quot;photo_mno=?,&quot;;</pre><br/><span class='lineno'>03556</span><pre class='pre'>		//$sql .= &quot;permission_account=?,&quot;;</pre><br/><span class='lineno'>03557</span><pre class='pre'>		//$sql .= &quot;permission_person=?,&quot;;</pre><br/><span class='lineno'>03558</span><pre class='pre'>		$sql .= &quot;permission_date=?&quot;;</pre><br/><span class='lineno'>03559</span><pre class='pre'>		$sql .= &quot; WHERE photo_id=?&quot;;</pre><br/><span class='lineno'>03560</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>03561</span><pre class='pre'></pre><br/><span class='lineno'>03562</span><pre class='pre'>		$stmt-&gt;bindParam(1, $this-&gt;publishing_situation_id);</pre><br/><span class='lineno'>03563</span><pre class='pre'>		$stmt-&gt;bindParam(2, $this-&gt;photo_mno);</pre><br/><span class='lineno'>03564</span><pre class='pre'>		//$stmt-&gt;bindParam(3, $this-&gt;permission_account);</pre><br/><span class='lineno'>03565</span><pre class='pre'>		//$stmt-&gt;bindParam(4, $this-&gt;permission_person);</pre><br/><span class='lineno'>03566</span><pre class='pre'>		$stmt-&gt;bindParam(3, $this-&gt;permission_date);</pre><br/><span class='lineno'>03567</span><pre class='pre'>		$stmt-&gt;bindParam(4, $this-&gt;photo_id);</pre><br/><span class='lineno'>03568</span><pre class='pre'>		// ãã©ã³ã¶ã¯ã·ã§ã³ãéå§ãã¾ããï¼ãªã¼ãã³ãããããªãã«ãªãã¾ããï¼</pre><br/><span class='lineno'>03569</span><pre class='pre'>		$db_link-&gt;beginTransaction();</pre><br/><span class='lineno'>03570</span><pre class='pre'></pre><br/><span class='lineno'>03571</span><pre class='pre'>		try</pre><br/><span class='lineno'>03572</span><pre class='pre'>		{</pre><br/><span class='lineno'>03573</span><pre class='pre'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>03574</span><pre class='pre'>			if ($result == true)</pre><br/><span class='lineno'>03575</span><pre class='pre'>			{</pre><br/><span class='lineno'>03576</span><pre class='pre'>				//</pre><br/><span class='lineno'>03577</span><pre class='pre'>				$keyword_id_temp = array();</pre><br/><span class='lineno'>03578</span><pre class='pre'>				$keyword_name_temp = array();</pre><br/><span class='lineno'>03579</span><pre class='pre'>				$this-&gt;get_keyword($db_link,$keyword_id_temp,$keyword_name_temp,$this-&gt;photo_id);</pre><br/><span class='lineno'>03580</span><pre class='pre'>				if(isset($keyword_name_temp[0]))</pre><br/><span class='lineno'>03581</span><pre class='pre'>				{</pre><br/><span class='lineno'>03582</span><pre class='pre'>					$keyword_name = array();</pre><br/><span class='lineno'>03583</span><pre class='pre'>					$keyword_name = explode(&quot; &quot;,trim($keyword_name_temp[0]));</pre><br/><span class='lineno'>03584</span><pre class='pre'>					$keyword_name[0] = $this-&gt;photo_mno;</pre><br/><span class='lineno'>03585</span><pre class='pre'>					$keyword_name[1] = &quot;&quot;;</pre><br/><span class='lineno'>03586</span><pre class='pre'>					$this-&gt;update_keyword($db_link,implode(&quot; &quot;,$keyword_name));</pre><br/><span class='lineno'>03587</span><pre class='pre'>				}</pre><br/><span class='lineno'>03588</span><pre class='pre'>				//</pre><br/><span class='lineno'>03589</span><pre class='pre'>				// ã³ããããã¾ãã</pre><br/><span class='lineno'>03590</span><pre class='pre'>				$db_link-&gt;commit();</pre><br/><span class='lineno'>03591</span><pre class='pre'>			}</pre><br/><span class='lineno'>03592</span><pre class='pre'>			else</pre><br/><span class='lineno'>03593</span><pre class='pre'>			{</pre><br/><span class='lineno'>03594</span><pre class='pre'>				$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>03595</span><pre class='pre'>				$this-&gt;message = &quot;ç»åãã¼ã¿ã®æ´æ°ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>03596</span><pre class='pre'>				//throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03597</span><pre class='pre'>				throw new Exception($err[2]);</pre><br/><span class='lineno'>03598</span><pre class='pre'>			}</pre><br/><span class='lineno'>03599</span><pre class='pre'>		}</pre><br/><span class='lineno'>03600</span><pre class='pre'>		catch(Exception $e)</pre><br/><span class='lineno'>03601</span><pre class='pre'>		{</pre><br/><span class='lineno'>03602</span><pre class='pre'>			// ã­ã¼ã«ããã¯ãã¾ãã</pre><br/><span class='lineno'>03603</span><pre class='pre'>			$db_link-&gt;rollBack();</pre><br/><span class='lineno'>03604</span><pre class='pre'></pre><br/><span class='lineno'>03605</span><pre class='pre'>			// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03606</span><pre class='pre'>			$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>03607</span><pre class='pre'>			throw new Exception($msg);</pre><br/><span class='lineno'>03608</span><pre class='pre'>		}</pre><br/><span class='lineno'>03609</span><pre class='pre'></pre><br/><span class='lineno'>03610</span><pre class='pre'>	}</pre><br/><span class='lineno'>03611</span><pre class='pre'>	//yupengbo add 2011/12/12 end</pre><br/><span class='lineno'>03612</span><pre class='pre'>	/*</pre><br/><span class='lineno'>03613</span><pre class='pre'>	 * é¢æ°åï¼update_keyword</pre><br/><span class='lineno'>03614</span><pre class='pre'>	 * é¢æ°èª¬æï¼ã­ã¼ã¯ã¼ãã®æ´æ°</pre><br/><span class='lineno'>03615</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼db_linkï¼ï¼¤ï¼¢ãªã³ã¯</pre><br/><span class='lineno'>03616</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼keyword_nameï¼ã­ã¼ã¯ã¼ã //yupengbo add 2011/12/12</pre><br/><span class='lineno'>03617</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>03618</span><pre class='pre'>	 */</pre><br/><span class='lineno'>03619</span><pre class='pre'>	function update_keyword($db_link,$keyword_name=&quot;&quot;)</pre><br/><span class='lineno'>03620</span><pre class='pre'>	{</pre><br/><span class='lineno'>03621</span><pre class='pre'>		// ã­ã¼ã¯ã¼ããã¼ãã«ãæ´æ°ãã¾ãã</pre><br/><span class='lineno'>03622</span><pre class='pre'>		$sql = &quot;UPDATE keyword SET &quot;;</pre><br/><span class='lineno'>03623</span><pre class='pre'>		//yupengbo modify 2011/12/15 start</pre><br/><span class='lineno'>03624</span><pre class='pre'>//		$sql .= &quot;publishing_situation_id=&quot;. $this-&gt;publishing_situation_id;</pre><br/><span class='lineno'>03625</span><pre class='pre'>//		//yupengbo add 2011/12/12 start</pre><br/><span class='lineno'>03626</span><pre class='pre'>//		if(!empty($keyword_name))</pre><br/><span class='lineno'>03627</span><pre class='pre'>//		{</pre><br/><span class='lineno'>03628</span><pre class='pre'>//			$sql .= &quot;,keyword_name='&quot;.$keyword_name.&quot;'&quot;;</pre><br/><span class='lineno'>03629</span><pre class='pre'>//		}</pre><br/><span class='lineno'>03630</span><pre class='pre'>//		//yupengbo add 2011/12/12 end</pre><br/><span class='lineno'>03631</span><pre class='pre'>//		$sql .= &quot; WHERE photo_id=&quot; . $this-&gt;photo_id;</pre><br/><span class='lineno'>03632</span><pre class='pre'>		$sql .= &quot;publishing_situation_id=?&quot;;</pre><br/><span class='lineno'>03633</span><pre class='pre'>		if(!empty($keyword_name)) $sql .= &quot;,keyword_name=?&quot;;</pre><br/><span class='lineno'>03634</span><pre class='pre'>		$sql .= &quot; WHERE photo_id=?&quot;;</pre><br/><span class='lineno'>03635</span><pre class='pre'>		//yupengbo modify 2011/11/15 end</pre><br/><span class='lineno'>03636</span><pre class='pre'></pre><br/><span class='lineno'>03637</span><pre class='pre'>		try</pre><br/><span class='lineno'>03638</span><pre class='pre'>		{</pre><br/><span class='lineno'>03639</span><pre class='pre'>			$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>03640</span><pre class='pre'>			//yupengbo add 2011/12/15 start</pre><br/><span class='lineno'>03641</span><pre class='pre'>			$stmt-&gt;bindParam(1,$this-&gt;publishing_situation_id);</pre><br/><span class='lineno'>03642</span><pre class='pre'>			if(!empty($keyword_name))</pre><br/><span class='lineno'>03643</span><pre class='pre'>			{</pre><br/><span class='lineno'>03644</span><pre class='pre'>				$stmt-&gt;bindParam(2,$keyword_name);</pre><br/><span class='lineno'>03645</span><pre class='pre'>				$stmt-&gt;bindParam(3,$this-&gt;photo_id);</pre><br/><span class='lineno'>03646</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>03647</span><pre class='pre'>				$stmt-&gt;bindParam(2,$this-&gt;photo_id);</pre><br/><span class='lineno'>03648</span><pre class='pre'>			}</pre><br/><span class='lineno'>03649</span><pre class='pre'>			//yupengbo add 2011/12/15 end</pre><br/><span class='lineno'>03650</span><pre class='pre'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>03651</span><pre class='pre'>			if ($result == false)</pre><br/><span class='lineno'>03652</span><pre class='pre'>			{</pre><br/><span class='lineno'>03653</span><pre class='pre'>				$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>03654</span><pre class='pre'>				$this-&gt;message = &quot;ç»åãã¼ã¿ã®æ´æ°ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>03655</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03656</span><pre class='pre'>			}</pre><br/><span class='lineno'>03657</span><pre class='pre'>		}</pre><br/><span class='lineno'>03658</span><pre class='pre'>		catch(Exception $e)</pre><br/><span class='lineno'>03659</span><pre class='pre'>		{</pre><br/><span class='lineno'>03660</span><pre class='pre'>			// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03661</span><pre class='pre'>			$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>03662</span><pre class='pre'>			throw new Exception($msg);</pre><br/><span class='lineno'>03663</span><pre class='pre'>		}</pre><br/><span class='lineno'>03664</span><pre class='pre'>	}</pre><br/><span class='lineno'>03665</span><pre class='pre'></pre><br/><span class='lineno'>03666</span><pre class='pre'>	// æ¹é¢åãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>03667</span><pre class='pre'>	function get_direction_name($db_link, $db_id, &amp;$db_name)</pre><br/><span class='lineno'>03668</span><pre class='pre'>	{</pre><br/><span class='lineno'>03669</span><pre class='pre'>		// æ¡ä»¶ãå¥ã£ã¦ããªãå ´åã¯ããã®ã¾ã¾æ»ãã¾ãã</pre><br/><span class='lineno'>03670</span><pre class='pre'>		if (empty($db_id) || $db_id == &quot;-1&quot;)</pre><br/><span class='lineno'>03671</span><pre class='pre'>		{</pre><br/><span class='lineno'>03672</span><pre class='pre'>			return;</pre><br/><span class='lineno'>03673</span><pre class='pre'>		}</pre><br/><span class='lineno'>03674</span><pre class='pre'></pre><br/><span class='lineno'>03675</span><pre class='pre'>		// æ¹é¢æå ±ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>03676</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>03677</span><pre class='pre'>		$sql = &quot;SELECT direction_id, direction_name FROM direction WHERE direction_id = ? &quot;;</pre><br/><span class='lineno'>03678</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>03679</span><pre class='pre'>		$stmt-&gt;bindParam(1, $db_id);</pre><br/><span class='lineno'>03680</span><pre class='pre'></pre><br/><span class='lineno'>03681</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>03682</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>03683</span><pre class='pre'></pre><br/><span class='lineno'>03684</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>03685</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>03686</span><pre class='pre'>		{</pre><br/><span class='lineno'>03687</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03688</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>03689</span><pre class='pre'>			if ($icount &gt;= 0)</pre><br/><span class='lineno'>03690</span><pre class='pre'>			{</pre><br/><span class='lineno'>03691</span><pre class='pre'>				$direction = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>03692</span><pre class='pre'>				//  æ¹é¢åãä¿å­ãã¾ãã</pre><br/><span class='lineno'>03693</span><pre class='pre'>				$db_name = $direction['direction_name'];</pre><br/><span class='lineno'>03694</span><pre class='pre'>			}</pre><br/><span class='lineno'>03695</span><pre class='pre'>			else</pre><br/><span class='lineno'>03696</span><pre class='pre'>			{</pre><br/><span class='lineno'>03697</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03698</span><pre class='pre'>				$this-&gt;message = &quot;æ¹é¢ãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;0ï¼&quot;;</pre><br/><span class='lineno'>03699</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03700</span><pre class='pre'>			}</pre><br/><span class='lineno'>03701</span><pre class='pre'>		}</pre><br/><span class='lineno'>03702</span><pre class='pre'>		else</pre><br/><span class='lineno'>03703</span><pre class='pre'>		{</pre><br/><span class='lineno'>03704</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03705</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03706</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>03707</span><pre class='pre'>			$this-&gt;message = &quot;æ¹é¢ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>03708</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03709</span><pre class='pre'>		}</pre><br/><span class='lineno'>03710</span><pre class='pre'>	}</pre><br/><span class='lineno'>03711</span><pre class='pre'></pre><br/><span class='lineno'>03712</span><pre class='pre'>	// å½ã»é½éåºçåãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>03713</span><pre class='pre'>	function get_country_prefecture_name($db_link, $db_id, &amp;$db_name)</pre><br/><span class='lineno'>03714</span><pre class='pre'>	{</pre><br/><span class='lineno'>03715</span><pre class='pre'>		// æ¡ä»¶ãå¥ã£ã¦ããªãå ´åã¯ããã®ã¾ã¾æ»ãã¾ãã</pre><br/><span class='lineno'>03716</span><pre class='pre'>		if (empty($db_id) || $db_id == &quot;-1&quot;)</pre><br/><span class='lineno'>03717</span><pre class='pre'>		{</pre><br/><span class='lineno'>03718</span><pre class='pre'>			return;</pre><br/><span class='lineno'>03719</span><pre class='pre'>		}</pre><br/><span class='lineno'>03720</span><pre class='pre'></pre><br/><span class='lineno'>03721</span><pre class='pre'>		// å½ã»é½éåºçæå ±ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>03722</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>03723</span><pre class='pre'>		$sql = &quot;SELECT country_prefecture_id, country_prefecture_name FROM country_prefecture WHERE country_prefecture_id = ? &quot;;</pre><br/><span class='lineno'>03724</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>03725</span><pre class='pre'>		$stmt-&gt;bindParam(1, $db_id);</pre><br/><span class='lineno'>03726</span><pre class='pre'></pre><br/><span class='lineno'>03727</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>03728</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>03729</span><pre class='pre'></pre><br/><span class='lineno'>03730</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>03731</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>03732</span><pre class='pre'>		{</pre><br/><span class='lineno'>03733</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03734</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>03735</span><pre class='pre'>			if ($icount &gt;= 0)</pre><br/><span class='lineno'>03736</span><pre class='pre'>			{</pre><br/><span class='lineno'>03737</span><pre class='pre'>				$country_prefecture = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>03738</span><pre class='pre'>				//  å½ã»é½éåºçåãä¿å­ãã¾ãã</pre><br/><span class='lineno'>03739</span><pre class='pre'>				$db_name = $country_prefecture['country_prefecture_name'];</pre><br/><span class='lineno'>03740</span><pre class='pre'>			}</pre><br/><span class='lineno'>03741</span><pre class='pre'>			else</pre><br/><span class='lineno'>03742</span><pre class='pre'>			{</pre><br/><span class='lineno'>03743</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03744</span><pre class='pre'>				$this-&gt;message = &quot;å½ã»é½éåºçãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;0ï¼&quot;;</pre><br/><span class='lineno'>03745</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03746</span><pre class='pre'>			}</pre><br/><span class='lineno'>03747</span><pre class='pre'>		}</pre><br/><span class='lineno'>03748</span><pre class='pre'>		else</pre><br/><span class='lineno'>03749</span><pre class='pre'>		{</pre><br/><span class='lineno'>03750</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03751</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03752</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>03753</span><pre class='pre'>			$this-&gt;message = &quot;å½ã»é½éåºçãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>03754</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03755</span><pre class='pre'>		}</pre><br/><span class='lineno'>03756</span><pre class='pre'>	}</pre><br/><span class='lineno'>03757</span><pre class='pre'></pre><br/><span class='lineno'>03758</span><pre class='pre'>	// å½ã»é½éåºçåãDBããåå¾ãã¾ããï¼æµ·å¤ç¨ï¼</pre><br/><span class='lineno'>03759</span><pre class='pre'>	function get_country_prefecture_name2($db_link, $db_id, &amp;$db_name)</pre><br/><span class='lineno'>03760</span><pre class='pre'>	{</pre><br/><span class='lineno'>03761</span><pre class='pre'>		// æ¡ä»¶ãå¥ã£ã¦ããªãå ´åã¯ããã®ã¾ã¾æ»ãã¾ãã</pre><br/><span class='lineno'>03762</span><pre class='pre'>		if (empty($db_id) || $db_id == &quot;-1&quot;)</pre><br/><span class='lineno'>03763</span><pre class='pre'>		{</pre><br/><span class='lineno'>03764</span><pre class='pre'>			return;</pre><br/><span class='lineno'>03765</span><pre class='pre'>		}</pre><br/><span class='lineno'>03766</span><pre class='pre'></pre><br/><span class='lineno'>03767</span><pre class='pre'>		// å½ã»é½éåºçæå ±ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>03768</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>03769</span><pre class='pre'>		$sql = &quot;SELECT &quot;;</pre><br/><span class='lineno'>03770</span><pre class='pre'>		$sql .= &quot;country_id, country_name_case0,country_name_case1,country_name_case2,&quot;;</pre><br/><span class='lineno'>03771</span><pre class='pre'>		$sql .= &quot;country_name_case3,country_name_case4,country_name_case5,country_name_case6,&quot;;</pre><br/><span class='lineno'>03772</span><pre class='pre'>		$sql .= &quot;country_name_case7,country_name_case8,country_name_case9,country_name_case10&quot;;</pre><br/><span class='lineno'>03773</span><pre class='pre'>		$sql .= &quot; FROM country_case WHERE country_id = ? &quot;;</pre><br/><span class='lineno'>03774</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>03775</span><pre class='pre'>		$stmt-&gt;bindParam(1, $db_id);</pre><br/><span class='lineno'>03776</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>03777</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>03778</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>03779</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>03780</span><pre class='pre'>		{</pre><br/><span class='lineno'>03781</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03782</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>03783</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>03784</span><pre class='pre'>			{</pre><br/><span class='lineno'>03785</span><pre class='pre'>				$country_prefecture = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>03786</span><pre class='pre'>				//  å½ã»é½éåºçåãä¿å­ãã¾ãã</pre><br/><span class='lineno'>03787</span><pre class='pre'>				$db_name = &quot;&quot;;</pre><br/><span class='lineno'>03788</span><pre class='pre'>				if(!empty($country_prefecture['country_name_case0'])) $db_name .= $country_prefecture['country_name_case0'].&quot; &quot;;</pre><br/><span class='lineno'>03789</span><pre class='pre'>				if(!empty($country_prefecture['country_name_case1'])) $db_name .= $country_prefecture['country_name_case1'].&quot; &quot;;</pre><br/><span class='lineno'>03790</span><pre class='pre'>				if(!empty($country_prefecture['country_name_case2'])) $db_name .= $country_prefecture['country_name_case2'].&quot; &quot;;</pre><br/><span class='lineno'>03791</span><pre class='pre'>				if(!empty($country_prefecture['country_name_case3'])) $db_name .= $country_prefecture['country_name_case3'].&quot; &quot;;</pre><br/><span class='lineno'>03792</span><pre class='pre'>				if(!empty($country_prefecture['country_name_case4'])) $db_name .= $country_prefecture['country_name_case4'].&quot; &quot;;</pre><br/><span class='lineno'>03793</span><pre class='pre'>				if(!empty($country_prefecture['country_name_case5'])) $db_name .= $country_prefecture['country_name_case5'].&quot; &quot;;</pre><br/><span class='lineno'>03794</span><pre class='pre'>				if(!empty($country_prefecture['country_name_case6'])) $db_name .= $country_prefecture['country_name_case6'].&quot; &quot;;</pre><br/><span class='lineno'>03795</span><pre class='pre'>				if(!empty($country_prefecture['country_name_case7'])) $db_name .= $country_prefecture['country_name_case7'].&quot; &quot;;</pre><br/><span class='lineno'>03796</span><pre class='pre'>				if(!empty($country_prefecture['country_name_case8'])) $db_name .= $country_prefecture['country_name_case8'].&quot; &quot;;</pre><br/><span class='lineno'>03797</span><pre class='pre'>				if(!empty($country_prefecture['country_name_case9'])) $db_name .= $country_prefecture['country_name_case9'];</pre><br/><span class='lineno'>03798</span><pre class='pre'>			}</pre><br/><span class='lineno'>03799</span><pre class='pre'>			else</pre><br/><span class='lineno'>03800</span><pre class='pre'>			{</pre><br/><span class='lineno'>03801</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03802</span><pre class='pre'>				$this-&gt;message = &quot;å½ã»é½éåºçãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;0ï¼&quot;;</pre><br/><span class='lineno'>03803</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03804</span><pre class='pre'>			}</pre><br/><span class='lineno'>03805</span><pre class='pre'>		}</pre><br/><span class='lineno'>03806</span><pre class='pre'>		else</pre><br/><span class='lineno'>03807</span><pre class='pre'>		{</pre><br/><span class='lineno'>03808</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03809</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03810</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>03811</span><pre class='pre'>			$this-&gt;message = &quot;å½ã»é½éåºçãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>03812</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03813</span><pre class='pre'>		}</pre><br/><span class='lineno'>03814</span><pre class='pre'>	}</pre><br/><span class='lineno'>03815</span><pre class='pre'></pre><br/><span class='lineno'>03816</span><pre class='pre'>	// å°åãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>03817</span><pre class='pre'>	function get_place_name($db_link, $db_id, &amp;$db_name)</pre><br/><span class='lineno'>03818</span><pre class='pre'>	{</pre><br/><span class='lineno'>03819</span><pre class='pre'>		// æ¡ä»¶ãå¥ã£ã¦ããªãå ´åã¯ããã®ã¾ã¾æ»ãã¾ãã</pre><br/><span class='lineno'>03820</span><pre class='pre'>		if (empty($db_id) || $db_id == &quot;-1&quot;)</pre><br/><span class='lineno'>03821</span><pre class='pre'>		{</pre><br/><span class='lineno'>03822</span><pre class='pre'>			return;</pre><br/><span class='lineno'>03823</span><pre class='pre'>		}</pre><br/><span class='lineno'>03824</span><pre class='pre'></pre><br/><span class='lineno'>03825</span><pre class='pre'>		// å°åãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>03826</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>03827</span><pre class='pre'>		$sql = &quot;SELECT place_id, place_name FROM place WHERE place_id = ? &quot;;</pre><br/><span class='lineno'>03828</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>03829</span><pre class='pre'>		$stmt-&gt;bindParam(1, $db_id);</pre><br/><span class='lineno'>03830</span><pre class='pre'></pre><br/><span class='lineno'>03831</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>03832</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>03833</span><pre class='pre'></pre><br/><span class='lineno'>03834</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>03835</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>03836</span><pre class='pre'>		{</pre><br/><span class='lineno'>03837</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03838</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>03839</span><pre class='pre'>			if ($icount &gt;= 0)</pre><br/><span class='lineno'>03840</span><pre class='pre'>			{</pre><br/><span class='lineno'>03841</span><pre class='pre'>				$place = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>03842</span><pre class='pre'>				//  å°åãä¿å­ãã¾ãã</pre><br/><span class='lineno'>03843</span><pre class='pre'>				$db_name = $place['place_name'];</pre><br/><span class='lineno'>03844</span><pre class='pre'>			}</pre><br/><span class='lineno'>03845</span><pre class='pre'>			else</pre><br/><span class='lineno'>03846</span><pre class='pre'>			{</pre><br/><span class='lineno'>03847</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03848</span><pre class='pre'>				$this-&gt;message = &quot;å°åãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;0ï¼&quot;;</pre><br/><span class='lineno'>03849</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03850</span><pre class='pre'>			}</pre><br/><span class='lineno'>03851</span><pre class='pre'>		}</pre><br/><span class='lineno'>03852</span><pre class='pre'>		else</pre><br/><span class='lineno'>03853</span><pre class='pre'>		{</pre><br/><span class='lineno'>03854</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03855</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03856</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>03857</span><pre class='pre'>			$this-&gt;message = &quot;å°åãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>03858</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03859</span><pre class='pre'>		}</pre><br/><span class='lineno'>03860</span><pre class='pre'>	}</pre><br/><span class='lineno'>03861</span><pre class='pre'></pre><br/><span class='lineno'>03862</span><pre class='pre'>	// æ®å½±ææã®æ¼¢å­ãæ¥ãå¤ãç§ãå¬ããDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>03863</span><pre class='pre'>	function get_take_picture_time2_name($db_link, $db_id, &amp;$db_name)</pre><br/><span class='lineno'>03864</span><pre class='pre'>	{</pre><br/><span class='lineno'>03865</span><pre class='pre'>		// æ¡ä»¶ãå¥ã£ã¦ããªãå ´åã¯ããã®ã¾ã¾æ»ãã¾ãã</pre><br/><span class='lineno'>03866</span><pre class='pre'>		if (empty($db_id) || $db_id == &quot;-1&quot;)</pre><br/><span class='lineno'>03867</span><pre class='pre'>		{</pre><br/><span class='lineno'>03868</span><pre class='pre'>			return &quot;&quot;;</pre><br/><span class='lineno'>03869</span><pre class='pre'>		}</pre><br/><span class='lineno'>03870</span><pre class='pre'></pre><br/><span class='lineno'>03871</span><pre class='pre'>		// æ®å½±ææ2ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>03872</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>03873</span><pre class='pre'>		$sql = &quot;SELECT * FROM take_picture_time2 WHERE take_picture_time2_id = ? &quot;;</pre><br/><span class='lineno'>03874</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>03875</span><pre class='pre'>		$stmt-&gt;bindParam(1, $db_id);</pre><br/><span class='lineno'>03876</span><pre class='pre'></pre><br/><span class='lineno'>03877</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>03878</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>03879</span><pre class='pre'></pre><br/><span class='lineno'>03880</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>03881</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>03882</span><pre class='pre'>		{</pre><br/><span class='lineno'>03883</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03884</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>03885</span><pre class='pre'>			if ($icount &gt;= 0)</pre><br/><span class='lineno'>03886</span><pre class='pre'>			{</pre><br/><span class='lineno'>03887</span><pre class='pre'>				$take_picture_time = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>03888</span><pre class='pre'>				//  æ®å½±ææ2ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>03889</span><pre class='pre'>				$db_name = $take_picture_time['take_picture_time2_name'];</pre><br/><span class='lineno'>03890</span><pre class='pre'>			}</pre><br/><span class='lineno'>03891</span><pre class='pre'>			else</pre><br/><span class='lineno'>03892</span><pre class='pre'>			{</pre><br/><span class='lineno'>03893</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03894</span><pre class='pre'>				$this-&gt;message = &quot;æ®å½±ææ2ãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;0ï¼&quot;;</pre><br/><span class='lineno'>03895</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03896</span><pre class='pre'>			}</pre><br/><span class='lineno'>03897</span><pre class='pre'>		}</pre><br/><span class='lineno'>03898</span><pre class='pre'>		else</pre><br/><span class='lineno'>03899</span><pre class='pre'>		{</pre><br/><span class='lineno'>03900</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03901</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03902</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>03903</span><pre class='pre'>			$this-&gt;message = &quot;æ®å½±ææ2ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>03904</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03905</span><pre class='pre'>		}</pre><br/><span class='lineno'>03906</span><pre class='pre'>	}</pre><br/><span class='lineno'>03907</span><pre class='pre'></pre><br/><span class='lineno'>03908</span><pre class='pre'>	// æ®å½±ææ1ã1æï½12æããDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>03909</span><pre class='pre'>	function get_take_picture_time_name($db_link, $db_id, &amp;$db_name)</pre><br/><span class='lineno'>03910</span><pre class='pre'>	{</pre><br/><span class='lineno'>03911</span><pre class='pre'>		// æ¡ä»¶ãå¥ã£ã¦ããªãå ´åã¯ããã®ã¾ã¾æ»ãã¾ãã</pre><br/><span class='lineno'>03912</span><pre class='pre'>		if (empty($db_id) || $db_id == &quot;-1&quot;)</pre><br/><span class='lineno'>03913</span><pre class='pre'>		{</pre><br/><span class='lineno'>03914</span><pre class='pre'>			return &quot;&quot;;</pre><br/><span class='lineno'>03915</span><pre class='pre'>		}</pre><br/><span class='lineno'>03916</span><pre class='pre'></pre><br/><span class='lineno'>03917</span><pre class='pre'>		// æ®å½±ææ1ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>03918</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>03919</span><pre class='pre'>		$sql = &quot;SELECT * FROM take_picture_time WHERE take_picture_time_id = ? &quot;;</pre><br/><span class='lineno'>03920</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>03921</span><pre class='pre'>		$stmt-&gt;bindParam(1, $db_id);</pre><br/><span class='lineno'>03922</span><pre class='pre'></pre><br/><span class='lineno'>03923</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>03924</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>03925</span><pre class='pre'></pre><br/><span class='lineno'>03926</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>03927</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>03928</span><pre class='pre'>		{</pre><br/><span class='lineno'>03929</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03930</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>03931</span><pre class='pre'>			if ($icount &gt;= 0)</pre><br/><span class='lineno'>03932</span><pre class='pre'>			{</pre><br/><span class='lineno'>03933</span><pre class='pre'>				$take_picture_time = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>03934</span><pre class='pre'>				//  æ®å½±ææ1ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>03935</span><pre class='pre'>				$db_name = $take_picture_time['take_picture_time_name'];</pre><br/><span class='lineno'>03936</span><pre class='pre'>			}</pre><br/><span class='lineno'>03937</span><pre class='pre'>			else</pre><br/><span class='lineno'>03938</span><pre class='pre'>			{</pre><br/><span class='lineno'>03939</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03940</span><pre class='pre'>				$this-&gt;message = &quot;æ®å½±ææ1ãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;0ï¼&quot;;</pre><br/><span class='lineno'>03941</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03942</span><pre class='pre'>			}</pre><br/><span class='lineno'>03943</span><pre class='pre'>		}</pre><br/><span class='lineno'>03944</span><pre class='pre'>		else</pre><br/><span class='lineno'>03945</span><pre class='pre'>		{</pre><br/><span class='lineno'>03946</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03947</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03948</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>03949</span><pre class='pre'>			$this-&gt;message = &quot;æ®å½±ææ1ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>03950</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03951</span><pre class='pre'>		}</pre><br/><span class='lineno'>03952</span><pre class='pre'>	}</pre><br/><span class='lineno'>03953</span><pre class='pre'></pre><br/><span class='lineno'>03954</span><pre class='pre'>	//added by wangtongchao 2011-12-20 begin</pre><br/><span class='lineno'>03955</span><pre class='pre'>	function get_registration_person($db_link, $db_id, &amp;$registration_person)</pre><br/><span class='lineno'>03956</span><pre class='pre'>	{</pre><br/><span class='lineno'>03957</span><pre class='pre'>		// æ¡ä»¶ãå¥ã£ã¦ããªãå ´åã¯ããã®ã¾ã¾æ»ãã¾ãã</pre><br/><span class='lineno'>03958</span><pre class='pre'>		if (empty($db_id) || $db_id == &quot;-1&quot;)</pre><br/><span class='lineno'>03959</span><pre class='pre'>		{</pre><br/><span class='lineno'>03960</span><pre class='pre'>			$registration_person = &quot;&quot;;</pre><br/><span class='lineno'>03961</span><pre class='pre'>			return &quot;&quot;;</pre><br/><span class='lineno'>03962</span><pre class='pre'>		}</pre><br/><span class='lineno'>03963</span><pre class='pre'></pre><br/><span class='lineno'>03964</span><pre class='pre'>		// ç»åç»é²ç³è«èãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>03965</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>03966</span><pre class='pre'>		$sql = &quot;SELECT `photoimg`.`registration_person` FROM photoimg WHERE `photoimg`.`photo_id` = ? &quot;;</pre><br/><span class='lineno'>03967</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>03968</span><pre class='pre'>		$stmt-&gt;bindParam(1, $db_id);</pre><br/><span class='lineno'>03969</span><pre class='pre'></pre><br/><span class='lineno'>03970</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>03971</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>03972</span><pre class='pre'></pre><br/><span class='lineno'>03973</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>03974</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>03975</span><pre class='pre'>		{</pre><br/><span class='lineno'>03976</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03977</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>03978</span><pre class='pre'>			if ($icount &gt;= 0)</pre><br/><span class='lineno'>03979</span><pre class='pre'>			{</pre><br/><span class='lineno'>03980</span><pre class='pre'>				$registration_person_ary = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>03981</span><pre class='pre'>				//  ç»åç»é²ç³è«èãä¿å­ãã¾ãã</pre><br/><span class='lineno'>03982</span><pre class='pre'>				$registration_person = $registration_person_ary['registration_person'];</pre><br/><span class='lineno'>03983</span><pre class='pre'>			}</pre><br/><span class='lineno'>03984</span><pre class='pre'>			else</pre><br/><span class='lineno'>03985</span><pre class='pre'>			{</pre><br/><span class='lineno'>03986</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03987</span><pre class='pre'>				$this-&gt;message = &quot;ç»åç»é²ç³è«èãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;0ï¼&quot;;</pre><br/><span class='lineno'>03988</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03989</span><pre class='pre'>			}</pre><br/><span class='lineno'>03990</span><pre class='pre'>		}</pre><br/><span class='lineno'>03991</span><pre class='pre'>		else</pre><br/><span class='lineno'>03992</span><pre class='pre'>		{</pre><br/><span class='lineno'>03993</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>03994</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>03995</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>03996</span><pre class='pre'>			$this-&gt;message = &quot;ç»åç»é²ç³è«èãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>03997</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>03998</span><pre class='pre'>		}</pre><br/><span class='lineno'>03999</span><pre class='pre'>	}</pre><br/><span class='lineno'>04000</span><pre class='pre'>	//added by wangtongchao 2011-12-20 end</pre><br/><span class='lineno'>04001</span><pre class='pre'>	/*</pre><br/><span class='lineno'>04002</span><pre class='pre'>	 * é¢æ°åï¼insert_keyword</pre><br/><span class='lineno'>04003</span><pre class='pre'>	 * é¢æ°èª¬æï¼ã­ã¼ã¯ã¼ãããã¼ãã«ã«ç»é²ãã</pre><br/><span class='lineno'>04004</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>04005</span><pre class='pre'>	 * db_link:ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>04006</span><pre class='pre'>	 * pid:ç»åID</pre><br/><span class='lineno'>04007</span><pre class='pre'>	 * kwd_str:è¨­å®ã®ã­ã¼ã¯ã¼ã</pre><br/><span class='lineno'>04008</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>04009</span><pre class='pre'>	 */</pre><br/><span class='lineno'>04010</span><pre class='pre'>	function insert_keyword($db_link, $pid, $kwd_str)</pre><br/><span class='lineno'>04011</span><pre class='pre'>	{</pre><br/><span class='lineno'>04012</span><pre class='pre'>		// ã¨ã©ã¼ãã§ãã¯ãè¡ãã¾ãã</pre><br/><span class='lineno'>04013</span><pre class='pre'>		if (empty($pid))</pre><br/><span class='lineno'>04014</span><pre class='pre'>		{</pre><br/><span class='lineno'>04015</span><pre class='pre'>			return ;</pre><br/><span class='lineno'>04016</span><pre class='pre'>		}</pre><br/><span class='lineno'>04017</span><pre class='pre'></pre><br/><span class='lineno'>04018</span><pre class='pre'>		$insert_keyword_str = &quot;&quot;;</pre><br/><span class='lineno'>04019</span><pre class='pre'></pre><br/><span class='lineno'>04020</span><pre class='pre'>		// åçãã¼ã¿ãè¿½å ãã¾ãã&lt;åçç®¡ççªå·&gt;</pre><br/><span class='lineno'>04021</span><pre class='pre'>		if (!empty($this-&gt;photo_mno) &amp;&amp; strlen($this-&gt;photo_mno) &gt; 0)</pre><br/><span class='lineno'>04022</span><pre class='pre'>		{</pre><br/><span class='lineno'>04023</span><pre class='pre'>			$insert_keyword_str = &quot; &quot;.$this-&gt;photo_mno;</pre><br/><span class='lineno'>04024</span><pre class='pre'>		}</pre><br/><span class='lineno'>04025</span><pre class='pre'></pre><br/><span class='lineno'>04026</span><pre class='pre'>		// åçãã¼ã¿ãè¿½å ãã¾ãã&lt;åçå&gt;</pre><br/><span class='lineno'>04027</span><pre class='pre'>		if (!empty($this-&gt;photo_name) &amp;&amp; strlen($this-&gt;photo_name) &gt; 0)</pre><br/><span class='lineno'>04028</span><pre class='pre'>		{</pre><br/><span class='lineno'>04029</span><pre class='pre'>			$insert_keyword_str .= &quot; &quot;.$this-&gt;photo_name;</pre><br/><span class='lineno'>04030</span><pre class='pre'>		}</pre><br/><span class='lineno'>04031</span><pre class='pre'></pre><br/><span class='lineno'>04032</span><pre class='pre'>		// åçãã¼ã¿ãè¿½å ãã¾ãã&lt;æ¹é¢ãå½ã»é½éåºçãå°å&gt;</pre><br/><span class='lineno'>04033</span><pre class='pre'>		$ed = $this-&gt;registration_classifications-&gt;count;</pre><br/><span class='lineno'>04034</span><pre class='pre'>		for ($i = 1; $i &lt;= $ed; $i++)</pre><br/><span class='lineno'>04035</span><pre class='pre'>		{</pre><br/><span class='lineno'>04036</span><pre class='pre'>			// æ¹é¢åãå½ã»é½éåºçåãå°åIDãåå¾ãã</pre><br/><span class='lineno'>04037</span><pre class='pre'>			$c_id = &quot;&quot;;</pre><br/><span class='lineno'>04038</span><pre class='pre'>			$d_id = &quot;&quot;;</pre><br/><span class='lineno'>04039</span><pre class='pre'>			$cp_id = &quot;&quot;;</pre><br/><span class='lineno'>04040</span><pre class='pre'>			$p_id = &quot;&quot;;</pre><br/><span class='lineno'>04041</span><pre class='pre'>			$this-&gt;registration_classifications-&gt;get_id($c_id, $d_id, $cp_id, $p_id, $i);</pre><br/><span class='lineno'>04042</span><pre class='pre'>			//æµ·å¤</pre><br/><span class='lineno'>04043</span><pre class='pre'>			if((int)$c_id == 1)</pre><br/><span class='lineno'>04044</span><pre class='pre'>			{</pre><br/><span class='lineno'>04045</span><pre class='pre'>				// æ¹é¢åãåå¾ãã</pre><br/><span class='lineno'>04046</span><pre class='pre'>				$d_name = &quot;&quot;;</pre><br/><span class='lineno'>04047</span><pre class='pre'>				if (!empty($d_id)) $this-&gt;get_direction_name($db_link,$d_id,$d_name);</pre><br/><span class='lineno'>04048</span><pre class='pre'></pre><br/><span class='lineno'>04049</span><pre class='pre'>				// å½ã»é½éåºçåãåå¾ãã</pre><br/><span class='lineno'>04050</span><pre class='pre'>				$cp_name = &quot;&quot;;</pre><br/><span class='lineno'>04051</span><pre class='pre'>				if (!empty($d_id)) $this-&gt;get_country_prefecture_name2($db_link,$cp_id,$cp_name);</pre><br/><span class='lineno'>04052</span><pre class='pre'></pre><br/><span class='lineno'>04053</span><pre class='pre'>				// å°åãåå¾ãã</pre><br/><span class='lineno'>04054</span><pre class='pre'>				$p_name = &quot;&quot;;</pre><br/><span class='lineno'>04055</span><pre class='pre'>				if (!empty($d_id)) $this-&gt;get_place_name($db_link,$p_id,$p_name);</pre><br/><span class='lineno'>04056</span><pre class='pre'></pre><br/><span class='lineno'>04057</span><pre class='pre'>				// æ¹é¢åãã­ã¼ã¯ã¼ãã«æ°è¦ãã</pre><br/><span class='lineno'>04058</span><pre class='pre'>				if (!empty($d_name) &amp;&amp; strlen($d_name) &gt; 0)</pre><br/><span class='lineno'>04059</span><pre class='pre'>				{</pre><br/><span class='lineno'>04060</span><pre class='pre'>					$insert_keyword_str .= &quot; &quot;.$d_name;</pre><br/><span class='lineno'>04061</span><pre class='pre'>				}</pre><br/><span class='lineno'>04062</span><pre class='pre'></pre><br/><span class='lineno'>04063</span><pre class='pre'>				// å½ã»é½éåºçåãã­ã¼ã¯ã¼ãã«æ°è¦ãã</pre><br/><span class='lineno'>04064</span><pre class='pre'>				if (!empty($cp_name) &amp;&amp; strlen($cp_name) &gt; 0)</pre><br/><span class='lineno'>04065</span><pre class='pre'>				{</pre><br/><span class='lineno'>04066</span><pre class='pre'>					$insert_keyword_str .= &quot; &quot;.$cp_name;</pre><br/><span class='lineno'>04067</span><pre class='pre'>				}</pre><br/><span class='lineno'>04068</span><pre class='pre'></pre><br/><span class='lineno'>04069</span><pre class='pre'>				//å°å</pre><br/><span class='lineno'>04070</span><pre class='pre'>				if (!empty($p_name) &amp;&amp; strlen($p_name) &gt; 0)</pre><br/><span class='lineno'>04071</span><pre class='pre'>				{</pre><br/><span class='lineno'>04072</span><pre class='pre'>					$insert_keyword_str .= &quot; &quot;.$p_name;</pre><br/><span class='lineno'>04073</span><pre class='pre'>				}</pre><br/><span class='lineno'>04074</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>04075</span><pre class='pre'>				// æ¹é¢åãåå¾ãã</pre><br/><span class='lineno'>04076</span><pre class='pre'>				$d_name = &quot;&quot;;</pre><br/><span class='lineno'>04077</span><pre class='pre'>				if (!empty($d_id)) $this-&gt;get_direction_name($db_link,$d_id,$d_name);</pre><br/><span class='lineno'>04078</span><pre class='pre'></pre><br/><span class='lineno'>04079</span><pre class='pre'>				// å½ã»é½éåºçåãåå¾ãã</pre><br/><span class='lineno'>04080</span><pre class='pre'>				$cp_name = &quot;&quot;;</pre><br/><span class='lineno'>04081</span><pre class='pre'>				if (!empty($d_id)) $this-&gt;get_country_prefecture_name($db_link,$cp_id,$cp_name);</pre><br/><span class='lineno'>04082</span><pre class='pre'></pre><br/><span class='lineno'>04083</span><pre class='pre'>				// å°åãåå¾ãã</pre><br/><span class='lineno'>04084</span><pre class='pre'>				$p_name = &quot;&quot;;</pre><br/><span class='lineno'>04085</span><pre class='pre'>				if (!empty($d_id)) $this-&gt;get_place_name($db_link,$p_id,$p_name);</pre><br/><span class='lineno'>04086</span><pre class='pre'></pre><br/><span class='lineno'>04087</span><pre class='pre'>				// æ¹é¢åãã­ã¼ã¯ã¼ãã«æ°è¦ãã</pre><br/><span class='lineno'>04088</span><pre class='pre'>				if (!empty($d_name) &amp;&amp; strlen($d_name) &gt; 0)</pre><br/><span class='lineno'>04089</span><pre class='pre'>				{</pre><br/><span class='lineno'>04090</span><pre class='pre'>					$insert_keyword_str .= &quot; &quot;.$d_name;</pre><br/><span class='lineno'>04091</span><pre class='pre'>				}</pre><br/><span class='lineno'>04092</span><pre class='pre'></pre><br/><span class='lineno'>04093</span><pre class='pre'>				// å½ã»é½éåºçåãã­ã¼ã¯ã¼ãã«æ°è¦ãã</pre><br/><span class='lineno'>04094</span><pre class='pre'>				if (!empty($cp_name) &amp;&amp; strlen($cp_name) &gt; 0)</pre><br/><span class='lineno'>04095</span><pre class='pre'>				{</pre><br/><span class='lineno'>04096</span><pre class='pre'>					$insert_keyword_str .= &quot; &quot;.$cp_name;</pre><br/><span class='lineno'>04097</span><pre class='pre'>					if($cp_name != &quot;åæµ·é&quot;)</pre><br/><span class='lineno'>04098</span><pre class='pre'>					{</pre><br/><span class='lineno'>04099</span><pre class='pre'>	//					print &quot;&lt;script type=\&quot;text/javascript\&quot;&gt;&quot;;</pre><br/><span class='lineno'>04100</span><pre class='pre'>	//					print &quot;alert(\&quot;&quot;.$cp_name.&quot;\&quot;);&quot;;</pre><br/><span class='lineno'>04101</span><pre class='pre'>	//					print &quot;&lt;/script&gt;&quot;;</pre><br/><span class='lineno'>04102</span><pre class='pre'>						if($cp_name == &quot;äº¬é½&quot; || $cp_name == &quot;å¤§éª&quot;)</pre><br/><span class='lineno'>04103</span><pre class='pre'>						{</pre><br/><span class='lineno'>04104</span><pre class='pre'>							$insert_keyword_str .= &quot; &quot;.$cp_name.&quot;åº&quot;;</pre><br/><span class='lineno'>04105</span><pre class='pre'>						} elseif($cp_name == &quot;æ±äº¬&quot;) {</pre><br/><span class='lineno'>04106</span><pre class='pre'>							$insert_keyword_str .= &quot; &quot;.$cp_name.&quot;é½&quot;;</pre><br/><span class='lineno'>04107</span><pre class='pre'>						} else {</pre><br/><span class='lineno'>04108</span><pre class='pre'>							$insert_keyword_str .= &quot; &quot;.$cp_name.&quot;ç&quot;;</pre><br/><span class='lineno'>04109</span><pre class='pre'>						}</pre><br/><span class='lineno'>04110</span><pre class='pre'>	//					print &quot;&lt;script type=\&quot;text/javascript\&quot;&gt;&quot;;</pre><br/><span class='lineno'>04111</span><pre class='pre'>	//					print &quot;alert(\&quot;&quot;.$insert_keyword_str.&quot;\&quot;);&quot;;</pre><br/><span class='lineno'>04112</span><pre class='pre'>	//					print &quot;&lt;/script&gt;&quot;;</pre><br/><span class='lineno'>04113</span><pre class='pre'>					}</pre><br/><span class='lineno'>04114</span><pre class='pre'>				}</pre><br/><span class='lineno'>04115</span><pre class='pre'></pre><br/><span class='lineno'>04116</span><pre class='pre'>				if (!empty($p_name) &amp;&amp; strlen($p_name) &gt; 0)</pre><br/><span class='lineno'>04117</span><pre class='pre'>				{</pre><br/><span class='lineno'>04118</span><pre class='pre'>					$insert_keyword_str .= &quot; &quot;.$p_name;</pre><br/><span class='lineno'>04119</span><pre class='pre'>				}</pre><br/><span class='lineno'>04120</span><pre class='pre'>			}</pre><br/><span class='lineno'>04121</span><pre class='pre'>		}</pre><br/><span class='lineno'>04122</span><pre class='pre'></pre><br/><span class='lineno'>04123</span><pre class='pre'>		// åçãã¼ã¿ãè¿½å ãã¾ãã&lt;åå®¹ï¼åçèª¬æï¼&gt;</pre><br/><span class='lineno'>04124</span><pre class='pre'>		if (!empty($this-&gt;photo_explanation) &amp;&amp; strlen($this-&gt;photo_explanation) &gt; 0)</pre><br/><span class='lineno'>04125</span><pre class='pre'>		{</pre><br/><span class='lineno'>04126</span><pre class='pre'>			$insert_keyword_str .= &quot; &quot;.$this-&gt;photo_explanation;</pre><br/><span class='lineno'>04127</span><pre class='pre'>		}</pre><br/><span class='lineno'>04128</span><pre class='pre'></pre><br/><span class='lineno'>04129</span><pre class='pre'>		// åçãã¼ã¿ãè¿½å ãã¾ãã&lt;æ®å½±ææã2&gt;</pre><br/><span class='lineno'>04130</span><pre class='pre'>		$t_p_time2_name = &quot;&quot;;</pre><br/><span class='lineno'>04131</span><pre class='pre'>		$this-&gt;get_take_picture_time2_name($db_link,$this-&gt;take_picture_time2_id,$t_p_time2_name);</pre><br/><span class='lineno'>04132</span><pre class='pre'>		if (!empty($t_p_time2_name) &amp;&amp; strlen($t_p_time2_name) &gt; 0)</pre><br/><span class='lineno'>04133</span><pre class='pre'>		{</pre><br/><span class='lineno'>04134</span><pre class='pre'>			$insert_keyword_str .= &quot; &quot;.$t_p_time2_name;</pre><br/><span class='lineno'>04135</span><pre class='pre'>		}</pre><br/><span class='lineno'>04136</span><pre class='pre'></pre><br/><span class='lineno'>04137</span><pre class='pre'>		// åçãã¼ã¿ãè¿½å ãã¾ãã&lt;æ®å½±ææã1&gt;</pre><br/><span class='lineno'>04138</span><pre class='pre'>		$t_p_time_name = &quot;&quot;;</pre><br/><span class='lineno'>04139</span><pre class='pre'>		$this-&gt;get_take_picture_time_name($db_link,$this-&gt;take_picture_time_id,$t_p_time_name);</pre><br/><span class='lineno'>04140</span><pre class='pre'>		if (!empty($t_p_time_name) &amp;&amp; strlen($t_p_time_name) &gt; 0)</pre><br/><span class='lineno'>04141</span><pre class='pre'>		{</pre><br/><span class='lineno'>04142</span><pre class='pre'>			$insert_keyword_str .= &quot; &quot;.$t_p_time_name;</pre><br/><span class='lineno'>04143</span><pre class='pre'>		}</pre><br/><span class='lineno'>04144</span><pre class='pre'></pre><br/><span class='lineno'>04145</span><pre class='pre'>		// åçãã¼ã¿ãè¿½å ãã¾ãã&lt;ä½¿ç¨ç¯å²&gt;</pre><br/><span class='lineno'>04146</span><pre class='pre'>		if ((int)$this-&gt;range_of_use_id == 1)</pre><br/><span class='lineno'>04147</span><pre class='pre'>		{</pre><br/><span class='lineno'>04148</span><pre class='pre'>			$insert_keyword_str .= &quot; ä½¿ç¨ä¸å¯&quot;;</pre><br/><span class='lineno'>04149</span><pre class='pre'>		} elseif ((int)$this-&gt;range_of_use_id == 2) {</pre><br/><span class='lineno'>04150</span><pre class='pre'>			$insert_keyword_str .= &quot; ä½¿ç¨å¯&quot;;</pre><br/><span class='lineno'>04151</span><pre class='pre'>		} elseif ((int)$this-&gt;range_of_use_id == 3) {</pre><br/><span class='lineno'>04152</span><pre class='pre'>			$insert_keyword_str .= &quot; æ¡ä»¶æ&quot;;</pre><br/><span class='lineno'>04153</span><pre class='pre'>		}</pre><br/><span class='lineno'>04154</span><pre class='pre'></pre><br/><span class='lineno'>04155</span><pre class='pre'>		// åçãã¼ã¿ãè¿½å ãã¾ãã&lt;ä»å æ¡ä»¶ï¼ã¯ã¬ã¸ãã&gt;</pre><br/><span class='lineno'>04156</span><pre class='pre'>		if (!empty($this-&gt;additional_constraints1) &amp;&amp; strlen($this-&gt;additional_constraints1) &gt; 0)</pre><br/><span class='lineno'>04157</span><pre class='pre'>		{</pre><br/><span class='lineno'>04158</span><pre class='pre'>			$insert_keyword_str .= &quot; è¦ã¯ã¬&quot;.$this-&gt;additional_constraints1;</pre><br/><span class='lineno'>04159</span><pre class='pre'>		}</pre><br/><span class='lineno'>04160</span><pre class='pre'></pre><br/><span class='lineno'>04161</span><pre class='pre'>		if (!empty($kwd_str))</pre><br/><span class='lineno'>04162</span><pre class='pre'>		{</pre><br/><span class='lineno'>04163</span><pre class='pre'>			$insert_keyword_str .= &quot; &quot;.$kwd_str;</pre><br/><span class='lineno'>04164</span><pre class='pre'>		}</pre><br/><span class='lineno'>04165</span><pre class='pre'></pre><br/><span class='lineno'>04166</span><pre class='pre'>		// è¨­å®ããã¦ããã­ã¼ã¯ã¼ãããã¹ã¦DBã«ç»é²ãã¾ãã</pre><br/><span class='lineno'>04167</span><pre class='pre'>		if (!empty($insert_keyword_str) &amp;&amp; strlen($insert_keyword_str) &gt; 0)</pre><br/><span class='lineno'>04168</span><pre class='pre'>		{</pre><br/><span class='lineno'>04169</span><pre class='pre'>			$keyword_str = $insert_keyword_str.&quot; &quot;;</pre><br/><span class='lineno'>04170</span><pre class='pre'></pre><br/><span class='lineno'>04171</span><pre class='pre'>			// åçãã¼ã¿ãè¿½å ãã¾ãã</pre><br/><span class='lineno'>04172</span><pre class='pre'>			//yupengbo modify 2011/12/15 start</pre><br/><span class='lineno'>04173</span><pre class='pre'>			$sql = &quot;INSERT INTO keyword (photo_id, keyword_name) VALUES ( &quot;;</pre><br/><span class='lineno'>04174</span><pre class='pre'>			//$sql .= $pid . &quot;,'&quot; . $keyword_str . &quot;')&quot;;</pre><br/><span class='lineno'>04175</span><pre class='pre'>			$sql .= &quot;?,?)&quot;;</pre><br/><span class='lineno'>04176</span><pre class='pre'>			//yupengbo modify 2011/12/15 end</pre><br/><span class='lineno'>04177</span><pre class='pre'></pre><br/><span class='lineno'>04178</span><pre class='pre'>			$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04179</span><pre class='pre'>			//yupengbo add 2011/12/15 start</pre><br/><span class='lineno'>04180</span><pre class='pre'>			$stmt-&gt;bindParam(1,$pid);</pre><br/><span class='lineno'>04181</span><pre class='pre'>			$stmt-&gt;bindParam(2,$keyword_str);</pre><br/><span class='lineno'>04182</span><pre class='pre'>			//yupengbo add 2011/12/15 end</pre><br/><span class='lineno'>04183</span><pre class='pre'></pre><br/><span class='lineno'>04184</span><pre class='pre'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04185</span><pre class='pre'></pre><br/><span class='lineno'>04186</span><pre class='pre'>			if ($result == true)</pre><br/><span class='lineno'>04187</span><pre class='pre'>			{</pre><br/><span class='lineno'>04188</span><pre class='pre'>				// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04189</span><pre class='pre'>				$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04190</span><pre class='pre'>				if ($icount != 1)</pre><br/><span class='lineno'>04191</span><pre class='pre'>				{</pre><br/><span class='lineno'>04192</span><pre class='pre'>					$this-&gt;message = &quot;ã­ã¼ã¯ã¼ããDBã«ç»é²ã§ãã¾ããã§ãããï¼å¦çæ°!=1ï¼&quot;;</pre><br/><span class='lineno'>04193</span><pre class='pre'>					throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04194</span><pre class='pre'>				}</pre><br/><span class='lineno'>04195</span><pre class='pre'>			}</pre><br/><span class='lineno'>04196</span><pre class='pre'>			else</pre><br/><span class='lineno'>04197</span><pre class='pre'>			{</pre><br/><span class='lineno'>04198</span><pre class='pre'>				$this-&gt;message = &quot;ã­ã¼ã¯ã¼ããDBã«ç»é²ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>04199</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04200</span><pre class='pre'>			}</pre><br/><span class='lineno'>04201</span><pre class='pre'>		}</pre><br/><span class='lineno'>04202</span><pre class='pre'>	}</pre><br/><span class='lineno'>04203</span><pre class='pre'></pre><br/><span class='lineno'>04204</span><pre class='pre'>	/*</pre><br/><span class='lineno'>04205</span><pre class='pre'>	 * é¢æ°åï¼get_photo_mno</pre><br/><span class='lineno'>04206</span><pre class='pre'>	 * é¢æ°èª¬æï¼ç»åIDããç»åç®¡ççªå·ãåå¾ãã</pre><br/><span class='lineno'>04207</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>04208</span><pre class='pre'>	 * db_linkï¼ï¼¤ï¼¢ãªã³ã¯</pre><br/><span class='lineno'>04209</span><pre class='pre'>	 * pid	ãï¼ç»åçªå·</pre><br/><span class='lineno'>04210</span><pre class='pre'>	 * p_mnoãï¼ç»åç®¡ççªå·</pre><br/><span class='lineno'>04211</span><pre class='pre'>	 * p_photonameãï¼ç»ååå</pre><br/><span class='lineno'>04212</span><pre class='pre'>	 * photo_explanationãï¼ç»åè©³ç´°åå®¹</pre><br/><span class='lineno'>04213</span><pre class='pre'>	 * bud_photo_noãï¼BUD Photoçªå·</pre><br/><span class='lineno'>04214</span><pre class='pre'>	 * registration_personãï¼ç³è«è</pre><br/><span class='lineno'>04215</span><pre class='pre'>	 * date_fromãï¼æéFrom</pre><br/><span class='lineno'>04216</span><pre class='pre'>	 * date_toãï¼æéTo</pre><br/><span class='lineno'>04217</span><pre class='pre'>	 * æ»ãå¤ï¼æçµç»åçªå·</pre><br/><span class='lineno'>04218</span><pre class='pre'>	 */</pre><br/><span class='lineno'>04219</span><pre class='pre'>	function get_photo_mno($db_link, $pid,&amp;$p_mno,&amp;$p_photoname,&amp;$photo_explanation,&amp;$bud_photo_no,&amp;$registration_person,&amp;$date_from,&amp;$date_to)</pre><br/><span class='lineno'>04220</span><pre class='pre'>	{</pre><br/><span class='lineno'>04221</span><pre class='pre'>		//yupengbo modify 2011/11/18 start</pre><br/><span class='lineno'>04222</span><pre class='pre'>		//$sql = &quot;SELECT photo_mno,photo_name FROM photoimg WHERE photo_id = ?&quot;;//yupengbo comment 2011/11/18</pre><br/><span class='lineno'>04223</span><pre class='pre'>		$sql = &quot;SELECT photo_mno,photo_name,photo_explanation,bud_photo_no,registration_person,dfrom,dto FROM photoimg WHERE photo_id = ?&quot;;</pre><br/><span class='lineno'>04224</span><pre class='pre'>		//yupengbo modify 2011/11/18 end</pre><br/><span class='lineno'>04225</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04226</span><pre class='pre'>		$stmt-&gt;bindParam(1, $pid);</pre><br/><span class='lineno'>04227</span><pre class='pre'></pre><br/><span class='lineno'>04228</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04229</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>04230</span><pre class='pre'>		{</pre><br/><span class='lineno'>04231</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04232</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04233</span><pre class='pre'>			if ($icount == 1)</pre><br/><span class='lineno'>04234</span><pre class='pre'>			{</pre><br/><span class='lineno'>04235</span><pre class='pre'>				// ãã¼ã¿ãåå¾ãã¾ãã</pre><br/><span class='lineno'>04236</span><pre class='pre'>				$photoimg = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>04237</span><pre class='pre'></pre><br/><span class='lineno'>04238</span><pre class='pre'>				$p_mno = $photoimg['photo_mno'];</pre><br/><span class='lineno'>04239</span><pre class='pre'>				$p_photoname = $photoimg['photo_name'];</pre><br/><span class='lineno'>04240</span><pre class='pre'></pre><br/><span class='lineno'>04241</span><pre class='pre'>				//yupengbo add 2011/11/18 start</pre><br/><span class='lineno'>04242</span><pre class='pre'>				$photo_explanation = $photoimg['photo_explanation'];</pre><br/><span class='lineno'>04243</span><pre class='pre'>				$bud_photo_no = $photoimg['bud_photo_no'];</pre><br/><span class='lineno'>04244</span><pre class='pre'>				$registration_person = $photoimg['registration_person'];</pre><br/><span class='lineno'>04245</span><pre class='pre'>				$date_from = $photoimg['dfrom'];</pre><br/><span class='lineno'>04246</span><pre class='pre'>				$date_to = $photoimg['dto'];</pre><br/><span class='lineno'>04247</span><pre class='pre'>				//yupengbo add 2011/11/18 end</pre><br/><span class='lineno'>04248</span><pre class='pre'>			}</pre><br/><span class='lineno'>04249</span><pre class='pre'>		}</pre><br/><span class='lineno'>04250</span><pre class='pre'>	}</pre><br/><span class='lineno'>04251</span><pre class='pre'>	//jinxin add 2012/02/09 start</pre><br/><span class='lineno'>04252</span><pre class='pre'>	function get_nopermit_log($db_link,$pid,&amp;$p_mno,&amp;$p_photoname,&amp;$photo_explanation,&amp;$bud_photo_no,&amp;$date_from,&amp;$date_to,&amp;$nopermission)</pre><br/><span class='lineno'>04253</span><pre class='pre'>		{</pre><br/><span class='lineno'>04254</span><pre class='pre'>		//$sql = &quot;SELECT photo_mno,photo_name FROM photoimg WHERE photo_id = ?&quot;;//yupengbo comment 2011/11/18</pre><br/><span class='lineno'>04255</span><pre class='pre'>		$sql = &quot;SELECT photo_mno,photo_name,photo_explanation,bud_photo_no,dfrom,dto,nopermit_note FROM photoimg WHERE photo_id = ?&quot;;</pre><br/><span class='lineno'>04256</span><pre class='pre'>		//yupengbo modify 2011/11/18 end</pre><br/><span class='lineno'>04257</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04258</span><pre class='pre'>		$stmt-&gt;bindParam(1, $pid);</pre><br/><span class='lineno'>04259</span><pre class='pre'></pre><br/><span class='lineno'>04260</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04261</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>04262</span><pre class='pre'>		{</pre><br/><span class='lineno'>04263</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04264</span><pre class='pre'>			if ($icount == 1)</pre><br/><span class='lineno'>04265</span><pre class='pre'>			{</pre><br/><span class='lineno'>04266</span><pre class='pre'>				$photoimg = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>04267</span><pre class='pre'></pre><br/><span class='lineno'>04268</span><pre class='pre'>				$p_mno = $photoimg['photo_mno'];</pre><br/><span class='lineno'>04269</span><pre class='pre'>				$p_photoname = $photoimg['photo_name'];</pre><br/><span class='lineno'>04270</span><pre class='pre'></pre><br/><span class='lineno'>04271</span><pre class='pre'>				//yupengbo add 2011/11/18 start</pre><br/><span class='lineno'>04272</span><pre class='pre'>				$photo_explanation = $photoimg['photo_explanation'];</pre><br/><span class='lineno'>04273</span><pre class='pre'>				$bud_photo_no = $photoimg['bud_photo_no'];</pre><br/><span class='lineno'>04274</span><pre class='pre'>				$registration_person = $photoimg['registration_person'];</pre><br/><span class='lineno'>04275</span><pre class='pre'>				$date_from = $photoimg['dfrom'];</pre><br/><span class='lineno'>04276</span><pre class='pre'>				$date_to = $photoimg['dto'];</pre><br/><span class='lineno'>04277</span><pre class='pre'>				$nopermission = $photoimg['nopermit_note'];</pre><br/><span class='lineno'>04278</span><pre class='pre'>			}</pre><br/><span class='lineno'>04279</span><pre class='pre'>		}</pre><br/><span class='lineno'>04280</span><pre class='pre'>	}</pre><br/><span class='lineno'>04281</span><pre class='pre'></pre><br/><span class='lineno'>04282</span><pre class='pre'>	function get_dfrom_date_forhidden($db_link,$pid){</pre><br/><span class='lineno'>04283</span><pre class='pre'>		$sql = &quot;SELECT dfrom FROM photoimg WHERE photo_id = ?&quot;;</pre><br/><span class='lineno'>04284</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04285</span><pre class='pre'>		$stmt-&gt;bindParam(1, $pid);</pre><br/><span class='lineno'>04286</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04287</span><pre class='pre'>		if ($result == true){</pre><br/><span class='lineno'>04288</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04289</span><pre class='pre'>			if($icount == 1){</pre><br/><span class='lineno'>04290</span><pre class='pre'>				$photoimg = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>04291</span><pre class='pre'>				$date_from = $photoimg['dfrom'];</pre><br/><span class='lineno'>04292</span><pre class='pre'>				return $date_from;</pre><br/><span class='lineno'>04293</span><pre class='pre'>			}</pre><br/><span class='lineno'>04294</span><pre class='pre'>		}</pre><br/><span class='lineno'>04295</span><pre class='pre'>	}</pre><br/><span class='lineno'>04296</span><pre class='pre'></pre><br/><span class='lineno'>04297</span><pre class='pre'>	//jinxin add 2012/02/09 end</pre><br/><span class='lineno'>04298</span><pre class='pre'>	//yupengbo add 2011/12/12 start</pre><br/><span class='lineno'>04299</span><pre class='pre'>	/*</pre><br/><span class='lineno'>04300</span><pre class='pre'>	 * é¢æ°åï¼get_photo_ext</pre><br/><span class='lineno'>04301</span><pre class='pre'>	 * é¢æ°èª¬æï¼ç»åIDããæ¡å¼µå­ãåå¾ãã</pre><br/><span class='lineno'>04302</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>04303</span><pre class='pre'>	 * db_linkï¼ï¼¤ï¼¢ãªã³ã¯</pre><br/><span class='lineno'>04304</span><pre class='pre'>	 * pid	ãï¼ç»åçªå·</pre><br/><span class='lineno'>04305</span><pre class='pre'>	 * extãï¼æ¡å¼µå­</pre><br/><span class='lineno'>04306</span><pre class='pre'>	 * æ»ãå¤ï¼æ¡å¼µå­</pre><br/><span class='lineno'>04307</span><pre class='pre'>	 */</pre><br/><span class='lineno'>04308</span><pre class='pre'>	function get_photo_ext($db_link, $pid,&amp;$ext)</pre><br/><span class='lineno'>04309</span><pre class='pre'>	{</pre><br/><span class='lineno'>04310</span><pre class='pre'>		$sql = &quot;SELECT ext FROM photoimg WHERE photo_id = ?&quot;;</pre><br/><span class='lineno'>04311</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04312</span><pre class='pre'>		$stmt-&gt;bindParam(1, $pid);</pre><br/><span class='lineno'>04313</span><pre class='pre'></pre><br/><span class='lineno'>04314</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04315</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>04316</span><pre class='pre'>		{</pre><br/><span class='lineno'>04317</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04318</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04319</span><pre class='pre'>			if ($icount == 1)</pre><br/><span class='lineno'>04320</span><pre class='pre'>			{</pre><br/><span class='lineno'>04321</span><pre class='pre'>				// ãã¼ã¿ãåå¾ãã¾ãã</pre><br/><span class='lineno'>04322</span><pre class='pre'>				$photoimg = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>04323</span><pre class='pre'>				$ext = $photoimg['ext'];</pre><br/><span class='lineno'>04324</span><pre class='pre'>			}</pre><br/><span class='lineno'>04325</span><pre class='pre'>		}</pre><br/><span class='lineno'>04326</span><pre class='pre'>	}</pre><br/><span class='lineno'>04327</span><pre class='pre'></pre><br/><span class='lineno'>04328</span><pre class='pre'>	/*</pre><br/><span class='lineno'>04329</span><pre class='pre'>	 * é¢æ°åï¼get_photo_filename</pre><br/><span class='lineno'>04330</span><pre class='pre'>	 * é¢æ°èª¬æï¼ç»åIDãããã¡ã¤ã«åãåå¾ãã</pre><br/><span class='lineno'>04331</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>04332</span><pre class='pre'>	 * db_linkï¼ï¼¤ï¼¢ãªã³ã¯</pre><br/><span class='lineno'>04333</span><pre class='pre'>	 * pid	ãï¼ç»åçªå·</pre><br/><span class='lineno'>04334</span><pre class='pre'>	 * file_nameãï¼ãã¡ã¤ã«å</pre><br/><span class='lineno'>04335</span><pre class='pre'>	 * file_name_th1ãï¼ãã¡ã¤ã«å</pre><br/><span class='lineno'>04336</span><pre class='pre'>	 * file_name_th2ãï¼ãã¡ã¤ã«å</pre><br/><span class='lineno'>04337</span><pre class='pre'>	 * file_name_th3ãï¼ãã¡ã¤ã«å</pre><br/><span class='lineno'>04338</span><pre class='pre'>	 * file_name_th4ãï¼ãã¡ã¤ã«å</pre><br/><span class='lineno'>04339</span><pre class='pre'>	 * æ»ãå¤ï¼æ¡å¼µå­</pre><br/><span class='lineno'>04340</span><pre class='pre'>	 */</pre><br/><span class='lineno'>04341</span><pre class='pre'>	function get_photo_filename($db_link, $pid,&amp;$file_name,&amp;$file_name_th1,&amp;$file_name_th2,&amp;$file_name_th3,&amp;$file_name_th4)</pre><br/><span class='lineno'>04342</span><pre class='pre'>	{</pre><br/><span class='lineno'>04343</span><pre class='pre'>		$sql = &quot;SELECT photo_filename,photo_filename_th1,photo_filename_th2,photo_filename_th3,photo_filename_th4 FROM photoimg WHERE photo_id = ?&quot;;</pre><br/><span class='lineno'>04344</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04345</span><pre class='pre'>		$stmt-&gt;bindParam(1, $pid);</pre><br/><span class='lineno'>04346</span><pre class='pre'></pre><br/><span class='lineno'>04347</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04348</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>04349</span><pre class='pre'>		{</pre><br/><span class='lineno'>04350</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04351</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04352</span><pre class='pre'>			if ($icount == 1)</pre><br/><span class='lineno'>04353</span><pre class='pre'>			{</pre><br/><span class='lineno'>04354</span><pre class='pre'>				// ãã¼ã¿ãåå¾ãã¾ãã</pre><br/><span class='lineno'>04355</span><pre class='pre'>				$photoimg = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>04356</span><pre class='pre'>				$file_name = $photoimg['photo_filename'];</pre><br/><span class='lineno'>04357</span><pre class='pre'>				$file_name_th1 = $photoimg['photo_filename_th1'];</pre><br/><span class='lineno'>04358</span><pre class='pre'>				$file_name_th2 = $photoimg['photo_filename_th2'];</pre><br/><span class='lineno'>04359</span><pre class='pre'>				$file_name_th3 = $photoimg['photo_filename_th3'];</pre><br/><span class='lineno'>04360</span><pre class='pre'>				$file_name_th4 = $photoimg['photo_filename_th4'];</pre><br/><span class='lineno'>04361</span><pre class='pre'>			}</pre><br/><span class='lineno'>04362</span><pre class='pre'>		}</pre><br/><span class='lineno'>04363</span><pre class='pre'>	}</pre><br/><span class='lineno'>04364</span><pre class='pre'>	//yupengbo add 2011/12/12 end</pre><br/><span class='lineno'>04365</span><pre class='pre'></pre><br/><span class='lineno'>04366</span><pre class='pre'>	/*</pre><br/><span class='lineno'>04367</span><pre class='pre'>	 * é¢æ°åï¼get_photo_lastid</pre><br/><span class='lineno'>04368</span><pre class='pre'>	 * é¢æ°èª¬æï¼æçµç»åçªå·ãåå¾ãã</pre><br/><span class='lineno'>04369</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼db_linkï¼ï¼¤ï¼¢ãªã³ã¯</pre><br/><span class='lineno'>04370</span><pre class='pre'>	 * æ»ãå¤ï¼æçµç»åçªå·</pre><br/><span class='lineno'>04371</span><pre class='pre'>	 */</pre><br/><span class='lineno'>04372</span><pre class='pre'>	function get_photo_lastid($db_link)</pre><br/><span class='lineno'>04373</span><pre class='pre'>	{</pre><br/><span class='lineno'>04374</span><pre class='pre'>		$sql = &quot;SELECT max( photo_id ) max_photo_id FROM photoimg;&quot;;</pre><br/><span class='lineno'>04375</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04376</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04377</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>04378</span><pre class='pre'>		{</pre><br/><span class='lineno'>04379</span><pre class='pre'>			// æçµçªå·ãåå¾ãã¾ãã</pre><br/><span class='lineno'>04380</span><pre class='pre'>			$max = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>04381</span><pre class='pre'>			return $max['max_photo_id'];</pre><br/><span class='lineno'>04382</span><pre class='pre'>		}</pre><br/><span class='lineno'>04383</span><pre class='pre'>		else</pre><br/><span class='lineno'>04384</span><pre class='pre'>		{</pre><br/><span class='lineno'>04385</span><pre class='pre'>			// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04386</span><pre class='pre'>			$this-&gt;message = &quot;æçµç»åçªå·ãåå¾ã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>04387</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04388</span><pre class='pre'>			return &quot;&quot;;</pre><br/><span class='lineno'>04389</span><pre class='pre'>		}</pre><br/><span class='lineno'>04390</span><pre class='pre'>	}</pre><br/><span class='lineno'>04391</span><pre class='pre'></pre><br/><span class='lineno'>04392</span><pre class='pre'>	/*</pre><br/><span class='lineno'>04393</span><pre class='pre'>	 * é¢æ°åï¼getmaxno</pre><br/><span class='lineno'>04394</span><pre class='pre'>	 * é¢æ°èª¬æï¼ç»åçªå·ã®æçµçªå·</pre><br/><span class='lineno'>04395</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼db_linkï¼ï¼¤ï¼¢ãªã³ã¯;p_photo_mno:ç»åç®¡ççªå·</pre><br/><span class='lineno'>04396</span><pre class='pre'>	 * æ»ãå¤ï¼æçµç»åçªå·</pre><br/><span class='lineno'>04397</span><pre class='pre'>	 */</pre><br/><span class='lineno'>04398</span><pre class='pre'>	function getmaxno($db_link,$p_photo_mno)</pre><br/><span class='lineno'>04399</span><pre class='pre'>	{</pre><br/><span class='lineno'>04400</span><pre class='pre'>		// ç»åçªå·ã®æçµçªå·ãåå¾ãã¾ãã</pre><br/><span class='lineno'>04401</span><pre class='pre'>		$sql = &quot;select * from lastnumber where lastnumber = \&quot;&quot;.$p_photo_mno.&quot;\&quot;&quot;;</pre><br/><span class='lineno'>04402</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04403</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04404</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>04405</span><pre class='pre'>		{</pre><br/><span class='lineno'>04406</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04407</span><pre class='pre'>			if ($icount == 0)</pre><br/><span class='lineno'>04408</span><pre class='pre'>			{</pre><br/><span class='lineno'>04409</span><pre class='pre'>				return 0;</pre><br/><span class='lineno'>04410</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>04411</span><pre class='pre'>				$sql = &quot;SELECT max(lastnumber)+1 as max FROM lastnumber WHERE lastnumber_name=\&quot;&quot;.$p_photo_mno.&quot;\&quot;&quot;;</pre><br/><span class='lineno'>04412</span><pre class='pre'>				$stmt1 = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04413</span><pre class='pre'>				$result = $stmt1-&gt;execute();</pre><br/><span class='lineno'>04414</span><pre class='pre'>				if ($result == true)</pre><br/><span class='lineno'>04415</span><pre class='pre'>				{</pre><br/><span class='lineno'>04416</span><pre class='pre'>					// æçµçªå·ãåå¾ãã¾ãã</pre><br/><span class='lineno'>04417</span><pre class='pre'>					$max = $stmt1-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>04418</span><pre class='pre'>					$maxno = $max['max'];</pre><br/><span class='lineno'>04419</span><pre class='pre'>					return $maxno;</pre><br/><span class='lineno'>04420</span><pre class='pre'>				}</pre><br/><span class='lineno'>04421</span><pre class='pre'>				else</pre><br/><span class='lineno'>04422</span><pre class='pre'>				{</pre><br/><span class='lineno'>04423</span><pre class='pre'>					// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04424</span><pre class='pre'>					$this-&gt;message = &quot;æçµçªå·ã®MAXå¤ãåå¾ã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>04425</span><pre class='pre'>					throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04426</span><pre class='pre'>				}</pre><br/><span class='lineno'>04427</span><pre class='pre'>			}</pre><br/><span class='lineno'>04428</span><pre class='pre'>		}</pre><br/><span class='lineno'>04429</span><pre class='pre'>		else</pre><br/><span class='lineno'>04430</span><pre class='pre'>		{</pre><br/><span class='lineno'>04431</span><pre class='pre'>			// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04432</span><pre class='pre'>			$this-&gt;message = &quot;æçµçªå·ã®MAXå¤ãåå¾ã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>04433</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04434</span><pre class='pre'>		}</pre><br/><span class='lineno'>04435</span><pre class='pre'>	}</pre><br/><span class='lineno'>04436</span><pre class='pre'></pre><br/><span class='lineno'>04437</span><pre class='pre'>	/*</pre><br/><span class='lineno'>04438</span><pre class='pre'>	 * é¢æ°åï¼setmaxno</pre><br/><span class='lineno'>04439</span><pre class='pre'>	 * é¢æ°èª¬æï¼ç»åçªå·ã®æçµçªå·</pre><br/><span class='lineno'>04440</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼db_linkï¼ï¼¤ï¼¢ãªã³ã¯;p_photo_mno:ç»åç®¡ççªå·;p_maxno:ç»åçªå·ã®æçµçªå·</pre><br/><span class='lineno'>04441</span><pre class='pre'>	 * æ»ãå¤ï¼æçµç»åçªå·</pre><br/><span class='lineno'>04442</span><pre class='pre'>	 */</pre><br/><span class='lineno'>04443</span><pre class='pre'>	function setmaxno($db_link,$p_photo_mno,$p_maxno,$delflg=0)</pre><br/><span class='lineno'>04444</span><pre class='pre'>	{</pre><br/><span class='lineno'>04445</span><pre class='pre'>		// æçµçªå·ãæ´æ°ãã¾ãã</pre><br/><span class='lineno'>04446</span><pre class='pre'></pre><br/><span class='lineno'>04447</span><pre class='pre'>		if ($delflg == 1)</pre><br/><span class='lineno'>04448</span><pre class='pre'>		{</pre><br/><span class='lineno'>04449</span><pre class='pre'>			if ($p_maxno &gt;= 0)</pre><br/><span class='lineno'>04450</span><pre class='pre'>			{</pre><br/><span class='lineno'>04451</span><pre class='pre'>				$sql = &quot;UPDATE lastnumber SET lastnumber=? WHERE lastnumber_name=?&quot;;</pre><br/><span class='lineno'>04452</span><pre class='pre'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04453</span><pre class='pre'>				$stmt-&gt;bindParam(1, $p_maxno);</pre><br/><span class='lineno'>04454</span><pre class='pre'>				$stmt-&gt;bindParam(2, $p_photo_mno);</pre><br/><span class='lineno'>04455</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>04456</span><pre class='pre'>				$sql = &quot;DELETE FROM lastnumber WHERE lastnumber_name=?&quot;;</pre><br/><span class='lineno'>04457</span><pre class='pre'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04458</span><pre class='pre'>				$stmt-&gt;bindParam(1, $p_photo_mno);</pre><br/><span class='lineno'>04459</span><pre class='pre'>			}</pre><br/><span class='lineno'>04460</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>04461</span><pre class='pre'>			if ($p_maxno &gt; 0)</pre><br/><span class='lineno'>04462</span><pre class='pre'>			{</pre><br/><span class='lineno'>04463</span><pre class='pre'>				$sql = &quot;UPDATE lastnumber SET lastnumber=? WHERE lastnumber_name=?&quot;;</pre><br/><span class='lineno'>04464</span><pre class='pre'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04465</span><pre class='pre'>				$stmt-&gt;bindParam(1, $p_maxno);</pre><br/><span class='lineno'>04466</span><pre class='pre'>				$stmt-&gt;bindParam(2, $p_photo_mno);</pre><br/><span class='lineno'>04467</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>04468</span><pre class='pre'>				$sql = &quot;INSERT INTO lastnumber (lastnumber_name, lastnumber) value (?, 0)&quot;;</pre><br/><span class='lineno'>04469</span><pre class='pre'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04470</span><pre class='pre'>				$stmt-&gt;bindParam(1, $p_photo_mno);</pre><br/><span class='lineno'>04471</span><pre class='pre'>			}</pre><br/><span class='lineno'>04472</span><pre class='pre'>		}</pre><br/><span class='lineno'>04473</span><pre class='pre'></pre><br/><span class='lineno'>04474</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04475</span><pre class='pre'>		if ($result == false)</pre><br/><span class='lineno'>04476</span><pre class='pre'>		{</pre><br/><span class='lineno'>04477</span><pre class='pre'>			$this-&gt;message = &quot;æçµçªå·ã®MAXå¤ãæ´æ°ã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>04478</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04479</span><pre class='pre'>		}</pre><br/><span class='lineno'>04480</span><pre class='pre'>	}</pre><br/><span class='lineno'>04481</span><pre class='pre'></pre><br/><span class='lineno'>04482</span><pre class='pre'>	function insert_data($db_link)</pre><br/><span class='lineno'>04483</span><pre class='pre'>	{</pre><br/><span class='lineno'>04484</span><pre class='pre'>		//global $comp_code;</pre><br/><span class='lineno'>04485</span><pre class='pre'></pre><br/><span class='lineno'>04486</span><pre class='pre'>		// ãã©ã¡ã¼ã¿ã®ãã§ãã¯ã¨èª¿æ´ããã¾ãã</pre><br/><span class='lineno'>04487</span><pre class='pre'>		$this-&gt;check_adjust_param(&quot;I&quot;);</pre><br/><span class='lineno'>04488</span><pre class='pre'>		// ãã©ã³ã¶ã¯ã·ã§ã³ãéå§ãã¾ããï¼ãªã¼ãã³ãããããªãã«ãªãã¾ããï¼</pre><br/><span class='lineno'>04489</span><pre class='pre'>		$db_link-&gt;beginTransaction();</pre><br/><span class='lineno'>04490</span><pre class='pre'></pre><br/><span class='lineno'>04491</span><pre class='pre'>		try</pre><br/><span class='lineno'>04492</span><pre class='pre'>		{</pre><br/><span class='lineno'>04493</span><pre class='pre'>			// åçãã¼ã¿ãè¿½å ãã¾ãã</pre><br/><span class='lineno'>04494</span><pre class='pre'>			$sql = &quot;INSERT INTO photoimg (  publishing_situation_id,</pre><br/><span class='lineno'>04495</span><pre class='pre'>											registration_division_id,</pre><br/><span class='lineno'>04496</span><pre class='pre'>											take_picture_time_id,</pre><br/><span class='lineno'>04497</span><pre class='pre'>											take_picture_time2_id,</pre><br/><span class='lineno'>04498</span><pre class='pre'>											borrowing_ahead_id,</pre><br/><span class='lineno'>04499</span><pre class='pre'>											range_of_use_id,</pre><br/><span class='lineno'>04500</span><pre class='pre'>											image_size_x,</pre><br/><span class='lineno'>04501</span><pre class='pre'>											image_size_y,</pre><br/><span class='lineno'>04502</span><pre class='pre'>											photo_mno,</pre><br/><span class='lineno'>04503</span><pre class='pre'>											source_image_no,</pre><br/><span class='lineno'>04504</span><pre class='pre'>											bud_photo_no,</pre><br/><span class='lineno'>04505</span><pre class='pre'>											photo_name,</pre><br/><span class='lineno'>04506</span><pre class='pre'>											photo_explanation,</pre><br/><span class='lineno'>04507</span><pre class='pre'>											dfrom,</pre><br/><span class='lineno'>04508</span><pre class='pre'>											dto,</pre><br/><span class='lineno'>04509</span><pre class='pre'>											kikan,</pre><br/><span class='lineno'>04510</span><pre class='pre'>											photo_filename,</pre><br/><span class='lineno'>04511</span><pre class='pre'>											photo_filename_th1,</pre><br/><span class='lineno'>04512</span><pre class='pre'>											photo_filename_th2,</pre><br/><span class='lineno'>04513</span><pre class='pre'>											photo_filename_th3,</pre><br/><span class='lineno'>04514</span><pre class='pre'>											photo_filename_th4,</pre><br/><span class='lineno'>04515</span><pre class='pre'>											photo_filename_th5,</pre><br/><span class='lineno'>04516</span><pre class='pre'>											photo_filename_th6,</pre><br/><span class='lineno'>04517</span><pre class='pre'>											photo_filename_th7,</pre><br/><span class='lineno'>04518</span><pre class='pre'>											photo_filename_th8,</pre><br/><span class='lineno'>04519</span><pre class='pre'>											photo_filename_th9,</pre><br/><span class='lineno'>04520</span><pre class='pre'>											photo_filename_th10,</pre><br/><span class='lineno'>04521</span><pre class='pre'>											ext,</pre><br/><span class='lineno'>04522</span><pre class='pre'>											note,</pre><br/><span class='lineno'>04523</span><pre class='pre'>											copyright_owner,</pre><br/><span class='lineno'>04524</span><pre class='pre'>											content_borrowing_ahead,</pre><br/><span class='lineno'>04525</span><pre class='pre'>											use_condition,</pre><br/><span class='lineno'>04526</span><pre class='pre'>											additional_constraints1,</pre><br/><span class='lineno'>04527</span><pre class='pre'>											additional_constraints2,</pre><br/><span class='lineno'>04528</span><pre class='pre'>											customer_section,</pre><br/><span class='lineno'>04529</span><pre class='pre'>											customer_name,</pre><br/><span class='lineno'>04530</span><pre class='pre'>											registration_account,</pre><br/><span class='lineno'>04531</span><pre class='pre'>											registration_person,</pre><br/><span class='lineno'>04532</span><pre class='pre'>											register_date,</pre><br/><span class='lineno'>04533</span><pre class='pre'>											monopoly_use</pre><br/><span class='lineno'>04534</span><pre class='pre'>								) VALUES (</pre><br/><span class='lineno'>04535</span><pre class='pre'>											$this-&gt;publishing_situation_id,</pre><br/><span class='lineno'>04536</span><pre class='pre'>											$this-&gt;registration_division_id,</pre><br/><span class='lineno'>04537</span><pre class='pre'>											$this-&gt;take_picture_time_id,</pre><br/><span class='lineno'>04538</span><pre class='pre'>											$this-&gt;take_picture_time2_id,</pre><br/><span class='lineno'>04539</span><pre class='pre'>											$this-&gt;borrowing_ahead_id,</pre><br/><span class='lineno'>04540</span><pre class='pre'>											$this-&gt;range_of_use_id,</pre><br/><span class='lineno'>04541</span><pre class='pre'>											$this-&gt;image_size_x,</pre><br/><span class='lineno'>04542</span><pre class='pre'>											$this-&gt;image_size_y,</pre><br/><span class='lineno'>04543</span><pre class='pre'>											?,?,?,?,?,</pre><br/><span class='lineno'>04544</span><pre class='pre'>											?,?,?,?,?,</pre><br/><span class='lineno'>04545</span><pre class='pre'>											?,?,?,?,?,</pre><br/><span class='lineno'>04546</span><pre class='pre'>											?,?,?,?,?,</pre><br/><span class='lineno'>04547</span><pre class='pre'>											?,?,?,?,?,</pre><br/><span class='lineno'>04548</span><pre class='pre'>											?,?,?,?,?,</pre><br/><span class='lineno'>04549</span><pre class='pre'>											?,?</pre><br/><span class='lineno'>04550</span><pre class='pre'>											)&quot;;</pre><br/><span class='lineno'>04551</span><pre class='pre'>			$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04552</span><pre class='pre'></pre><br/><span class='lineno'>04553</span><pre class='pre'>			$p_max_photo_id = $this-&gt;get_photo_lastid($db_link);</pre><br/><span class='lineno'>04554</span><pre class='pre'></pre><br/><span class='lineno'>04555</span><pre class='pre'>			if (strlen($this-&gt;photo_mno) &lt;= 5) $this-&gt;photo_mno = &quot;ç³è«ä¸­&quot;.$this-&gt;comp_code.&quot; &quot;.$p_max_photo_id;</pre><br/><span class='lineno'>04556</span><pre class='pre'></pre><br/><span class='lineno'>04557</span><pre class='pre'>			$stmt-&gt;bindParam(1, $this-&gt;photo_mno);</pre><br/><span class='lineno'>04558</span><pre class='pre'>			$stmt-&gt;bindParam(2, $this-&gt;source_image_no);</pre><br/><span class='lineno'>04559</span><pre class='pre'>			$stmt-&gt;bindParam(3, $this-&gt;bud_photo_no);</pre><br/><span class='lineno'>04560</span><pre class='pre'>			$stmt-&gt;bindParam(4, $this-&gt;photo_name);</pre><br/><span class='lineno'>04561</span><pre class='pre'>			$stmt-&gt;bindParam(5, $this-&gt;photo_explanation);</pre><br/><span class='lineno'>04562</span><pre class='pre'>			$stmt-&gt;bindParam(6, $this-&gt;dfrom);</pre><br/><span class='lineno'>04563</span><pre class='pre'>			$stmt-&gt;bindParam(7, $this-&gt;dto);</pre><br/><span class='lineno'>04564</span><pre class='pre'>			$stmt-&gt;bindParam(8, $this-&gt;kikan);</pre><br/><span class='lineno'>04565</span><pre class='pre'></pre><br/><span class='lineno'>04566</span><pre class='pre'>			if (!empty($this-&gt;up_url[0]))</pre><br/><span class='lineno'>04567</span><pre class='pre'>			{</pre><br/><span class='lineno'>04568</span><pre class='pre'>				$stmt-&gt;bindParam(9, $this-&gt;up_url[0]);</pre><br/><span class='lineno'>04569</span><pre class='pre'>			}</pre><br/><span class='lineno'>04570</span><pre class='pre'>			else</pre><br/><span class='lineno'>04571</span><pre class='pre'>			{</pre><br/><span class='lineno'>04572</span><pre class='pre'>				$stmt-&gt;bindValue(9, null);</pre><br/><span class='lineno'>04573</span><pre class='pre'>			}</pre><br/><span class='lineno'>04574</span><pre class='pre'></pre><br/><span class='lineno'>04575</span><pre class='pre'>			if (!empty($this-&gt;up_url[1]))</pre><br/><span class='lineno'>04576</span><pre class='pre'>			{</pre><br/><span class='lineno'>04577</span><pre class='pre'>				$stmt-&gt;bindParam(10, $this-&gt;up_url[1]);</pre><br/><span class='lineno'>04578</span><pre class='pre'>			}</pre><br/><span class='lineno'>04579</span><pre class='pre'>			else</pre><br/><span class='lineno'>04580</span><pre class='pre'>			{</pre><br/><span class='lineno'>04581</span><pre class='pre'>				$stmt-&gt;bindValue(10, null);</pre><br/><span class='lineno'>04582</span><pre class='pre'>			}</pre><br/><span class='lineno'>04583</span><pre class='pre'></pre><br/><span class='lineno'>04584</span><pre class='pre'>			if (!empty($this-&gt;up_url[2]))</pre><br/><span class='lineno'>04585</span><pre class='pre'>			{</pre><br/><span class='lineno'>04586</span><pre class='pre'>				$stmt-&gt;bindParam(11, $this-&gt;up_url[2]);</pre><br/><span class='lineno'>04587</span><pre class='pre'>			}</pre><br/><span class='lineno'>04588</span><pre class='pre'>			else</pre><br/><span class='lineno'>04589</span><pre class='pre'>			{</pre><br/><span class='lineno'>04590</span><pre class='pre'>				$stmt-&gt;bindValue(11, null);</pre><br/><span class='lineno'>04591</span><pre class='pre'>			}</pre><br/><span class='lineno'>04592</span><pre class='pre'></pre><br/><span class='lineno'>04593</span><pre class='pre'>			if (!empty($this-&gt;up_url[3]))</pre><br/><span class='lineno'>04594</span><pre class='pre'>			{</pre><br/><span class='lineno'>04595</span><pre class='pre'>				$stmt-&gt;bindParam(12, $this-&gt;up_url[3]);</pre><br/><span class='lineno'>04596</span><pre class='pre'>			}</pre><br/><span class='lineno'>04597</span><pre class='pre'>			else</pre><br/><span class='lineno'>04598</span><pre class='pre'>			{</pre><br/><span class='lineno'>04599</span><pre class='pre'>				$stmt-&gt;bindValue(12, null);</pre><br/><span class='lineno'>04600</span><pre class='pre'>			}</pre><br/><span class='lineno'>04601</span><pre class='pre'></pre><br/><span class='lineno'>04602</span><pre class='pre'>			if (!empty($this-&gt;up_url[4]))</pre><br/><span class='lineno'>04603</span><pre class='pre'>			{</pre><br/><span class='lineno'>04604</span><pre class='pre'>				$stmt-&gt;bindParam(13, $this-&gt;up_url[4]);</pre><br/><span class='lineno'>04605</span><pre class='pre'>			}</pre><br/><span class='lineno'>04606</span><pre class='pre'>			else</pre><br/><span class='lineno'>04607</span><pre class='pre'>			{</pre><br/><span class='lineno'>04608</span><pre class='pre'>				$stmt-&gt;bindValue(13, null);</pre><br/><span class='lineno'>04609</span><pre class='pre'>			}</pre><br/><span class='lineno'>04610</span><pre class='pre'></pre><br/><span class='lineno'>04611</span><pre class='pre'>			if (!empty($this-&gt;up_url[5]))</pre><br/><span class='lineno'>04612</span><pre class='pre'>			{</pre><br/><span class='lineno'>04613</span><pre class='pre'>				$stmt-&gt;bindParam(14, $this-&gt;up_url[5]);</pre><br/><span class='lineno'>04614</span><pre class='pre'>			}</pre><br/><span class='lineno'>04615</span><pre class='pre'>			else</pre><br/><span class='lineno'>04616</span><pre class='pre'>			{</pre><br/><span class='lineno'>04617</span><pre class='pre'>				$stmt-&gt;bindValue(14, null);</pre><br/><span class='lineno'>04618</span><pre class='pre'>			}</pre><br/><span class='lineno'>04619</span><pre class='pre'></pre><br/><span class='lineno'>04620</span><pre class='pre'>			if (!empty($this-&gt;up_url[6]))</pre><br/><span class='lineno'>04621</span><pre class='pre'>			{</pre><br/><span class='lineno'>04622</span><pre class='pre'>				$stmt-&gt;bindParam(15, $this-&gt;up_url[6]);</pre><br/><span class='lineno'>04623</span><pre class='pre'>			}</pre><br/><span class='lineno'>04624</span><pre class='pre'>			else</pre><br/><span class='lineno'>04625</span><pre class='pre'>			{</pre><br/><span class='lineno'>04626</span><pre class='pre'>				$stmt-&gt;bindValue(15, null);</pre><br/><span class='lineno'>04627</span><pre class='pre'>			}</pre><br/><span class='lineno'>04628</span><pre class='pre'></pre><br/><span class='lineno'>04629</span><pre class='pre'>			if (!empty($this-&gt;up_url[7]))</pre><br/><span class='lineno'>04630</span><pre class='pre'>			{</pre><br/><span class='lineno'>04631</span><pre class='pre'>				$stmt-&gt;bindParam(16, $this-&gt;up_url[7]);</pre><br/><span class='lineno'>04632</span><pre class='pre'>			}</pre><br/><span class='lineno'>04633</span><pre class='pre'>			else</pre><br/><span class='lineno'>04634</span><pre class='pre'>			{</pre><br/><span class='lineno'>04635</span><pre class='pre'>				$stmt-&gt;bindValue(16, null);</pre><br/><span class='lineno'>04636</span><pre class='pre'>			}</pre><br/><span class='lineno'>04637</span><pre class='pre'></pre><br/><span class='lineno'>04638</span><pre class='pre'>			if (!empty($this-&gt;up_url[8]))</pre><br/><span class='lineno'>04639</span><pre class='pre'>			{</pre><br/><span class='lineno'>04640</span><pre class='pre'>				$stmt-&gt;bindParam(17, $this-&gt;up_url[8]);</pre><br/><span class='lineno'>04641</span><pre class='pre'>			}</pre><br/><span class='lineno'>04642</span><pre class='pre'>			else</pre><br/><span class='lineno'>04643</span><pre class='pre'>			{</pre><br/><span class='lineno'>04644</span><pre class='pre'>				$stmt-&gt;bindValue(17, null);</pre><br/><span class='lineno'>04645</span><pre class='pre'>			}</pre><br/><span class='lineno'>04646</span><pre class='pre'></pre><br/><span class='lineno'>04647</span><pre class='pre'>			if (!empty($this-&gt;up_url[9]))</pre><br/><span class='lineno'>04648</span><pre class='pre'>			{</pre><br/><span class='lineno'>04649</span><pre class='pre'>				$stmt-&gt;bindParam(18, $this-&gt;up_url[9]);</pre><br/><span class='lineno'>04650</span><pre class='pre'>			}</pre><br/><span class='lineno'>04651</span><pre class='pre'>			else</pre><br/><span class='lineno'>04652</span><pre class='pre'>			{</pre><br/><span class='lineno'>04653</span><pre class='pre'>				$stmt-&gt;bindValue(18, null);</pre><br/><span class='lineno'>04654</span><pre class='pre'>			}</pre><br/><span class='lineno'>04655</span><pre class='pre'></pre><br/><span class='lineno'>04656</span><pre class='pre'>			if (!empty($this-&gt;up_url[10]))</pre><br/><span class='lineno'>04657</span><pre class='pre'>			{</pre><br/><span class='lineno'>04658</span><pre class='pre'>				$stmt-&gt;bindParam(19, $this-&gt;up_url[10]);</pre><br/><span class='lineno'>04659</span><pre class='pre'>			}</pre><br/><span class='lineno'>04660</span><pre class='pre'>			else</pre><br/><span class='lineno'>04661</span><pre class='pre'>			{</pre><br/><span class='lineno'>04662</span><pre class='pre'>				$stmt-&gt;bindValue(19, null);</pre><br/><span class='lineno'>04663</span><pre class='pre'>			}</pre><br/><span class='lineno'>04664</span><pre class='pre'></pre><br/><span class='lineno'>04665</span><pre class='pre'>			$stmt-&gt;bindParam(20, $this-&gt;ext);</pre><br/><span class='lineno'>04666</span><pre class='pre'></pre><br/><span class='lineno'>04667</span><pre class='pre'>			$stmt-&gt;bindParam(21, $this-&gt;note);</pre><br/><span class='lineno'>04668</span><pre class='pre'>			$stmt-&gt;bindParam(22, $this-&gt;copyright_owner);</pre><br/><span class='lineno'>04669</span><pre class='pre'>			$stmt-&gt;bindParam(23, $this-&gt;content_borrowing_ahead);</pre><br/><span class='lineno'>04670</span><pre class='pre'>			$stmt-&gt;bindParam(24, $this-&gt;use_condition);</pre><br/><span class='lineno'>04671</span><pre class='pre'>			$stmt-&gt;bindParam(25, $this-&gt;additional_constraints1);</pre><br/><span class='lineno'>04672</span><pre class='pre'>			$stmt-&gt;bindParam(26, $this-&gt;additional_constraints2);</pre><br/><span class='lineno'>04673</span><pre class='pre'>			$stmt-&gt;bindParam(27, $this-&gt;customer_section);</pre><br/><span class='lineno'>04674</span><pre class='pre'>			$stmt-&gt;bindParam(28, $this-&gt;customer_name);</pre><br/><span class='lineno'>04675</span><pre class='pre'>			$stmt-&gt;bindParam(29, $this-&gt;registration_account);</pre><br/><span class='lineno'>04676</span><pre class='pre'>			$stmt-&gt;bindParam(30, $this-&gt;registration_person);</pre><br/><span class='lineno'>04677</span><pre class='pre'>			$stmt-&gt;bindParam(31, $this-&gt;register_date);</pre><br/><span class='lineno'>04678</span><pre class='pre'>			$stmt-&gt;bindParam(32, $this-&gt;monopoly_use);</pre><br/><span class='lineno'>04679</span><pre class='pre'></pre><br/><span class='lineno'>04680</span><pre class='pre'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04681</span><pre class='pre'>			if ($result == true)</pre><br/><span class='lineno'>04682</span><pre class='pre'>			{</pre><br/><span class='lineno'>04683</span><pre class='pre'>				// å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>04684</span><pre class='pre'>				$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04685</span><pre class='pre'></pre><br/><span class='lineno'>04686</span><pre class='pre'>				// è¿½å ããããã¼ã¿æ°ãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>04687</span><pre class='pre'>				if ($icount == 1)</pre><br/><span class='lineno'>04688</span><pre class='pre'>				{</pre><br/><span class='lineno'>04689</span><pre class='pre'>					// æ¿å¥ããç»åãã¼ã¿ã®photo_idãåå¾ãã¾ãã(ä»ç»é²ãããphoto_idãåå¾ãã¾ãã)</pre><br/><span class='lineno'>04690</span><pre class='pre'>					$pid = $db_link-&gt;lastInsertId();</pre><br/><span class='lineno'>04691</span><pre class='pre'></pre><br/><span class='lineno'>04692</span><pre class='pre'>					// ã­ã¼ã¯ã¼ããå¥ãã¼ãã«ã«ç»é²ãã¾ãã</pre><br/><span class='lineno'>04693</span><pre class='pre'>					$this-&gt;insert_keyword($db_link, $pid, $this-&gt;keyword_str);</pre><br/><span class='lineno'>04694</span><pre class='pre'></pre><br/><span class='lineno'>04695</span><pre class='pre'>					// åé¡ãå¥ãã¼ãã«ã«ç»é²ãã¾ãã</pre><br/><span class='lineno'>04696</span><pre class='pre'>					// â»ãã§ã«photo_idä»¥å¤ã¯ãã¹ã¦ãã¼ã¿ã»ããæ¸ã¿ã§ã</pre><br/><span class='lineno'>04697</span><pre class='pre'>					$this-&gt;registration_classifications-&gt;insert_data($db_link, $pid);</pre><br/><span class='lineno'>04698</span><pre class='pre'></pre><br/><span class='lineno'>04699</span><pre class='pre'>					// ã³ããããã¾ãã</pre><br/><span class='lineno'>04700</span><pre class='pre'>					$db_link-&gt;commit();</pre><br/><span class='lineno'>04701</span><pre class='pre'></pre><br/><span class='lineno'>04702</span><pre class='pre'>					return true;</pre><br/><span class='lineno'>04703</span><pre class='pre'>				}</pre><br/><span class='lineno'>04704</span><pre class='pre'>				else</pre><br/><span class='lineno'>04705</span><pre class='pre'>				{</pre><br/><span class='lineno'>04706</span><pre class='pre'>					$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>04707</span><pre class='pre'>					$this-&gt;message = &quot;ç»åãDBã«ç»é²ã§ãã¾ããã§ãããï¼å¦çæ°!=1ï¼&quot;;</pre><br/><span class='lineno'>04708</span><pre class='pre'>					throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04709</span><pre class='pre'>					//throw new Exception($err[2]);</pre><br/><span class='lineno'>04710</span><pre class='pre'>				}</pre><br/><span class='lineno'>04711</span><pre class='pre'>			}</pre><br/><span class='lineno'>04712</span><pre class='pre'>			else</pre><br/><span class='lineno'>04713</span><pre class='pre'>			{</pre><br/><span class='lineno'>04714</span><pre class='pre'>				$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>04715</span><pre class='pre'>				var_dump($stmt,&quot;*****&quot;,$err);exit;</pre><br/><span class='lineno'>04716</span><pre class='pre'>				$this-&gt;message = &quot;ç»åãDBã«ç»é²ã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>04717</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04718</span><pre class='pre'>				//throw new Exception($err[2]);</pre><br/><span class='lineno'>04719</span><pre class='pre'>			}</pre><br/><span class='lineno'>04720</span><pre class='pre'>		}</pre><br/><span class='lineno'>04721</span><pre class='pre'>		catch(Exception $e)</pre><br/><span class='lineno'>04722</span><pre class='pre'>		{</pre><br/><span class='lineno'>04723</span><pre class='pre'>			// ã­ã¼ã«ããã¯ãã¾ãã</pre><br/><span class='lineno'>04724</span><pre class='pre'>			$db_link-&gt;rollBack();</pre><br/><span class='lineno'>04725</span><pre class='pre'></pre><br/><span class='lineno'>04726</span><pre class='pre'>			// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04727</span><pre class='pre'>			$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>04728</span><pre class='pre'>			throw new Exception($msg);</pre><br/><span class='lineno'>04729</span><pre class='pre'>		}</pre><br/><span class='lineno'>04730</span><pre class='pre'>	}</pre><br/><span class='lineno'>04731</span><pre class='pre'></pre><br/><span class='lineno'>04732</span><pre class='pre'>	// ç»åIDãããã¼ã¿ãåé¤ãã</pre><br/><span class='lineno'>04733</span><pre class='pre'>	function delete_data($db_link, $p_photo_id, $flg=&quot;0&quot;)</pre><br/><span class='lineno'>04734</span><pre class='pre'>	{</pre><br/><span class='lineno'>04735</span><pre class='pre'>		$retFlg = false;</pre><br/><span class='lineno'>04736</span><pre class='pre'>		if (!empty($p_photo_id))</pre><br/><span class='lineno'>04737</span><pre class='pre'>		{</pre><br/><span class='lineno'>04738</span><pre class='pre'>			// ãã©ã³ã¶ã¯ã·ã§ã³ãéå§ãã¾ããï¼ãªã¼ãã³ãããããªãã«ãªãã¾ããï¼</pre><br/><span class='lineno'>04739</span><pre class='pre'>			$db_link-&gt;beginTransaction();</pre><br/><span class='lineno'>04740</span><pre class='pre'></pre><br/><span class='lineno'>04741</span><pre class='pre'>			$sql = &quot;DELETE FROM photoimg WHERE photo_id = &quot;.$p_photo_id;</pre><br/><span class='lineno'>04742</span><pre class='pre'>			$sql .= &quot; AND photo_server_flg = &quot;.$flg;</pre><br/><span class='lineno'>04743</span><pre class='pre'>			$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04744</span><pre class='pre'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04745</span><pre class='pre'>			if ($result == false)</pre><br/><span class='lineno'>04746</span><pre class='pre'>			{</pre><br/><span class='lineno'>04747</span><pre class='pre'>				// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04748</span><pre class='pre'>				$this-&gt;message = &quot;ç»åã®åé¤ãã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>04749</span><pre class='pre'>				// ã­ã¼ã«ããã¯ãã¾ãã</pre><br/><span class='lineno'>04750</span><pre class='pre'>				$db_link-&gt;rollBack();</pre><br/><span class='lineno'>04751</span><pre class='pre'>				// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04752</span><pre class='pre'>				$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>04753</span><pre class='pre'>				throw new Exception($msg);</pre><br/><span class='lineno'>04754</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>04755</span><pre class='pre'>				// ã­ã¼ã¯ã¼ããåé¤ãã</pre><br/><span class='lineno'>04756</span><pre class='pre'>				$del_ok = $this-&gt;delete_keyword($db_link, $p_photo_id);</pre><br/><span class='lineno'>04757</span><pre class='pre'>				//if ($del_ok)//yupengbo comment 2011/11/18</pre><br/><span class='lineno'>04758</span><pre class='pre'>				//{//yupengbo comment 2011/11/18</pre><br/><span class='lineno'>04759</span><pre class='pre'>				// åé¡ãåé¤ãã</pre><br/><span class='lineno'>04760</span><pre class='pre'>				$this-&gt;registration_classifications-&gt;delete_data($db_link, $p_photo_id);</pre><br/><span class='lineno'>04761</span><pre class='pre'></pre><br/><span class='lineno'>04762</span><pre class='pre'>				$sql = &quot;DELETE FROM `photo_imgdata` WHERE photo_id = &quot;.$p_photo_id;</pre><br/><span class='lineno'>04763</span><pre class='pre'>				$stmt_imgdata = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04764</span><pre class='pre'>				$stmt_imgdata-&gt;execute();</pre><br/><span class='lineno'>04765</span><pre class='pre'></pre><br/><span class='lineno'>04766</span><pre class='pre'>				$db_link-&gt;commit();</pre><br/><span class='lineno'>04767</span><pre class='pre'>				$retFlg = true;</pre><br/><span class='lineno'>04768</span><pre class='pre'>				//} else {//yupengbo comment 2011/11/18</pre><br/><span class='lineno'>04769</span><pre class='pre'>				//	$db_link-&gt;rollBack();//yupengbo comment 2011/11/18</pre><br/><span class='lineno'>04770</span><pre class='pre'>				//}//yupengbo comment 2011/11/18</pre><br/><span class='lineno'>04771</span><pre class='pre'>			}</pre><br/><span class='lineno'>04772</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>04773</span><pre class='pre'>			$retFlg = true;</pre><br/><span class='lineno'>04774</span><pre class='pre'>		}</pre><br/><span class='lineno'>04775</span><pre class='pre'></pre><br/><span class='lineno'>04776</span><pre class='pre'>		return $retFlg;</pre><br/><span class='lineno'>04777</span><pre class='pre'>	}</pre><br/><span class='lineno'>04778</span><pre class='pre'></pre><br/><span class='lineno'>04779</span><pre class='pre'>	// æ²è¼ç¶æ³ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>04780</span><pre class='pre'>	function get_publishing_situation($db_link, &amp;$db_id, &amp;$db_name)</pre><br/><span class='lineno'>04781</span><pre class='pre'>	{</pre><br/><span class='lineno'>04782</span><pre class='pre'>		// æ²è¼ç¶æ³æå ±ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>04783</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>04784</span><pre class='pre'>		$sql = &quot;SELECT * FROM publishing_situation order by publishing_situation_id&quot;;</pre><br/><span class='lineno'>04785</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04786</span><pre class='pre'></pre><br/><span class='lineno'>04787</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>04788</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04789</span><pre class='pre'></pre><br/><span class='lineno'>04790</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>04791</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>04792</span><pre class='pre'>		{</pre><br/><span class='lineno'>04793</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04794</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04795</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>04796</span><pre class='pre'>			{</pre><br/><span class='lineno'>04797</span><pre class='pre'>				// åæåãã¾ãã</pre><br/><span class='lineno'>04798</span><pre class='pre'>				$db_id = array();</pre><br/><span class='lineno'>04799</span><pre class='pre'>				$db_name = array();</pre><br/><span class='lineno'>04800</span><pre class='pre'></pre><br/><span class='lineno'>04801</span><pre class='pre'>				while ($publishing_situation = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>04802</span><pre class='pre'>				{</pre><br/><span class='lineno'>04803</span><pre class='pre'>					// æ²è¼ç¶æ³IDãæ²è¼ç¶æ³ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>04804</span><pre class='pre'>					$db_id[] = $publishing_situation['publishing_situation_id'];</pre><br/><span class='lineno'>04805</span><pre class='pre'>					$db_name[] = $publishing_situation['publishing_situation_name'];</pre><br/><span class='lineno'>04806</span><pre class='pre'>				}</pre><br/><span class='lineno'>04807</span><pre class='pre'>			}</pre><br/><span class='lineno'>04808</span><pre class='pre'>			else</pre><br/><span class='lineno'>04809</span><pre class='pre'>			{</pre><br/><span class='lineno'>04810</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04811</span><pre class='pre'>				$this-&gt;message = &quot;æ²è¼ç¶æ³ãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>04812</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04813</span><pre class='pre'>			}</pre><br/><span class='lineno'>04814</span><pre class='pre'>		}</pre><br/><span class='lineno'>04815</span><pre class='pre'>		else</pre><br/><span class='lineno'>04816</span><pre class='pre'>		{</pre><br/><span class='lineno'>04817</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04818</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04819</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>04820</span><pre class='pre'>			$this-&gt;message = &quot;æ²è¼ç¶æ³ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>04821</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04822</span><pre class='pre'>		}</pre><br/><span class='lineno'>04823</span><pre class='pre'>	}</pre><br/><span class='lineno'>04824</span><pre class='pre'></pre><br/><span class='lineno'>04825</span><pre class='pre'>/*</pre><br/><span class='lineno'>04826</span><pre class='pre'> * no permission reasonãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>04827</span><pre class='pre'> * written by jinxin 2012/02/07</pre><br/><span class='lineno'>04828</span><pre class='pre'> */</pre><br/><span class='lineno'>04829</span><pre class='pre'>	function get_nopermis_reasons($db_link, &amp;$db_id, &amp;$db_name)</pre><br/><span class='lineno'>04830</span><pre class='pre'>	{</pre><br/><span class='lineno'>04831</span><pre class='pre'>		$sql = &quot;SELECT * FROM nopermit_master order by nopermit_id&quot;;</pre><br/><span class='lineno'>04832</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04833</span><pre class='pre'></pre><br/><span class='lineno'>04834</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>04835</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04836</span><pre class='pre'></pre><br/><span class='lineno'>04837</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>04838</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>04839</span><pre class='pre'>		{</pre><br/><span class='lineno'>04840</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04841</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04842</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>04843</span><pre class='pre'>			{</pre><br/><span class='lineno'>04844</span><pre class='pre'>				// åæåãã¾ãã</pre><br/><span class='lineno'>04845</span><pre class='pre'>				$db_id = array();</pre><br/><span class='lineno'>04846</span><pre class='pre'>				$db_name = array();</pre><br/><span class='lineno'>04847</span><pre class='pre'></pre><br/><span class='lineno'>04848</span><pre class='pre'>				while ($nopermit_master = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>04849</span><pre class='pre'>				{</pre><br/><span class='lineno'>04850</span><pre class='pre'>					// nopermis IDãnopermis ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>04851</span><pre class='pre'>					$db_id[] = $nopermit_master['nopermit_id'];</pre><br/><span class='lineno'>04852</span><pre class='pre'>					$db_name[] = $nopermit_master['nopermit_name'];</pre><br/><span class='lineno'>04853</span><pre class='pre'>				}</pre><br/><span class='lineno'>04854</span><pre class='pre'>			}</pre><br/><span class='lineno'>04855</span><pre class='pre'>			else</pre><br/><span class='lineno'>04856</span><pre class='pre'>			{</pre><br/><span class='lineno'>04857</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04858</span><pre class='pre'>				$this-&gt;message = &quot;nopermis reason ãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>04859</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04860</span><pre class='pre'>			}</pre><br/><span class='lineno'>04861</span><pre class='pre'>		}</pre><br/><span class='lineno'>04862</span><pre class='pre'>		else</pre><br/><span class='lineno'>04863</span><pre class='pre'>		{</pre><br/><span class='lineno'>04864</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04865</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04866</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>04867</span><pre class='pre'>			$this-&gt;message = &quot;nopermis reason ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>04868</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04869</span><pre class='pre'>		}</pre><br/><span class='lineno'>04870</span><pre class='pre'>	}</pre><br/><span class='lineno'>04871</span><pre class='pre'>	//2012-02-09 modify by jinxin end</pre><br/><span class='lineno'>04872</span><pre class='pre'></pre><br/><span class='lineno'>04873</span><pre class='pre'>	// ã«ãã´ãªã¼ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>04874</span><pre class='pre'>	//   $db_id,$db_name:ï¼æ¬¡éåï¼ã«ãã´ãªã¼ãã¼ãã«ã¯å¤æ¬¡åæ§é ï¼</pre><br/><span class='lineno'>04875</span><pre class='pre'>	//   $db_id[x][0]ï¼ãããã«ãã´ãªã¼</pre><br/><span class='lineno'>04876</span><pre class='pre'>	//   $db_id[x][1-]ï¼å­ã«ãã´ãªã¼</pre><br/><span class='lineno'>04877</span><pre class='pre'>	function get_category($db_link, &amp;$db_id, &amp;$db_name)</pre><br/><span class='lineno'>04878</span><pre class='pre'>	{</pre><br/><span class='lineno'>04879</span><pre class='pre'>		// ãããã«ãã´ãªã¼ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>04880</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>04881</span><pre title='' class='pre covered'>		$sql = &quot;SELECT * FROM category WHERE parent_id = 0 order by category_id&quot;;</pre><br/><span class='lineno'>04882</span><pre title='' class='pre covered'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04883</span><pre class='pre'></pre><br/><span class='lineno'>04884</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>04885</span><pre title='' class='pre covered'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04886</span><pre class='pre'></pre><br/><span class='lineno'>04887</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>04888</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>04889</span><pre class='pre'>		{</pre><br/><span class='lineno'>04890</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04891</span><pre title='' class='pre covered'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04892</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>04893</span><pre class='pre'>			{</pre><br/><span class='lineno'>04894</span><pre class='pre'>				// åæåãã¾ãã</pre><br/><span class='lineno'>04895</span><pre title='' class='pre covered'>				$db_id = array();</pre><br/><span class='lineno'>04896</span><pre title='' class='pre covered'>				$db_name = array();</pre><br/><span class='lineno'>04897</span><pre class='pre'></pre><br/><span class='lineno'>04898</span><pre title='' class='pre covered'>				$cnt = 0;</pre><br/><span class='lineno'>04899</span><pre class='pre'>				while ($category = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>04900</span><pre class='pre'>				{</pre><br/><span class='lineno'>04901</span><pre class='pre'>					// ã«ãã´ãªã¼IDãã«ãã´ãªã¼ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>04902</span><pre title='' class='pre covered'>					$db_id[$cnt] = array();</pre><br/><span class='lineno'>04903</span><pre title='' class='pre covered'>					$db_name[$cnt] = array();</pre><br/><span class='lineno'>04904</span><pre title='' class='pre covered'>					$db_id[$cnt][] = $category['category_id'];</pre><br/><span class='lineno'>04905</span><pre title='' class='pre covered'>					$db_name[$cnt][] = $category['category_name'];</pre><br/><span class='lineno'>04906</span><pre title='' class='pre covered'>					$cnt++;</pre><br/><span class='lineno'>04907</span><pre class='pre'>				}</pre><br/><span class='lineno'>04908</span><pre class='pre'>			}</pre><br/><span class='lineno'>04909</span><pre class='pre'>			else</pre><br/><span class='lineno'>04910</span><pre class='pre'>			{</pre><br/><span class='lineno'>04911</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04912</span><pre class='pre'>				$this-&gt;message = &quot;ãããã«ãã´ãªã¼ãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>04913</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04914</span><pre class='pre'>			}</pre><br/><span class='lineno'>04915</span><pre class='pre'>		}</pre><br/><span class='lineno'>04916</span><pre class='pre'>		else</pre><br/><span class='lineno'>04917</span><pre class='pre'>		{</pre><br/><span class='lineno'>04918</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04919</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04920</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>04921</span><pre class='pre'>			$this-&gt;message = &quot;ãããã«ãã´ãªã¼ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>04922</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04923</span><pre class='pre'>		}</pre><br/><span class='lineno'>04924</span><pre class='pre'></pre><br/><span class='lineno'>04925</span><pre class='pre'>		// ï¼ã¤ç®ã®å­ã«ãã´ãªã¼ãåå¾ãã¾ãã</pre><br/><span class='lineno'>04926</span><pre title='' class='pre covered'>		$ed = count($db_id);</pre><br/><span class='lineno'>04927</span><pre class='pre'>		for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>04928</span><pre class='pre'>		{</pre><br/><span class='lineno'>04929</span><pre class='pre'>			// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>04930</span><pre title='' class='pre covered'>			$sql = &quot;SELECT * FROM category WHERE parent_id = &quot; . $db_id[$i][0] . &quot; order by category_id&quot;;</pre><br/><span class='lineno'>04931</span><pre title='' class='pre covered'>			$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04932</span><pre class='pre'></pre><br/><span class='lineno'>04933</span><pre class='pre'>			// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>04934</span><pre title='' class='pre covered'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04935</span><pre class='pre'></pre><br/><span class='lineno'>04936</span><pre class='pre'>			// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>04937</span><pre class='pre'>			if ($result == true)</pre><br/><span class='lineno'>04938</span><pre class='pre'>			{</pre><br/><span class='lineno'>04939</span><pre class='pre'>				// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04940</span><pre title='' class='pre covered'>				$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04941</span><pre class='pre'>				if ($icount &gt;= 0)</pre><br/><span class='lineno'>04942</span><pre class='pre'>				{</pre><br/><span class='lineno'>04943</span><pre class='pre'>					while ($category = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>04944</span><pre class='pre'>					{</pre><br/><span class='lineno'>04945</span><pre class='pre'>						// ã«ãã´ãªã¼IDãã«ãã´ãªã¼ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>04946</span><pre title='' class='pre covered'>						$db_id[$i][] = $category['category_id'];</pre><br/><span class='lineno'>04947</span><pre title='' class='pre covered'>						$db_name[$i][] = $category['category_name'];</pre><br/><span class='lineno'>04948</span><pre class='pre'>					}</pre><br/><span class='lineno'>04949</span><pre class='pre'>				}</pre><br/><span class='lineno'>04950</span><pre class='pre'>				else</pre><br/><span class='lineno'>04951</span><pre class='pre'>				{</pre><br/><span class='lineno'>04952</span><pre class='pre'>					// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04953</span><pre class='pre'>					$this-&gt;message = &quot;å­ã«ãã´ãªã¼ãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;0ï¼&quot;;</pre><br/><span class='lineno'>04954</span><pre class='pre'>					throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04955</span><pre class='pre'>				}</pre><br/><span class='lineno'>04956</span><pre class='pre'>			}</pre><br/><span class='lineno'>04957</span><pre class='pre'>			else</pre><br/><span class='lineno'>04958</span><pre class='pre'>			{</pre><br/><span class='lineno'>04959</span><pre class='pre'>				// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04960</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>04961</span><pre class='pre'>				$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>04962</span><pre class='pre'>				$this-&gt;message = &quot;å­ã«ãã´ãªã¼ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>04963</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>04964</span><pre class='pre'>			}</pre><br/><span class='lineno'>04965</span><pre class='pre'>		}</pre><br/><span class='lineno'>04966</span><pre class='pre'>	}</pre><br/><span class='lineno'>04967</span><pre class='pre'></pre><br/><span class='lineno'>04968</span><pre class='pre'>	// ç»é²åºåãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>04969</span><pre class='pre'>	function get_registration_division($db_link, &amp;$db_id, &amp;$db_name)</pre><br/><span class='lineno'>04970</span><pre class='pre'>	{</pre><br/><span class='lineno'>04971</span><pre class='pre'>		// ç»é²åºåãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>04972</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>04973</span><pre title='' class='pre covered'>		$sql = &quot;SELECT * FROM registration_division order by registration_division_id&quot;;</pre><br/><span class='lineno'>04974</span><pre title='' class='pre covered'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>04975</span><pre class='pre'></pre><br/><span class='lineno'>04976</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>04977</span><pre title='' class='pre covered'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>04978</span><pre class='pre'></pre><br/><span class='lineno'>04979</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>04980</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>04981</span><pre class='pre'>		{</pre><br/><span class='lineno'>04982</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>04983</span><pre title='' class='pre covered'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>04984</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>04985</span><pre class='pre'>			{</pre><br/><span class='lineno'>04986</span><pre class='pre'>				// åæåãã¾ãã</pre><br/><span class='lineno'>04987</span><pre title='' class='pre covered'>				$db_id = array();</pre><br/><span class='lineno'>04988</span><pre title='' class='pre covered'>				$db_name = array();</pre><br/><span class='lineno'>04989</span><pre class='pre'></pre><br/><span class='lineno'>04990</span><pre class='pre'>				while ($registration_division = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>04991</span><pre class='pre'>				{</pre><br/><span class='lineno'>04992</span><pre class='pre'>					// ç»é²åºåIDãç»é²åºåãä¿å­ãã¾ãã</pre><br/><span class='lineno'>04993</span><pre title='' class='pre covered'>					$db_id[] = $registration_division['registration_division_id'];</pre><br/><span class='lineno'>04994</span><pre title='' class='pre covered'>					$db_name[] = $registration_division['registration_division_name'];</pre><br/><span class='lineno'>04995</span><pre class='pre'>				}</pre><br/><span class='lineno'>04996</span><pre class='pre'>			}</pre><br/><span class='lineno'>04997</span><pre class='pre'>			else</pre><br/><span class='lineno'>04998</span><pre class='pre'>			{</pre><br/><span class='lineno'>04999</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05000</span><pre class='pre'>				$this-&gt;message = &quot;ç»é²åºåãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>05001</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05002</span><pre class='pre'>			}</pre><br/><span class='lineno'>05003</span><pre class='pre'>		}</pre><br/><span class='lineno'>05004</span><pre class='pre'>		else</pre><br/><span class='lineno'>05005</span><pre class='pre'>		{</pre><br/><span class='lineno'>05006</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05007</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05008</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>05009</span><pre class='pre'>			$this-&gt;message = &quot;ç»é²åºåãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>05010</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05011</span><pre class='pre'>		}</pre><br/><span class='lineno'>05012</span><pre class='pre'>	}</pre><br/><span class='lineno'>05013</span><pre class='pre'></pre><br/><span class='lineno'>05014</span><pre class='pre'>	// åé¡ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05015</span><pre class='pre'>	function get_classification($db_link, &amp;$db_id, &amp;$db_name)</pre><br/><span class='lineno'>05016</span><pre class='pre'>	{</pre><br/><span class='lineno'>05017</span><pre class='pre'>		// åé¡ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05018</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>05019</span><pre title='' class='pre covered'>		$sql = &quot;SELECT * FROM classification order by classification_id&quot;;</pre><br/><span class='lineno'>05020</span><pre title='' class='pre covered'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>05021</span><pre class='pre'></pre><br/><span class='lineno'>05022</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>05023</span><pre title='' class='pre covered'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>05024</span><pre class='pre'></pre><br/><span class='lineno'>05025</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>05026</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>05027</span><pre class='pre'>		{</pre><br/><span class='lineno'>05028</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05029</span><pre title='' class='pre covered'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>05030</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>05031</span><pre class='pre'>			{</pre><br/><span class='lineno'>05032</span><pre class='pre'>				// åæåãã¾ãã</pre><br/><span class='lineno'>05033</span><pre title='' class='pre covered'>				$db_id = array();</pre><br/><span class='lineno'>05034</span><pre title='' class='pre covered'>				$db_name = array();</pre><br/><span class='lineno'>05035</span><pre class='pre'></pre><br/><span class='lineno'>05036</span><pre class='pre'>				while ($classification = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>05037</span><pre class='pre'>				{</pre><br/><span class='lineno'>05038</span><pre class='pre'>					// åé¡IDãåé¡ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>05039</span><pre title='' class='pre covered'>					$db_id[] = $classification['classification_id'];</pre><br/><span class='lineno'>05040</span><pre title='' class='pre covered'>					$db_name[] = $classification['classification_name'];</pre><br/><span class='lineno'>05041</span><pre class='pre'>				}</pre><br/><span class='lineno'>05042</span><pre class='pre'>			}</pre><br/><span class='lineno'>05043</span><pre class='pre'>			else</pre><br/><span class='lineno'>05044</span><pre class='pre'>			{</pre><br/><span class='lineno'>05045</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05046</span><pre class='pre'>				$this-&gt;message = &quot;åé¡ãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>05047</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05048</span><pre class='pre'>			}</pre><br/><span class='lineno'>05049</span><pre class='pre'>		}</pre><br/><span class='lineno'>05050</span><pre class='pre'>		else</pre><br/><span class='lineno'>05051</span><pre class='pre'>		{</pre><br/><span class='lineno'>05052</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05053</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05054</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>05055</span><pre class='pre'>			$this-&gt;message = &quot;åé¡ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>05056</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05057</span><pre class='pre'>		}</pre><br/><span class='lineno'>05058</span><pre class='pre'>	}</pre><br/><span class='lineno'>05059</span><pre class='pre'></pre><br/><span class='lineno'>05060</span><pre class='pre'>	// æ¹é¢ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05061</span><pre class='pre'>	//   $select_id = ï¼æ¬¡éå</pre><br/><span class='lineno'>05062</span><pre class='pre'>	//   $db_id,$db_name = ï¼æ¬¡éå</pre><br/><span class='lineno'>05063</span><pre class='pre'>	function get_direction($db_link, &amp;$db_id, &amp;$db_name, $select_id)</pre><br/><span class='lineno'>05064</span><pre class='pre'>	{</pre><br/><span class='lineno'>05065</span><pre class='pre'>		// æ¡ä»¶ãå¥ã£ã¦ããªãå ´åã¯ããã®ã¾ã¾æ»ãã¾ãã</pre><br/><span class='lineno'>05066</span><pre class='pre'>		if (empty($select_id) || $select_id == &quot;-1&quot;)</pre><br/><span class='lineno'>05067</span><pre class='pre'>		{</pre><br/><span class='lineno'>05068</span><pre class='pre'>			return;</pre><br/><span class='lineno'>05069</span><pre class='pre'>		}</pre><br/><span class='lineno'>05070</span><pre class='pre'></pre><br/><span class='lineno'>05071</span><pre class='pre'>		// æ¡ä»¶ãéåãã©ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>05072</span><pre title='' class='pre covered'>		$where_id = array();</pre><br/><span class='lineno'>05073</span><pre class='pre'>		if (is_array($select_id))</pre><br/><span class='lineno'>05074</span><pre class='pre'>		{</pre><br/><span class='lineno'>05075</span><pre class='pre'>			// éåã®å ´åã¯ããã®ã¾ã¾æ¡ä»¶ã¨ãã¾ãã</pre><br/><span class='lineno'>05076</span><pre title='' class='pre covered'>			$where_id = $select_id;</pre><br/><span class='lineno'>05077</span><pre class='pre'>		}</pre><br/><span class='lineno'>05078</span><pre class='pre'>		else</pre><br/><span class='lineno'>05079</span><pre class='pre'>		{</pre><br/><span class='lineno'>05080</span><pre class='pre'>			// éåã§ãªãå ´åã¯ãéåã«å¥ãæ¿ãã¦æ¡ä»¶ã¨ãã¾ãã</pre><br/><span class='lineno'>05081</span><pre class='pre'>			$where_id[] = $select_id;</pre><br/><span class='lineno'>05082</span><pre class='pre'>		}</pre><br/><span class='lineno'>05083</span><pre class='pre'></pre><br/><span class='lineno'>05084</span><pre class='pre'>		// åé¡ã«åãã¦ãæ¹é¢ãåå¾ãã¾ãã</pre><br/><span class='lineno'>05085</span><pre title='' class='pre covered'>		$ed = count($where_id);</pre><br/><span class='lineno'>05086</span><pre title='' class='pre covered'>		$db_id = array();</pre><br/><span class='lineno'>05087</span><pre title='' class='pre covered'>		$db_name = array();</pre><br/><span class='lineno'>05088</span><pre class='pre'>		for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>05089</span><pre class='pre'>		{</pre><br/><span class='lineno'>05090</span><pre title='' class='pre covered'>			$db_id[$i] = array();</pre><br/><span class='lineno'>05091</span><pre title='' class='pre covered'>			$db_name[$i] = array();</pre><br/><span class='lineno'>05092</span><pre class='pre'></pre><br/><span class='lineno'>05093</span><pre class='pre'>			// æ¹é¢æå ±ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05094</span><pre class='pre'>			// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>05095</span><pre title='' class='pre covered'>			$sql = &quot;SELECT direction_id, direction_name FROM direction WHERE classification_id = ? order by direction_id &quot;;</pre><br/><span class='lineno'>05096</span><pre title='' class='pre covered'>			$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>05097</span><pre title='' class='pre covered'>			$stmt-&gt;bindParam(1, $where_id[$i]);</pre><br/><span class='lineno'>05098</span><pre class='pre'></pre><br/><span class='lineno'>05099</span><pre class='pre'>			// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>05100</span><pre title='' class='pre covered'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>05101</span><pre class='pre'></pre><br/><span class='lineno'>05102</span><pre class='pre'>			// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>05103</span><pre class='pre'>			if ($result == true)</pre><br/><span class='lineno'>05104</span><pre class='pre'>			{</pre><br/><span class='lineno'>05105</span><pre class='pre'>				// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05106</span><pre title='' class='pre covered'>				$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>05107</span><pre class='pre'>				if ($icount &gt;= 0)</pre><br/><span class='lineno'>05108</span><pre class='pre'>				{</pre><br/><span class='lineno'>05109</span><pre class='pre'>					while ($direction = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>05110</span><pre class='pre'>					{</pre><br/><span class='lineno'>05111</span><pre class='pre'>						//  æ¹é¢IDãæ¹é¢ã³ã¼ããæ¹é¢åãä¿å­ãã¾ãã</pre><br/><span class='lineno'>05112</span><pre title='' class='pre covered'>						$db_id[$i][] = $direction['direction_id'];</pre><br/><span class='lineno'>05113</span><pre title='' class='pre covered'>						$db_name[$i][] = $direction['direction_name'];</pre><br/><span class='lineno'>05114</span><pre class='pre'>					}</pre><br/><span class='lineno'>05115</span><pre class='pre'>				}</pre><br/><span class='lineno'>05116</span><pre class='pre'>				else</pre><br/><span class='lineno'>05117</span><pre class='pre'>				{</pre><br/><span class='lineno'>05118</span><pre class='pre'>					// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05119</span><pre class='pre'>					$this-&gt;message = &quot;æ¹é¢ãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;0ï¼&quot;;</pre><br/><span class='lineno'>05120</span><pre class='pre'>					throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05121</span><pre class='pre'>				}</pre><br/><span class='lineno'>05122</span><pre class='pre'>			}</pre><br/><span class='lineno'>05123</span><pre class='pre'>			else</pre><br/><span class='lineno'>05124</span><pre class='pre'>			{</pre><br/><span class='lineno'>05125</span><pre class='pre'>				// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05126</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05127</span><pre class='pre'>				$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>05128</span><pre class='pre'>				$this-&gt;message = &quot;æ¹é¢ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>05129</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05130</span><pre class='pre'>			}</pre><br/><span class='lineno'>05131</span><pre class='pre'>		}</pre><br/><span class='lineno'>05132</span><pre class='pre'>	}</pre><br/><span class='lineno'>05133</span><pre class='pre'></pre><br/><span class='lineno'>05134</span><pre class='pre'>	// å½ã»é½éåºçãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05135</span><pre class='pre'>	//   $select_id = ï¼æ¬¡éå</pre><br/><span class='lineno'>05136</span><pre class='pre'>	//   $db_id,$db_name = ï¼æ¬¡éå</pre><br/><span class='lineno'>05137</span><pre class='pre'>	function get_country_prefecture($db_link, &amp;$db_id, &amp;$db_name, $select_id)</pre><br/><span class='lineno'>05138</span><pre class='pre'>	{</pre><br/><span class='lineno'>05139</span><pre class='pre'>		// æ¡ä»¶ãå¥ã£ã¦ããªãå ´åã¯ããã®ã¾ã¾æ»ãã¾ãã</pre><br/><span class='lineno'>05140</span><pre class='pre'>		if (empty($select_id) || $select_id == &quot;-1&quot;)</pre><br/><span class='lineno'>05141</span><pre class='pre'>		{</pre><br/><span class='lineno'>05142</span><pre class='pre'>			return;</pre><br/><span class='lineno'>05143</span><pre class='pre'>		}</pre><br/><span class='lineno'>05144</span><pre class='pre'></pre><br/><span class='lineno'>05145</span><pre class='pre'>		// æ¡ä»¶ãéåãã©ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>05146</span><pre title='' class='pre covered'>		$where_id = array();</pre><br/><span class='lineno'>05147</span><pre class='pre'>		if (is_array($select_id))</pre><br/><span class='lineno'>05148</span><pre class='pre'>		{</pre><br/><span class='lineno'>05149</span><pre class='pre'>			// éåã®å ´åã¯ããã®ã¾ã¾æ¡ä»¶ã¨ãã¾ãã</pre><br/><span class='lineno'>05150</span><pre title='' class='pre covered'>			$where_id = $select_id;</pre><br/><span class='lineno'>05151</span><pre class='pre'>		}</pre><br/><span class='lineno'>05152</span><pre class='pre'>		else</pre><br/><span class='lineno'>05153</span><pre class='pre'>		{</pre><br/><span class='lineno'>05154</span><pre class='pre'>			// éåã§ãªãå ´åã¯ãéåã«å¥ãæ¿ãã¦æ¡ä»¶ã¨ãã¾ãã</pre><br/><span class='lineno'>05155</span><pre class='pre'>			$where_id[0] = array();</pre><br/><span class='lineno'>05156</span><pre class='pre'>			$where_id[0][] = $select_id;</pre><br/><span class='lineno'>05157</span><pre class='pre'>		}</pre><br/><span class='lineno'>05158</span><pre class='pre'></pre><br/><span class='lineno'>05159</span><pre class='pre'>		// æ¹é¢æ¯ã«ãå½ã»é½éåºçãåå¾ãã¾ãã</pre><br/><span class='lineno'>05160</span><pre title='' class='pre covered'>		$ed = count($where_id);</pre><br/><span class='lineno'>05161</span><pre title='' class='pre covered'>		$db_id = array();</pre><br/><span class='lineno'>05162</span><pre title='' class='pre covered'>		$db_name = array();</pre><br/><span class='lineno'>05163</span><pre class='pre'>		for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>05164</span><pre class='pre'>		{</pre><br/><span class='lineno'>05165</span><pre title='' class='pre covered'>			$db_id[$i] = array();</pre><br/><span class='lineno'>05166</span><pre title='' class='pre covered'>			$db_name[$i] = array();</pre><br/><span class='lineno'>05167</span><pre title='' class='pre covered'>			$ed2 = count($where_id[$i]);</pre><br/><span class='lineno'>05168</span><pre class='pre'>			for ($j = 0 ; $j&lt; $ed2 ; $j++)</pre><br/><span class='lineno'>05169</span><pre class='pre'>			{</pre><br/><span class='lineno'>05170</span><pre title='' class='pre covered'>				$db_id[$i][$j] = array();</pre><br/><span class='lineno'>05171</span><pre title='' class='pre covered'>				$db_name[$i][$j] = array();</pre><br/><span class='lineno'>05172</span><pre class='pre'></pre><br/><span class='lineno'>05173</span><pre class='pre'>				// å½ã»é½éåºçæå ±ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05174</span><pre class='pre'>				// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>05175</span><pre title='' class='pre covered'>				$sql = &quot;SELECT country_prefecture_id, country_prefecture_name FROM country_prefecture WHERE direction_id = ? order by country_prefecture_id &quot;;</pre><br/><span class='lineno'>05176</span><pre title='' class='pre covered'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>05177</span><pre title='' class='pre covered'>				$stmt-&gt;bindParam(1, $where_id[$i][$j]);</pre><br/><span class='lineno'>05178</span><pre class='pre'></pre><br/><span class='lineno'>05179</span><pre class='pre'>				// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>05180</span><pre title='' class='pre covered'>				$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>05181</span><pre class='pre'></pre><br/><span class='lineno'>05182</span><pre class='pre'>				// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>05183</span><pre class='pre'>				if ($result == true)</pre><br/><span class='lineno'>05184</span><pre class='pre'>				{</pre><br/><span class='lineno'>05185</span><pre class='pre'>					// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05186</span><pre title='' class='pre covered'>					$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>05187</span><pre class='pre'>					if ($icount &gt;= 0)</pre><br/><span class='lineno'>05188</span><pre class='pre'>					{</pre><br/><span class='lineno'>05189</span><pre class='pre'>						while ($country_prefecture = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>05190</span><pre class='pre'>						{</pre><br/><span class='lineno'>05191</span><pre class='pre'>							//  å½ã»é½éåºçIDãå½ã»é½éåºçã³ã¼ããå½ã»é½éåºçåãä¿å­ãã¾ãã</pre><br/><span class='lineno'>05192</span><pre title='' class='pre covered'>							$db_id[$i][$j][] = $country_prefecture['country_prefecture_id'];</pre><br/><span class='lineno'>05193</span><pre title='' class='pre covered'>							$db_name[$i][$j][] = $country_prefecture['country_prefecture_name'];</pre><br/><span class='lineno'>05194</span><pre class='pre'>						}</pre><br/><span class='lineno'>05195</span><pre class='pre'>					}</pre><br/><span class='lineno'>05196</span><pre class='pre'>					else</pre><br/><span class='lineno'>05197</span><pre class='pre'>					{</pre><br/><span class='lineno'>05198</span><pre class='pre'>						// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05199</span><pre class='pre'>						$this-&gt;message = &quot;å½ã»é½éåºçãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;0ï¼&quot;;</pre><br/><span class='lineno'>05200</span><pre class='pre'>						throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05201</span><pre class='pre'>					}</pre><br/><span class='lineno'>05202</span><pre class='pre'>				}</pre><br/><span class='lineno'>05203</span><pre class='pre'>				else</pre><br/><span class='lineno'>05204</span><pre class='pre'>				{</pre><br/><span class='lineno'>05205</span><pre class='pre'>					// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05206</span><pre class='pre'>					// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05207</span><pre class='pre'>					$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>05208</span><pre class='pre'>					$this-&gt;message = &quot;å½ã»é½éåºçãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>05209</span><pre class='pre'>					throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05210</span><pre class='pre'>				}</pre><br/><span class='lineno'>05211</span><pre class='pre'>			}</pre><br/><span class='lineno'>05212</span><pre class='pre'>		}</pre><br/><span class='lineno'>05213</span><pre class='pre'>	}</pre><br/><span class='lineno'>05214</span><pre class='pre'></pre><br/><span class='lineno'>05215</span><pre class='pre'>	// å°åãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05216</span><pre class='pre'>	//   $select_id = ï¼æ¬¡éå</pre><br/><span class='lineno'>05217</span><pre class='pre'>	//   $db_id,$db_name = ï¼æ¬¡éå</pre><br/><span class='lineno'>05218</span><pre class='pre'>	function get_place($db_link, &amp;$db_id, &amp;$db_name, $select_id)</pre><br/><span class='lineno'>05219</span><pre class='pre'>	{</pre><br/><span class='lineno'>05220</span><pre class='pre'>		// æ¡ä»¶ãå¥ã£ã¦ããªãå ´åã¯ããã®ã¾ã¾æ»ãã¾ãã</pre><br/><span class='lineno'>05221</span><pre class='pre'>		if (empty($select_id) || $select_id == &quot;-1&quot;)</pre><br/><span class='lineno'>05222</span><pre class='pre'>		{</pre><br/><span class='lineno'>05223</span><pre class='pre'>			return;</pre><br/><span class='lineno'>05224</span><pre class='pre'>		}</pre><br/><span class='lineno'>05225</span><pre class='pre'></pre><br/><span class='lineno'>05226</span><pre class='pre'>		// æ¡ä»¶ãéåãã©ããããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>05227</span><pre title='' class='pre covered'>		$where_id = array();</pre><br/><span class='lineno'>05228</span><pre class='pre'>		if (is_array($select_id))</pre><br/><span class='lineno'>05229</span><pre class='pre'>		{</pre><br/><span class='lineno'>05230</span><pre class='pre'>			// éåã®å ´åã¯ããã®ã¾ã¾æ¡ä»¶ã¨ãã¾ãã</pre><br/><span class='lineno'>05231</span><pre title='' class='pre covered'>			$where_id = $select_id;</pre><br/><span class='lineno'>05232</span><pre class='pre'>		}</pre><br/><span class='lineno'>05233</span><pre class='pre'>		else</pre><br/><span class='lineno'>05234</span><pre class='pre'>		{</pre><br/><span class='lineno'>05235</span><pre class='pre'>			// éåã§ãªãå ´åã¯ãéåã«å¥ãæ¿ãã¦æ¡ä»¶ã¨ãã¾ãã</pre><br/><span class='lineno'>05236</span><pre class='pre'>			$where_id[0] = array();</pre><br/><span class='lineno'>05237</span><pre class='pre'>			$where_id[0][0] = array();</pre><br/><span class='lineno'>05238</span><pre class='pre'>			$where_id[0][0][] = $select_id;</pre><br/><span class='lineno'>05239</span><pre class='pre'>		}</pre><br/><span class='lineno'>05240</span><pre class='pre'></pre><br/><span class='lineno'>05241</span><pre class='pre'>		// å½ã»é½éåºçæ¯ã«ãå°åãåå¾ãã¾ãã</pre><br/><span class='lineno'>05242</span><pre title='' class='pre covered'>		$ed = count($where_id);</pre><br/><span class='lineno'>05243</span><pre title='' class='pre covered'>		$db_id = array();</pre><br/><span class='lineno'>05244</span><pre title='' class='pre covered'>		$db_name = array();</pre><br/><span class='lineno'>05245</span><pre class='pre'></pre><br/><span class='lineno'>05246</span><pre class='pre'>		for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>05247</span><pre class='pre'>		{</pre><br/><span class='lineno'>05248</span><pre title='' class='pre covered'>			$db_id[$i] = array();</pre><br/><span class='lineno'>05249</span><pre title='' class='pre covered'>			$db_name[$i] = array();</pre><br/><span class='lineno'>05250</span><pre class='pre'></pre><br/><span class='lineno'>05251</span><pre title='' class='pre covered'>			$ed2 = count($where_id[$i]);</pre><br/><span class='lineno'>05252</span><pre class='pre'>			for ($j = 0 ; $j&lt; $ed2 ; $j++)</pre><br/><span class='lineno'>05253</span><pre class='pre'>			{</pre><br/><span class='lineno'>05254</span><pre title='' class='pre covered'>				$db_id[$i][$j] = array();</pre><br/><span class='lineno'>05255</span><pre title='' class='pre covered'>				$db_name[$i][$j] = array();</pre><br/><span class='lineno'>05256</span><pre class='pre'></pre><br/><span class='lineno'>05257</span><pre title='' class='pre covered'>				$ed3 = count($where_id[$i][$j]);</pre><br/><span class='lineno'>05258</span><pre class='pre'>				for ($k = 0 ; $k&lt; $ed3 ; $k++)</pre><br/><span class='lineno'>05259</span><pre class='pre'>				{</pre><br/><span class='lineno'>05260</span><pre title='' class='pre covered'>					$db_id[$i][$j][$k] = array();</pre><br/><span class='lineno'>05261</span><pre title='' class='pre covered'>					$db_name[$i][$j][$k] = array();</pre><br/><span class='lineno'>05262</span><pre class='pre'></pre><br/><span class='lineno'>05263</span><pre class='pre'>					// å°åæå ±ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05264</span><pre class='pre'>					// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>05265</span><pre title='' class='pre covered'>					$sql = &quot;SELECT place_id, place_name FROM place WHERE country_prefecture_id = ? order by place_id &quot;;</pre><br/><span class='lineno'>05266</span><pre title='' class='pre covered'>					$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>05267</span><pre title='' class='pre covered'>					$stmt-&gt;bindParam(1, $where_id[$i][$j][$k]);</pre><br/><span class='lineno'>05268</span><pre class='pre'></pre><br/><span class='lineno'>05269</span><pre class='pre'>					// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>05270</span><pre title='' class='pre covered'>					$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>05271</span><pre class='pre'></pre><br/><span class='lineno'>05272</span><pre class='pre'>					// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>05273</span><pre class='pre'>					if ($result == true)</pre><br/><span class='lineno'>05274</span><pre class='pre'>					{</pre><br/><span class='lineno'>05275</span><pre class='pre'>						// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05276</span><pre title='' class='pre covered'>						$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>05277</span><pre class='pre'>						if ($icount &gt;= 0)</pre><br/><span class='lineno'>05278</span><pre class='pre'>						{</pre><br/><span class='lineno'>05279</span><pre class='pre'>							while ($place = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>05280</span><pre class='pre'>							{</pre><br/><span class='lineno'>05281</span><pre class='pre'>								//  å°åIDãå°åã³ã¼ããå°ååãä¿å­ãã¾ãã</pre><br/><span class='lineno'>05282</span><pre title='' class='pre covered'>								$db_id[$i][$j][$k][] = $place['place_id'];</pre><br/><span class='lineno'>05283</span><pre title='' class='pre covered'>								$db_name[$i][$j][$k][] = $place['place_name'];</pre><br/><span class='lineno'>05284</span><pre class='pre'>							}</pre><br/><span class='lineno'>05285</span><pre class='pre'>						}</pre><br/><span class='lineno'>05286</span><pre class='pre'>						else</pre><br/><span class='lineno'>05287</span><pre class='pre'>						{</pre><br/><span class='lineno'>05288</span><pre class='pre'>							// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05289</span><pre class='pre'>							$this-&gt;message = &quot;å°åãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;0ï¼&quot;;</pre><br/><span class='lineno'>05290</span><pre class='pre'>							throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05291</span><pre class='pre'>						}</pre><br/><span class='lineno'>05292</span><pre class='pre'>					}</pre><br/><span class='lineno'>05293</span><pre class='pre'>					else</pre><br/><span class='lineno'>05294</span><pre class='pre'>					{</pre><br/><span class='lineno'>05295</span><pre class='pre'>						// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05296</span><pre class='pre'>						// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05297</span><pre class='pre'>						$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>05298</span><pre class='pre'>						$this-&gt;message = &quot;å°åãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>05299</span><pre class='pre'>						throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05300</span><pre class='pre'>					}</pre><br/><span class='lineno'>05301</span><pre class='pre'>				}</pre><br/><span class='lineno'>05302</span><pre class='pre'>			}</pre><br/><span class='lineno'>05303</span><pre class='pre'>		}</pre><br/><span class='lineno'>05304</span><pre class='pre'>	}</pre><br/><span class='lineno'>05305</span><pre class='pre'></pre><br/><span class='lineno'>05306</span><pre class='pre'>	//yupengbo modify 2011/12/12 start</pre><br/><span class='lineno'>05307</span><pre class='pre'>	// ã­ã¼ã¯ã¼ããDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05308</span><pre class='pre'>	function get_keyword($db_link, &amp;$db_id, &amp;$db_name, $photo_id=&quot;&quot;)</pre><br/><span class='lineno'>05309</span><pre class='pre'>	//yupengbo modify 2011/12/12 end</pre><br/><span class='lineno'>05310</span><pre class='pre'>	{</pre><br/><span class='lineno'>05311</span><pre class='pre'>		// ã­ã¼ã¯ã¼ãæå ±ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05312</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>05313</span><pre class='pre'>		$sql = &quot;SELECT * FROM keyword&quot;;</pre><br/><span class='lineno'>05314</span><pre class='pre'>		//yupengbo modify 2011/12/12 start</pre><br/><span class='lineno'>05315</span><pre class='pre'>		if(!empty($photo_id))</pre><br/><span class='lineno'>05316</span><pre class='pre'>		{</pre><br/><span class='lineno'>05317</span><pre class='pre'>			$sql .= &quot; WHERE photo_id = &quot;.$photo_id;</pre><br/><span class='lineno'>05318</span><pre class='pre'>		}</pre><br/><span class='lineno'>05319</span><pre class='pre'>		$sql .= &quot; order by keyword_id&quot;;</pre><br/><span class='lineno'>05320</span><pre class='pre'>		//yupengbo modify 2011/12/12 end</pre><br/><span class='lineno'>05321</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>05322</span><pre class='pre'></pre><br/><span class='lineno'>05323</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>05324</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>05325</span><pre class='pre'></pre><br/><span class='lineno'>05326</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>05327</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>05328</span><pre class='pre'>		{</pre><br/><span class='lineno'>05329</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05330</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>05331</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>05332</span><pre class='pre'>			{</pre><br/><span class='lineno'>05333</span><pre class='pre'>				// ã­ã¼ã¯ã¼ãIDãã­ã¼ã¯ã¼ããåæåãã¾ãã</pre><br/><span class='lineno'>05334</span><pre class='pre'>				$db_id = array();</pre><br/><span class='lineno'>05335</span><pre class='pre'>				$db_name = array();</pre><br/><span class='lineno'>05336</span><pre class='pre'>				while ($keyword = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>05337</span><pre class='pre'>				{</pre><br/><span class='lineno'>05338</span><pre class='pre'>					// ã­ã¼ã¯ã¼ãIDãã­ã¼ã¯ã¼ããä¿å­ãã¾ãã</pre><br/><span class='lineno'>05339</span><pre class='pre'>					$db_id[] = $keyword['keyword_id'];</pre><br/><span class='lineno'>05340</span><pre class='pre'>					$db_name[] = $keyword['keyword_name'];</pre><br/><span class='lineno'>05341</span><pre class='pre'>				}</pre><br/><span class='lineno'>05342</span><pre class='pre'>			}</pre><br/><span class='lineno'>05343</span><pre class='pre'>			else</pre><br/><span class='lineno'>05344</span><pre class='pre'>			{</pre><br/><span class='lineno'>05345</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05346</span><pre class='pre'>				$this-&gt;message = &quot;ã­ã¼ã¯ã¼ããåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>05347</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05348</span><pre class='pre'>			}</pre><br/><span class='lineno'>05349</span><pre class='pre'>		}</pre><br/><span class='lineno'>05350</span><pre class='pre'>		else</pre><br/><span class='lineno'>05351</span><pre class='pre'>		{</pre><br/><span class='lineno'>05352</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05353</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05354</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>05355</span><pre class='pre'>			$this-&gt;message = &quot;ã­ã¼ã¯ã¼ããåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>05356</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05357</span><pre class='pre'>		}</pre><br/><span class='lineno'>05358</span><pre class='pre'>	}</pre><br/><span class='lineno'>05359</span><pre class='pre'></pre><br/><span class='lineno'>05360</span><pre class='pre'></pre><br/><span class='lineno'>05361</span><pre class='pre'>	function get_take_picture_time($db_link, &amp;$db_id, &amp;$db_name)</pre><br/><span class='lineno'>05362</span><pre class='pre'>	{</pre><br/><span class='lineno'>05363</span><pre class='pre'>//		echo &quot;&lt;br /&gt;get_take_picture_time&quot;;</pre><br/><span class='lineno'>05364</span><pre class='pre'></pre><br/><span class='lineno'>05365</span><pre class='pre'>		// æ®å½±æææå ±ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05366</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>05367</span><pre title='' class='pre covered'>		$sql = &quot;SELECT * FROM take_picture_time order by take_picture_time_id&quot;;</pre><br/><span class='lineno'>05368</span><pre title='' class='pre covered'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>05369</span><pre class='pre'></pre><br/><span class='lineno'>05370</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>05371</span><pre title='' class='pre covered'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>05372</span><pre class='pre'>//		echo &quot;&lt;br /&gt;SQL Exc&quot;;</pre><br/><span class='lineno'>05373</span><pre class='pre'></pre><br/><span class='lineno'>05374</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>05375</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>05376</span><pre class='pre'>		{</pre><br/><span class='lineno'>05377</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05378</span><pre title='' class='pre covered'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>05379</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>05380</span><pre class='pre'>			{</pre><br/><span class='lineno'>05381</span><pre class='pre'>				// æ®å½±ææIDãæ®å½±ææãåæåãã¾ãã</pre><br/><span class='lineno'>05382</span><pre title='' class='pre covered'>				$db_id = array();</pre><br/><span class='lineno'>05383</span><pre title='' class='pre covered'>				$db_name = array();</pre><br/><span class='lineno'>05384</span><pre class='pre'>				while ($take_picture_time = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>05385</span><pre class='pre'>				{</pre><br/><span class='lineno'>05386</span><pre class='pre'>					// æ®å½±ææIDãæ®å½±ææãä¿å­ãã¾ãã</pre><br/><span class='lineno'>05387</span><pre title='' class='pre covered'>					$db_id[] = $take_picture_time['take_picture_time_id'];</pre><br/><span class='lineno'>05388</span><pre title='' class='pre covered'>					$db_name[] = $take_picture_time['take_picture_time_name'];</pre><br/><span class='lineno'>05389</span><pre class='pre'>				}</pre><br/><span class='lineno'>05390</span><pre class='pre'>			}</pre><br/><span class='lineno'>05391</span><pre class='pre'>			else</pre><br/><span class='lineno'>05392</span><pre class='pre'>			{</pre><br/><span class='lineno'>05393</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05394</span><pre class='pre'>				$this-&gt;message = &quot;æ®å½±ææãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>05395</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05396</span><pre class='pre'>			}</pre><br/><span class='lineno'>05397</span><pre class='pre'>		}</pre><br/><span class='lineno'>05398</span><pre class='pre'>		else</pre><br/><span class='lineno'>05399</span><pre class='pre'>		{</pre><br/><span class='lineno'>05400</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05401</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05402</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>05403</span><pre class='pre'>			$this-&gt;message = &quot;æ®å½±ææãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>05404</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05405</span><pre class='pre'>		}</pre><br/><span class='lineno'>05406</span><pre class='pre'>//		echo &quot;&lt;br /&gt;get_take_picture_time END&quot;;</pre><br/><span class='lineno'>05407</span><pre class='pre'>	}</pre><br/><span class='lineno'>05408</span><pre class='pre'></pre><br/><span class='lineno'>05409</span><pre class='pre'>	function get_take_picture_time2($db_link, &amp;$db_id, &amp;$db_name)</pre><br/><span class='lineno'>05410</span><pre class='pre'>	{</pre><br/><span class='lineno'>05411</span><pre class='pre'>		// æ®å½±ææ(2)ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05412</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>05413</span><pre title='' class='pre covered'>		$sql = &quot;SELECT * FROM take_picture_time2 order by take_picture_time2_id&quot;;</pre><br/><span class='lineno'>05414</span><pre title='' class='pre covered'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>05415</span><pre class='pre'></pre><br/><span class='lineno'>05416</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>05417</span><pre title='' class='pre covered'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>05418</span><pre class='pre'></pre><br/><span class='lineno'>05419</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>05420</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>05421</span><pre class='pre'>		{</pre><br/><span class='lineno'>05422</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05423</span><pre title='' class='pre covered'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>05424</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>05425</span><pre class='pre'>			{</pre><br/><span class='lineno'>05426</span><pre class='pre'>				// æ®å½±ææIDãæ®å½±ææãåæåãã¾ãã</pre><br/><span class='lineno'>05427</span><pre title='' class='pre covered'>				$db_id = array();</pre><br/><span class='lineno'>05428</span><pre title='' class='pre covered'>				$db_name = array();</pre><br/><span class='lineno'>05429</span><pre class='pre'>				while ($take_picture_time = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>05430</span><pre class='pre'>				{</pre><br/><span class='lineno'>05431</span><pre class='pre'>					// æ®å½±ææIDãæ®å½±ææãä¿å­ãã¾ãã</pre><br/><span class='lineno'>05432</span><pre title='' class='pre covered'>					$db_id[] = $take_picture_time['take_picture_time2_id'];</pre><br/><span class='lineno'>05433</span><pre title='' class='pre covered'>					$db_name[] = $take_picture_time['take_picture_time2_name'];</pre><br/><span class='lineno'>05434</span><pre class='pre'>				}</pre><br/><span class='lineno'>05435</span><pre class='pre'>			}</pre><br/><span class='lineno'>05436</span><pre class='pre'>			else</pre><br/><span class='lineno'>05437</span><pre class='pre'>			{</pre><br/><span class='lineno'>05438</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05439</span><pre class='pre'>				$this-&gt;message = &quot;æ®å½±ææ(2)ãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>05440</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05441</span><pre class='pre'>			}</pre><br/><span class='lineno'>05442</span><pre class='pre'>		}</pre><br/><span class='lineno'>05443</span><pre class='pre'>		else</pre><br/><span class='lineno'>05444</span><pre class='pre'>		{</pre><br/><span class='lineno'>05445</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05446</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05447</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>05448</span><pre class='pre'>			$this-&gt;message = &quot;æ®å½±ææ(2)ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>05449</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05450</span><pre class='pre'>		}</pre><br/><span class='lineno'>05451</span><pre class='pre'>	}</pre><br/><span class='lineno'>05452</span><pre class='pre'></pre><br/><span class='lineno'>05453</span><pre class='pre'>	function get_borrowing_ahead($db_link, &amp;$db_id, &amp;$db_name)</pre><br/><span class='lineno'>05454</span><pre class='pre'>	{</pre><br/><span class='lineno'>05455</span><pre class='pre'>		// åçå¥æåæå ±ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05456</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>05457</span><pre title='' class='pre covered'>		$sql = &quot;SELECT * FROM borrowing_ahead order by borrowing_ahead_id&quot;;</pre><br/><span class='lineno'>05458</span><pre title='' class='pre covered'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>05459</span><pre class='pre'></pre><br/><span class='lineno'>05460</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>05461</span><pre title='' class='pre covered'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>05462</span><pre class='pre'></pre><br/><span class='lineno'>05463</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>05464</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>05465</span><pre class='pre'>		{</pre><br/><span class='lineno'>05466</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05467</span><pre title='' class='pre covered'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>05468</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>05469</span><pre class='pre'>			{</pre><br/><span class='lineno'>05470</span><pre class='pre'>				// åçå¥æåIDãåçå¥æåãåæåãã¾ãã</pre><br/><span class='lineno'>05471</span><pre title='' class='pre covered'>				$db_id = array();</pre><br/><span class='lineno'>05472</span><pre title='' class='pre covered'>				$db_name = array();</pre><br/><span class='lineno'>05473</span><pre class='pre'>				while ($borrowing_ahead = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>05474</span><pre class='pre'>				{</pre><br/><span class='lineno'>05475</span><pre class='pre'>					// åçå¥æåIDãåçå¥æåãä¿å­ãã¾ãã</pre><br/><span class='lineno'>05476</span><pre title='' class='pre covered'>					$db_id[] = $borrowing_ahead['borrowing_ahead_id'];</pre><br/><span class='lineno'>05477</span><pre title='' class='pre covered'>					$db_name[] = $borrowing_ahead['borrowing_ahead_name'];</pre><br/><span class='lineno'>05478</span><pre class='pre'>				}</pre><br/><span class='lineno'>05479</span><pre class='pre'>			}</pre><br/><span class='lineno'>05480</span><pre class='pre'>			else</pre><br/><span class='lineno'>05481</span><pre class='pre'>			{</pre><br/><span class='lineno'>05482</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05483</span><pre class='pre'>				$this-&gt;messag = &quot;åçå¥æåãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>05484</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05485</span><pre class='pre'>			}</pre><br/><span class='lineno'>05486</span><pre class='pre'>		}</pre><br/><span class='lineno'>05487</span><pre class='pre'>		else</pre><br/><span class='lineno'>05488</span><pre class='pre'>		{</pre><br/><span class='lineno'>05489</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05490</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05491</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>05492</span><pre class='pre'>			$this-&gt;messag = &quot;åçå¥æåãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>05493</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05494</span><pre class='pre'>		}</pre><br/><span class='lineno'>05495</span><pre class='pre'>	}</pre><br/><span class='lineno'>05496</span><pre class='pre'></pre><br/><span class='lineno'>05497</span><pre class='pre'>	function get_range_of_use($db_link, &amp;$db_id, &amp;$db_name)</pre><br/><span class='lineno'>05498</span><pre class='pre'>	{</pre><br/><span class='lineno'>05499</span><pre class='pre'>		// ä½¿ç¨ç¯å²æå ±ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>05500</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>05501</span><pre title='' class='pre covered'>		$sql = &quot;SELECT * FROM range_of_use order by range_of_use_id&quot;;</pre><br/><span class='lineno'>05502</span><pre title='' class='pre covered'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>05503</span><pre class='pre'></pre><br/><span class='lineno'>05504</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>05505</span><pre title='' class='pre covered'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>05506</span><pre class='pre'></pre><br/><span class='lineno'>05507</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>05508</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>05509</span><pre class='pre'>		{</pre><br/><span class='lineno'>05510</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05511</span><pre title='' class='pre covered'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>05512</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>05513</span><pre class='pre'>			{</pre><br/><span class='lineno'>05514</span><pre class='pre'>				// ä½¿ç¨ç¯å²IDãä½¿ç¨ç¯å²ãåæåãã¾ãã</pre><br/><span class='lineno'>05515</span><pre title='' class='pre covered'>				$db_id = array();</pre><br/><span class='lineno'>05516</span><pre title='' class='pre covered'>				$db_name = array();</pre><br/><span class='lineno'>05517</span><pre class='pre'>				while ($range_of_use = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>05518</span><pre class='pre'>				{</pre><br/><span class='lineno'>05519</span><pre class='pre'>					// ä½¿ç¨ç¯å²IDãä½¿ç¨ç¯å²ãä¿å­ãã¾ãã</pre><br/><span class='lineno'>05520</span><pre title='' class='pre covered'>					$db_id[] = $range_of_use['range_of_use_id'];</pre><br/><span class='lineno'>05521</span><pre title='' class='pre covered'>					$db_name[] = $range_of_use['range_of_use_name'];</pre><br/><span class='lineno'>05522</span><pre class='pre'>				}</pre><br/><span class='lineno'>05523</span><pre class='pre'>			}</pre><br/><span class='lineno'>05524</span><pre class='pre'>			else</pre><br/><span class='lineno'>05525</span><pre class='pre'>			{</pre><br/><span class='lineno'>05526</span><pre class='pre'>				// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05527</span><pre class='pre'>				$this-&gt;message = &quot;ä½¿ç¨ç¯å²ãåå¾ã§ãã¾ããã§ãããï¼åå¾æ°&lt;=0ï¼&quot;;</pre><br/><span class='lineno'>05528</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05529</span><pre class='pre'>			}</pre><br/><span class='lineno'>05530</span><pre class='pre'>		}</pre><br/><span class='lineno'>05531</span><pre class='pre'>		else</pre><br/><span class='lineno'>05532</span><pre class='pre'>		{</pre><br/><span class='lineno'>05533</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>05534</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>05535</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>05536</span><pre class='pre'>			$this-&gt;message = &quot;ä½¿ç¨ç¯å²ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>05537</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>05538</span><pre class='pre'>		}</pre><br/><span class='lineno'>05539</span><pre class='pre'>	}</pre><br/><span class='lineno'>05540</span><pre class='pre'>}</pre><br/><span class='lineno'>05541</span><pre class='pre'></pre><br/><span class='lineno'>05542</span><pre class='pre'>class PhotoImageDataAll extends PhotoImageData</pre><br/><span class='lineno'>05543</span><pre class='pre'>{</pre><br/><span class='lineno'>05544</span><pre class='pre'>	var $publishing_situation_name;													// æ²è¼ç¶æ³</pre><br/><span class='lineno'>05545</span><pre class='pre'>	var $registration_division_name;												// ç»é²åºå</pre><br/><span class='lineno'>05546</span><pre class='pre'>	var $take_picture_time_name;													// æ®å½±ææ(1)</pre><br/><span class='lineno'>05547</span><pre class='pre'>	var $take_picture_time2_name;													// æ®å½±ææ(2)</pre><br/><span class='lineno'>05548</span><pre class='pre'>	var $borrowing_ahead_name;														// åçå¥æå</pre><br/><span class='lineno'>05549</span><pre class='pre'>	var $range_of_use_name;															// ä½¿ç¨ç¯å²</pre><br/><span class='lineno'>05550</span><pre class='pre'></pre><br/><span class='lineno'>05551</span><pre class='pre'>	function __construct()</pre><br/><span class='lineno'>05552</span><pre class='pre'>	{</pre><br/><span class='lineno'>05553</span><pre class='pre'>		PhotoImageData::__construct();</pre><br/><span class='lineno'>05554</span><pre class='pre'>	}</pre><br/><span class='lineno'>05555</span><pre class='pre'></pre><br/><span class='lineno'>05556</span><pre class='pre'>	/**</pre><br/><span class='lineno'>05557</span><pre class='pre'>	 * åæåãã¾ãã</pre><br/><span class='lineno'>05558</span><pre class='pre'>	 */</pre><br/><span class='lineno'>05559</span><pre class='pre'>	function init_data()</pre><br/><span class='lineno'>05560</span><pre class='pre'>	{</pre><br/><span class='lineno'>05561</span><pre class='pre'>		$this-&gt;publishing_situation_name = &quot;&quot;;										// æ²è¼ç¶æ³</pre><br/><span class='lineno'>05562</span><pre class='pre'>		$this-&gt;registration_division_name = &quot;&quot;;										// ç»é²åºå</pre><br/><span class='lineno'>05563</span><pre class='pre'>		$this-&gt;take_picture_time_name = &quot;&quot;;											// æ®å½±ææ(1)</pre><br/><span class='lineno'>05564</span><pre class='pre'>		$this-&gt;take_picture_time2_name = &quot;&quot;;										// æ®å½±ææ(2)</pre><br/><span class='lineno'>05565</span><pre class='pre'>		$this-&gt;borrowing_ahead_name = &quot;&quot;;											// åçå¥æå</pre><br/><span class='lineno'>05566</span><pre class='pre'>		$this-&gt;range_of_use_name = &quot;&quot;;												// ä½¿ç¨ç¯å²</pre><br/><span class='lineno'>05567</span><pre class='pre'>	}</pre><br/><span class='lineno'>05568</span><pre class='pre'></pre><br/><span class='lineno'>05569</span><pre class='pre'>	/**</pre><br/><span class='lineno'>05570</span><pre class='pre'>	 * ãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>05571</span><pre class='pre'>	 */</pre><br/><span class='lineno'>05572</span><pre class='pre'>	function set_data($imgdata)</pre><br/><span class='lineno'>05573</span><pre class='pre'>	{</pre><br/><span class='lineno'>05574</span><pre class='pre'>		// åæåãã¾ãã</pre><br/><span class='lineno'>05575</span><pre class='pre'>		$this-&gt;init_data();</pre><br/><span class='lineno'>05576</span><pre class='pre'>		PhotoImageData::init_data();</pre><br/><span class='lineno'>05577</span><pre class='pre'></pre><br/><span class='lineno'>05578</span><pre class='pre'>		// ãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>05579</span><pre class='pre'>		$this-&gt;publishing_situation_name = $imgdata['publishing_situation_name'];	// æ²è¼ç¶æ³</pre><br/><span class='lineno'>05580</span><pre class='pre'>		$this-&gt;registration_division_name = $imgdata['registration_division_name'];	// ç»é²åºå</pre><br/><span class='lineno'>05581</span><pre class='pre'>		$this-&gt;take_picture_time_name = $imgdata['take_picture_time_name'];			// æ®å½±ææ(1)</pre><br/><span class='lineno'>05582</span><pre class='pre'>		$this-&gt;take_picture_time2_name = $imgdata['take_picture_time2_name'];		// æ®å½±ææ(2)</pre><br/><span class='lineno'>05583</span><pre class='pre'>		$this-&gt;borrowing_ahead_name = $imgdata['borrowing_ahead_name'];				// åçå¥æå</pre><br/><span class='lineno'>05584</span><pre class='pre'>		$this-&gt;range_of_use_name = $imgdata['range_of_use_name'];					// ä½¿ç¨ç¯å²</pre><br/><span class='lineno'>05585</span><pre class='pre'></pre><br/><span class='lineno'>05586</span><pre class='pre'>		PhotoImageData::set_data($imgdata);</pre><br/><span class='lineno'>05587</span><pre class='pre'>	}</pre><br/><span class='lineno'>05588</span><pre class='pre'></pre><br/><span class='lineno'>05589</span><pre class='pre'>}</pre><br/><span class='lineno'>05590</span><pre class='pre'></pre><br/><span class='lineno'>05591</span><pre class='pre'>//yupengbo add 2011/11/17 start</pre><br/><span class='lineno'>05592</span><pre class='pre'>class PhotoImageLog</pre><br/><span class='lineno'>05593</span><pre class='pre'>{</pre><br/><span class='lineno'>05594</span><pre class='pre'>	var $photo_mno;									// ç»åçªå·</pre><br/><span class='lineno'>05595</span><pre class='pre'>	var $bud_photo_no;								// BUD_PHOTOçªå·</pre><br/><span class='lineno'>05596</span><pre class='pre'>	var $photo_name;								// åçåï¼ã¿ã¤ãã«ï¼</pre><br/><span class='lineno'>05597</span><pre class='pre'>	var $photo_explanation;							// åçèª¬æ</pre><br/><span class='lineno'>05598</span><pre class='pre'>	var $dfrom;										// æ²è¼æéï¼Fromï¼</pre><br/><span class='lineno'>05599</span><pre class='pre'>	var $dto;										// æ²è¼æéï¼Toï¼</pre><br/><span class='lineno'>05600</span><pre class='pre'>	var $register_date;								// ç»é²æ¥</pre><br/><span class='lineno'>05601</span><pre class='pre'>	var $log_flag;									// ã­ã°ãã©ãã°ï¼ï¼èªåãï¼ï¼æå</pre><br/><span class='lineno'>05602</span><pre class='pre'>	var $login_account;								// ã­ã°ã¤ã³ã¦ã¼ã¶ã¼</pre><br/><span class='lineno'>05603</span><pre class='pre'>	var $login_account_name;						// ã­ã°ã¤ã³ã¦ã¼ã¶ã¼åå</pre><br/><span class='lineno'>05604</span><pre class='pre'>	var $registration_person;						// ç³è«è</pre><br/><span class='lineno'>05605</span><pre class='pre'></pre><br/><span class='lineno'>05606</span><pre class='pre'>	/**</pre><br/><span class='lineno'>05607</span><pre class='pre'>	 * ãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>05608</span><pre class='pre'>	 */</pre><br/><span class='lineno'>05609</span><pre class='pre'>	function set_data($imgdata)</pre><br/><span class='lineno'>05610</span><pre class='pre'>	{</pre><br/><span class='lineno'>05611</span><pre class='pre'>		$this-&gt;photo_mno = $imgdata['photo_mno'];						// ç»åçªå·</pre><br/><span class='lineno'>05612</span><pre class='pre'>		$this-&gt;bud_photo_no = $imgdata['bud_photo_no'];					// BUD_PHOTOçªå·</pre><br/><span class='lineno'>05613</span><pre class='pre'>		$this-&gt;photo_name = $imgdata['photo_name'];						// åçåï¼ã¿ã¤ãã«ï¼</pre><br/><span class='lineno'>05614</span><pre class='pre'>		$this-&gt;photo_explanation = $imgdata['photo_explanation'];		// åçèª¬æ</pre><br/><span class='lineno'>05615</span><pre class='pre'>		$this-&gt;dfrom = $imgdata['dfrom'];								// æ²è¼æéï¼Fromï¼</pre><br/><span class='lineno'>05616</span><pre class='pre'>		$this-&gt;dto = $imgdata['dto'];									// æ²è¼æéï¼Toï¼</pre><br/><span class='lineno'>05617</span><pre class='pre'>		$this-&gt;register_date = $imgdata['register_date'];				// ç»é²æ¥</pre><br/><span class='lineno'>05618</span><pre class='pre'>		$this-&gt;log_flag = $imgdata['log_flag'];							// ã­ã°ãã©ãã°ï¼ï¼èªåãï¼ï¼æå</pre><br/><span class='lineno'>05619</span><pre class='pre'>		$this-&gt;login_account = $imgdata['login_account'];				// ã­ã°ã¤ã³ã¦ã¼ã¶ã¼</pre><br/><span class='lineno'>05620</span><pre class='pre'>		$this-&gt;login_account_name = $imgdata['login_account_name'];		// ã­ã°ã¤ã³ã¦ã¼ã¶ã¼åå</pre><br/><span class='lineno'>05621</span><pre class='pre'>		$this-&gt;registration_person = $imgdata['registration_person'];	// ç³è«è</pre><br/><span class='lineno'>05622</span><pre class='pre'>	}</pre><br/><span class='lineno'>05623</span><pre class='pre'>}</pre><br/><span class='lineno'>05624</span><pre class='pre'>//yupengbo add 2011/11/17</pre><br/><span class='lineno'>05625</span><pre class='pre'>//jinxin add 2012/02/07 start</pre><br/><span class='lineno'>05626</span><pre class='pre'>class PhotoImageNopermit</pre><br/><span class='lineno'>05627</span><pre class='pre'>{</pre><br/><span class='lineno'>05628</span><pre class='pre'>	var $photo_mno;									// ç»åçªå·</pre><br/><span class='lineno'>05629</span><pre class='pre'>	var $bud_photo_no;								// BUD_PHOTOçªå·</pre><br/><span class='lineno'>05630</span><pre class='pre'>	var $photo_name;								// åçåï¼ã¿ã¤ãã«ï¼</pre><br/><span class='lineno'>05631</span><pre class='pre'>	var $photo_explanation;							// åçèª¬æ</pre><br/><span class='lineno'>05632</span><pre class='pre'>	var $dfrom;										// æ²è¼æéï¼Fromï¼</pre><br/><span class='lineno'>05633</span><pre class='pre'>	var $dto;										// æ²è¼æéï¼Toï¼</pre><br/><span class='lineno'>05634</span><pre class='pre'>	var $nopermit_date;								// ç»é²æ¥</pre><br/><span class='lineno'>05635</span><pre class='pre'>	var $log_flag;									// ã­ã°ãã©ãã°ï¼ï¼èªåãï¼ï¼æå</pre><br/><span class='lineno'>05636</span><pre class='pre'>	var $login_account;								// ã­ã°ã¤ã³ã¦ã¼ã¶ã¼</pre><br/><span class='lineno'>05637</span><pre class='pre'>	var $login_account_name;						// ã­ã°ã¤ã³ã¦ã¼ã¶ã¼åå</pre><br/><span class='lineno'>05638</span><pre class='pre'>	var $nopermit_personid;						// ç³è«è</pre><br/><span class='lineno'>05639</span><pre class='pre'>	var $nopermission;								// no permit reason</pre><br/><span class='lineno'>05640</span><pre class='pre'></pre><br/><span class='lineno'>05641</span><pre class='pre'>	/**</pre><br/><span class='lineno'>05642</span><pre class='pre'>	 * ãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>05643</span><pre class='pre'>	 */</pre><br/><span class='lineno'>05644</span><pre class='pre'>	function set_data($imgdata)</pre><br/><span class='lineno'>05645</span><pre class='pre'>	{</pre><br/><span class='lineno'>05646</span><pre class='pre'>		$this-&gt;photo_mno = $imgdata['photo_mno'];						// ç»åçªå·</pre><br/><span class='lineno'>05647</span><pre class='pre'>		$this-&gt;bud_photo_no = $imgdata['bud_photo_no'];					// BUD_PHOTOçªå·</pre><br/><span class='lineno'>05648</span><pre class='pre'>		$this-&gt;photo_name = $imgdata['photo_name'];						// åçåï¼ã¿ã¤ãã«ï¼</pre><br/><span class='lineno'>05649</span><pre class='pre'>		$this-&gt;photo_explanation = $imgdata['photo_explanation'];		// åçèª¬æ</pre><br/><span class='lineno'>05650</span><pre class='pre'>		$this-&gt;dfrom = $imgdata['dfrom'];								// æ²è¼æéï¼Fromï¼</pre><br/><span class='lineno'>05651</span><pre class='pre'>		$this-&gt;dto = $imgdata['dto'];									// æ²è¼æéï¼Toï¼</pre><br/><span class='lineno'>05652</span><pre class='pre'>		$this-&gt;nopermit_date = $imgdata['nopermit_date'];				// ç»é²æ¥</pre><br/><span class='lineno'>05653</span><pre class='pre'>		$this-&gt;nopermit_personid = $imgdata['nopermit_personid'];	// ç³è«è</pre><br/><span class='lineno'>05654</span><pre class='pre'>		$this-&gt;nopermission = $imgdata['nopermit_note'];  				// no permit reason</pre><br/><span class='lineno'>05655</span><pre class='pre'>	}</pre><br/><span class='lineno'>05656</span><pre class='pre'>}</pre><br/><span class='lineno'>05657</span><pre class='pre'>//jinxin add 2012/02/07 end</pre><br/><span class='lineno'>05658</span><pre class='pre'></pre><br/><span class='lineno'>05659</span><pre class='pre'>class ImageSearch</pre><br/><span class='lineno'>05660</span><pre class='pre'>{</pre><br/><span class='lineno'>05661</span><pre class='pre'>	// æ¬æ¥ãªãPrivateã«ããæ¹ãè¯ãã¨æãã¾ããå©ä¾¿æ§ãèãvarã§å®£è¨ãã¦ãã¾ãã</pre><br/><span class='lineno'>05662</span><pre class='pre'>	var $message;									// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>05663</span><pre class='pre'>	var $error;										// ã¨ã©ã¼</pre><br/><span class='lineno'>05664</span><pre class='pre'></pre><br/><span class='lineno'>05665</span><pre class='pre'>	// æ¤ç´¢æ¡ä»¶</pre><br/><span class='lineno'>05666</span><pre class='pre'>	var $sp_ext;										// æ¡å¼µå­ï¼åãã¡ã¤ã«åï¼</pre><br/><span class='lineno'>05667</span><pre class='pre'>	var $sp_photo_id;									// åçID</pre><br/><span class='lineno'>05668</span><pre class='pre'>	var $sp_photo_mno;									// åçç®¡ççªå·</pre><br/><span class='lineno'>05669</span><pre class='pre'>	var $sp_photo_name;									// åçå</pre><br/><span class='lineno'>05670</span><pre class='pre'>	var $sp_photo_explanation;							// åçèª¬æ</pre><br/><span class='lineno'>05671</span><pre class='pre'>	var $sp_keyword_str;								// ã­ã¼ã¯ã¼ãï¼ã«ã³ãåºåãï¼</pre><br/><span class='lineno'>05672</span><pre class='pre'>	var $sp_dfrom;										// æ²è¼æéï¼Fromï¼</pre><br/><span class='lineno'>05673</span><pre class='pre'>	var $sp_dto;										// æ²è¼æéï¼Toï¼</pre><br/><span class='lineno'>05674</span><pre class='pre'>	var $sp_take_picture_time_id;						// æ®å½±ææ(1)</pre><br/><span class='lineno'>05675</span><pre class='pre'>	var $sp_take_picture_time2_id;						// æ®å½±ææ(2)</pre><br/><span class='lineno'>05676</span><pre class='pre'>	var $sp_borrowing_ahead_id;							// åçå¥æå</pre><br/><span class='lineno'>05677</span><pre class='pre'>	var $sp_content_borrowing_ahead;					// åçå¥æåï¼åå®¹ï¼</pre><br/><span class='lineno'>05678</span><pre class='pre'>	var $sp_range_of_use_id;							// ä½¿ç¨ç¯å²</pre><br/><span class='lineno'>05679</span><pre class='pre'>	var $sp_additional_constraints1;					// ä»å æ¡ä»¶(1)</pre><br/><span class='lineno'>05680</span><pre class='pre'>	var $sp_additional_constraints2;					// ä»å æ¡ä»¶(2)</pre><br/><span class='lineno'>05681</span><pre class='pre'>	var $sp_note;										// åé¡</pre><br/><span class='lineno'>05682</span><pre class='pre'>	var $sp_copyright_owner;							// çæ¨©ææè</pre><br/><span class='lineno'>05683</span><pre class='pre'>	var $sp_publishing_situation_id;					// æ²è¼ç¶æ³</pre><br/><span class='lineno'>05684</span><pre class='pre'>	var $sp_register_date;								// ç»é²æ¥</pre><br/><span class='lineno'>05685</span><pre class='pre'>	var $sp_state;										// ç¶æ</pre><br/><span class='lineno'>05686</span><pre class='pre'>	var $sp_kikan;										// æé</pre><br/><span class='lineno'>05687</span><pre class='pre'>	var $sp_photo_id_str;								// åçIDï¼ã«ã³ãåºåãï¼</pre><br/><span class='lineno'>05688</span><pre class='pre'>	var $sp_source_image_no;							// åç»åID</pre><br/><span class='lineno'>05689</span><pre class='pre'>	var $sp_bud_photo_no;								// BUD çªå·</pre><br/><span class='lineno'>05690</span><pre class='pre'>	var $sp_registration_person;						// ç»é²ç³è«è</pre><br/><span class='lineno'>05691</span><pre class='pre'>	var $sp_permission_person;							// ç»é²è¨±å¯è</pre><br/><span class='lineno'>05692</span><pre class='pre'>	var $sp_customer_info;								// ãå®¢æ§æå ±</pre><br/><span class='lineno'>05693</span><pre class='pre'>	var $sp_classification_id;							// æµ·å¤ãå½åãã¤ã¡ã¼ã¸</pre><br/><span class='lineno'>05694</span><pre class='pre'>	var $sp_direction_id;								// æ¹é¢</pre><br/><span class='lineno'>05695</span><pre class='pre'>	var $sp_country_prefecture_id;						// å½ã»é½éåºç</pre><br/><span class='lineno'>05696</span><pre class='pre'>	var $sp_place_id;									// å°å</pre><br/><span class='lineno'>05697</span><pre class='pre'>	var $sp_monopoly_use;								// ç¬å ä½¿ç¨</pre><br/><span class='lineno'>05698</span><pre class='pre'>	var $sp_login_id;                                    // å½åç»å½ç¨æ·</pre><br/><span class='lineno'>05699</span><pre class='pre'>	var $sp_nopermission_reason;						//no permission reason add by jinxin 2012/02/10</pre><br/><span class='lineno'>05700</span><pre class='pre'></pre><br/><span class='lineno'>05701</span><pre class='pre'>	var $images;										// ã¤ã¡ã¼ã¸ã®ã¤ã³ã¹ã¿ã³ã¹ä¿å­ç¨ï¼éåï¼</pre><br/><span class='lineno'>05702</span><pre class='pre'>	var $imagescount;									// 	ã¤ã¡ã¼ã¸ç·æ°</pre><br/><span class='lineno'>05703</span><pre class='pre'></pre><br/><span class='lineno'>05704</span><pre class='pre'>	var $istart;										// ã¤ã³ããã¯ã¹</pre><br/><span class='lineno'>05705</span><pre class='pre'>	var $iend;											// ã¤ã³ããã¯ã¹</pre><br/><span class='lineno'>05706</span><pre class='pre'></pre><br/><span class='lineno'>05707</span><pre class='pre'>	function __construct()</pre><br/><span class='lineno'>05708</span><pre class='pre'>	{</pre><br/><span class='lineno'>05709</span><pre class='pre'>		// æ¡ä»¶ãåæåãã¾ãã</pre><br/><span class='lineno'>05710</span><pre class='pre'>		$this-&gt;init_condition();</pre><br/><span class='lineno'>05711</span><pre class='pre'>	}</pre><br/><span class='lineno'>05712</span><pre class='pre'></pre><br/><span class='lineno'>05713</span><pre class='pre'>	function init_condition()</pre><br/><span class='lineno'>05714</span><pre class='pre'>	{</pre><br/><span class='lineno'>05715</span><pre class='pre'>		// æ¤ç´¢æ¡ä»¶ãåæåãã¾ãã</pre><br/><span class='lineno'>05716</span><pre class='pre'>		$this-&gt;sp_ext = &quot;&quot;;									// æ¡å¼µå­ï¼åãã¡ã¤ã«åï¼</pre><br/><span class='lineno'>05717</span><pre class='pre'>		$this-&gt;sp_photo_id = -1;							// åçID</pre><br/><span class='lineno'>05718</span><pre class='pre'>		$this-&gt;sp_photo_mno = &quot;&quot;;							// åçç®¡ççªå·</pre><br/><span class='lineno'>05719</span><pre class='pre'>		$this-&gt;sp_photo_name = &quot;&quot;;							// åçå</pre><br/><span class='lineno'>05720</span><pre class='pre'>		$this-&gt;sp_photo_explanation = &quot;&quot;;					// åçèª¬æ</pre><br/><span class='lineno'>05721</span><pre class='pre'>		$this-&gt;sp_keyword_str = &quot;&quot;;							// ã­ã¼ã¯ã¼ãï¼ã«ã³ãåºåãï¼</pre><br/><span class='lineno'>05722</span><pre class='pre'>		$this-&gt;sp_dfrom = &quot;&quot;;								// æ²è¼æéï¼Fromï¼</pre><br/><span class='lineno'>05723</span><pre class='pre'>		$this-&gt;sp_dto = &quot;&quot;;									// æ²è¼æéï¼Toï¼</pre><br/><span class='lineno'>05724</span><pre class='pre'>		//$this-&gt;sp_take_picture_time_id = -1;				// æ®å½±ææ(1)</pre><br/><span class='lineno'>05725</span><pre class='pre'>		//$this-&gt;sp_take_picture_time2_id = -1;				// æ®å½±ææ(2)</pre><br/><span class='lineno'>05726</span><pre class='pre'>		$this-&gt;sp_take_picture_time_id = &quot;&quot;;				// æ®å½±ææ(1)</pre><br/><span class='lineno'>05727</span><pre class='pre'>		$this-&gt;sp_take_picture_time2_id = &quot;&quot;;				// æ®å½±ææ(2)</pre><br/><span class='lineno'>05728</span><pre class='pre'>		$this-&gt;sp_borrowing_ahead_id = -1;					// åçå¥æå</pre><br/><span class='lineno'>05729</span><pre class='pre'>		$this-&gt;sp_content_borrowing_ahead = &quot;&quot;;				// åçå¥æåï¼åå®¹ï¼</pre><br/><span class='lineno'>05730</span><pre class='pre'>		//$this-&gt;sp_range_of_use_id = -1;					// ä½¿ç¨ç¯å²</pre><br/><span class='lineno'>05731</span><pre class='pre'>		$this-&gt;sp_range_of_use_id = &quot;&quot;;						// ä½¿ç¨ç¯å²</pre><br/><span class='lineno'>05732</span><pre class='pre'>		$this-&gt;sp_additional_constraints1 = &quot;&quot;;				// ä»å æ¡ä»¶(1)</pre><br/><span class='lineno'>05733</span><pre class='pre'>		$this-&gt;sp_additional_constraints2 = &quot;&quot;;				// ä»å æ¡ä»¶(2)</pre><br/><span class='lineno'>05734</span><pre class='pre'>		$this-&gt;sp_note = &quot;&quot;;								// åè</pre><br/><span class='lineno'>05735</span><pre class='pre'>		$this-&gt;sp_copyright_owner = &quot;&quot;;						// çæ¨©ææè</pre><br/><span class='lineno'>05736</span><pre class='pre'>		$this-&gt;sp_publishing_situation_id = -1;				// æ²è¼ç¶æ³</pre><br/><span class='lineno'>05737</span><pre class='pre'>		$this-&gt;sp_nopermission_reason = &quot;&quot;;				//add by jinxin 2012/02/10</pre><br/><span class='lineno'>05738</span><pre class='pre'>		$this-&gt;sp_register_date = &quot;0000-00-00 00:00:00&quot;;	// ç»é²æ¥</pre><br/><span class='lineno'>05739</span><pre class='pre'>		$this-&gt;sp_state = 0;								// ç¶æ</pre><br/><span class='lineno'>05740</span><pre class='pre'>		$this-&gt;sp_kikan = &quot;&quot;;								// æé</pre><br/><span class='lineno'>05741</span><pre class='pre'>		$this-&gt;sp_photo_id_str = &quot;&quot;;						// åçIDï¼ã«ã³ãåºåãï¼</pre><br/><span class='lineno'>05742</span><pre class='pre'>		$sp_source_image_no = &quot;&quot;;							// åç»åID</pre><br/><span class='lineno'>05743</span><pre class='pre'>		$sp_bud_photo_no = &quot;&quot;;								// BUD çªå·</pre><br/><span class='lineno'>05744</span><pre class='pre'>		$sp_registration_person = &quot;&quot;;						// ç»é²ç³è«è</pre><br/><span class='lineno'>05745</span><pre class='pre'>		$sp_permission_person = &quot;&quot;;							// ç»é²è¨±å¯è</pre><br/><span class='lineno'>05746</span><pre class='pre'>		$sp_customer_info = &quot;&quot;;								// ãå®¢æ§æå ±</pre><br/><span class='lineno'>05747</span><pre class='pre'>		$sp_classification_id = &quot;&quot;;							// æµ·å¤ãå½åãã¤ã¡ã¼ã¸</pre><br/><span class='lineno'>05748</span><pre class='pre'>		$sp_direction_id = &quot;&quot;;								// æ¹é¢</pre><br/><span class='lineno'>05749</span><pre class='pre'>		$sp_country_prefecture_id = &quot;&quot;;						// å½ã»é½éåºç</pre><br/><span class='lineno'>05750</span><pre class='pre'>		$sp_place_id = &quot;&quot;;									// å°å</pre><br/><span class='lineno'>05751</span><pre class='pre'>		$sp_monopoly_use = &quot;&quot;;								// ç¬å ä½¿ç¨</pre><br/><span class='lineno'>05752</span><pre class='pre'>		$this-&gt;sp_login_id = &quot;&quot;;                           // å½åç»å½ç¨æ·</pre><br/><span class='lineno'>05753</span><pre class='pre'></pre><br/><span class='lineno'>05754</span><pre class='pre'>		$this-&gt;images = array();							// ã¤ã¡ã¼ã¸ã®ã¤ã³ã¹ã¿ã³ã¹ä¿å­ç¨</pre><br/><span class='lineno'>05755</span><pre class='pre'>		$this-&gt;imagescount = 0;								// ã¤ã¡ã¼ã¸ç·æ°</pre><br/><span class='lineno'>05756</span><pre class='pre'>		$this-&gt;istart = -1;									// ã¤ã³ããã¯ã¹</pre><br/><span class='lineno'>05757</span><pre class='pre'>		$this-&gt;iend = -1;									// ã¤ã³ããã¯ã¹</pre><br/><span class='lineno'>05758</span><pre class='pre'>	}</pre><br/><span class='lineno'>05759</span><pre class='pre'></pre><br/><span class='lineno'>05760</span><pre class='pre'>	function set_ext($ext)</pre><br/><span class='lineno'>05761</span><pre class='pre'>	{</pre><br/><span class='lineno'>05762</span><pre class='pre'>		if (!empty($ext))</pre><br/><span class='lineno'>05763</span><pre class='pre'>		{</pre><br/><span class='lineno'>05764</span><pre class='pre'>			$this-&gt;sp_ext = $ext;</pre><br/><span class='lineno'>05765</span><pre class='pre'>		}</pre><br/><span class='lineno'>05766</span><pre class='pre'>	}</pre><br/><span class='lineno'>05767</span><pre class='pre'></pre><br/><span class='lineno'>05768</span><pre class='pre'>	function set_photo_mno($photo_mno)</pre><br/><span class='lineno'>05769</span><pre class='pre'>	{</pre><br/><span class='lineno'>05770</span><pre class='pre'>		if (!empty($photo_mno))</pre><br/><span class='lineno'>05771</span><pre class='pre'>		{</pre><br/><span class='lineno'>05772</span><pre class='pre'>			$this-&gt;sp_photo_mno = $photo_mno;</pre><br/><span class='lineno'>05773</span><pre class='pre'>		}</pre><br/><span class='lineno'>05774</span><pre class='pre'>	}</pre><br/><span class='lineno'>05775</span><pre class='pre'></pre><br/><span class='lineno'>05776</span><pre class='pre'>	function set_photo_name($photo_name)</pre><br/><span class='lineno'>05777</span><pre class='pre'>	{</pre><br/><span class='lineno'>05778</span><pre class='pre'>		if (!empty($photo_name))</pre><br/><span class='lineno'>05779</span><pre class='pre'>		{</pre><br/><span class='lineno'>05780</span><pre class='pre'>			$this-&gt;sp_photo_name = $photo_name;</pre><br/><span class='lineno'>05781</span><pre class='pre'>		}</pre><br/><span class='lineno'>05782</span><pre class='pre'>	}</pre><br/><span class='lineno'>05783</span><pre class='pre'></pre><br/><span class='lineno'>05784</span><pre class='pre'>	function set_take_picture_time_id($take_picture_time_id)</pre><br/><span class='lineno'>05785</span><pre class='pre'>	{</pre><br/><span class='lineno'>05786</span><pre class='pre'>		//if (is_numeric($take_picture_time_id))</pre><br/><span class='lineno'>05787</span><pre class='pre'>		//{</pre><br/><span class='lineno'>05788</span><pre class='pre'>			$this-&gt;sp_take_picture_time_id = $take_picture_time_id;</pre><br/><span class='lineno'>05789</span><pre class='pre'>		//}</pre><br/><span class='lineno'>05790</span><pre class='pre'>	}</pre><br/><span class='lineno'>05791</span><pre class='pre'></pre><br/><span class='lineno'>05792</span><pre class='pre'>	function set_take_picture_time2_id($take_picture_time2_id)</pre><br/><span class='lineno'>05793</span><pre class='pre'>	{</pre><br/><span class='lineno'>05794</span><pre class='pre'>		//if (is_numeric($take_picture_time2_id))</pre><br/><span class='lineno'>05795</span><pre class='pre'>		//{</pre><br/><span class='lineno'>05796</span><pre class='pre'>			$this-&gt;sp_take_picture_time2_id = $take_picture_time2_id;</pre><br/><span class='lineno'>05797</span><pre class='pre'>		//}</pre><br/><span class='lineno'>05798</span><pre class='pre'>	}</pre><br/><span class='lineno'>05799</span><pre class='pre'></pre><br/><span class='lineno'>05800</span><pre class='pre'>	function set_borrowing_ahead_id($borrowing_ahead_id)</pre><br/><span class='lineno'>05801</span><pre class='pre'>	{</pre><br/><span class='lineno'>05802</span><pre class='pre'>		if (is_numeric($borrowing_ahead_id))</pre><br/><span class='lineno'>05803</span><pre class='pre'>		{</pre><br/><span class='lineno'>05804</span><pre class='pre'>			$this-&gt;sp_borrowing_ahead_id = $borrowing_ahead_id;</pre><br/><span class='lineno'>05805</span><pre class='pre'>		}</pre><br/><span class='lineno'>05806</span><pre class='pre'>	}</pre><br/><span class='lineno'>05807</span><pre class='pre'></pre><br/><span class='lineno'>05808</span><pre class='pre'>	function set_content_borrowing_ahead($content_borrowing_ahead)</pre><br/><span class='lineno'>05809</span><pre class='pre'>	{</pre><br/><span class='lineno'>05810</span><pre class='pre'>		if (!empty($content_borrowing_ahead))</pre><br/><span class='lineno'>05811</span><pre class='pre'>		{</pre><br/><span class='lineno'>05812</span><pre class='pre'>			$this-&gt;sp_content_borrowing_ahead = $content_borrowing_ahead;</pre><br/><span class='lineno'>05813</span><pre class='pre'>		}</pre><br/><span class='lineno'>05814</span><pre class='pre'>	}</pre><br/><span class='lineno'>05815</span><pre class='pre'></pre><br/><span class='lineno'>05816</span><pre class='pre'>	function set_range_of_use_id($range_of_use_id)</pre><br/><span class='lineno'>05817</span><pre class='pre'>	{</pre><br/><span class='lineno'>05818</span><pre class='pre'>		//if (is_numeric($range_of_use_id))</pre><br/><span class='lineno'>05819</span><pre class='pre'>		//{</pre><br/><span class='lineno'>05820</span><pre class='pre'>			$this-&gt;sp_range_of_use_id = $range_of_use_id;</pre><br/><span class='lineno'>05821</span><pre class='pre'>		//}</pre><br/><span class='lineno'>05822</span><pre class='pre'>	}</pre><br/><span class='lineno'>05823</span><pre class='pre'></pre><br/><span class='lineno'>05824</span><pre class='pre'>	function set_publishing_situation_id($publishing_situation_id)</pre><br/><span class='lineno'>05825</span><pre class='pre'>	{</pre><br/><span class='lineno'>05826</span><pre class='pre'>		//if (is_numeric($publishing_situation_id))</pre><br/><span class='lineno'>05827</span><pre class='pre'>		//{</pre><br/><span class='lineno'>05828</span><pre class='pre'>			$this-&gt;sp_publishing_situation_id = $publishing_situation_id;</pre><br/><span class='lineno'>05829</span><pre class='pre'>		//}</pre><br/><span class='lineno'>05830</span><pre class='pre'>	}</pre><br/><span class='lineno'>05831</span><pre class='pre'></pre><br/><span class='lineno'>05832</span><pre class='pre'>	function set_additional_constraints1($additional_constraints1)</pre><br/><span class='lineno'>05833</span><pre class='pre'>	{</pre><br/><span class='lineno'>05834</span><pre class='pre'>		if (!empty($additional_constraints1))</pre><br/><span class='lineno'>05835</span><pre class='pre'>		{</pre><br/><span class='lineno'>05836</span><pre class='pre'>			$this-&gt;sp_additional_constraints1 = $additional_constraints1;</pre><br/><span class='lineno'>05837</span><pre class='pre'>		}</pre><br/><span class='lineno'>05838</span><pre class='pre'>	}</pre><br/><span class='lineno'>05839</span><pre class='pre'></pre><br/><span class='lineno'>05840</span><pre class='pre'>	function set_additional_constraints2($additional_constraints2)</pre><br/><span class='lineno'>05841</span><pre class='pre'>	{</pre><br/><span class='lineno'>05842</span><pre class='pre'>		if (!empty($additional_constraints2))</pre><br/><span class='lineno'>05843</span><pre class='pre'>		{</pre><br/><span class='lineno'>05844</span><pre class='pre'>			$this-&gt;sp_additional_constraints2 = $additional_constraints2;</pre><br/><span class='lineno'>05845</span><pre class='pre'>		}</pre><br/><span class='lineno'>05846</span><pre class='pre'>	}</pre><br/><span class='lineno'>05847</span><pre class='pre'></pre><br/><span class='lineno'>05848</span><pre class='pre'>	function set_note($note)</pre><br/><span class='lineno'>05849</span><pre class='pre'>	{</pre><br/><span class='lineno'>05850</span><pre class='pre'>		if (!empty($note))</pre><br/><span class='lineno'>05851</span><pre class='pre'>		{</pre><br/><span class='lineno'>05852</span><pre class='pre'>			$this-&gt;sp_note = $note;</pre><br/><span class='lineno'>05853</span><pre class='pre'>		}</pre><br/><span class='lineno'>05854</span><pre class='pre'>	}</pre><br/><span class='lineno'>05855</span><pre class='pre'></pre><br/><span class='lineno'>05856</span><pre class='pre'>	function set_copyright_owner($copyright_owner)</pre><br/><span class='lineno'>05857</span><pre class='pre'>	{</pre><br/><span class='lineno'>05858</span><pre class='pre'>		if (!empty($copyright_owner))</pre><br/><span class='lineno'>05859</span><pre class='pre'>		{</pre><br/><span class='lineno'>05860</span><pre class='pre'>			$this-&gt;sp_copyright_owner = $copyright_owner;</pre><br/><span class='lineno'>05861</span><pre class='pre'>		}</pre><br/><span class='lineno'>05862</span><pre class='pre'>	}</pre><br/><span class='lineno'>05863</span><pre class='pre'></pre><br/><span class='lineno'>05864</span><pre class='pre'>	function set_register_date($register_date)</pre><br/><span class='lineno'>05865</span><pre class='pre'>	{</pre><br/><span class='lineno'>05866</span><pre class='pre'>		if (!empty($register_date))</pre><br/><span class='lineno'>05867</span><pre class='pre'>		{</pre><br/><span class='lineno'>05868</span><pre class='pre'>			$this-&gt;sp_register_date = $register_date;</pre><br/><span class='lineno'>05869</span><pre class='pre'>		}</pre><br/><span class='lineno'>05870</span><pre class='pre'>	}</pre><br/><span class='lineno'>05871</span><pre class='pre'></pre><br/><span class='lineno'>05872</span><pre class='pre'>	function set_viewable($viewable)</pre><br/><span class='lineno'>05873</span><pre class='pre'>	{</pre><br/><span class='lineno'>05874</span><pre class='pre'>		if ($viewable == true || $viewable == false)</pre><br/><span class='lineno'>05875</span><pre class='pre'>		{</pre><br/><span class='lineno'>05876</span><pre class='pre'>			$this-&gt;sp_viewable = $viewable;</pre><br/><span class='lineno'>05877</span><pre class='pre'>		}</pre><br/><span class='lineno'>05878</span><pre class='pre'>	}</pre><br/><span class='lineno'>05879</span><pre class='pre'></pre><br/><span class='lineno'>05880</span><pre class='pre'>	function set_dfrom($dfrom)</pre><br/><span class='lineno'>05881</span><pre class='pre'>	{</pre><br/><span class='lineno'>05882</span><pre class='pre'>		if (!empty($dfrom))</pre><br/><span class='lineno'>05883</span><pre class='pre'>		{</pre><br/><span class='lineno'>05884</span><pre class='pre'>			$this-&gt;sp_dfrom = $dfrom;</pre><br/><span class='lineno'>05885</span><pre class='pre'>		}</pre><br/><span class='lineno'>05886</span><pre class='pre'>	}</pre><br/><span class='lineno'>05887</span><pre class='pre'></pre><br/><span class='lineno'>05888</span><pre class='pre'>	function set_dto($dto)</pre><br/><span class='lineno'>05889</span><pre class='pre'>	{</pre><br/><span class='lineno'>05890</span><pre class='pre'>		if (!empty($dto))</pre><br/><span class='lineno'>05891</span><pre class='pre'>		{</pre><br/><span class='lineno'>05892</span><pre class='pre'>			$this-&gt;sp_dto = $dto;</pre><br/><span class='lineno'>05893</span><pre class='pre'>		}</pre><br/><span class='lineno'>05894</span><pre class='pre'>	}</pre><br/><span class='lineno'>05895</span><pre class='pre'></pre><br/><span class='lineno'>05896</span><pre class='pre'>	function set_keyword_str($keyword_str)</pre><br/><span class='lineno'>05897</span><pre class='pre'>	{</pre><br/><span class='lineno'>05898</span><pre class='pre'>		if (!empty($keyword_str))</pre><br/><span class='lineno'>05899</span><pre class='pre'>		{</pre><br/><span class='lineno'>05900</span><pre class='pre'>			$this-&gt;sp_keyword_str = $keyword_str;</pre><br/><span class='lineno'>05901</span><pre class='pre'>		}</pre><br/><span class='lineno'>05902</span><pre class='pre'>	}</pre><br/><span class='lineno'>05903</span><pre class='pre'></pre><br/><span class='lineno'>05904</span><pre class='pre'>	function set_photo_id_str($photo_id_str)</pre><br/><span class='lineno'>05905</span><pre class='pre'>	{</pre><br/><span class='lineno'>05906</span><pre class='pre'>		if (!empty($photo_id_str))</pre><br/><span class='lineno'>05907</span><pre class='pre'>		{</pre><br/><span class='lineno'>05908</span><pre class='pre'>			$this-&gt;sp_photo_id_str = $photo_id_str;</pre><br/><span class='lineno'>05909</span><pre class='pre'>		}</pre><br/><span class='lineno'>05910</span><pre class='pre'>	}</pre><br/><span class='lineno'>05911</span><pre class='pre'></pre><br/><span class='lineno'>05912</span><pre class='pre'>	function set_source_image_no($source_image_no)</pre><br/><span class='lineno'>05913</span><pre class='pre'>	{</pre><br/><span class='lineno'>05914</span><pre class='pre'>		if (!empty($source_image_no))</pre><br/><span class='lineno'>05915</span><pre class='pre'>		{</pre><br/><span class='lineno'>05916</span><pre class='pre'>			$this-&gt;sp_source_image_no = $source_image_no;</pre><br/><span class='lineno'>05917</span><pre class='pre'>		}</pre><br/><span class='lineno'>05918</span><pre class='pre'>	}</pre><br/><span class='lineno'>05919</span><pre class='pre'></pre><br/><span class='lineno'>05920</span><pre class='pre'>	function set_bud_photo_no($bud_photo_no)</pre><br/><span class='lineno'>05921</span><pre class='pre'>	{</pre><br/><span class='lineno'>05922</span><pre class='pre'>		if (!empty($bud_photo_no))</pre><br/><span class='lineno'>05923</span><pre class='pre'>		{</pre><br/><span class='lineno'>05924</span><pre class='pre'>			$this-&gt;sp_bud_photo_no = $bud_photo_no;</pre><br/><span class='lineno'>05925</span><pre class='pre'>		}</pre><br/><span class='lineno'>05926</span><pre class='pre'>	}</pre><br/><span class='lineno'>05927</span><pre class='pre'></pre><br/><span class='lineno'>05928</span><pre class='pre'>	function set_registration_person($registration_person)</pre><br/><span class='lineno'>05929</span><pre class='pre'>	{</pre><br/><span class='lineno'>05930</span><pre class='pre'>		if (!empty($registration_person))</pre><br/><span class='lineno'>05931</span><pre class='pre'>		{</pre><br/><span class='lineno'>05932</span><pre class='pre'>			$this-&gt;sp_registration_person = $registration_person;</pre><br/><span class='lineno'>05933</span><pre class='pre'>		}</pre><br/><span class='lineno'>05934</span><pre class='pre'>	}</pre><br/><span class='lineno'>05935</span><pre class='pre'></pre><br/><span class='lineno'>05936</span><pre class='pre'>	function set_permission_person($permission_person)</pre><br/><span class='lineno'>05937</span><pre class='pre'>	{</pre><br/><span class='lineno'>05938</span><pre class='pre'>		if (!empty($permission_person))</pre><br/><span class='lineno'>05939</span><pre class='pre'>		{</pre><br/><span class='lineno'>05940</span><pre class='pre'>			$this-&gt;sp_permission_person = $permission_person;</pre><br/><span class='lineno'>05941</span><pre class='pre'>		}</pre><br/><span class='lineno'>05942</span><pre class='pre'>	}</pre><br/><span class='lineno'>05943</span><pre class='pre'></pre><br/><span class='lineno'>05944</span><pre class='pre'>	function set_customer_info($customer_info)</pre><br/><span class='lineno'>05945</span><pre class='pre'>	{</pre><br/><span class='lineno'>05946</span><pre class='pre'>		if (!empty($customer_info))</pre><br/><span class='lineno'>05947</span><pre class='pre'>		{</pre><br/><span class='lineno'>05948</span><pre class='pre'>			$this-&gt;sp_customer_info = $customer_info;</pre><br/><span class='lineno'>05949</span><pre class='pre'>		}</pre><br/><span class='lineno'>05950</span><pre class='pre'>	}</pre><br/><span class='lineno'>05951</span><pre class='pre'></pre><br/><span class='lineno'>05952</span><pre class='pre'>	function set_classification_id($classification_id)</pre><br/><span class='lineno'>05953</span><pre class='pre'>	{</pre><br/><span class='lineno'>05954</span><pre class='pre'>		if (!empty($classification_id))</pre><br/><span class='lineno'>05955</span><pre class='pre'>		{</pre><br/><span class='lineno'>05956</span><pre class='pre'>			$this-&gt;sp_classification_id = $classification_id;</pre><br/><span class='lineno'>05957</span><pre class='pre'>		}</pre><br/><span class='lineno'>05958</span><pre class='pre'>	}</pre><br/><span class='lineno'>05959</span><pre class='pre'></pre><br/><span class='lineno'>05960</span><pre class='pre'>	function set_direction_id($direction_id)</pre><br/><span class='lineno'>05961</span><pre class='pre'>	{</pre><br/><span class='lineno'>05962</span><pre class='pre'>		if (!empty($direction_id))</pre><br/><span class='lineno'>05963</span><pre class='pre'>		{</pre><br/><span class='lineno'>05964</span><pre class='pre'>			$this-&gt;sp_direction_id = $direction_id;</pre><br/><span class='lineno'>05965</span><pre class='pre'>		}</pre><br/><span class='lineno'>05966</span><pre class='pre'>	}</pre><br/><span class='lineno'>05967</span><pre class='pre'></pre><br/><span class='lineno'>05968</span><pre class='pre'>	function set_country_prefecture_id($country_prefecture_id)</pre><br/><span class='lineno'>05969</span><pre class='pre'>	{</pre><br/><span class='lineno'>05970</span><pre class='pre'>		if (!empty($country_prefecture_id))</pre><br/><span class='lineno'>05971</span><pre class='pre'>		{</pre><br/><span class='lineno'>05972</span><pre class='pre'>			$this-&gt;sp_country_prefecture_id = $country_prefecture_id;</pre><br/><span class='lineno'>05973</span><pre class='pre'>		}</pre><br/><span class='lineno'>05974</span><pre class='pre'>	}</pre><br/><span class='lineno'>05975</span><pre class='pre'></pre><br/><span class='lineno'>05976</span><pre class='pre'>	function set_place_id($place_id)</pre><br/><span class='lineno'>05977</span><pre class='pre'>	{</pre><br/><span class='lineno'>05978</span><pre class='pre'>		if (!empty($place_id))</pre><br/><span class='lineno'>05979</span><pre class='pre'>		{</pre><br/><span class='lineno'>05980</span><pre class='pre'>			$this-&gt;sp_place_id = $place_id;</pre><br/><span class='lineno'>05981</span><pre class='pre'>		}</pre><br/><span class='lineno'>05982</span><pre class='pre'>	}</pre><br/><span class='lineno'>05983</span><pre class='pre'></pre><br/><span class='lineno'>05984</span><pre class='pre'>	function set_monopoly_use($monopoly_use)</pre><br/><span class='lineno'>05985</span><pre class='pre'>	{</pre><br/><span class='lineno'>05986</span><pre class='pre'>		if (!empty($monopoly_use))</pre><br/><span class='lineno'>05987</span><pre class='pre'>		{</pre><br/><span class='lineno'>05988</span><pre class='pre'>			$this-&gt;sp_monopoly_use = $monopoly_use;</pre><br/><span class='lineno'>05989</span><pre class='pre'>		}</pre><br/><span class='lineno'>05990</span><pre class='pre'>	}</pre><br/><span class='lineno'>05991</span><pre class='pre'></pre><br/><span class='lineno'>05992</span><pre class='pre'>	private function set_sql()</pre><br/><span class='lineno'>05993</span><pre class='pre'>	{</pre><br/><span class='lineno'>05994</span><pre class='pre'>		$sql = &quot;SELECT * FROM photoimg&quot;;</pre><br/><span class='lineno'>05995</span><pre class='pre'>		$sql .= &quot; LEFT JOIN publishing_situation on photoimg.publishing_situation_id = publishing_situation.publishing_situation_id &quot;;</pre><br/><span class='lineno'>05996</span><pre class='pre'>		$sql .= &quot; LEFT JOIN registration_division on photoimg.registration_division_id = registration_division.registration_division_id &quot;;</pre><br/><span class='lineno'>05997</span><pre class='pre'>		$sql .= &quot; LEFT JOIN take_picture_time on photoimg.take_picture_time_id = take_picture_time.take_picture_time_id &quot;;</pre><br/><span class='lineno'>05998</span><pre class='pre'>		$sql .= &quot; LEFT JOIN take_picture_time2 on photoimg.take_picture_time2_id = take_picture_time2.take_picture_time2_id &quot;;</pre><br/><span class='lineno'>05999</span><pre class='pre'>		$sql .= &quot; LEFT JOIN borrowing_ahead on photoimg.borrowing_ahead_id = borrowing_ahead.borrowing_ahead_id &quot;;</pre><br/><span class='lineno'>06000</span><pre class='pre'>		$sql .= &quot; LEFT JOIN range_of_use on photoimg.range_of_use_id = range_of_use.range_of_use_id &quot;;</pre><br/><span class='lineno'>06001</span><pre class='pre'></pre><br/><span class='lineno'>06002</span><pre class='pre'>		// Group Byãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>06003</span><pre class='pre'>		//$sql .= &quot;group by photoimg.photo_id, photoimg.photo_mno &quot;;</pre><br/><span class='lineno'>06004</span><pre class='pre'></pre><br/><span class='lineno'>06005</span><pre class='pre'>		return $sql;</pre><br/><span class='lineno'>06006</span><pre class='pre'>	}</pre><br/><span class='lineno'>06007</span><pre class='pre'></pre><br/><span class='lineno'>06008</span><pre class='pre'>	/*</pre><br/><span class='lineno'>06009</span><pre class='pre'>	 * é¢æ°åï¼select_image_keyword</pre><br/><span class='lineno'>06010</span><pre class='pre'>	 * é¢æ°èª¬æï¼ã­ã¼ã¯ã¼ããã¼ãã«ããæ¤ç´¢ãã</pre><br/><span class='lineno'>06011</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>06012</span><pre class='pre'>	 * db_link:ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>06013</span><pre class='pre'>	 * sp_str:å¥åã®æ¤ç´¢æ¡ä»¶</pre><br/><span class='lineno'>06014</span><pre class='pre'>	 * sp_str_content:é¸æã®æ¤ç´¢æ¡ä»¶ï¼è©³ç´°æ¤ç´¢ï¼</pre><br/><span class='lineno'>06015</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>06016</span><pre class='pre'>	 */</pre><br/><span class='lineno'>06017</span><pre class='pre'>	function select_image_keyword($db_link,$sp_str,$sp_str_content,$p_tmp_kikan)</pre><br/><span class='lineno'>06018</span><pre class='pre'>	{</pre><br/><span class='lineno'>06019</span><pre class='pre'>		$sql_where = &quot;&quot;;</pre><br/><span class='lineno'>06020</span><pre class='pre'>		$sql = &quot;&quot;;</pre><br/><span class='lineno'>06021</span><pre class='pre'>		$tmpsql2_1 = &quot;&quot;;</pre><br/><span class='lineno'>06022</span><pre class='pre'>		$kwd_a = array();</pre><br/><span class='lineno'>06023</span><pre class='pre'></pre><br/><span class='lineno'>06024</span><pre class='pre'>		if (!empty($sp_str))</pre><br/><span class='lineno'>06025</span><pre class='pre'>		{</pre><br/><span class='lineno'>06026</span><pre class='pre'>			// æ¤ç´¢åå®¹ã®æå­åï¼ãorãã§åºåãï¼&rarr;éåã«å¤æãã¾ãã</pre><br/><span class='lineno'>06027</span><pre class='pre'>//			$flg1 = stripos($sp_str,&quot; or &quot;);</pre><br/><span class='lineno'>06028</span><pre class='pre'>//			$flg2 = stripos($sp_str,&quot;ãor &quot;);</pre><br/><span class='lineno'>06029</span><pre class='pre'>//			$flg3 = stripos($sp_str,&quot; orã&quot;);</pre><br/><span class='lineno'>06030</span><pre class='pre'>//			$flg4 = stripos($sp_str,&quot;ãorã&quot;);</pre><br/><span class='lineno'>06031</span><pre class='pre'>//			if ($flg1 || $flg2 || $flg3 || $flg4)</pre><br/><span class='lineno'>06032</span><pre class='pre'>//			{</pre><br/><span class='lineno'>06033</span><pre class='pre'>//				// æ­£å¸¸ã®SQLæã¯ä»¥ä¸ã®ãããªSQLæã§ãã</pre><br/><span class='lineno'>06034</span><pre class='pre'>//				/*</pre><br/><span class='lineno'>06035</span><pre class='pre'>//					SELECT DISTINCT photo_id FROM keyword WHERE</pre><br/><span class='lineno'>06036</span><pre class='pre'>//					keyword_name COLLATE utf8_bin LIKE 'ï¼æ%' OR</pre><br/><span class='lineno'>06037</span><pre class='pre'>//					keyword_name COLLATE utf8_bin LIKE 'ï¼æ%'</pre><br/><span class='lineno'>06038</span><pre class='pre'>//				*/</pre><br/><span class='lineno'>06039</span><pre class='pre'>//				if ($flg1) $kwd_a = spliti(&quot; or &quot;, $sp_str);</pre><br/><span class='lineno'>06040</span><pre class='pre'>//				if ($flg2) $kwd_a = spliti(&quot;ãor &quot;, $sp_str);</pre><br/><span class='lineno'>06041</span><pre class='pre'>//				if ($flg3) $kwd_a = spliti(&quot; orã&quot;, $sp_str);</pre><br/><span class='lineno'>06042</span><pre class='pre'>//				if ($flg4) $kwd_a = spliti(&quot;ãorã&quot;, $sp_str);</pre><br/><span class='lineno'>06043</span><pre class='pre'>//				$ed = count($kwd_a);</pre><br/><span class='lineno'>06044</span><pre class='pre'>//				for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>06045</span><pre class='pre'>//				{</pre><br/><span class='lineno'>06046</span><pre class='pre'>//					if (!empty($sql_where) &amp;&amp; !empty($kwd_a[$i]))</pre><br/><span class='lineno'>06047</span><pre class='pre'>//					{</pre><br/><span class='lineno'>06048</span><pre class='pre'>//						 $sql_where.= &quot; OR &quot;;</pre><br/><span class='lineno'>06049</span><pre class='pre'>//					}</pre><br/><span class='lineno'>06050</span><pre class='pre'>//					if (!empty($kwd_a[$i]))</pre><br/><span class='lineno'>06051</span><pre class='pre'>//					{</pre><br/><span class='lineno'>06052</span><pre class='pre'>//						$sql_where.= &quot;keyword_name LIKE '%&quot;.$kwd_a[$i].&quot;%'&quot;;</pre><br/><span class='lineno'>06053</span><pre class='pre'>//					}</pre><br/><span class='lineno'>06054</span><pre class='pre'>//				}</pre><br/><span class='lineno'>06055</span><pre class='pre'>//				$sql = &quot; SELECT DISTINCT photo_id FROM keyword WHERE &quot;.$sql_where;</pre><br/><span class='lineno'>06056</span><pre class='pre'>//			} else {</pre><br/><span class='lineno'>06057</span><pre class='pre'>				// æå­åã«ã-ãããããã©ãããã§ãã¯ãã</pre><br/><span class='lineno'>06058</span><pre class='pre'>				$tmpstr = &quot;_&quot;.$sp_str;</pre><br/><span class='lineno'>06059</span><pre class='pre'>				$flg = stripos($tmpstr,&quot;\&quot;&quot;);</pre><br/><span class='lineno'>06060</span><pre class='pre'></pre><br/><span class='lineno'>06061</span><pre class='pre'>				if ($flg)</pre><br/><span class='lineno'>06062</span><pre class='pre'>				{</pre><br/><span class='lineno'>06063</span><pre class='pre'>					// æ¤ç´¢åå®¹ã®æå­åï¼ã ãã§åºåãï¼&rarr;éåã«å¤æãã¾ãã</pre><br/><span class='lineno'>06064</span><pre class='pre'>					$tmp_1 = preg_replace('/(ã)+?/',&quot; &quot;,$sp_str);</pre><br/><span class='lineno'>06065</span><pre class='pre'>					$kwd_a = explode(&quot; &quot;, $tmp_1);</pre><br/><span class='lineno'>06066</span><pre class='pre'>					$ed = count($kwd_a);</pre><br/><span class='lineno'>06067</span><pre class='pre'>					$tmp_str = &quot;&quot;;</pre><br/><span class='lineno'>06068</span><pre class='pre'>					$sql_where1 = &quot;&quot;;</pre><br/><span class='lineno'>06069</span><pre class='pre'>					// --------SQLæãæ§ç¯ããï¼éå§ï¼--------------------------------------</pre><br/><span class='lineno'>06070</span><pre class='pre'>					for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>06071</span><pre class='pre'>					{</pre><br/><span class='lineno'>06072</span><pre class='pre'>						$tmp_str = str_replace(&quot;\\&quot;,&quot;&quot;,$kwd_a[$i]);</pre><br/><span class='lineno'>06073</span><pre class='pre'>						$tmp_str = str_replace(&quot;\&quot;&quot;,&quot;&quot;,$tmp_str);</pre><br/><span class='lineno'>06074</span><pre class='pre'></pre><br/><span class='lineno'>06075</span><pre class='pre'>						if (!empty($sql_where))</pre><br/><span class='lineno'>06076</span><pre class='pre'>						{</pre><br/><span class='lineno'>06077</span><pre class='pre'>							$sql_where1 .= &quot; AND &quot;;</pre><br/><span class='lineno'>06078</span><pre class='pre'>						}</pre><br/><span class='lineno'>06079</span><pre class='pre'></pre><br/><span class='lineno'>06080</span><pre class='pre'>						$sql_where1 .= &quot;keyword_name LIKE '% &quot;.$tmp_str.&quot; %'&quot;;</pre><br/><span class='lineno'>06081</span><pre class='pre'>					}</pre><br/><span class='lineno'>06082</span><pre class='pre'></pre><br/><span class='lineno'>06083</span><pre class='pre'>					$sql = &quot; SELECT * FROM keyword WHERE &quot;.$sql_where1;</pre><br/><span class='lineno'>06084</span><pre class='pre'>					// --------SQLæãæ§ç¯ããï¼çµäºï¼--------------------------------------</pre><br/><span class='lineno'>06085</span><pre class='pre'>				} else {</pre><br/><span class='lineno'>06086</span><pre class='pre'>					// æ¤ç´¢åå®¹ã®æå­åï¼ã ãã§åºåãï¼&rarr;éåã«å¤æãã¾ãã</pre><br/><span class='lineno'>06087</span><pre class='pre'>					$tmpstr = &quot;_&quot;.$sp_str;</pre><br/><span class='lineno'>06088</span><pre class='pre'>					$flg = stripos($tmpstr,&quot;-&quot;);</pre><br/><span class='lineno'>06089</span><pre class='pre'>					if ($flg)</pre><br/><span class='lineno'>06090</span><pre class='pre'>					{</pre><br/><span class='lineno'>06091</span><pre class='pre'>						// æ¤ç´¢åå®¹ã®æå­åï¼ã ãã§åºåãï¼&rarr;éåã«å¤æãã¾ãã</pre><br/><span class='lineno'>06092</span><pre class='pre'>						$tmp_1 = preg_replace('/(ã)+?/',&quot; &quot;,$sp_str);</pre><br/><span class='lineno'>06093</span><pre class='pre'>						$kwd_a = explode(&quot; &quot;, $tmp_1);</pre><br/><span class='lineno'>06094</span><pre class='pre'>						$ed = count($kwd_a);</pre><br/><span class='lineno'>06095</span><pre class='pre'>						// --------SQLæãæ§ç¯ããï¼éå§ï¼--------------------------------------</pre><br/><span class='lineno'>06096</span><pre class='pre'></pre><br/><span class='lineno'>06097</span><pre class='pre'>						$tmpsql2_ary = array();</pre><br/><span class='lineno'>06098</span><pre class='pre'>						$tmpsql2_not_ary = array();</pre><br/><span class='lineno'>06099</span><pre class='pre'></pre><br/><span class='lineno'>06100</span><pre class='pre'>						$sql_where1 = &quot;&quot;;</pre><br/><span class='lineno'>06101</span><pre class='pre'>						for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>06102</span><pre class='pre'>						{</pre><br/><span class='lineno'>06103</span><pre class='pre'>							if (substr($kwd_a[$i],0,1) == &quot;-&quot;)</pre><br/><span class='lineno'>06104</span><pre class='pre'>							{</pre><br/><span class='lineno'>06105</span><pre class='pre'>								$tmp1 = substr($kwd_a[$i],1);</pre><br/><span class='lineno'>06106</span><pre class='pre'></pre><br/><span class='lineno'>06107</span><pre class='pre'>								if (!empty($sql_where1))</pre><br/><span class='lineno'>06108</span><pre class='pre'>								{</pre><br/><span class='lineno'>06109</span><pre class='pre'>									$sql_where1 .= &quot; AND &quot;;</pre><br/><span class='lineno'>06110</span><pre class='pre'>								}</pre><br/><span class='lineno'>06111</span><pre class='pre'>								$sql_where1 .= &quot;keyword.keyword_name NOT LIKE '%&quot;.$tmp1.&quot;%'&quot;;</pre><br/><span class='lineno'>06112</span><pre class='pre'>							} else {</pre><br/><span class='lineno'>06113</span><pre class='pre'>								if (!empty($sql_where1))</pre><br/><span class='lineno'>06114</span><pre class='pre'>								{</pre><br/><span class='lineno'>06115</span><pre class='pre'>									$sql_where1 .= &quot; AND &quot;;</pre><br/><span class='lineno'>06116</span><pre class='pre'>								}</pre><br/><span class='lineno'>06117</span><pre class='pre'>								$sql_where1 .= &quot;keyword.keyword_name LIKE '%&quot;.$kwd_a[$i].&quot;%'&quot;;</pre><br/><span class='lineno'>06118</span><pre class='pre'>							}</pre><br/><span class='lineno'>06119</span><pre class='pre'>						}</pre><br/><span class='lineno'>06120</span><pre class='pre'></pre><br/><span class='lineno'>06121</span><pre class='pre'>						if (!empty($sql_where1))</pre><br/><span class='lineno'>06122</span><pre class='pre'>						{</pre><br/><span class='lineno'>06123</span><pre class='pre'>							$sql = &quot;SELECT * FROM keyword WHERE &quot;.$sql_where1;</pre><br/><span class='lineno'>06124</span><pre class='pre'>						}</pre><br/><span class='lineno'>06125</span><pre class='pre'>					} else {</pre><br/><span class='lineno'>06126</span><pre class='pre'>						// æ¤ç´¢åå®¹ã®æå­åï¼ã ãã§åºåãï¼&rarr;éåã«å¤æãã¾ãã</pre><br/><span class='lineno'>06127</span><pre class='pre'>						$tmp_1 = preg_replace(&quot;/ã/&quot;,&quot; &quot;,$sp_str);</pre><br/><span class='lineno'>06128</span><pre class='pre'>						$kwd_a = explode(&quot; &quot;, $tmp_1);</pre><br/><span class='lineno'>06129</span><pre class='pre'>						$ed = count($kwd_a);</pre><br/><span class='lineno'>06130</span><pre class='pre'>						// --------SQLæãæ§ç¯ããï¼éå§ï¼--------------------------------------</pre><br/><span class='lineno'>06131</span><pre class='pre'>						$sql_where1 = &quot;&quot;;</pre><br/><span class='lineno'>06132</span><pre class='pre'>						for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>06133</span><pre class='pre'>						{</pre><br/><span class='lineno'>06134</span><pre class='pre'>							if (!empty($sql_where1))</pre><br/><span class='lineno'>06135</span><pre class='pre'>							{</pre><br/><span class='lineno'>06136</span><pre class='pre'>								$sql_where1 .= &quot; AND &quot;;</pre><br/><span class='lineno'>06137</span><pre class='pre'>							}</pre><br/><span class='lineno'>06138</span><pre class='pre'>							$sql_where1 .= &quot;keyword.keyword_name LIKE '%&quot;.$kwd_a[$i].&quot;%'&quot;;</pre><br/><span class='lineno'>06139</span><pre class='pre'>						}</pre><br/><span class='lineno'>06140</span><pre class='pre'></pre><br/><span class='lineno'>06141</span><pre class='pre'>						$sql = &quot; SELECT * FROM keyword WHERE &quot;.$sql_where1;</pre><br/><span class='lineno'>06142</span><pre class='pre'>					}</pre><br/><span class='lineno'>06143</span><pre class='pre'>				}</pre><br/><span class='lineno'>06144</span><pre class='pre'>			//}</pre><br/><span class='lineno'>06145</span><pre class='pre'>		}</pre><br/><span class='lineno'>06146</span><pre class='pre'></pre><br/><span class='lineno'>06147</span><pre class='pre'>		if (!empty($sp_str_content))</pre><br/><span class='lineno'>06148</span><pre class='pre'>		{</pre><br/><span class='lineno'>06149</span><pre class='pre'>			// æå­åã«ã-ãããããã©ãããã§ãã¯ãã</pre><br/><span class='lineno'>06150</span><pre class='pre'>			// æ¤ç´¢åå®¹ã®æå­åï¼ã ãã§åºåãï¼&rarr;éåã«å¤æãã¾ãã</pre><br/><span class='lineno'>06151</span><pre class='pre'>			$kwd_a = explode(&quot; &quot;, $sp_str_content);</pre><br/><span class='lineno'>06152</span><pre class='pre'>			$ed = count($kwd_a);</pre><br/><span class='lineno'>06153</span><pre class='pre'></pre><br/><span class='lineno'>06154</span><pre class='pre'>			$sql_where1 = &quot;&quot;;</pre><br/><span class='lineno'>06155</span><pre class='pre'></pre><br/><span class='lineno'>06156</span><pre class='pre'>			for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>06157</span><pre class='pre'>			{</pre><br/><span class='lineno'>06158</span><pre class='pre'>				if (substr($kwd_a[$i],0,1) == &quot;-&quot;)</pre><br/><span class='lineno'>06159</span><pre class='pre'>				{</pre><br/><span class='lineno'>06160</span><pre class='pre'>					if (!empty($kwd_a[$i]))</pre><br/><span class='lineno'>06161</span><pre class='pre'>					{</pre><br/><span class='lineno'>06162</span><pre class='pre'>						if (!empty($sql_where1))</pre><br/><span class='lineno'>06163</span><pre class='pre'>						{</pre><br/><span class='lineno'>06164</span><pre class='pre'>							$sql_where1 .= &quot; AND &quot;;</pre><br/><span class='lineno'>06165</span><pre class='pre'>						}</pre><br/><span class='lineno'>06166</span><pre class='pre'>						$sql_where1 .= &quot; keyword.keyword_name NOT LIKE '% &quot;.substr($kwd_a[$i],1).&quot; %'&quot;;</pre><br/><span class='lineno'>06167</span><pre class='pre'>					}</pre><br/><span class='lineno'>06168</span><pre class='pre'>				} else {</pre><br/><span class='lineno'>06169</span><pre class='pre'>					if (!empty($kwd_a[$i]))</pre><br/><span class='lineno'>06170</span><pre class='pre'>					{</pre><br/><span class='lineno'>06171</span><pre class='pre'>						if (!empty($sql_where1))</pre><br/><span class='lineno'>06172</span><pre class='pre'>						{</pre><br/><span class='lineno'>06173</span><pre class='pre'>							$sql_where1 .= &quot; AND &quot;;</pre><br/><span class='lineno'>06174</span><pre class='pre'>						}</pre><br/><span class='lineno'>06175</span><pre class='pre'>						$sql_where1 .= &quot; keyword.keyword_name LIKE '% &quot;.$kwd_a[$i].&quot; %'&quot;;</pre><br/><span class='lineno'>06176</span><pre class='pre'>					}</pre><br/><span class='lineno'>06177</span><pre class='pre'>				}</pre><br/><span class='lineno'>06178</span><pre class='pre'>			}</pre><br/><span class='lineno'>06179</span><pre class='pre'>			if (!empty($sql))</pre><br/><span class='lineno'>06180</span><pre class='pre'>			{</pre><br/><span class='lineno'>06181</span><pre class='pre'>				$sql .= &quot; AND &quot;.$sql_where1;</pre><br/><span class='lineno'>06182</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>06183</span><pre class='pre'>				$sql = &quot; SELECT * FROM keyword WHERE &quot;.$sql_where1;</pre><br/><span class='lineno'>06184</span><pre class='pre'>			}</pre><br/><span class='lineno'>06185</span><pre class='pre'>		}</pre><br/><span class='lineno'>06186</span><pre class='pre'></pre><br/><span class='lineno'>06187</span><pre class='pre'>		$sql .= &quot; AND keyword.publishing_situation_id = 2 &quot;;</pre><br/><span class='lineno'>06188</span><pre class='pre'></pre><br/><span class='lineno'>06189</span><pre class='pre'>		if(empty($p_tmp_kikan))</pre><br/><span class='lineno'>06190</span><pre class='pre'>		{</pre><br/><span class='lineno'>06191</span><pre class='pre'>			// hst 20140317 $sql .= &quot; AND keyword.photo_id IN(SELECT photo_id FROM photoimg WHERE photoimg.publishing_situation_id = 2)&quot;;</pre><br/><span class='lineno'>06192</span><pre class='pre'>			$sql .= &quot; AND keyword.photo_id IN(SELECT photo_id FROM photoimg WHERE photoimg.publishing_situation_id = 2 AND photoimg.photo_server_flg = 0 )&quot;;</pre><br/><span class='lineno'>06193</span><pre class='pre'></pre><br/><span class='lineno'>06194</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>06195</span><pre class='pre'>			if((int)$p_tmp_kikan == 3)</pre><br/><span class='lineno'>06196</span><pre class='pre'>			{</pre><br/><span class='lineno'>06197</span><pre class='pre'>				// hst 20140317 $sql .= &quot; AND keyword.photo_id IN(SELECT photo_id FROM photoimg WHERE photoimg.publishing_situation_id = 2&quot;;</pre><br/><span class='lineno'>06198</span><pre class='pre'>				$sql .= &quot; AND keyword.photo_id IN(SELECT photo_id FROM photoimg WHERE photoimg.publishing_situation_id = 2 AND photoimg.photo_server_flg = 0 &quot;;</pre><br/><span class='lineno'>06199</span><pre class='pre'>				$sql .= &quot; AND DATEDIFF( photoimg.dto, NOW() ) &gt;90 )&quot;;</pre><br/><span class='lineno'>06200</span><pre class='pre'>			}</pre><br/><span class='lineno'>06201</span><pre class='pre'></pre><br/><span class='lineno'>06202</span><pre class='pre'>			if((int)$p_tmp_kikan == 6)</pre><br/><span class='lineno'>06203</span><pre class='pre'>			{</pre><br/><span class='lineno'>06204</span><pre class='pre'>				// hst 20140317 $sql .= &quot; AND keyword.photo_id IN(SELECT photo_id FROM photoimg WHERE photoimg.publishing_situation_id = 2&quot;;</pre><br/><span class='lineno'>06205</span><pre class='pre'>				$sql .= &quot; AND keyword.photo_id IN(SELECT photo_id FROM photoimg WHERE photoimg.publishing_situation_id = 2 AND photoimg.photo_server_flg = 0 &quot;;</pre><br/><span class='lineno'>06206</span><pre class='pre'>				$sql .= &quot; AND DATEDIFF( photoimg.dto, NOW() ) &gt;180 )&quot;;</pre><br/><span class='lineno'>06207</span><pre class='pre'>			}</pre><br/><span class='lineno'>06208</span><pre class='pre'></pre><br/><span class='lineno'>06209</span><pre class='pre'>			if((int)$p_tmp_kikan == 9)</pre><br/><span class='lineno'>06210</span><pre class='pre'>			{</pre><br/><span class='lineno'>06211</span><pre class='pre'>				// hst 20140317 $sql .= &quot; AND keyword.photo_id IN(SELECT photo_id FROM photoimg WHERE photoimg.publishing_situation_id = 2&quot;;</pre><br/><span class='lineno'>06212</span><pre class='pre'>				$sql .= &quot; AND keyword.photo_id IN(SELECT photo_id FROM photoimg WHERE photoimg.publishing_situation_id = 2 AND photoimg.photo_server_flg = 0 &quot;;</pre><br/><span class='lineno'>06213</span><pre class='pre'>				$sql .= &quot; AND photoimg.kikan = 'mukigen')&quot;;</pre><br/><span class='lineno'>06214</span><pre class='pre'>			}</pre><br/><span class='lineno'>06215</span><pre class='pre'>		}</pre><br/><span class='lineno'>06216</span><pre class='pre'></pre><br/><span class='lineno'>06217</span><pre class='pre'>		$sqlcount = $sql;</pre><br/><span class='lineno'>06218</span><pre class='pre'></pre><br/><span class='lineno'>06219</span><pre class='pre'>		$sql .= &quot; ORDER BY keyword.photo_id DESC&quot;;</pre><br/><span class='lineno'>06220</span><pre class='pre'>		$tmpistart = (int)$this-&gt;istart;</pre><br/><span class='lineno'>06221</span><pre class='pre'>		$tmpend = (int)$this-&gt;iend;</pre><br/><span class='lineno'>06222</span><pre class='pre'></pre><br/><span class='lineno'>06223</span><pre class='pre'>		if ($tmpistart &gt;= 0 &amp;&amp; $tmpend &gt; 0)</pre><br/><span class='lineno'>06224</span><pre class='pre'>		{</pre><br/><span class='lineno'>06225</span><pre class='pre'>			$sql .= &quot; LIMIT &quot;.$this-&gt;istart.&quot;,&quot;.$this-&gt;iend;</pre><br/><span class='lineno'>06226</span><pre class='pre'>		}</pre><br/><span class='lineno'>06227</span><pre class='pre'>		//echo $sql;</pre><br/><span class='lineno'>06228</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>06229</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>06230</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>06231</span><pre class='pre'>		{</pre><br/><span class='lineno'>06232</span><pre class='pre'>			// å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>06233</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>06234</span><pre class='pre'>			// é¸æããããã¼ã¿æ°ãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>06235</span><pre class='pre'>			if ($icount &lt;= 0)</pre><br/><span class='lineno'>06236</span><pre class='pre'>			{</pre><br/><span class='lineno'>06237</span><pre class='pre'>				$this-&gt;images = array();</pre><br/><span class='lineno'>06238</span><pre class='pre'>				return true;</pre><br/><span class='lineno'>06239</span><pre class='pre'>			}</pre><br/><span class='lineno'>06240</span><pre class='pre'></pre><br/><span class='lineno'>06241</span><pre class='pre'>			$stmtcount = $db_link-&gt;prepare($sqlcount);</pre><br/><span class='lineno'>06242</span><pre class='pre'>			$resultcount = $stmtcount-&gt;execute();</pre><br/><span class='lineno'>06243</span><pre class='pre'>			if ($resultcount == true)</pre><br/><span class='lineno'>06244</span><pre class='pre'>			{</pre><br/><span class='lineno'>06245</span><pre class='pre'>				$this-&gt;imagescount = $stmtcount-&gt;rowCount();</pre><br/><span class='lineno'>06246</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>06247</span><pre class='pre'>				$this-&gt;imagescount = 0;</pre><br/><span class='lineno'>06248</span><pre class='pre'>			}</pre><br/><span class='lineno'>06249</span><pre class='pre'></pre><br/><span class='lineno'>06250</span><pre class='pre'>			$sp_p_id = &quot;&quot;;</pre><br/><span class='lineno'>06251</span><pre class='pre'></pre><br/><span class='lineno'>06252</span><pre class='pre'>			if ((int)$this-&gt;istart &gt;= 0 &amp;&amp; (int)$this-&gt;iend &gt; 0)</pre><br/><span class='lineno'>06253</span><pre class='pre'>			{</pre><br/><span class='lineno'>06254</span><pre class='pre'>				$tmpend = $this-&gt;iend - $this-&gt;istart;</pre><br/><span class='lineno'>06255</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>06256</span><pre class='pre'>				$tmpend = 0;</pre><br/><span class='lineno'>06257</span><pre class='pre'>			}</pre><br/><span class='lineno'>06258</span><pre class='pre'></pre><br/><span class='lineno'>06259</span><pre class='pre'>			$tmpi = 0;</pre><br/><span class='lineno'>06260</span><pre class='pre'>			while($image_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>06261</span><pre class='pre'>			{</pre><br/><span class='lineno'>06262</span><pre class='pre'>				$tmpi = $tmpi + 1;</pre><br/><span class='lineno'>06263</span><pre class='pre'>				if ($tmpend &gt; 0)</pre><br/><span class='lineno'>06264</span><pre class='pre'>				{</pre><br/><span class='lineno'>06265</span><pre class='pre'>					if ($tmpi &gt; $tmpend)</pre><br/><span class='lineno'>06266</span><pre class='pre'>					{</pre><br/><span class='lineno'>06267</span><pre class='pre'>						break;</pre><br/><span class='lineno'>06268</span><pre class='pre'>					}</pre><br/><span class='lineno'>06269</span><pre class='pre'>				}</pre><br/><span class='lineno'>06270</span><pre class='pre'></pre><br/><span class='lineno'>06271</span><pre class='pre'>				$sp_p_id = $sp_p_id.$image_data['photo_id'].&quot;,&quot;;</pre><br/><span class='lineno'>06272</span><pre class='pre'>			}</pre><br/><span class='lineno'>06273</span><pre class='pre'>			$sp_p_id = substr($sp_p_id,0,strlen($sp_p_id) - 1);</pre><br/><span class='lineno'>06274</span><pre class='pre'>			//echo $sp_p_id;</pre><br/><span class='lineno'>06275</span><pre class='pre'>			$this-&gt;sp_photo_id_str = $sp_p_id;</pre><br/><span class='lineno'>06276</span><pre class='pre'>			$this-&gt;select_image($db_link,&quot;&quot;);</pre><br/><span class='lineno'>06277</span><pre class='pre'>		}</pre><br/><span class='lineno'>06278</span><pre class='pre'>		else</pre><br/><span class='lineno'>06279</span><pre class='pre'>		{</pre><br/><span class='lineno'>06280</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>06281</span><pre class='pre'>			$this-&gt;message = &quot;ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>06282</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>06283</span><pre class='pre'>		}</pre><br/><span class='lineno'>06284</span><pre class='pre'>		return true;</pre><br/><span class='lineno'>06285</span><pre class='pre'>	}</pre><br/><span class='lineno'>06286</span><pre class='pre'>//added by wangtongchao 2011-12-13 begin</pre><br/><span class='lineno'>06287</span><pre class='pre'>	function select_image_all($db_link, $where=&quot;&quot;)</pre><br/><span class='lineno'>06288</span><pre class='pre'>	{</pre><br/><span class='lineno'>06289</span><pre class='pre'>		// SQLãã»ãããã¾ãã</pre><br/><span class='lineno'>06290</span><pre class='pre'>		$sql = $this-&gt;set_sql();</pre><br/><span class='lineno'>06291</span><pre class='pre'>		if(!empty($where))</pre><br/><span class='lineno'>06292</span><pre class='pre'>		{</pre><br/><span class='lineno'>06293</span><pre class='pre'>			$sql .= $where;</pre><br/><span class='lineno'>06294</span><pre class='pre'>		}</pre><br/><span class='lineno'>06295</span><pre class='pre'>		$sql .= &quot; ORDER BY photo_id DESC&quot;;</pre><br/><span class='lineno'>06296</span><pre class='pre'></pre><br/><span class='lineno'>06297</span><pre class='pre'>		$sqlcount = $sql;</pre><br/><span class='lineno'>06298</span><pre class='pre'></pre><br/><span class='lineno'>06299</span><pre class='pre'>		$tmpistart = (int)$this-&gt;istart;</pre><br/><span class='lineno'>06300</span><pre class='pre'>		$tmpend = (int)$this-&gt;iend;</pre><br/><span class='lineno'>06301</span><pre class='pre'></pre><br/><span class='lineno'>06302</span><pre class='pre'>		if ($tmpistart &gt;= 0 &amp;&amp; $tmpend &gt; 0)</pre><br/><span class='lineno'>06303</span><pre class='pre'>		{</pre><br/><span class='lineno'>06304</span><pre class='pre'>			$sql .= &quot; LIMIT &quot;.$this-&gt;istart.&quot;,&quot;.$this-&gt;iend;</pre><br/><span class='lineno'>06305</span><pre class='pre'>		}</pre><br/><span class='lineno'>06306</span><pre class='pre'>//echo $sql;</pre><br/><span class='lineno'>06307</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>06308</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>06309</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>06310</span><pre class='pre'>		{</pre><br/><span class='lineno'>06311</span><pre class='pre'>			// å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>06312</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>06313</span><pre class='pre'></pre><br/><span class='lineno'>06314</span><pre class='pre'>			// é¸æããããã¼ã¿æ°ãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>06315</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>06316</span><pre class='pre'>			{</pre><br/><span class='lineno'>06317</span><pre class='pre'>				// ã¤ã¡ã¼ã¸ãçµ±è¨ãã</pre><br/><span class='lineno'>06318</span><pre class='pre'></pre><br/><span class='lineno'>06319</span><pre class='pre'>				$stmtcount = $db_link-&gt;prepare($sqlcount);</pre><br/><span class='lineno'>06320</span><pre class='pre'>				$resultcount = $stmtcount-&gt;execute();</pre><br/><span class='lineno'>06321</span><pre class='pre'>				if ($resultcount == true)</pre><br/><span class='lineno'>06322</span><pre class='pre'>				{</pre><br/><span class='lineno'>06323</span><pre class='pre'>					if ($this-&gt;imagescount &lt;= 0)</pre><br/><span class='lineno'>06324</span><pre class='pre'>					{</pre><br/><span class='lineno'>06325</span><pre class='pre'>						$this-&gt;imagescount = $stmtcount-&gt;rowCount();</pre><br/><span class='lineno'>06326</span><pre class='pre'>					}</pre><br/><span class='lineno'>06327</span><pre class='pre'>				} else {</pre><br/><span class='lineno'>06328</span><pre class='pre'>					$this-&gt;imagescount = 0;</pre><br/><span class='lineno'>06329</span><pre class='pre'>				}</pre><br/><span class='lineno'>06330</span><pre class='pre'></pre><br/><span class='lineno'>06331</span><pre class='pre'>				$this-&gt;images = array();</pre><br/><span class='lineno'>06332</span><pre class='pre'></pre><br/><span class='lineno'>06333</span><pre class='pre'>				if ((int)$this-&gt;istart &gt;= 0 &amp;&amp; (int)$this-&gt;iend &gt; 0)</pre><br/><span class='lineno'>06334</span><pre class='pre'>				{</pre><br/><span class='lineno'>06335</span><pre class='pre'>					$tmpend = $this-&gt;iend - $this-&gt;istart;</pre><br/><span class='lineno'>06336</span><pre class='pre'>				} else {</pre><br/><span class='lineno'>06337</span><pre class='pre'>					$tmpend = 0;</pre><br/><span class='lineno'>06338</span><pre class='pre'>				}</pre><br/><span class='lineno'>06339</span><pre class='pre'></pre><br/><span class='lineno'>06340</span><pre class='pre'>				$tmpi = 0;</pre><br/><span class='lineno'>06341</span><pre class='pre'>				while($image_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>06342</span><pre class='pre'>				{</pre><br/><span class='lineno'>06343</span><pre class='pre'>					$tmpi = $tmpi + 1;</pre><br/><span class='lineno'>06344</span><pre class='pre'>					if ($tmpend &gt; 0)</pre><br/><span class='lineno'>06345</span><pre class='pre'>					{</pre><br/><span class='lineno'>06346</span><pre class='pre'>						if ($tmpi &gt; $tmpend)</pre><br/><span class='lineno'>06347</span><pre class='pre'>						{</pre><br/><span class='lineno'>06348</span><pre class='pre'>							break;</pre><br/><span class='lineno'>06349</span><pre class='pre'>						}</pre><br/><span class='lineno'>06350</span><pre class='pre'>					}</pre><br/><span class='lineno'>06351</span><pre class='pre'>					// ç»åãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>06352</span><pre class='pre'>					$photo_idata = new PhotoImageDataAll();</pre><br/><span class='lineno'>06353</span><pre class='pre'>					$photo_idata-&gt;set_data($image_data);</pre><br/><span class='lineno'>06354</span><pre class='pre'>					$this-&gt;images[] = $photo_idata;</pre><br/><span class='lineno'>06355</span><pre class='pre'>				}</pre><br/><span class='lineno'>06356</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>06357</span><pre class='pre'>				$this-&gt;imagescount = 0;</pre><br/><span class='lineno'>06358</span><pre class='pre'>			}</pre><br/><span class='lineno'>06359</span><pre class='pre'>		}</pre><br/><span class='lineno'>06360</span><pre class='pre'>		else</pre><br/><span class='lineno'>06361</span><pre class='pre'>		{</pre><br/><span class='lineno'>06362</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>06363</span><pre class='pre'>			$this-&gt;message = &quot;ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>06364</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>06365</span><pre class='pre'>			//echo $err[2];</pre><br/><span class='lineno'>06366</span><pre class='pre'>		}</pre><br/><span class='lineno'>06367</span><pre class='pre'></pre><br/><span class='lineno'>06368</span><pre class='pre'>		return $this-&gt;images;</pre><br/><span class='lineno'>06369</span><pre class='pre'>	}</pre><br/><span class='lineno'>06370</span><pre class='pre'>//added by wangtongchao 2011-12-13 end</pre><br/><span class='lineno'>06371</span><pre class='pre'>	function select_image($db_link, $p_tmp_kikan)</pre><br/><span class='lineno'>06372</span><pre class='pre'>	{</pre><br/><span class='lineno'>06373</span><pre class='pre'>		// SQLãã»ãããã¾ãã</pre><br/><span class='lineno'>06374</span><pre class='pre'>		$sql = $this-&gt;set_sql();</pre><br/><span class='lineno'>06375</span><pre class='pre'></pre><br/><span class='lineno'>06376</span><pre class='pre'>		$optset = false;</pre><br/><span class='lineno'>06377</span><pre class='pre'></pre><br/><span class='lineno'>06378</span><pre class='pre'>		// åççªå·</pre><br/><span class='lineno'>06379</span><pre class='pre'>		if (!empty($this-&gt;sp_photo_id_str))</pre><br/><span class='lineno'>06380</span><pre class='pre'>		{</pre><br/><span class='lineno'>06381</span><pre class='pre'>			$sql .= &quot; WHERE photo_id IN (&quot;.$this-&gt;sp_photo_id_str.&quot;) &quot;;</pre><br/><span class='lineno'>06382</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06383</span><pre class='pre'>		}</pre><br/><span class='lineno'>06384</span><pre class='pre'></pre><br/><span class='lineno'>06385</span><pre class='pre'>		// åçç®¡ççªå·</pre><br/><span class='lineno'>06386</span><pre class='pre'>		if (!empty($this-&gt;sp_photo_mno))</pre><br/><span class='lineno'>06387</span><pre class='pre'>		{</pre><br/><span class='lineno'>06388</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06389</span><pre class='pre'>			{</pre><br/><span class='lineno'>06390</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06391</span><pre class='pre'>			}</pre><br/><span class='lineno'>06392</span><pre class='pre'>			else</pre><br/><span class='lineno'>06393</span><pre class='pre'>			{</pre><br/><span class='lineno'>06394</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06395</span><pre class='pre'>			}</pre><br/><span class='lineno'>06396</span><pre class='pre'>			//$sql .= &quot;photo_mno LIKE ? &quot;;</pre><br/><span class='lineno'>06397</span><pre class='pre'>			//$opt[] = $this-&gt;sp_photo_mno;</pre><br/><span class='lineno'>06398</span><pre class='pre'>			$sql .= &quot;photo_mno COLLATE utf8_bin LIKE &quot;.$this-&gt;sp_photo_mno;</pre><br/><span class='lineno'>06399</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06400</span><pre class='pre'>		}</pre><br/><span class='lineno'>06401</span><pre class='pre'></pre><br/><span class='lineno'>06402</span><pre class='pre'>		// åçå</pre><br/><span class='lineno'>06403</span><pre class='pre'>		if (!empty($this-&gt;sp_photo_name))</pre><br/><span class='lineno'>06404</span><pre class='pre'>		{</pre><br/><span class='lineno'>06405</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06406</span><pre class='pre'>			{</pre><br/><span class='lineno'>06407</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06408</span><pre class='pre'>			}</pre><br/><span class='lineno'>06409</span><pre class='pre'>			else</pre><br/><span class='lineno'>06410</span><pre class='pre'>			{</pre><br/><span class='lineno'>06411</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06412</span><pre class='pre'>			}</pre><br/><span class='lineno'>06413</span><pre class='pre'>			$sql .= &quot;photo_name COLLATE utf8_bin LIKE &quot;.$this-&gt;sp_photo_name;</pre><br/><span class='lineno'>06414</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06415</span><pre class='pre'>		}</pre><br/><span class='lineno'>06416</span><pre class='pre'></pre><br/><span class='lineno'>06417</span><pre class='pre'>		// åçèª¬æ</pre><br/><span class='lineno'>06418</span><pre class='pre'>		if (!empty($this-&gt;sp_photo_explanation))</pre><br/><span class='lineno'>06419</span><pre class='pre'>		{</pre><br/><span class='lineno'>06420</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06421</span><pre class='pre'>			{</pre><br/><span class='lineno'>06422</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06423</span><pre class='pre'>			}</pre><br/><span class='lineno'>06424</span><pre class='pre'>			else</pre><br/><span class='lineno'>06425</span><pre class='pre'>			{</pre><br/><span class='lineno'>06426</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06427</span><pre class='pre'>			}</pre><br/><span class='lineno'>06428</span><pre class='pre'>			$sql .= &quot;photo_explanation COLLATE utf8_bin LIKE &quot;.$this-&gt;sp_photo_explanation;</pre><br/><span class='lineno'>06429</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06430</span><pre class='pre'>		}</pre><br/><span class='lineno'>06431</span><pre class='pre'></pre><br/><span class='lineno'>06432</span><pre class='pre'>		// æ®å½±ææID</pre><br/><span class='lineno'>06433</span><pre class='pre'>		if (is_numeric($this-&gt;sp_take_picture_time_id) &amp;&amp; $this-&gt;sp_take_picture_time_id != -1)</pre><br/><span class='lineno'>06434</span><pre class='pre'>		{</pre><br/><span class='lineno'>06435</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06436</span><pre class='pre'>			{</pre><br/><span class='lineno'>06437</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06438</span><pre class='pre'>			}</pre><br/><span class='lineno'>06439</span><pre class='pre'>			else</pre><br/><span class='lineno'>06440</span><pre class='pre'>			{</pre><br/><span class='lineno'>06441</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06442</span><pre class='pre'>			}</pre><br/><span class='lineno'>06443</span><pre class='pre'>			$sql .= &quot;photoimg.take_picture_time_id=&quot; . $this-&gt;sp_take_picture_time_id;</pre><br/><span class='lineno'>06444</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06445</span><pre class='pre'>		}</pre><br/><span class='lineno'>06446</span><pre class='pre'></pre><br/><span class='lineno'>06447</span><pre class='pre'>		// æ®å½±ææ2ID</pre><br/><span class='lineno'>06448</span><pre class='pre'>		if (is_numeric($this-&gt;sp_take_picture_time2_id) &amp;&amp; $this-&gt;sp_take_picture_time2_id != -1)</pre><br/><span class='lineno'>06449</span><pre class='pre'>		{</pre><br/><span class='lineno'>06450</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06451</span><pre class='pre'>			{</pre><br/><span class='lineno'>06452</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06453</span><pre class='pre'>			}</pre><br/><span class='lineno'>06454</span><pre class='pre'>			else</pre><br/><span class='lineno'>06455</span><pre class='pre'>			{</pre><br/><span class='lineno'>06456</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06457</span><pre class='pre'>			}</pre><br/><span class='lineno'>06458</span><pre class='pre'>			$sql .= &quot;photoimg.take_picture_time2_id=&quot;.$this-&gt;sp_take_picture_time2_id;</pre><br/><span class='lineno'>06459</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06460</span><pre class='pre'>		}</pre><br/><span class='lineno'>06461</span><pre class='pre'></pre><br/><span class='lineno'>06462</span><pre class='pre'>		// åçå¥æåï¼åå®¹ï¼</pre><br/><span class='lineno'>06463</span><pre class='pre'>		if (!empty($this-&gt;sp_content_borrowing_ahead))</pre><br/><span class='lineno'>06464</span><pre class='pre'>		{</pre><br/><span class='lineno'>06465</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06466</span><pre class='pre'>			{</pre><br/><span class='lineno'>06467</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06468</span><pre class='pre'>			}</pre><br/><span class='lineno'>06469</span><pre class='pre'>			else</pre><br/><span class='lineno'>06470</span><pre class='pre'>			{</pre><br/><span class='lineno'>06471</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06472</span><pre class='pre'>			}</pre><br/><span class='lineno'>06473</span><pre class='pre'></pre><br/><span class='lineno'>06474</span><pre class='pre'>			$tmp = array();</pre><br/><span class='lineno'>06475</span><pre class='pre'>			$tmp = explode(&quot;;&quot;,$this-&gt;sp_content_borrowing_ahead);</pre><br/><span class='lineno'>06476</span><pre class='pre'>			// åçå¥æåID</pre><br/><span class='lineno'>06477</span><pre class='pre'>			$sql .= &quot;photoimg.borrowing_ahead_id=&quot; . $tmp[0];</pre><br/><span class='lineno'>06478</span><pre class='pre'>			if (count($tmp) &gt; 1)</pre><br/><span class='lineno'>06479</span><pre class='pre'>			{</pre><br/><span class='lineno'>06480</span><pre class='pre'>				//if (substr($tmp[1],0,1) == &quot;*&quot;)</pre><br/><span class='lineno'>06481</span><pre class='pre'>				//{</pre><br/><span class='lineno'>06482</span><pre class='pre'>				//	$sql .= &quot; AND photoimg.content_borrowing_ahead COLLATE utf8_bin LIKE '%&quot;.substr($tmp[1],1).&quot;%'&quot;;</pre><br/><span class='lineno'>06483</span><pre class='pre'>				//} else {</pre><br/><span class='lineno'>06484</span><pre class='pre'>				//	$sql .= &quot; AND photoimg.content_borrowing_ahead COLLATE utf8_bin LIKE '&quot;.$tmp[1].&quot;%'&quot;;</pre><br/><span class='lineno'>06485</span><pre class='pre'>				//}</pre><br/><span class='lineno'>06486</span><pre class='pre'>				$sql .= &quot; AND photoimg.content_borrowing_ahead COLLATE utf8_bin LIKE '%&quot;.$tmp[1].&quot;%'&quot;;</pre><br/><span class='lineno'>06487</span><pre class='pre'>			}</pre><br/><span class='lineno'>06488</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06489</span><pre class='pre'>		}</pre><br/><span class='lineno'>06490</span><pre class='pre'></pre><br/><span class='lineno'>06491</span><pre class='pre'>		// ä½¿ç¨ç¯å²ID</pre><br/><span class='lineno'>06492</span><pre class='pre'>		if (!empty($this-&gt;sp_range_of_use_id))</pre><br/><span class='lineno'>06493</span><pre class='pre'>		{</pre><br/><span class='lineno'>06494</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06495</span><pre class='pre'>			{</pre><br/><span class='lineno'>06496</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06497</span><pre class='pre'>			}</pre><br/><span class='lineno'>06498</span><pre class='pre'>			else</pre><br/><span class='lineno'>06499</span><pre class='pre'>			{</pre><br/><span class='lineno'>06500</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06501</span><pre class='pre'>			}</pre><br/><span class='lineno'>06502</span><pre class='pre'>			$tmp = array();</pre><br/><span class='lineno'>06503</span><pre class='pre'>			$tmp = explode(&quot;;&quot;,$this-&gt;sp_range_of_use_id);</pre><br/><span class='lineno'>06504</span><pre class='pre'>			$sql .= &quot;photoimg.range_of_use_id=&quot;.$tmp[0];</pre><br/><span class='lineno'>06505</span><pre class='pre'>			if (count($tmp) &gt; 1)</pre><br/><span class='lineno'>06506</span><pre class='pre'>			{</pre><br/><span class='lineno'>06507</span><pre class='pre'>				if (!empty($tmp[1]))</pre><br/><span class='lineno'>06508</span><pre class='pre'>				{</pre><br/><span class='lineno'>06509</span><pre class='pre'>					//if (substr($tmp[1],0,1) == &quot;*&quot;)</pre><br/><span class='lineno'>06510</span><pre class='pre'>					//{</pre><br/><span class='lineno'>06511</span><pre class='pre'>					//	$sql .= &quot; AND use_condition COLLATE utf8_bin LIKE '%&quot;.substr($tmp[1],1).&quot;%'&quot;;</pre><br/><span class='lineno'>06512</span><pre class='pre'>					//} else {</pre><br/><span class='lineno'>06513</span><pre class='pre'>					//	$sql .= &quot; AND use_condition COLLATE utf8_bin LIKE '&quot;.$tmp[1].&quot;%'&quot;;</pre><br/><span class='lineno'>06514</span><pre class='pre'>					//}</pre><br/><span class='lineno'>06515</span><pre class='pre'>					$sql .= &quot; AND use_condition COLLATE utf8_bin LIKE '%&quot;.$tmp[1].&quot;%'&quot;;</pre><br/><span class='lineno'>06516</span><pre class='pre'>				}</pre><br/><span class='lineno'>06517</span><pre class='pre'>			}</pre><br/><span class='lineno'>06518</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06519</span><pre class='pre'>		}</pre><br/><span class='lineno'>06520</span><pre class='pre'></pre><br/><span class='lineno'>06521</span><pre class='pre'>		// ä»å æ¡ä»¶(1)</pre><br/><span class='lineno'>06522</span><pre class='pre'>		if (!empty($this-&gt;sp_additional_constraints1))</pre><br/><span class='lineno'>06523</span><pre class='pre'>		{</pre><br/><span class='lineno'>06524</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06525</span><pre class='pre'>			{</pre><br/><span class='lineno'>06526</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06527</span><pre class='pre'>			}</pre><br/><span class='lineno'>06528</span><pre class='pre'>			else</pre><br/><span class='lineno'>06529</span><pre class='pre'>			{</pre><br/><span class='lineno'>06530</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06531</span><pre class='pre'>			}</pre><br/><span class='lineno'>06532</span><pre class='pre'>			$sql .= &quot;additional_constraints1 COLLATE utf8_bin LIKE &quot;.$this-&gt;sp_additional_constraints1;</pre><br/><span class='lineno'>06533</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06534</span><pre class='pre'>		}</pre><br/><span class='lineno'>06535</span><pre class='pre'></pre><br/><span class='lineno'>06536</span><pre class='pre'>		// ä»å æ¡ä»¶(2)</pre><br/><span class='lineno'>06537</span><pre class='pre'>		if (!empty($this-&gt;sp_additional_constraints2))</pre><br/><span class='lineno'>06538</span><pre class='pre'>		{</pre><br/><span class='lineno'>06539</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06540</span><pre class='pre'>			{</pre><br/><span class='lineno'>06541</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06542</span><pre class='pre'>			}</pre><br/><span class='lineno'>06543</span><pre class='pre'>			else</pre><br/><span class='lineno'>06544</span><pre class='pre'>			{</pre><br/><span class='lineno'>06545</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06546</span><pre class='pre'>			}</pre><br/><span class='lineno'>06547</span><pre class='pre'>			$sql .= &quot;additional_constraints2 COLLATE utf8_bin LIKE &quot;.$this-&gt;sp_additional_constraints2;</pre><br/><span class='lineno'>06548</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06549</span><pre class='pre'>		}</pre><br/><span class='lineno'>06550</span><pre class='pre'></pre><br/><span class='lineno'>06551</span><pre class='pre'>		// åè</pre><br/><span class='lineno'>06552</span><pre class='pre'>		if (!empty($this-&gt;sp_note))</pre><br/><span class='lineno'>06553</span><pre class='pre'>		{</pre><br/><span class='lineno'>06554</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06555</span><pre class='pre'>			{</pre><br/><span class='lineno'>06556</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06557</span><pre class='pre'>			}</pre><br/><span class='lineno'>06558</span><pre class='pre'>			else</pre><br/><span class='lineno'>06559</span><pre class='pre'>			{</pre><br/><span class='lineno'>06560</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06561</span><pre class='pre'>			}</pre><br/><span class='lineno'>06562</span><pre class='pre'>			$sql .= &quot;note COLLATE utf8_bin LIKE &quot;.$this-&gt;sp_note;</pre><br/><span class='lineno'>06563</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06564</span><pre class='pre'>		}</pre><br/><span class='lineno'>06565</span><pre class='pre'></pre><br/><span class='lineno'>06566</span><pre class='pre'>		// çæ¨©ææè</pre><br/><span class='lineno'>06567</span><pre class='pre'>		if (!empty($this-&gt;sp_copyright_owner))</pre><br/><span class='lineno'>06568</span><pre class='pre'>		{</pre><br/><span class='lineno'>06569</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06570</span><pre class='pre'>			{</pre><br/><span class='lineno'>06571</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06572</span><pre class='pre'>			}</pre><br/><span class='lineno'>06573</span><pre class='pre'>			else</pre><br/><span class='lineno'>06574</span><pre class='pre'>			{</pre><br/><span class='lineno'>06575</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06576</span><pre class='pre'>			}</pre><br/><span class='lineno'>06577</span><pre class='pre'>			$sql .= &quot;copyright_owner COLLATE utf8_bin LIKE &quot;.$this-&gt;sp_copyright_owner;</pre><br/><span class='lineno'>06578</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06579</span><pre class='pre'>		}</pre><br/><span class='lineno'>06580</span><pre class='pre'></pre><br/><span class='lineno'>06581</span><pre class='pre'>		// æ²è¼æéï¼æéï¼</pre><br/><span class='lineno'>06582</span><pre class='pre'>		if (!empty($this-&gt;sp_kikan))</pre><br/><span class='lineno'>06583</span><pre class='pre'>		{</pre><br/><span class='lineno'>06584</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06585</span><pre class='pre'>			{</pre><br/><span class='lineno'>06586</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06587</span><pre class='pre'>			}</pre><br/><span class='lineno'>06588</span><pre class='pre'>			else</pre><br/><span class='lineno'>06589</span><pre class='pre'>			{</pre><br/><span class='lineno'>06590</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06591</span><pre class='pre'>			}</pre><br/><span class='lineno'>06592</span><pre class='pre'>			$sql .= &quot;kikan ='&quot;.$this-&gt;sp_kikan.&quot;'&quot;;</pre><br/><span class='lineno'>06593</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06594</span><pre class='pre'>		}</pre><br/><span class='lineno'>06595</span><pre class='pre'></pre><br/><span class='lineno'>06596</span><pre class='pre'>		// æ²è¼æéï¼Toï¼</pre><br/><span class='lineno'>06597</span><pre class='pre'>		if (!empty($this-&gt;sp_dto) &amp;&amp; $this-&gt;sp_dto != &quot;0000-00-00 00:00:00&quot;)</pre><br/><span class='lineno'>06598</span><pre class='pre'>		{</pre><br/><span class='lineno'>06599</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06600</span><pre class='pre'>			{</pre><br/><span class='lineno'>06601</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06602</span><pre class='pre'>			}</pre><br/><span class='lineno'>06603</span><pre class='pre'>			else</pre><br/><span class='lineno'>06604</span><pre class='pre'>			{</pre><br/><span class='lineno'>06605</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06606</span><pre class='pre'>			}</pre><br/><span class='lineno'>06607</span><pre class='pre'>			$dt = $this-&gt;sp_dto;</pre><br/><span class='lineno'>06608</span><pre class='pre'>			$dtto = $dt . &quot; 23:59:59&quot;;</pre><br/><span class='lineno'>06609</span><pre class='pre'>			$sql .= &quot;dto &lt;= '&quot; .$dtto.&quot;'&quot;;</pre><br/><span class='lineno'>06610</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06611</span><pre class='pre'>		}</pre><br/><span class='lineno'>06612</span><pre class='pre'></pre><br/><span class='lineno'>06613</span><pre class='pre'>		// åç»åID</pre><br/><span class='lineno'>06614</span><pre class='pre'>		if (!empty($this-&gt;sp_source_image_no))</pre><br/><span class='lineno'>06615</span><pre class='pre'>		{</pre><br/><span class='lineno'>06616</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06617</span><pre class='pre'>			{</pre><br/><span class='lineno'>06618</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06619</span><pre class='pre'>			}</pre><br/><span class='lineno'>06620</span><pre class='pre'>			else</pre><br/><span class='lineno'>06621</span><pre class='pre'>			{</pre><br/><span class='lineno'>06622</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06623</span><pre class='pre'>			}</pre><br/><span class='lineno'>06624</span><pre class='pre'>			$sql .= &quot;source_image_no COLLATE utf8_bin LIKE &quot;.$this-&gt;sp_source_image_no;</pre><br/><span class='lineno'>06625</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06626</span><pre class='pre'>		}</pre><br/><span class='lineno'>06627</span><pre class='pre'></pre><br/><span class='lineno'>06628</span><pre class='pre'>		// BUD çªå·</pre><br/><span class='lineno'>06629</span><pre class='pre'>		if (!empty($this-&gt;sp_bud_photo_no))</pre><br/><span class='lineno'>06630</span><pre class='pre'>		{</pre><br/><span class='lineno'>06631</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06632</span><pre class='pre'>			{</pre><br/><span class='lineno'>06633</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06634</span><pre class='pre'>			}</pre><br/><span class='lineno'>06635</span><pre class='pre'>			else</pre><br/><span class='lineno'>06636</span><pre class='pre'>			{</pre><br/><span class='lineno'>06637</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06638</span><pre class='pre'>			}</pre><br/><span class='lineno'>06639</span><pre class='pre'>			if ($this-&gt;sp_bud_photo_no == &quot;_&quot;)</pre><br/><span class='lineno'>06640</span><pre class='pre'>			{</pre><br/><span class='lineno'>06641</span><pre class='pre'>				$sql .= &quot;bud_photo_no = NULL OR bud_photo_no = '' OR bud_photo_no = null OR bud_photo_no = \&quot;\&quot;&quot;;</pre><br/><span class='lineno'>06642</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>06643</span><pre class='pre'>				//if (substr($this-&gt;sp_bud_photo_no,0,1) == &quot;*&quot;)</pre><br/><span class='lineno'>06644</span><pre class='pre'>				//{</pre><br/><span class='lineno'>06645</span><pre class='pre'>				//	$sql .= &quot;bud_photo_no COLLATE utf8_bin LIKE '%&quot;.substr($this-&gt;sp_bud_photo_no,1).&quot;%'&quot;;</pre><br/><span class='lineno'>06646</span><pre class='pre'>				//} else {</pre><br/><span class='lineno'>06647</span><pre class='pre'>				//	$sql .= &quot;bud_photo_no COLLATE utf8_bin LIKE '&quot;.$this-&gt;sp_bud_photo_no.&quot;%'&quot;;</pre><br/><span class='lineno'>06648</span><pre class='pre'>				//}</pre><br/><span class='lineno'>06649</span><pre class='pre'>				$sql .= &quot;bud_photo_no COLLATE utf8_bin LIKE '%&quot;.$this-&gt;sp_bud_photo_no.&quot;%'&quot;;</pre><br/><span class='lineno'>06650</span><pre class='pre'>			}</pre><br/><span class='lineno'>06651</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06652</span><pre class='pre'>		}</pre><br/><span class='lineno'>06653</span><pre class='pre'></pre><br/><span class='lineno'>06654</span><pre class='pre'>		// ç»é²ç³è«è</pre><br/><span class='lineno'>06655</span><pre class='pre'>		if (!empty($this-&gt;sp_registration_person))</pre><br/><span class='lineno'>06656</span><pre class='pre'>		{</pre><br/><span class='lineno'>06657</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06658</span><pre class='pre'>			{</pre><br/><span class='lineno'>06659</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06660</span><pre class='pre'>			}</pre><br/><span class='lineno'>06661</span><pre class='pre'>			else</pre><br/><span class='lineno'>06662</span><pre class='pre'>			{</pre><br/><span class='lineno'>06663</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06664</span><pre class='pre'>			}</pre><br/><span class='lineno'>06665</span><pre class='pre'>			$sql .= &quot;registration_person COLLATE utf8_bin LIKE &quot;.$this-&gt;sp_registration_person;</pre><br/><span class='lineno'>06666</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06667</span><pre class='pre'>		}</pre><br/><span class='lineno'>06668</span><pre class='pre'></pre><br/><span class='lineno'>06669</span><pre class='pre'>		// ç»é²è¨±å¯è</pre><br/><span class='lineno'>06670</span><pre class='pre'>		if (!empty($this-&gt;sp_permission_person))</pre><br/><span class='lineno'>06671</span><pre class='pre'>		{</pre><br/><span class='lineno'>06672</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06673</span><pre class='pre'>			{</pre><br/><span class='lineno'>06674</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06675</span><pre class='pre'>			}</pre><br/><span class='lineno'>06676</span><pre class='pre'>			else</pre><br/><span class='lineno'>06677</span><pre class='pre'>			{</pre><br/><span class='lineno'>06678</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06679</span><pre class='pre'>			}</pre><br/><span class='lineno'>06680</span><pre class='pre'>			$sql .= &quot;permission_person COLLATE utf8_bin LIKE &quot;.$this-&gt;sp_permission_person;</pre><br/><span class='lineno'>06681</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06682</span><pre class='pre'>		}</pre><br/><span class='lineno'>06683</span><pre class='pre'></pre><br/><span class='lineno'>06684</span><pre class='pre'>		// ãå®¢æ§æå ±</pre><br/><span class='lineno'>06685</span><pre class='pre'>		if (!empty($this-&gt;sp_customer_info))</pre><br/><span class='lineno'>06686</span><pre class='pre'>		{</pre><br/><span class='lineno'>06687</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06688</span><pre class='pre'>			{</pre><br/><span class='lineno'>06689</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06690</span><pre class='pre'>			}</pre><br/><span class='lineno'>06691</span><pre class='pre'>			else</pre><br/><span class='lineno'>06692</span><pre class='pre'>			{</pre><br/><span class='lineno'>06693</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06694</span><pre class='pre'>			}</pre><br/><span class='lineno'>06695</span><pre class='pre'>			$tmp_customer = &quot;==&quot;.$this-&gt;sp_customer_info;</pre><br/><span class='lineno'>06696</span><pre class='pre'>			$sql .= &quot; ISNULL(customer_section) = 0 AND ISNULL(customer_name) = 0&quot;;</pre><br/><span class='lineno'>06697</span><pre class='pre'>			$sql .= &quot; AND customer_section != '' AND customer_name != ''&quot;;</pre><br/><span class='lineno'>06698</span><pre class='pre'>			$sql .= &quot; AND (POSITION( customer_section COLLATE utf8_bin IN '&quot;.$tmp_customer.&quot;' ) &gt;0 &quot;;</pre><br/><span class='lineno'>06699</span><pre class='pre'>			$sql .= &quot; OR POSITION( customer_name COLLATE utf8_bin IN '&quot;.$tmp_customer.&quot;' ) &gt;0) &quot;;</pre><br/><span class='lineno'>06700</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06701</span><pre class='pre'>		}</pre><br/><span class='lineno'>06702</span><pre class='pre'></pre><br/><span class='lineno'>06703</span><pre class='pre'>		// æµ·å¤ãå½åãã¤ã¡ã¼ã¸</pre><br/><span class='lineno'>06704</span><pre class='pre'>		if (!empty($this-&gt;sp_classification_id))</pre><br/><span class='lineno'>06705</span><pre class='pre'>		{</pre><br/><span class='lineno'>06706</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06707</span><pre class='pre'>			{</pre><br/><span class='lineno'>06708</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06709</span><pre class='pre'>			}</pre><br/><span class='lineno'>06710</span><pre class='pre'>			else</pre><br/><span class='lineno'>06711</span><pre class='pre'>			{</pre><br/><span class='lineno'>06712</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06713</span><pre class='pre'>			}</pre><br/><span class='lineno'>06714</span><pre class='pre'>			// --------WHERE SQLæãæ§ç¯ããï¼éå§ï¼--------------------------------------</pre><br/><span class='lineno'>06715</span><pre class='pre'>			// æ­£å¸¸ã®SQLæã¯ä»¥ä¸ã®ãããªSQLæã§ãã</pre><br/><span class='lineno'>06716</span><pre class='pre'>			/*</pre><br/><span class='lineno'>06717</span><pre class='pre'>				photo_id IN (</pre><br/><span class='lineno'>06718</span><pre class='pre'>					SELECT photoid FROM registration_classification WHERE classification_id IN</pre><br/><span class='lineno'>06719</span><pre class='pre'>					(</pre><br/><span class='lineno'>06720</span><pre class='pre'>						SELECT classification_id FROM classification WHERE classification_name like '%å½å%'</pre><br/><span class='lineno'>06721</span><pre class='pre'>					)</pre><br/><span class='lineno'>06722</span><pre class='pre'>				)</pre><br/><span class='lineno'>06723</span><pre class='pre'>			*/</pre><br/><span class='lineno'>06724</span><pre class='pre'>			$sql1 = &quot;SELECT photo_id FROM registration_classification WHERE classification_id IN(&quot;;</pre><br/><span class='lineno'>06725</span><pre class='pre'>			$sql2 = &quot;SELECT classification_id FROM classification WHERE classification_name COLLATE utf8_bin like&quot;.$this-&gt;sp_classification_id;</pre><br/><span class='lineno'>06726</span><pre class='pre'>			$sql3 = $sql1.$sql2.&quot;)&quot;;</pre><br/><span class='lineno'>06727</span><pre class='pre'>			$sql .= &quot;photo_id IN (&quot;.$sql3.&quot;) &quot;;</pre><br/><span class='lineno'>06728</span><pre class='pre'>			// --------WHERE SQLæãæ§ç¯ããï¼çµäºï¼--------------------------------------</pre><br/><span class='lineno'>06729</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06730</span><pre class='pre'>		}</pre><br/><span class='lineno'>06731</span><pre class='pre'></pre><br/><span class='lineno'>06732</span><pre class='pre'>		// æ¹é¢</pre><br/><span class='lineno'>06733</span><pre class='pre'>		if (!empty($this-&gt;sp_direction_id))</pre><br/><span class='lineno'>06734</span><pre class='pre'>		{</pre><br/><span class='lineno'>06735</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06736</span><pre class='pre'>			{</pre><br/><span class='lineno'>06737</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06738</span><pre class='pre'>			}</pre><br/><span class='lineno'>06739</span><pre class='pre'>			else</pre><br/><span class='lineno'>06740</span><pre class='pre'>			{</pre><br/><span class='lineno'>06741</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06742</span><pre class='pre'>			}</pre><br/><span class='lineno'>06743</span><pre class='pre'>			// --------WHERE SQLæãæ§ç¯ããï¼éå§ï¼--------------------------------------</pre><br/><span class='lineno'>06744</span><pre class='pre'>			// æ­£å¸¸ã®SQLæã¯ä»¥ä¸ã®ãããªSQLæã§ãã</pre><br/><span class='lineno'>06745</span><pre class='pre'>			/*</pre><br/><span class='lineno'>06746</span><pre class='pre'>				photo_id IN (</pre><br/><span class='lineno'>06747</span><pre class='pre'>					SELECT photoid FROM registration_classification WHERE direction_id IN</pre><br/><span class='lineno'>06748</span><pre class='pre'>					(</pre><br/><span class='lineno'>06749</span><pre class='pre'>						SELECT direction_id FROM direction WHERE direction_name like '%ä¸­å½%'</pre><br/><span class='lineno'>06750</span><pre class='pre'>					)</pre><br/><span class='lineno'>06751</span><pre class='pre'>				)</pre><br/><span class='lineno'>06752</span><pre class='pre'>			*/</pre><br/><span class='lineno'>06753</span><pre class='pre'>			$sql1 = &quot;SELECT photo_id FROM registration_classification WHERE direction_id IN(&quot;;</pre><br/><span class='lineno'>06754</span><pre class='pre'>			$sql2 = &quot;SELECT direction_id FROM direction WHERE direction_name COLLATE utf8_bin like&quot;.$this-&gt;sp_direction_id;</pre><br/><span class='lineno'>06755</span><pre class='pre'>			$sql3 = $sql1.$sql2.&quot;)&quot;;</pre><br/><span class='lineno'>06756</span><pre class='pre'>			$sql .= &quot;photo_id IN (&quot;.$sql3.&quot;) &quot;;</pre><br/><span class='lineno'>06757</span><pre class='pre'>			// --------WHERE SQLæãæ§ç¯ããï¼çµäºï¼--------------------------------------</pre><br/><span class='lineno'>06758</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06759</span><pre class='pre'>		}</pre><br/><span class='lineno'>06760</span><pre class='pre'></pre><br/><span class='lineno'>06761</span><pre class='pre'>		// å½ã»é½éåºç</pre><br/><span class='lineno'>06762</span><pre class='pre'>		if (!empty($this-&gt;sp_country_prefecture_id))</pre><br/><span class='lineno'>06763</span><pre class='pre'>		{</pre><br/><span class='lineno'>06764</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06765</span><pre class='pre'>			{</pre><br/><span class='lineno'>06766</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06767</span><pre class='pre'>			}</pre><br/><span class='lineno'>06768</span><pre class='pre'>			else</pre><br/><span class='lineno'>06769</span><pre class='pre'>			{</pre><br/><span class='lineno'>06770</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06771</span><pre class='pre'>			}</pre><br/><span class='lineno'>06772</span><pre class='pre'>			// --------WHERE SQLæãæ§ç¯ããï¼éå§ï¼--------------------------------------</pre><br/><span class='lineno'>06773</span><pre class='pre'>			// æ­£å¸¸ã®SQLæã¯ä»¥ä¸ã®ãããªSQLæã§ãã</pre><br/><span class='lineno'>06774</span><pre class='pre'>			/*</pre><br/><span class='lineno'>06775</span><pre class='pre'>				photo_id IN (</pre><br/><span class='lineno'>06776</span><pre class='pre'>					SELECT photoid FROM registration_classification WHERE country_prefecture_id IN</pre><br/><span class='lineno'>06777</span><pre class='pre'>					(</pre><br/><span class='lineno'>06778</span><pre class='pre'>						SELECT country_prefecture_id FROM country_prefecture WHERE country_prefecture_name like '%ä¸­å½%'</pre><br/><span class='lineno'>06779</span><pre class='pre'>					)</pre><br/><span class='lineno'>06780</span><pre class='pre'>				)</pre><br/><span class='lineno'>06781</span><pre class='pre'>			*/</pre><br/><span class='lineno'>06782</span><pre class='pre'>			$sql1 = &quot;SELECT photo_id FROM registration_classification WHERE country_prefecture_id IN(&quot;;</pre><br/><span class='lineno'>06783</span><pre class='pre'>			$sql2 = &quot;SELECT country_prefecture_id FROM country_prefecture WHERE country_prefecture_name COLLATE utf8_bin like&quot;.$this-&gt;sp_country_prefecture_id;</pre><br/><span class='lineno'>06784</span><pre class='pre'>			$sql3 = $sql1.$sql2.&quot;)&quot;;</pre><br/><span class='lineno'>06785</span><pre class='pre'>			$sql .= &quot;photo_id IN (&quot;.$sql3.&quot;) &quot;;</pre><br/><span class='lineno'>06786</span><pre class='pre'>			// --------WHERE SQLæãæ§ç¯ããï¼çµäºï¼--------------------------------------</pre><br/><span class='lineno'>06787</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06788</span><pre class='pre'>		}</pre><br/><span class='lineno'>06789</span><pre class='pre'></pre><br/><span class='lineno'>06790</span><pre class='pre'>		// å°å</pre><br/><span class='lineno'>06791</span><pre class='pre'>		if (!empty($this-&gt;sp_place_id))</pre><br/><span class='lineno'>06792</span><pre class='pre'>		{</pre><br/><span class='lineno'>06793</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06794</span><pre class='pre'>			{</pre><br/><span class='lineno'>06795</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06796</span><pre class='pre'>			}</pre><br/><span class='lineno'>06797</span><pre class='pre'>			else</pre><br/><span class='lineno'>06798</span><pre class='pre'>			{</pre><br/><span class='lineno'>06799</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06800</span><pre class='pre'>			}</pre><br/><span class='lineno'>06801</span><pre class='pre'>			// --------WHERE SQLæãæ§ç¯ããï¼éå§ï¼--------------------------------------</pre><br/><span class='lineno'>06802</span><pre class='pre'>			// æ­£å¸¸ã®SQLæã¯ä»¥ä¸ã®ãããªSQLæã§ãã</pre><br/><span class='lineno'>06803</span><pre class='pre'>			/*</pre><br/><span class='lineno'>06804</span><pre class='pre'>				photo_id IN (</pre><br/><span class='lineno'>06805</span><pre class='pre'>					SELECT photoid FROM registration_classification WHERE place_id IN</pre><br/><span class='lineno'>06806</span><pre class='pre'>					(</pre><br/><span class='lineno'>06807</span><pre class='pre'>						SELECT place_id FROM place WHERE place_name like '%ä¸­å½%'</pre><br/><span class='lineno'>06808</span><pre class='pre'>					)</pre><br/><span class='lineno'>06809</span><pre class='pre'>				)</pre><br/><span class='lineno'>06810</span><pre class='pre'>			*/</pre><br/><span class='lineno'>06811</span><pre class='pre'>			$sql1 = &quot;SELECT photo_id FROM registration_classification WHERE place_id IN(&quot;;</pre><br/><span class='lineno'>06812</span><pre class='pre'>			$sql2 = &quot;SELECT place_id FROM place WHERE place_name COLLATE utf8_bin like&quot;.$this-&gt;sp_place_id;</pre><br/><span class='lineno'>06813</span><pre class='pre'>			$sql3 = $sql1.$sql2.&quot;)&quot;;</pre><br/><span class='lineno'>06814</span><pre class='pre'>			$sql .= &quot;photo_id IN (&quot;.$sql3.&quot;) &quot;;</pre><br/><span class='lineno'>06815</span><pre class='pre'>			// --------WHERE SQLæãæ§ç¯ããï¼çµäºï¼--------------------------------------</pre><br/><span class='lineno'>06816</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06817</span><pre class='pre'>		}</pre><br/><span class='lineno'>06818</span><pre class='pre'></pre><br/><span class='lineno'>06819</span><pre class='pre'>		// ã«ãã´ãªã¼</pre><br/><span class='lineno'>06820</span><pre class='pre'>		if (!empty($this-&gt;sp_keyword_str))</pre><br/><span class='lineno'>06821</span><pre class='pre'>		{</pre><br/><span class='lineno'>06822</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06823</span><pre class='pre'>			{</pre><br/><span class='lineno'>06824</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06825</span><pre class='pre'>			}</pre><br/><span class='lineno'>06826</span><pre class='pre'>			else</pre><br/><span class='lineno'>06827</span><pre class='pre'>			{</pre><br/><span class='lineno'>06828</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06829</span><pre class='pre'>			}</pre><br/><span class='lineno'>06830</span><pre class='pre'>			// --------WHERE SQLæãæ§ç¯ããï¼éå§ï¼--------------------------------------</pre><br/><span class='lineno'>06831</span><pre class='pre'>			// æ­£å¸¸ã®SQLæã¯ä»¥ä¸ã®ãããªSQLæã§ãã</pre><br/><span class='lineno'>06832</span><pre class='pre'>			/*</pre><br/><span class='lineno'>06833</span><pre class='pre'>				photo_id IN (</pre><br/><span class='lineno'>06834</span><pre class='pre'>					SELECT photo_id FROM keyword WHERE keyword_name like '%ä¸­å½%'</pre><br/><span class='lineno'>06835</span><pre class='pre'>					AND keyword_name</pre><br/><span class='lineno'>06836</span><pre class='pre'>					IN (</pre><br/><span class='lineno'>06837</span><pre class='pre'>					SELECT category_name</pre><br/><span class='lineno'>06838</span><pre class='pre'>					FROM category</pre><br/><span class='lineno'>06839</span><pre class='pre'>					WHERE category_name</pre><br/><span class='lineno'>06840</span><pre class='pre'>					COLLATE utf8_bin LIKE '%ç©%'</pre><br/><span class='lineno'>06841</span><pre class='pre'>					)</pre><br/><span class='lineno'>06842</span><pre class='pre'>				)</pre><br/><span class='lineno'>06843</span><pre class='pre'>			*/</pre><br/><span class='lineno'>06844</span><pre class='pre'>			$sql1 = &quot;SELECT photo_id FROM keyword WHERE keyword_name COLLATE utf8_bin LIKE&quot;.$this-&gt;sp_keyword_str;</pre><br/><span class='lineno'>06845</span><pre class='pre'>			$sql1 .= &quot; AND keyword_name IN (&quot;;</pre><br/><span class='lineno'>06846</span><pre class='pre'>			$sql1 .= &quot;SELECT category_name FROM category WHERE category_name COLLATE utf8_bin LIKE&quot;.$this-&gt;sp_keyword_str.&quot;)&quot;;</pre><br/><span class='lineno'>06847</span><pre class='pre'>			$sql .= &quot;photo_id IN (&quot;.$sql1.&quot;) &quot;;</pre><br/><span class='lineno'>06848</span><pre class='pre'>			// --------WHERE SQLæãæ§ç¯ããï¼çµäºï¼--------------------------------------</pre><br/><span class='lineno'>06849</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06850</span><pre class='pre'>		}</pre><br/><span class='lineno'>06851</span><pre class='pre'></pre><br/><span class='lineno'>06852</span><pre class='pre'>		// ãã®ã¢ã«ã¦ã³ãã®ã¿ä½¿ç¨å¯(ç¬å ä½¿ç¨)</pre><br/><span class='lineno'>06853</span><pre class='pre'>		if (!empty($this-&gt;sp_monopoly_use))</pre><br/><span class='lineno'>06854</span><pre class='pre'>		{</pre><br/><span class='lineno'>06855</span><pre class='pre'>			if ($optset == false)</pre><br/><span class='lineno'>06856</span><pre class='pre'>			{</pre><br/><span class='lineno'>06857</span><pre class='pre'>				$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06858</span><pre class='pre'>			}</pre><br/><span class='lineno'>06859</span><pre class='pre'>			else</pre><br/><span class='lineno'>06860</span><pre class='pre'>			{</pre><br/><span class='lineno'>06861</span><pre class='pre'>				$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06862</span><pre class='pre'>			}</pre><br/><span class='lineno'>06863</span><pre class='pre'>			$only_use = substr($this-&gt;sp_monopoly_use,1);</pre><br/><span class='lineno'>06864</span><pre class='pre'>			$sql .= &quot;monopoly_use = &quot;.$only_use;</pre><br/><span class='lineno'>06865</span><pre class='pre'>			//ä»å½åç»åç»é²ç³è«èåBUDç®¡çèå¯æ¥è¯¢</pre><br/><span class='lineno'>06866</span><pre class='pre'>			if($only_use == &quot;1&quot; &amp;&amp; $this-&gt;sp_login_id != &quot;admin&quot;) {</pre><br/><span class='lineno'>06867</span><pre class='pre'>			    $sql .= &quot; AND registration_account = '&quot;.$this-&gt;sp_login_id.&quot;'&quot;;</pre><br/><span class='lineno'>06868</span><pre class='pre'>			}</pre><br/><span class='lineno'>06869</span><pre class='pre'>			$optset = true;</pre><br/><span class='lineno'>06870</span><pre class='pre'>		}</pre><br/><span class='lineno'>06871</span><pre class='pre'>		else {</pre><br/><span class='lineno'>06872</span><pre class='pre'>		    if($this-&gt;sp_login_id != &quot;admin&quot;) {</pre><br/><span class='lineno'>06873</span><pre class='pre'></pre><br/><span class='lineno'>06874</span><pre class='pre'>		        if ($optset == false)</pre><br/><span class='lineno'>06875</span><pre class='pre'>		        {</pre><br/><span class='lineno'>06876</span><pre class='pre'>		            $sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06877</span><pre class='pre'>		        }</pre><br/><span class='lineno'>06878</span><pre class='pre'>		        else</pre><br/><span class='lineno'>06879</span><pre class='pre'>		        {</pre><br/><span class='lineno'>06880</span><pre class='pre'>		            $sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06881</span><pre class='pre'>		        }</pre><br/><span class='lineno'>06882</span><pre class='pre'></pre><br/><span class='lineno'>06883</span><pre class='pre'>		        $sql .= &quot; (monopoly_use = 1 AND registration_account = '&quot;.$this-&gt;sp_login_id.&quot;'&quot;</pre><br/><span class='lineno'>06884</span><pre class='pre'>		            .&quot; OR monopoly_use = 0) &quot;;</pre><br/><span class='lineno'>06885</span><pre class='pre'></pre><br/><span class='lineno'>06886</span><pre class='pre'>		        $optset = true;</pre><br/><span class='lineno'>06887</span><pre class='pre'>		    }</pre><br/><span class='lineno'>06888</span><pre class='pre'>		}</pre><br/><span class='lineno'>06889</span><pre class='pre'></pre><br/><span class='lineno'>06890</span><pre class='pre'>		// æ¡ä»¶ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>06891</span><pre class='pre'>		if ($optset == false)</pre><br/><span class='lineno'>06892</span><pre class='pre'>		{</pre><br/><span class='lineno'>06893</span><pre class='pre'>			$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>06894</span><pre class='pre'>		}</pre><br/><span class='lineno'>06895</span><pre class='pre'>		else</pre><br/><span class='lineno'>06896</span><pre class='pre'>		{</pre><br/><span class='lineno'>06897</span><pre class='pre'>			$sql .= &quot; AND &quot;;</pre><br/><span class='lineno'>06898</span><pre class='pre'>		}</pre><br/><span class='lineno'>06899</span><pre class='pre'>		//$sql .= &quot;photo_mno NOT LIKE '%ç³è«ä¸­%'&quot;;</pre><br/><span class='lineno'>06900</span><pre class='pre'>		//2008-12-22 debug</pre><br/><span class='lineno'>06901</span><pre class='pre'>		$sql .= &quot; photoimg.publishing_situation_id = 2&quot;;</pre><br/><span class='lineno'>06902</span><pre class='pre'></pre><br/><span class='lineno'>06903</span><pre class='pre'>		//$sql .= &quot; photoimg.publishing_situation_id = 2 OR photoimg.publishing_situation_id = 1&quot;;</pre><br/><span class='lineno'>06904</span><pre class='pre'>		if(!empty($p_tmp_kikan))</pre><br/><span class='lineno'>06905</span><pre class='pre'>		{</pre><br/><span class='lineno'>06906</span><pre class='pre'>			if((int)$p_tmp_kikan == 3)</pre><br/><span class='lineno'>06907</span><pre class='pre'>			{</pre><br/><span class='lineno'>06908</span><pre class='pre'>				$sql .= &quot; AND DATEDIFF( photoimg.dto, NOW() ) &gt;90&quot;;</pre><br/><span class='lineno'>06909</span><pre class='pre'>			}</pre><br/><span class='lineno'>06910</span><pre class='pre'></pre><br/><span class='lineno'>06911</span><pre class='pre'>			if((int)$p_tmp_kikan == 6)</pre><br/><span class='lineno'>06912</span><pre class='pre'>			{</pre><br/><span class='lineno'>06913</span><pre class='pre'>				$sql .= &quot; AND DATEDIFF( photoimg.dto, NOW() ) &gt;180&quot;;</pre><br/><span class='lineno'>06914</span><pre class='pre'>			}</pre><br/><span class='lineno'>06915</span><pre class='pre'></pre><br/><span class='lineno'>06916</span><pre class='pre'>			if((int)$p_tmp_kikan == 9)</pre><br/><span class='lineno'>06917</span><pre class='pre'>			{</pre><br/><span class='lineno'>06918</span><pre class='pre'>				$sql .= &quot; AND photoimg.kikan = 'mukigen'&quot;;</pre><br/><span class='lineno'>06919</span><pre class='pre'>			}</pre><br/><span class='lineno'>06920</span><pre class='pre'>		}</pre><br/><span class='lineno'>06921</span><pre class='pre'>		$sql .= &quot; AND photo_server_flg = 0 ORDER BY photo_id DESC&quot;;</pre><br/><span class='lineno'>06922</span><pre class='pre'></pre><br/><span class='lineno'>06923</span><pre class='pre'>		$sqlcount = $sql;</pre><br/><span class='lineno'>06924</span><pre class='pre'></pre><br/><span class='lineno'>06925</span><pre class='pre'>		if (!empty($this-&gt;sp_photo_id_str))</pre><br/><span class='lineno'>06926</span><pre class='pre'>		{</pre><br/><span class='lineno'>06927</span><pre class='pre'>			//å¦çããªã</pre><br/><span class='lineno'>06928</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>06929</span><pre class='pre'>			$tmpistart = (int)$this-&gt;istart;</pre><br/><span class='lineno'>06930</span><pre class='pre'>			$tmpend = (int)$this-&gt;iend;</pre><br/><span class='lineno'>06931</span><pre class='pre'></pre><br/><span class='lineno'>06932</span><pre class='pre'>			if ($tmpistart &gt;= 0 &amp;&amp; $tmpend &gt; 0)</pre><br/><span class='lineno'>06933</span><pre class='pre'>			{</pre><br/><span class='lineno'>06934</span><pre class='pre'>				$sql .= &quot; LIMIT &quot;.$this-&gt;istart.&quot;,&quot;.$this-&gt;iend;</pre><br/><span class='lineno'>06935</span><pre class='pre'>			}</pre><br/><span class='lineno'>06936</span><pre class='pre'>		}</pre><br/><span class='lineno'>06937</span><pre class='pre'></pre><br/><span class='lineno'>06938</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>06939</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>06940</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>06941</span><pre class='pre'>		{</pre><br/><span class='lineno'>06942</span><pre class='pre'>			// å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>06943</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>06944</span><pre class='pre'>			// é¸æããããã¼ã¿æ°ãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>06945</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>06946</span><pre class='pre'>			{</pre><br/><span class='lineno'>06947</span><pre class='pre'>				// ã¤ã¡ã¼ã¸ãçµ±è¨ãã</pre><br/><span class='lineno'>06948</span><pre class='pre'></pre><br/><span class='lineno'>06949</span><pre class='pre'>				$stmtcount = $db_link-&gt;prepare($sqlcount);</pre><br/><span class='lineno'>06950</span><pre class='pre'>				$resultcount = $stmtcount-&gt;execute();</pre><br/><span class='lineno'>06951</span><pre class='pre'>				if ($resultcount == true)</pre><br/><span class='lineno'>06952</span><pre class='pre'>				{</pre><br/><span class='lineno'>06953</span><pre class='pre'>					if ($this-&gt;imagescount &lt;= 0)</pre><br/><span class='lineno'>06954</span><pre class='pre'>					{</pre><br/><span class='lineno'>06955</span><pre class='pre'>						$this-&gt;imagescount = $stmtcount-&gt;rowCount();</pre><br/><span class='lineno'>06956</span><pre class='pre'>					}</pre><br/><span class='lineno'>06957</span><pre class='pre'>				} else {</pre><br/><span class='lineno'>06958</span><pre class='pre'>					$this-&gt;imagescount = 0;</pre><br/><span class='lineno'>06959</span><pre class='pre'>				}</pre><br/><span class='lineno'>06960</span><pre class='pre'>				$this-&gt;images = array();</pre><br/><span class='lineno'>06961</span><pre class='pre'>				//if (!empty($this-&gt;istart) &amp;&amp; !empty($this-&gt;iend))</pre><br/><span class='lineno'>06962</span><pre class='pre'>				//{</pre><br/><span class='lineno'>06963</span><pre class='pre'>					if ((int)$this-&gt;istart &gt;= 0 &amp;&amp; (int)$this-&gt;iend &gt; 0)</pre><br/><span class='lineno'>06964</span><pre class='pre'>					{</pre><br/><span class='lineno'>06965</span><pre class='pre'>						$tmpend = $this-&gt;iend - $this-&gt;istart;</pre><br/><span class='lineno'>06966</span><pre class='pre'>					} else {</pre><br/><span class='lineno'>06967</span><pre class='pre'>						$tmpend = 0;</pre><br/><span class='lineno'>06968</span><pre class='pre'>					}</pre><br/><span class='lineno'>06969</span><pre class='pre'>				//} else {</pre><br/><span class='lineno'>06970</span><pre class='pre'>				//	$tmpend = 0;</pre><br/><span class='lineno'>06971</span><pre class='pre'>				//}</pre><br/><span class='lineno'>06972</span><pre class='pre'></pre><br/><span class='lineno'>06973</span><pre class='pre'>				$tmpi = 0;</pre><br/><span class='lineno'>06974</span><pre class='pre'></pre><br/><span class='lineno'>06975</span><pre class='pre'>				while($image_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>06976</span><pre class='pre'>				{</pre><br/><span class='lineno'>06977</span><pre class='pre'>					$tmpi = $tmpi + 1;</pre><br/><span class='lineno'>06978</span><pre class='pre'>					if ($tmpend &gt; 0)</pre><br/><span class='lineno'>06979</span><pre class='pre'>					{</pre><br/><span class='lineno'>06980</span><pre class='pre'>						if ($tmpi &gt; $tmpend)</pre><br/><span class='lineno'>06981</span><pre class='pre'>						{</pre><br/><span class='lineno'>06982</span><pre class='pre'>							break;</pre><br/><span class='lineno'>06983</span><pre class='pre'>						}</pre><br/><span class='lineno'>06984</span><pre class='pre'>					}</pre><br/><span class='lineno'>06985</span><pre class='pre'>					// ç»åãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>06986</span><pre class='pre'>					$photo_idata = new PhotoImageDataAll();</pre><br/><span class='lineno'>06987</span><pre class='pre'>					$photo_idata-&gt;set_data($image_data);</pre><br/><span class='lineno'>06988</span><pre class='pre'>					$this-&gt;images[] = $photo_idata;</pre><br/><span class='lineno'>06989</span><pre class='pre'>				}</pre><br/><span class='lineno'>06990</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>06991</span><pre class='pre'>				$this-&gt;imagescount = 0;</pre><br/><span class='lineno'>06992</span><pre class='pre'>			}</pre><br/><span class='lineno'>06993</span><pre class='pre'>		}</pre><br/><span class='lineno'>06994</span><pre class='pre'>		else</pre><br/><span class='lineno'>06995</span><pre class='pre'>		{</pre><br/><span class='lineno'>06996</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>06997</span><pre class='pre'>			$this-&gt;message = &quot;ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>06998</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>06999</span><pre class='pre'>			//echo $err[2];</pre><br/><span class='lineno'>07000</span><pre class='pre'>		}</pre><br/><span class='lineno'>07001</span><pre class='pre'></pre><br/><span class='lineno'>07002</span><pre class='pre'>		return $this-&gt;images;</pre><br/><span class='lineno'>07003</span><pre class='pre'>	}</pre><br/><span class='lineno'>07004</span><pre class='pre'></pre><br/><span class='lineno'>07005</span><pre class='pre'>	function select_image_fmid_2($db_link)</pre><br/><span class='lineno'>07006</span><pre class='pre'>	{</pre><br/><span class='lineno'>07007</span><pre class='pre'>		// æ¤ç´¢æ¡ä»¶ãè¨­å®ããã¦ããªãå ´åã¯ãæ»ãã¾ãã</pre><br/><span class='lineno'>07008</span><pre class='pre'>		if (empty($this-&gt;sp_photo_id_str))</pre><br/><span class='lineno'>07009</span><pre class='pre'>		{</pre><br/><span class='lineno'>07010</span><pre class='pre'>			return ;</pre><br/><span class='lineno'>07011</span><pre class='pre'>		}</pre><br/><span class='lineno'>07012</span><pre class='pre'></pre><br/><span class='lineno'>07013</span><pre class='pre'>		// SQLãã»ãããã¾ãã</pre><br/><span class='lineno'>07014</span><pre class='pre'>		$sql = $this-&gt;set_sql();</pre><br/><span class='lineno'>07015</span><pre class='pre'></pre><br/><span class='lineno'>07016</span><pre class='pre'>		// æ¡ä»¶ãæå­åããéåã«ãã¾ãã</pre><br/><span class='lineno'>07017</span><pre class='pre'>		$sp_photo_id_a = explode(&quot;,&quot;, $this-&gt;sp_photo_id_str);</pre><br/><span class='lineno'>07018</span><pre class='pre'>		$ed = count($sp_photo_id_a);</pre><br/><span class='lineno'>07019</span><pre class='pre'>		$opt = array();</pre><br/><span class='lineno'>07020</span><pre class='pre'>		$optset = false;</pre><br/><span class='lineno'>07021</span><pre class='pre'>		for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>07022</span><pre class='pre'>		{</pre><br/><span class='lineno'>07023</span><pre class='pre'>			if (!empty($sp_photo_id_a))</pre><br/><span class='lineno'>07024</span><pre class='pre'>			{</pre><br/><span class='lineno'>07025</span><pre class='pre'>				if ($optset == false)</pre><br/><span class='lineno'>07026</span><pre class='pre'>				{</pre><br/><span class='lineno'>07027</span><pre class='pre'>					$sql .= &quot; WHERE &quot;;</pre><br/><span class='lineno'>07028</span><pre class='pre'>				}</pre><br/><span class='lineno'>07029</span><pre class='pre'>				else</pre><br/><span class='lineno'>07030</span><pre class='pre'>				{</pre><br/><span class='lineno'>07031</span><pre class='pre'>					$sql .= &quot; or &quot;;</pre><br/><span class='lineno'>07032</span><pre class='pre'>				}</pre><br/><span class='lineno'>07033</span><pre class='pre'>				$sql .= &quot; photo_id = ? &quot;;</pre><br/><span class='lineno'>07034</span><pre class='pre'>				$opt[] = $sp_photo_id_a[$i];</pre><br/><span class='lineno'>07035</span><pre class='pre'>				$optset = true;</pre><br/><span class='lineno'>07036</span><pre class='pre'>			}</pre><br/><span class='lineno'>07037</span><pre class='pre'>		}</pre><br/><span class='lineno'>07038</span><pre class='pre'></pre><br/><span class='lineno'>07039</span><pre class='pre'>		// æ¡ä»¶ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>07040</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07041</span><pre class='pre'>		$ed = count($opt);</pre><br/><span class='lineno'>07042</span><pre class='pre'>		for($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>07043</span><pre class='pre'>		{</pre><br/><span class='lineno'>07044</span><pre class='pre'>			$stmt-&gt;bindParam($i + 1, $opt[$i]);</pre><br/><span class='lineno'>07045</span><pre class='pre'>		}</pre><br/><span class='lineno'>07046</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07047</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>07048</span><pre class='pre'>		{</pre><br/><span class='lineno'>07049</span><pre class='pre'>			// å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>07050</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>07051</span><pre class='pre'></pre><br/><span class='lineno'>07052</span><pre class='pre'>			// é¸æããããã¼ã¿æ°ãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>07053</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>07054</span><pre class='pre'>			{</pre><br/><span class='lineno'>07055</span><pre class='pre'>				$this-&gt;images = array();</pre><br/><span class='lineno'>07056</span><pre class='pre'>				while($image_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>07057</span><pre class='pre'>				{</pre><br/><span class='lineno'>07058</span><pre class='pre'>					// ç»åãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>07059</span><pre class='pre'>					$photo_idata = new PhotoImageDataAll();</pre><br/><span class='lineno'>07060</span><pre class='pre'>					$photo_idata-&gt;set_data($image_data);</pre><br/><span class='lineno'>07061</span><pre class='pre'>					$this-&gt;images[] = $photo_idata;</pre><br/><span class='lineno'>07062</span><pre class='pre'>				}</pre><br/><span class='lineno'>07063</span><pre class='pre'>			}</pre><br/><span class='lineno'>07064</span><pre class='pre'>		}</pre><br/><span class='lineno'>07065</span><pre class='pre'>		else</pre><br/><span class='lineno'>07066</span><pre class='pre'>		{</pre><br/><span class='lineno'>07067</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>07068</span><pre class='pre'>			$this-&gt;message = &quot;ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>07069</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07070</span><pre class='pre'>		}</pre><br/><span class='lineno'>07071</span><pre class='pre'></pre><br/><span class='lineno'>07072</span><pre class='pre'>		return $this-&gt;images;</pre><br/><span class='lineno'>07073</span><pre class='pre'>	}</pre><br/><span class='lineno'>07074</span><pre class='pre'></pre><br/><span class='lineno'>07075</span><pre class='pre'>	function select_image_fmid($db_link)</pre><br/><span class='lineno'>07076</span><pre class='pre'>	{</pre><br/><span class='lineno'>07077</span><pre class='pre'>		// æ¤ç´¢æ¡ä»¶ãè¨­å®ããã¦ããªãå ´åã¯ãæ»ãã¾ãã</pre><br/><span class='lineno'>07078</span><pre class='pre'>		if (empty($this-&gt;sp_photo_id_str))</pre><br/><span class='lineno'>07079</span><pre class='pre'>		{</pre><br/><span class='lineno'>07080</span><pre class='pre'>			return ;</pre><br/><span class='lineno'>07081</span><pre class='pre'>		}</pre><br/><span class='lineno'>07082</span><pre class='pre'></pre><br/><span class='lineno'>07083</span><pre class='pre'>		// SQLãã»ãããã¾ãã</pre><br/><span class='lineno'>07084</span><pre class='pre'>		$sql = $this-&gt;set_sql();</pre><br/><span class='lineno'>07085</span><pre class='pre'>		$sql .= &quot; WHERE photo_id=?&quot;;</pre><br/><span class='lineno'>07086</span><pre class='pre'></pre><br/><span class='lineno'>07087</span><pre class='pre'>		// æ¡ä»¶ãæå­åããéåã«ãã¾ãã</pre><br/><span class='lineno'>07088</span><pre class='pre'>		$sp_photo_id_a = explode(&quot;,&quot;, $this-&gt;sp_photo_id_str);</pre><br/><span class='lineno'>07089</span><pre class='pre'>		$ed = count($sp_photo_id_a);</pre><br/><span class='lineno'>07090</span><pre class='pre'>		$this-&gt;images = array();</pre><br/><span class='lineno'>07091</span><pre class='pre'>		for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>07092</span><pre class='pre'>		{</pre><br/><span class='lineno'>07093</span><pre class='pre'>			if (!empty($sp_photo_id_a))</pre><br/><span class='lineno'>07094</span><pre class='pre'>			{</pre><br/><span class='lineno'>07095</span><pre class='pre'>				// æ¡ä»¶ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>07096</span><pre class='pre'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07097</span><pre class='pre'>				$stmt-&gt;bindParam(1, $sp_photo_id_a[$i]);</pre><br/><span class='lineno'>07098</span><pre class='pre'>				$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07099</span><pre class='pre'>				if ($result == true)</pre><br/><span class='lineno'>07100</span><pre class='pre'>				{</pre><br/><span class='lineno'>07101</span><pre class='pre'>					// å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>07102</span><pre class='pre'>					$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>07103</span><pre class='pre'></pre><br/><span class='lineno'>07104</span><pre class='pre'>					// é¸æããããã¼ã¿æ°ãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>07105</span><pre class='pre'>					if ($icount == 1)</pre><br/><span class='lineno'>07106</span><pre class='pre'>					{</pre><br/><span class='lineno'>07107</span><pre class='pre'>						$image_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>07108</span><pre class='pre'>						// ç»åãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>07109</span><pre class='pre'>						$photo_idata = new PhotoImageDataAll();</pre><br/><span class='lineno'>07110</span><pre class='pre'>						$photo_idata-&gt;set_data($image_data);</pre><br/><span class='lineno'>07111</span><pre class='pre'>						$this-&gt;images[] = $photo_idata;</pre><br/><span class='lineno'>07112</span><pre class='pre'>					}</pre><br/><span class='lineno'>07113</span><pre class='pre'>				}</pre><br/><span class='lineno'>07114</span><pre class='pre'>				else</pre><br/><span class='lineno'>07115</span><pre class='pre'>				{</pre><br/><span class='lineno'>07116</span><pre class='pre'>					$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>07117</span><pre class='pre'>					$this-&gt;message = &quot;ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>07118</span><pre class='pre'>					throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07119</span><pre class='pre'>				}</pre><br/><span class='lineno'>07120</span><pre class='pre'>			}</pre><br/><span class='lineno'>07121</span><pre class='pre'>		}</pre><br/><span class='lineno'>07122</span><pre class='pre'></pre><br/><span class='lineno'>07123</span><pre class='pre'>		return $this-&gt;images;</pre><br/><span class='lineno'>07124</span><pre class='pre'>	}</pre><br/><span class='lineno'>07125</span><pre class='pre'></pre><br/><span class='lineno'>07126</span><pre class='pre'>	//select the image data</pre><br/><span class='lineno'>07127</span><pre class='pre'>	function select_image_registed($db_link,$where=&quot;&quot;,$orderby=&quot;&quot;)</pre><br/><span class='lineno'>07128</span><pre class='pre'>	{</pre><br/><span class='lineno'>07129</span><pre class='pre'>		// SQLãã»ãããã¾ãã</pre><br/><span class='lineno'>07130</span><pre class='pre'>		$sql = $this-&gt;set_sql();</pre><br/><span class='lineno'>07131</span><pre class='pre'>		$sql .= &quot; WHERE photoimg.publishing_situation_id = 2 AND photo_server_flg=0&quot;;</pre><br/><span class='lineno'>07132</span><pre class='pre'>		//yupengbo add 2011/11/14 start</pre><br/><span class='lineno'>07133</span><pre class='pre'>		if(!empty($where)) {</pre><br/><span class='lineno'>07134</span><pre class='pre'>			$sql .= &quot; AND &quot;.$where;</pre><br/><span class='lineno'>07135</span><pre class='pre'>		}</pre><br/><span class='lineno'>07136</span><pre class='pre'>		//yupengbo add 2011/11/14 end</pre><br/><span class='lineno'>07137</span><pre class='pre'>		//yupengbo add 2011/11/15 start</pre><br/><span class='lineno'>07138</span><pre class='pre'>		if(!empty($orderby))</pre><br/><span class='lineno'>07139</span><pre class='pre'>		{</pre><br/><span class='lineno'>07140</span><pre class='pre'>			$sql .= &quot; ORDER BY &quot;.$orderby;</pre><br/><span class='lineno'>07141</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>07142</span><pre class='pre'>			$sql .= &quot; ORDER BY photo_id &quot;;</pre><br/><span class='lineno'>07143</span><pre class='pre'>		}</pre><br/><span class='lineno'>07144</span><pre class='pre'>		//yupengbo add 2011/11/15 end</pre><br/><span class='lineno'>07145</span><pre class='pre'></pre><br/><span class='lineno'>07146</span><pre class='pre'>		$tmpistart = (int)$this-&gt;istart;</pre><br/><span class='lineno'>07147</span><pre class='pre'>		$tmpend = (int)$this-&gt;iend;</pre><br/><span class='lineno'>07148</span><pre class='pre'></pre><br/><span class='lineno'>07149</span><pre class='pre'>		if ($tmpistart &gt;= 0 &amp;&amp; $tmpend &gt; 0)</pre><br/><span class='lineno'>07150</span><pre class='pre'>		{</pre><br/><span class='lineno'>07151</span><pre class='pre'>			$sql .= &quot; LIMIT &quot;.$this-&gt;istart.&quot;,&quot;.$this-&gt;per_page;</pre><br/><span class='lineno'>07152</span><pre class='pre'>		}</pre><br/><span class='lineno'>07153</span><pre class='pre'></pre><br/><span class='lineno'>07154</span><pre class='pre'>		$this-&gt;images = array();</pre><br/><span class='lineno'>07155</span><pre class='pre'>		// æ¡ä»¶ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>07156</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07157</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07158</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>07159</span><pre class='pre'>		{</pre><br/><span class='lineno'>07160</span><pre class='pre'>			// å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>07161</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>07162</span><pre class='pre'></pre><br/><span class='lineno'>07163</span><pre class='pre'>			// é¸æããããã¼ã¿æ°ãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>07164</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>07165</span><pre class='pre'>			{</pre><br/><span class='lineno'>07166</span><pre class='pre'>				$this-&gt;images = array();</pre><br/><span class='lineno'>07167</span><pre class='pre'>				if (!empty($this-&gt;istart) &amp;&amp; !empty($this-&gt;iend))</pre><br/><span class='lineno'>07168</span><pre class='pre'>				{</pre><br/><span class='lineno'>07169</span><pre class='pre'>					if ((int)$this-&gt;istart &gt;= 0 &amp;&amp; (int)$this-&gt;iend &gt; 0)</pre><br/><span class='lineno'>07170</span><pre class='pre'>					{</pre><br/><span class='lineno'>07171</span><pre class='pre'>						$tmpend = $this-&gt;iend - $this-&gt;istart + 1;</pre><br/><span class='lineno'>07172</span><pre class='pre'>					} else {</pre><br/><span class='lineno'>07173</span><pre class='pre'>						$tmpend = 0;</pre><br/><span class='lineno'>07174</span><pre class='pre'>					}</pre><br/><span class='lineno'>07175</span><pre class='pre'>				} else {</pre><br/><span class='lineno'>07176</span><pre class='pre'>					$tmpend = 0;</pre><br/><span class='lineno'>07177</span><pre class='pre'>				}</pre><br/><span class='lineno'>07178</span><pre class='pre'></pre><br/><span class='lineno'>07179</span><pre class='pre'>				$tmpi = 0;</pre><br/><span class='lineno'>07180</span><pre class='pre'>				while($image_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>07181</span><pre class='pre'>				{</pre><br/><span class='lineno'>07182</span><pre class='pre'>					$tmpi = $tmpi + 1;</pre><br/><span class='lineno'>07183</span><pre class='pre'></pre><br/><span class='lineno'>07184</span><pre class='pre'>					if ($tmpend &gt; 0)</pre><br/><span class='lineno'>07185</span><pre class='pre'>					{</pre><br/><span class='lineno'>07186</span><pre class='pre'>						if ($tmpi &gt; $tmpend)</pre><br/><span class='lineno'>07187</span><pre class='pre'>						{</pre><br/><span class='lineno'>07188</span><pre class='pre'>							break;</pre><br/><span class='lineno'>07189</span><pre class='pre'>						}</pre><br/><span class='lineno'>07190</span><pre class='pre'>					}</pre><br/><span class='lineno'>07191</span><pre class='pre'>					// ç»åãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>07192</span><pre class='pre'>					$photo_idata = new PhotoImageDataAll();</pre><br/><span class='lineno'>07193</span><pre class='pre'>					$photo_idata-&gt;set_data($image_data);</pre><br/><span class='lineno'>07194</span><pre class='pre'>					$this-&gt;images[] = $photo_idata;</pre><br/><span class='lineno'>07195</span><pre class='pre'>				}</pre><br/><span class='lineno'>07196</span><pre class='pre'>			}</pre><br/><span class='lineno'>07197</span><pre class='pre'>		}</pre><br/><span class='lineno'>07198</span><pre class='pre'>		else</pre><br/><span class='lineno'>07199</span><pre class='pre'>		{</pre><br/><span class='lineno'>07200</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>07201</span><pre class='pre'>			$this-&gt;message = &quot;ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>07202</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07203</span><pre class='pre'>		}</pre><br/><span class='lineno'>07204</span><pre class='pre'>		return $this-&gt;images;</pre><br/><span class='lineno'>07205</span><pre class='pre'>	}</pre><br/><span class='lineno'>07206</span><pre class='pre'></pre><br/><span class='lineno'>07207</span><pre class='pre'></pre><br/><span class='lineno'>07208</span><pre class='pre'>	function select_image_registed_forDelete($db_link,$where=&quot;&quot;,$orderby=&quot;&quot;)</pre><br/><span class='lineno'>07209</span><pre class='pre'>	{</pre><br/><span class='lineno'>07210</span><pre class='pre'>	    // SQLãã»ãããã¾ãã</pre><br/><span class='lineno'>07211</span><pre class='pre'>	    $sql = $this-&gt;set_sql();</pre><br/><span class='lineno'>07212</span><pre class='pre'>	    $sql .= &quot; WHERE photoimg.publishing_situation_id = 2 AND photo_server_flg=0&quot;;</pre><br/><span class='lineno'>07213</span><pre class='pre'>	    //yupengbo add 2011/11/14 start</pre><br/><span class='lineno'>07214</span><pre class='pre'>	    if(!empty($where)) {</pre><br/><span class='lineno'>07215</span><pre class='pre'>	        $sql .= &quot; AND &quot;.$where;</pre><br/><span class='lineno'>07216</span><pre class='pre'>	    }</pre><br/><span class='lineno'>07217</span><pre class='pre'>	    //yupengbo add 2011/11/14 end</pre><br/><span class='lineno'>07218</span><pre class='pre'>	    //yupengbo add 2011/11/15 start</pre><br/><span class='lineno'>07219</span><pre class='pre'>	    if(!empty($orderby))</pre><br/><span class='lineno'>07220</span><pre class='pre'>	    {</pre><br/><span class='lineno'>07221</span><pre class='pre'>	        $sql .= &quot; ORDER BY &quot;.$orderby;</pre><br/><span class='lineno'>07222</span><pre class='pre'>	    } else {</pre><br/><span class='lineno'>07223</span><pre class='pre'>	        $sql .= &quot; ORDER BY photo_id &quot;;</pre><br/><span class='lineno'>07224</span><pre class='pre'>	    }</pre><br/><span class='lineno'>07225</span><pre class='pre'>	    //yupengbo add 2011/11/15 end</pre><br/><span class='lineno'>07226</span><pre class='pre'></pre><br/><span class='lineno'>07227</span><pre class='pre'>	    $tmpistart = (int)$this-&gt;istart;</pre><br/><span class='lineno'>07228</span><pre class='pre'>	    $tmpend = (int)$this-&gt;iend;</pre><br/><span class='lineno'>07229</span><pre class='pre'></pre><br/><span class='lineno'>07230</span><pre class='pre'>	    if ($tmpistart &gt;= 0 &amp;&amp; $tmpend &gt; 0)</pre><br/><span class='lineno'>07231</span><pre class='pre'>	    {</pre><br/><span class='lineno'>07232</span><pre class='pre'>	        $sql .= &quot; LIMIT &quot;.$this-&gt;istart.&quot;,&quot;.$this-&gt;iend;</pre><br/><span class='lineno'>07233</span><pre class='pre'>	    }</pre><br/><span class='lineno'>07234</span><pre class='pre'></pre><br/><span class='lineno'>07235</span><pre class='pre'>	    $this-&gt;images = array();</pre><br/><span class='lineno'>07236</span><pre class='pre'>	    // æ¡ä»¶ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>07237</span><pre class='pre'>	    $stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07238</span><pre class='pre'>	    $result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07239</span><pre class='pre'>	    if ($result == true)</pre><br/><span class='lineno'>07240</span><pre class='pre'>	    {</pre><br/><span class='lineno'>07241</span><pre class='pre'>	        // å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>07242</span><pre class='pre'>	        $icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>07243</span><pre class='pre'></pre><br/><span class='lineno'>07244</span><pre class='pre'>	        // é¸æããããã¼ã¿æ°ãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>07245</span><pre class='pre'>	        if ($icount &gt; 0)</pre><br/><span class='lineno'>07246</span><pre class='pre'>	        {</pre><br/><span class='lineno'>07247</span><pre class='pre'>	            $this-&gt;images = array();</pre><br/><span class='lineno'>07248</span><pre class='pre'>	            if (!empty($this-&gt;istart) &amp;&amp; !empty($this-&gt;iend))</pre><br/><span class='lineno'>07249</span><pre class='pre'>	            {</pre><br/><span class='lineno'>07250</span><pre class='pre'>	                if ((int)$this-&gt;istart &gt;= 0 &amp;&amp; (int)$this-&gt;iend &gt; 0)</pre><br/><span class='lineno'>07251</span><pre class='pre'>	                {</pre><br/><span class='lineno'>07252</span><pre class='pre'>	                    $tmpend = $this-&gt;iend - $this-&gt;istart + 1;</pre><br/><span class='lineno'>07253</span><pre class='pre'>	                } else {</pre><br/><span class='lineno'>07254</span><pre class='pre'>	                    $tmpend = 0;</pre><br/><span class='lineno'>07255</span><pre class='pre'>	                }</pre><br/><span class='lineno'>07256</span><pre class='pre'>	            } else {</pre><br/><span class='lineno'>07257</span><pre class='pre'>	                $tmpend = 0;</pre><br/><span class='lineno'>07258</span><pre class='pre'>	            }</pre><br/><span class='lineno'>07259</span><pre class='pre'></pre><br/><span class='lineno'>07260</span><pre class='pre'>	            $tmpi = 0;</pre><br/><span class='lineno'>07261</span><pre class='pre'>	            while($image_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>07262</span><pre class='pre'>	            {</pre><br/><span class='lineno'>07263</span><pre class='pre'>	                $tmpi = $tmpi + 1;</pre><br/><span class='lineno'>07264</span><pre class='pre'></pre><br/><span class='lineno'>07265</span><pre class='pre'>	                if ($tmpend &gt; 0)</pre><br/><span class='lineno'>07266</span><pre class='pre'>	                {</pre><br/><span class='lineno'>07267</span><pre class='pre'>	                    if ($tmpi &gt; $tmpend)</pre><br/><span class='lineno'>07268</span><pre class='pre'>	                    {</pre><br/><span class='lineno'>07269</span><pre class='pre'>	                        break;</pre><br/><span class='lineno'>07270</span><pre class='pre'>	                    }</pre><br/><span class='lineno'>07271</span><pre class='pre'>	                }</pre><br/><span class='lineno'>07272</span><pre class='pre'>	                // ç»åãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>07273</span><pre class='pre'>	                $photo_idata = new PhotoImageDataAll();</pre><br/><span class='lineno'>07274</span><pre class='pre'>	                $photo_idata-&gt;set_data($image_data);</pre><br/><span class='lineno'>07275</span><pre class='pre'>	                $this-&gt;images[] = $photo_idata;</pre><br/><span class='lineno'>07276</span><pre class='pre'>	            }</pre><br/><span class='lineno'>07277</span><pre class='pre'>	        }</pre><br/><span class='lineno'>07278</span><pre class='pre'>	    }</pre><br/><span class='lineno'>07279</span><pre class='pre'>	    else</pre><br/><span class='lineno'>07280</span><pre class='pre'>	    {</pre><br/><span class='lineno'>07281</span><pre class='pre'>	        $err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>07282</span><pre class='pre'>	        $this-&gt;message = &quot;ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>07283</span><pre class='pre'>	        throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07284</span><pre class='pre'>	    }</pre><br/><span class='lineno'>07285</span><pre class='pre'>	    return $this-&gt;images;</pre><br/><span class='lineno'>07286</span><pre class='pre'>	}</pre><br/><span class='lineno'>07287</span><pre class='pre'>	//yupengbo add 2011/11/17 start</pre><br/><span class='lineno'>07288</span><pre class='pre'>	function select_image_deleted($db_link,$where=&quot;&quot;,$orderby=&quot;register_date&quot;)</pre><br/><span class='lineno'>07289</span><pre class='pre'>	{</pre><br/><span class='lineno'>07290</span><pre class='pre'>		global $table_log_name;</pre><br/><span class='lineno'>07291</span><pre class='pre'>		// SQLãã»ãããã¾ãã</pre><br/><span class='lineno'>07292</span><pre class='pre'>		$sql = &quot;SELECT * FROM &quot;.$table_log_name.&quot; WHERE 1=1&quot;;</pre><br/><span class='lineno'>07293</span><pre class='pre'>		if(!empty($where)) $sql .= $where;</pre><br/><span class='lineno'>07294</span><pre class='pre'>		$sql .= &quot; ORDER BY &quot;.$orderby;</pre><br/><span class='lineno'>07295</span><pre class='pre'>		//print $sql;exit;</pre><br/><span class='lineno'>07296</span><pre class='pre'>		$tmpistart = (int)$this-&gt;istart;</pre><br/><span class='lineno'>07297</span><pre class='pre'>		$tmpend = (int)$this-&gt;iend;</pre><br/><span class='lineno'>07298</span><pre class='pre'>		if ($tmpistart &gt;= 0 &amp;&amp; $tmpend &gt; 0) $sql .= &quot; LIMIT &quot;.$this-&gt;istart.&quot;,&quot;.$this-&gt;per_page;</pre><br/><span class='lineno'>07299</span><pre class='pre'>		$this-&gt;images = array();</pre><br/><span class='lineno'>07300</span><pre class='pre'>		// æ¡ä»¶ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>07301</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07302</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07303</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>07304</span><pre class='pre'>		{</pre><br/><span class='lineno'>07305</span><pre class='pre'>			// å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>07306</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>07307</span><pre class='pre'>			// é¸æããããã¼ã¿æ°ãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>07308</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>07309</span><pre class='pre'>			{</pre><br/><span class='lineno'>07310</span><pre class='pre'>				$this-&gt;images = array();</pre><br/><span class='lineno'>07311</span><pre class='pre'>				$tmpend = 0;</pre><br/><span class='lineno'>07312</span><pre class='pre'>				if ((!empty($this-&gt;istart) &amp;&amp; !empty($this-&gt;iend)) &amp;&amp;</pre><br/><span class='lineno'>07313</span><pre class='pre'>				    ((int)$this-&gt;istart &gt;= 0 &amp;&amp; (int)$this-&gt;iend &gt; 0)</pre><br/><span class='lineno'>07314</span><pre class='pre'>				    ) $tmpend = $this-&gt;iend - $this-&gt;istart + 1;</pre><br/><span class='lineno'>07315</span><pre class='pre'></pre><br/><span class='lineno'>07316</span><pre class='pre'>				$tmpi = 0;</pre><br/><span class='lineno'>07317</span><pre class='pre'>				while($image_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>07318</span><pre class='pre'>				{</pre><br/><span class='lineno'>07319</span><pre class='pre'>					$tmpi = $tmpi + 1;</pre><br/><span class='lineno'>07320</span><pre class='pre'>					if (($tmpend &gt; 0) &amp;&amp; ($tmpi &gt; $tmpend)) break;</pre><br/><span class='lineno'>07321</span><pre class='pre'>					// ç»åãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>07322</span><pre class='pre'>					$photo_idata = new PhotoImageLog();</pre><br/><span class='lineno'>07323</span><pre class='pre'>					$photo_idata-&gt;set_data($image_data);</pre><br/><span class='lineno'>07324</span><pre class='pre'>					$this-&gt;images[] = $photo_idata;</pre><br/><span class='lineno'>07325</span><pre class='pre'>				}</pre><br/><span class='lineno'>07326</span><pre class='pre'>			}</pre><br/><span class='lineno'>07327</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>07328</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>07329</span><pre class='pre'>			$this-&gt;message = &quot;ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>07330</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07331</span><pre class='pre'>		}</pre><br/><span class='lineno'>07332</span><pre class='pre'>		return $this-&gt;images;</pre><br/><span class='lineno'>07333</span><pre class='pre'>	}</pre><br/><span class='lineno'>07334</span><pre class='pre'>	//yupengbo add 2011/11/17 end</pre><br/><span class='lineno'>07335</span><pre class='pre'>	//jinxin add 2012/02/07 start</pre><br/><span class='lineno'>07336</span><pre class='pre'>	function select_image_nopermit($db_link,$where=&quot;&quot;,$orderby=&quot;permit_date&quot;)</pre><br/><span class='lineno'>07337</span><pre class='pre'>	{</pre><br/><span class='lineno'>07338</span><pre class='pre'>		global $table_log_name;</pre><br/><span class='lineno'>07339</span><pre class='pre'>		// SQLãã»ãããã¾ãã</pre><br/><span class='lineno'>07340</span><pre class='pre'>		$sql = &quot;SELECT * FROM photoimg WHERE photoimg.publishing_situation_id = 3 AND photo_server_flg = 0&quot;;</pre><br/><span class='lineno'>07341</span><pre class='pre'>		if(!empty($where)) $sql .= $where;</pre><br/><span class='lineno'>07342</span><pre class='pre'>		$sql .= &quot; ORDER BY &quot;.$orderby;</pre><br/><span class='lineno'>07343</span><pre class='pre'>		//print $sql;exit;</pre><br/><span class='lineno'>07344</span><pre class='pre'>		$tmpistart = (int)$this-&gt;istart;</pre><br/><span class='lineno'>07345</span><pre class='pre'>		$tmpend = (int)$this-&gt;iend;</pre><br/><span class='lineno'>07346</span><pre class='pre'>		if ($tmpistart &gt;= 0 &amp;&amp; $tmpend &gt; 0) $sql .= &quot; LIMIT &quot;.$this-&gt;istart.&quot;,&quot;.$this-&gt;per_page;</pre><br/><span class='lineno'>07347</span><pre class='pre'>		$this-&gt;images = array();</pre><br/><span class='lineno'>07348</span><pre class='pre'>		// æ¡ä»¶ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>07349</span><pre class='pre'>//		echo $sql;</pre><br/><span class='lineno'>07350</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07351</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07352</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>07353</span><pre class='pre'>		{</pre><br/><span class='lineno'>07354</span><pre class='pre'>			// å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>07355</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>07356</span><pre class='pre'>			// é¸æããããã¼ã¿æ°ãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>07357</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>07358</span><pre class='pre'>			{</pre><br/><span class='lineno'>07359</span><pre class='pre'>				$this-&gt;images = array();</pre><br/><span class='lineno'>07360</span><pre class='pre'>				$tmpend = 0;</pre><br/><span class='lineno'>07361</span><pre class='pre'>				if ((!empty($this-&gt;istart) &amp;&amp; !empty($this-&gt;iend)) &amp;&amp;</pre><br/><span class='lineno'>07362</span><pre class='pre'>				    ((int)$this-&gt;istart &gt;= 0 &amp;&amp; (int)$this-&gt;iend &gt; 0)</pre><br/><span class='lineno'>07363</span><pre class='pre'>				    ) $tmpend = $this-&gt;iend - $this-&gt;istart + 1;</pre><br/><span class='lineno'>07364</span><pre class='pre'></pre><br/><span class='lineno'>07365</span><pre class='pre'>				$tmpi = 0;</pre><br/><span class='lineno'>07366</span><pre class='pre'>				while($image_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>07367</span><pre class='pre'>				{</pre><br/><span class='lineno'>07368</span><pre class='pre'>//					print_r($image_data);			//add by jinxin 2012/02/07</pre><br/><span class='lineno'>07369</span><pre class='pre'>					$tmpi = $tmpi + 1;</pre><br/><span class='lineno'>07370</span><pre class='pre'>					if (($tmpend &gt; 0) &amp;&amp; ($tmpi &gt; $tmpend)) break;</pre><br/><span class='lineno'>07371</span><pre class='pre'>					// ç»åãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>07372</span><pre class='pre'>					$photo_idata = new PhotoImageNopermit();</pre><br/><span class='lineno'>07373</span><pre class='pre'>					$photo_idata-&gt;set_data($image_data);</pre><br/><span class='lineno'>07374</span><pre class='pre'>					$this-&gt;images[] = $photo_idata;</pre><br/><span class='lineno'>07375</span><pre class='pre'>				}</pre><br/><span class='lineno'>07376</span><pre class='pre'>			}</pre><br/><span class='lineno'>07377</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>07378</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>07379</span><pre class='pre'>			$this-&gt;message = &quot;ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>07380</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07381</span><pre class='pre'>		}</pre><br/><span class='lineno'>07382</span><pre class='pre'>		return $this-&gt;images;</pre><br/><span class='lineno'>07383</span><pre class='pre'>	}</pre><br/><span class='lineno'>07384</span><pre class='pre'>	//jinxin add 2012/02/07 end</pre><br/><span class='lineno'>07385</span><pre class='pre'></pre><br/><span class='lineno'>07386</span><pre class='pre'>	function select_image_registration($db_link)</pre><br/><span class='lineno'>07387</span><pre class='pre'>	{</pre><br/><span class='lineno'>07388</span><pre class='pre'>		//added by wangtognchao 2012-02-14 begin</pre><br/><span class='lineno'>07389</span><pre class='pre'>		global $one_page_records_cnt;</pre><br/><span class='lineno'>07390</span><pre class='pre'>		//added by wangtongchao 2012-02-14 end</pre><br/><span class='lineno'>07391</span><pre class='pre'>		// SQLãã»ãããã¾ãã</pre><br/><span class='lineno'>07392</span><pre class='pre'>		$sql = $this-&gt;set_sql();</pre><br/><span class='lineno'>07393</span><pre class='pre'>		//$sql .= &quot; WHERE photo_mno = \&quot;ç³è«ä¸­\&quot;&quot;;</pre><br/><span class='lineno'>07394</span><pre class='pre'>		//added by wangtongchao 2011-12-14 begin</pre><br/><span class='lineno'>07395</span><pre class='pre'>		$sql .= &quot; WHERE photoimg.publishing_situation_id = 1 AND photo_server_flg = 0&quot;;</pre><br/><span class='lineno'>07396</span><pre class='pre'>		//added by wangtongchao 2011-12-14 end</pre><br/><span class='lineno'>07397</span><pre class='pre'>		$sql .= &quot; ORDER BY photo_id &quot;;</pre><br/><span class='lineno'>07398</span><pre class='pre'></pre><br/><span class='lineno'>07399</span><pre class='pre'>		//if (!empty($this-&gt;istart) &amp;&amp; !empty($this-&gt;iend))</pre><br/><span class='lineno'>07400</span><pre class='pre'>		//{</pre><br/><span class='lineno'>07401</span><pre class='pre'>			$tmpistart = (int)$this-&gt;istart;</pre><br/><span class='lineno'>07402</span><pre class='pre'>			$tmpend = (int)$this-&gt;iend;</pre><br/><span class='lineno'>07403</span><pre class='pre'></pre><br/><span class='lineno'>07404</span><pre class='pre'>			if ($tmpistart &gt;= 0 &amp;&amp; $tmpend &gt; 0)</pre><br/><span class='lineno'>07405</span><pre class='pre'>			{</pre><br/><span class='lineno'>07406</span><pre class='pre'>				//changed by wangtongchao 2012-02-14 begin</pre><br/><span class='lineno'>07407</span><pre class='pre'>				//$sql .= &quot; LIMIT &quot;.$this-&gt;istart.&quot;,&quot;.$this-&gt;iend;</pre><br/><span class='lineno'>07408</span><pre class='pre'>				$sql .= &quot; LIMIT &quot;.$this-&gt;istart.&quot;,&quot;.$one_page_records_cnt;</pre><br/><span class='lineno'>07409</span><pre class='pre'>				//changed by wangtongchao 2012-02-14 end</pre><br/><span class='lineno'>07410</span><pre class='pre'>			}</pre><br/><span class='lineno'>07411</span><pre class='pre'>		//}</pre><br/><span class='lineno'>07412</span><pre class='pre'>		//echo $sql;</pre><br/><span class='lineno'>07413</span><pre class='pre'>		$this-&gt;images = array();</pre><br/><span class='lineno'>07414</span><pre class='pre'>		// æ¡ä»¶ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>07415</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07416</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07417</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>07418</span><pre class='pre'>		{</pre><br/><span class='lineno'>07419</span><pre class='pre'>			// å¦çæ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>07420</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>07421</span><pre class='pre'></pre><br/><span class='lineno'>07422</span><pre class='pre'>			// é¸æããããã¼ã¿æ°ãï¼ãã©ãããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>07423</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>07424</span><pre class='pre'>			{</pre><br/><span class='lineno'>07425</span><pre class='pre'>				$this-&gt;images = array();</pre><br/><span class='lineno'>07426</span><pre class='pre'>				if (!empty($this-&gt;istart) &amp;&amp; !empty($this-&gt;iend))</pre><br/><span class='lineno'>07427</span><pre class='pre'>				{</pre><br/><span class='lineno'>07428</span><pre class='pre'>					if ((int)$this-&gt;istart &gt;= 0 &amp;&amp; (int)$this-&gt;iend &gt; 0)</pre><br/><span class='lineno'>07429</span><pre class='pre'>					{</pre><br/><span class='lineno'>07430</span><pre class='pre'>						$tmpend = $this-&gt;iend - $this-&gt;istart + 1;</pre><br/><span class='lineno'>07431</span><pre class='pre'>					} else {</pre><br/><span class='lineno'>07432</span><pre class='pre'>						$tmpend = 0;</pre><br/><span class='lineno'>07433</span><pre class='pre'>					}</pre><br/><span class='lineno'>07434</span><pre class='pre'>				} else {</pre><br/><span class='lineno'>07435</span><pre class='pre'>					$tmpend = 0;</pre><br/><span class='lineno'>07436</span><pre class='pre'>				}</pre><br/><span class='lineno'>07437</span><pre class='pre'></pre><br/><span class='lineno'>07438</span><pre class='pre'>				$tmpi = 0;</pre><br/><span class='lineno'>07439</span><pre class='pre'>				while($image_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>07440</span><pre class='pre'>				{</pre><br/><span class='lineno'>07441</span><pre class='pre'>					$tmpi = $tmpi + 1;</pre><br/><span class='lineno'>07442</span><pre class='pre'></pre><br/><span class='lineno'>07443</span><pre class='pre'>					if ($tmpend &gt; 0)</pre><br/><span class='lineno'>07444</span><pre class='pre'>					{</pre><br/><span class='lineno'>07445</span><pre class='pre'>						if ($tmpi &gt; $tmpend)</pre><br/><span class='lineno'>07446</span><pre class='pre'>						{</pre><br/><span class='lineno'>07447</span><pre class='pre'>							break;</pre><br/><span class='lineno'>07448</span><pre class='pre'>						}</pre><br/><span class='lineno'>07449</span><pre class='pre'>					}</pre><br/><span class='lineno'>07450</span><pre class='pre'>					// ç»åãã¼ã¿ãã»ãããã¾ãã</pre><br/><span class='lineno'>07451</span><pre class='pre'>					$photo_idata = new PhotoImageDataAll();</pre><br/><span class='lineno'>07452</span><pre class='pre'>					$photo_idata-&gt;set_data($image_data);</pre><br/><span class='lineno'>07453</span><pre class='pre'>					$this-&gt;images[] = $photo_idata;</pre><br/><span class='lineno'>07454</span><pre class='pre'>				}</pre><br/><span class='lineno'>07455</span><pre class='pre'>			}</pre><br/><span class='lineno'>07456</span><pre class='pre'>		}</pre><br/><span class='lineno'>07457</span><pre class='pre'>		else</pre><br/><span class='lineno'>07458</span><pre class='pre'>		{</pre><br/><span class='lineno'>07459</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>07460</span><pre class='pre'>			$this-&gt;message = &quot;ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>07461</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07462</span><pre class='pre'>		}</pre><br/><span class='lineno'>07463</span><pre class='pre'>		return $this-&gt;images;</pre><br/><span class='lineno'>07464</span><pre class='pre'>	}</pre><br/><span class='lineno'>07465</span><pre class='pre'>}</pre><br/><span class='lineno'>07466</span><pre class='pre'></pre><br/><span class='lineno'>07467</span><pre class='pre'>class Album</pre><br/><span class='lineno'>07468</span><pre class='pre'>{</pre><br/><span class='lineno'>07469</span><pre class='pre'>	var $message;					// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>07470</span><pre class='pre'>	var $error;						// ã¨ã©ã¼</pre><br/><span class='lineno'>07471</span><pre class='pre'></pre><br/><span class='lineno'>07472</span><pre class='pre'>	var $sp_album_id;				// ã¢ã«ãã ID</pre><br/><span class='lineno'>07473</span><pre class='pre'>	var $sp_album_name;				// ã¢ã«ãã å</pre><br/><span class='lineno'>07474</span><pre class='pre'>	var $sp_album_explanation;		// èª¬æ</pre><br/><span class='lineno'>07475</span><pre class='pre'>	var $sp_registration_date;		// ç»é²æ¥</pre><br/><span class='lineno'>07476</span><pre class='pre'></pre><br/><span class='lineno'>07477</span><pre class='pre'>	var $sp_state;					// ã¹ãã¼ã¿ã¹ï¼ç¾å¨ã¯å¸¸ã«0ï¼</pre><br/><span class='lineno'>07478</span><pre class='pre'></pre><br/><span class='lineno'>07479</span><pre class='pre'>	var $sp_photo_id;				//	ã¤ã¡ã¼ã¸ID</pre><br/><span class='lineno'>07480</span><pre class='pre'>	var $sp_photo_mno;              //ãã¤ã¡ã¼ã¸ç®¡ççªå·</pre><br/><span class='lineno'>07481</span><pre class='pre'>	var $sp_photo_name;			    //ãåçåï¼ã¿ã¤ãã«ï¼</pre><br/><span class='lineno'>07482</span><pre class='pre'>	var $sp_up_url;					//ãã¢ããã­ã¼ãURL</pre><br/><span class='lineno'>07483</span><pre class='pre'></pre><br/><span class='lineno'>07484</span><pre class='pre'>	function set_album_id($album_id)</pre><br/><span class='lineno'>07485</span><pre class='pre'>	{</pre><br/><span class='lineno'>07486</span><pre class='pre'>		if (!empty($album_id))</pre><br/><span class='lineno'>07487</span><pre class='pre'>		{</pre><br/><span class='lineno'>07488</span><pre class='pre'>			$this-&gt;sp_album_id = $album_id;</pre><br/><span class='lineno'>07489</span><pre class='pre'>		}</pre><br/><span class='lineno'>07490</span><pre class='pre'>	}</pre><br/><span class='lineno'>07491</span><pre class='pre'></pre><br/><span class='lineno'>07492</span><pre class='pre'>	function set_album_name($album_name)</pre><br/><span class='lineno'>07493</span><pre class='pre'>	{</pre><br/><span class='lineno'>07494</span><pre class='pre'>		if (!empty($album_name))</pre><br/><span class='lineno'>07495</span><pre class='pre'>		{</pre><br/><span class='lineno'>07496</span><pre class='pre'>			$this-&gt;sp_album_name = $album_name;</pre><br/><span class='lineno'>07497</span><pre class='pre'>		}</pre><br/><span class='lineno'>07498</span><pre class='pre'>	}</pre><br/><span class='lineno'>07499</span><pre class='pre'></pre><br/><span class='lineno'>07500</span><pre class='pre'>	function set_album_explanation($album_explanation)</pre><br/><span class='lineno'>07501</span><pre class='pre'>	{</pre><br/><span class='lineno'>07502</span><pre class='pre'>		if (!empty($album_explanation))</pre><br/><span class='lineno'>07503</span><pre class='pre'>		{</pre><br/><span class='lineno'>07504</span><pre class='pre'>			$this-&gt;sp_album_explanation = $album_explanation;</pre><br/><span class='lineno'>07505</span><pre class='pre'>		}</pre><br/><span class='lineno'>07506</span><pre class='pre'>	}</pre><br/><span class='lineno'>07507</span><pre class='pre'></pre><br/><span class='lineno'>07508</span><pre class='pre'>	function set_album_registration_date($album_registration_date)</pre><br/><span class='lineno'>07509</span><pre class='pre'>	{</pre><br/><span class='lineno'>07510</span><pre class='pre'>		if (!empty($album_registration_date))</pre><br/><span class='lineno'>07511</span><pre class='pre'>		{</pre><br/><span class='lineno'>07512</span><pre class='pre'>			$this-&gt;sp_registration_date = $album_registration_date;</pre><br/><span class='lineno'>07513</span><pre class='pre'>		}</pre><br/><span class='lineno'>07514</span><pre class='pre'>	}</pre><br/><span class='lineno'>07515</span><pre class='pre'></pre><br/><span class='lineno'>07516</span><pre class='pre'>	function set_state($state)</pre><br/><span class='lineno'>07517</span><pre class='pre'>	{</pre><br/><span class='lineno'>07518</span><pre class='pre'>		if (!empty($state))</pre><br/><span class='lineno'>07519</span><pre class='pre'>		{</pre><br/><span class='lineno'>07520</span><pre class='pre'>			$this-&gt;sp_state = $state;</pre><br/><span class='lineno'>07521</span><pre class='pre'>		}</pre><br/><span class='lineno'>07522</span><pre class='pre'>	}</pre><br/><span class='lineno'>07523</span><pre class='pre'></pre><br/><span class='lineno'>07524</span><pre class='pre'>	function set_photo_id($photo_id)</pre><br/><span class='lineno'>07525</span><pre class='pre'>	{</pre><br/><span class='lineno'>07526</span><pre class='pre'>		if (!empty($photo_id))</pre><br/><span class='lineno'>07527</span><pre class='pre'>		{</pre><br/><span class='lineno'>07528</span><pre class='pre'>			$this-&gt;sp_photo_id = $photo_id;</pre><br/><span class='lineno'>07529</span><pre class='pre'>		}</pre><br/><span class='lineno'>07530</span><pre class='pre'>	}</pre><br/><span class='lineno'>07531</span><pre class='pre'></pre><br/><span class='lineno'>07532</span><pre class='pre'>	function set_photo_mno($photo_mno)</pre><br/><span class='lineno'>07533</span><pre class='pre'>	{</pre><br/><span class='lineno'>07534</span><pre class='pre'>		if (!empty($photo_mno))</pre><br/><span class='lineno'>07535</span><pre class='pre'>		{</pre><br/><span class='lineno'>07536</span><pre class='pre'>			$this-&gt;sp_photo_mno = $photo_mno;</pre><br/><span class='lineno'>07537</span><pre class='pre'>		}</pre><br/><span class='lineno'>07538</span><pre class='pre'>	}</pre><br/><span class='lineno'>07539</span><pre class='pre'></pre><br/><span class='lineno'>07540</span><pre class='pre'>	function set_photo_name($photo_name)</pre><br/><span class='lineno'>07541</span><pre class='pre'>	{</pre><br/><span class='lineno'>07542</span><pre class='pre'>		if (!empty($photo_name))</pre><br/><span class='lineno'>07543</span><pre class='pre'>		{</pre><br/><span class='lineno'>07544</span><pre class='pre'>			$this-&gt;sp_photo_name = $photo_name;</pre><br/><span class='lineno'>07545</span><pre class='pre'>		}</pre><br/><span class='lineno'>07546</span><pre class='pre'>	}</pre><br/><span class='lineno'>07547</span><pre class='pre'></pre><br/><span class='lineno'>07548</span><pre class='pre'>	function __construct()</pre><br/><span class='lineno'>07549</span><pre class='pre'>	{</pre><br/><span class='lineno'>07550</span><pre class='pre'>		// ã¿ã¤ã ã¾ã¼ã³ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>07551</span><pre class='pre'>		date_default_timezone_set(&quot;Asia/Tokyo&quot;);</pre><br/><span class='lineno'>07552</span><pre class='pre'>		// ã¡ã³ãã¼ãåæåãã¾ãã</pre><br/><span class='lineno'>07553</span><pre class='pre'>		$this-&gt;init_data();</pre><br/><span class='lineno'>07554</span><pre class='pre'>	}</pre><br/><span class='lineno'>07555</span><pre class='pre'></pre><br/><span class='lineno'>07556</span><pre class='pre'>	/**</pre><br/><span class='lineno'>07557</span><pre class='pre'>	 * ãã¼ã¿ãåæåãã¾ãã</pre><br/><span class='lineno'>07558</span><pre class='pre'>	 */</pre><br/><span class='lineno'>07559</span><pre class='pre'>	function init_data()</pre><br/><span class='lineno'>07560</span><pre class='pre'>	{</pre><br/><span class='lineno'>07561</span><pre class='pre'>		$this-&gt;sp_album_id = -1;						// ã¢ã«ãã ID</pre><br/><span class='lineno'>07562</span><pre class='pre'>		$this-&gt;sp_album_name = &quot;&quot;;						// ã¢ã«ãã å</pre><br/><span class='lineno'>07563</span><pre class='pre'>		$this-&gt;sp_album_explanation = &quot;&quot;;				// èª¬æ</pre><br/><span class='lineno'>07564</span><pre class='pre'>		$this-&gt;sp_registration_date = date(&quot;Y-m-d&quot;);	// ç»é²æ¥</pre><br/><span class='lineno'>07565</span><pre class='pre'>		$this-&gt;state = 0;								// ã¹ãã¼ã¿ã¹ï¼ç¾å¨ã¯å¸¸ã«0ï¼</pre><br/><span class='lineno'>07566</span><pre class='pre'></pre><br/><span class='lineno'>07567</span><pre class='pre'>		$this-&gt;sp_photo_id = -1;						//	ã¤ã¡ã¼ã¸ID</pre><br/><span class='lineno'>07568</span><pre class='pre'>		$this-&gt;sp_photo_mno = &quot;&quot;;						//ãã¤ã¡ã¼ã¸ç®¡ççªå·</pre><br/><span class='lineno'>07569</span><pre class='pre'>		$this-&gt;sp_photo_name = &quot;&quot;;						//ãåçåï¼ã¿ã¤ãã«ï¼</pre><br/><span class='lineno'>07570</span><pre class='pre'>		$this-&gt;sp_up_url = array();						// ã¢ããã­ã¼ãURLï¼æçµçã«ã¢ããã­ã¼ããããURLï¼</pre><br/><span class='lineno'>07571</span><pre class='pre'>														//	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>07572</span><pre class='pre'>	}</pre><br/><span class='lineno'>07573</span><pre class='pre'></pre><br/><span class='lineno'>07574</span><pre class='pre'>	/*</pre><br/><span class='lineno'>07575</span><pre class='pre'>	 * é¢æ°åï¼insert_data</pre><br/><span class='lineno'>07576</span><pre class='pre'>	 * é¢æ°èª¬æï¼ã¢ã«ãã ã«ç»é²ãã</pre><br/><span class='lineno'>07577</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>07578</span><pre class='pre'>	 * $db_link:ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>07579</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>07580</span><pre class='pre'>	 */</pre><br/><span class='lineno'>07581</span><pre class='pre'>	function insert_data($db_link)</pre><br/><span class='lineno'>07582</span><pre class='pre'>	{</pre><br/><span class='lineno'>07583</span><pre class='pre'>		$sql = &quot;SELECT max( album_id ) + 1 max_id FROM album;&quot;;</pre><br/><span class='lineno'>07584</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07585</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07586</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>07587</span><pre class='pre'>		{</pre><br/><span class='lineno'>07588</span><pre class='pre'>			// æçµçªå·ãåå¾ãã¾ãã</pre><br/><span class='lineno'>07589</span><pre class='pre'>			$max = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>07590</span><pre class='pre'>			$this-&gt;sp_album_id = $max['max_id'];</pre><br/><span class='lineno'>07591</span><pre class='pre'>		}</pre><br/><span class='lineno'>07592</span><pre class='pre'>		else</pre><br/><span class='lineno'>07593</span><pre class='pre'>		{</pre><br/><span class='lineno'>07594</span><pre class='pre'>			// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07595</span><pre class='pre'>			$this-&gt;message = &quot;æçµçªå·ã®MAXå¤ãåå¾ã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>07596</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07597</span><pre class='pre'>		}</pre><br/><span class='lineno'>07598</span><pre class='pre'>		// æçµçªå·ãè£æ­£ãã¾ãã</pre><br/><span class='lineno'>07599</span><pre class='pre'>		if (empty($this-&gt;sp_album_id))</pre><br/><span class='lineno'>07600</span><pre class='pre'>		{</pre><br/><span class='lineno'>07601</span><pre class='pre'>			$this-&gt;sp_album_id = 1;</pre><br/><span class='lineno'>07602</span><pre class='pre'>		}</pre><br/><span class='lineno'>07603</span><pre class='pre'></pre><br/><span class='lineno'>07604</span><pre class='pre'>		$sql = &quot;INSERT INTO album (album_id, album_name, album_explanation, registration_date, state) VALUES ( &quot;;</pre><br/><span class='lineno'>07605</span><pre class='pre'>		$sql .= $this-&gt;sp_album_id . &quot;,&quot;;					// ã¢ã«ãã ID</pre><br/><span class='lineno'>07606</span><pre class='pre'>		$sql .= &quot;\&quot;&quot;.$this-&gt;sp_album_name . &quot;\&quot;,&quot;;			// ã¢ã«ãã å</pre><br/><span class='lineno'>07607</span><pre class='pre'>		$sql .= &quot;\&quot;&quot;.$this-&gt;sp_album_explanation . &quot;\&quot;,&quot;;	// èª¬æ</pre><br/><span class='lineno'>07608</span><pre class='pre'>		$sql .= &quot;\&quot;&quot;.$this-&gt;sp_registration_date . &quot;\&quot;,&quot;;	// ç»é²æ¥</pre><br/><span class='lineno'>07609</span><pre class='pre'>		$sql .= $this-&gt;state;								// ã¹ãã¼ã¿ã¹</pre><br/><span class='lineno'>07610</span><pre class='pre'>		$sql .= &quot;);&quot;;</pre><br/><span class='lineno'>07611</span><pre class='pre'></pre><br/><span class='lineno'>07612</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07613</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07614</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>07615</span><pre class='pre'>		{</pre><br/><span class='lineno'>07616</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>07617</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>07618</span><pre class='pre'>			if ($icount != 1)</pre><br/><span class='lineno'>07619</span><pre class='pre'>			{</pre><br/><span class='lineno'>07620</span><pre class='pre'>				$this-&gt;message = &quot;ã¢ã«ãã ãDBã«ç»é²ã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>07621</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07622</span><pre class='pre'>			}</pre><br/><span class='lineno'>07623</span><pre class='pre'>		}</pre><br/><span class='lineno'>07624</span><pre class='pre'>		else</pre><br/><span class='lineno'>07625</span><pre class='pre'>		{</pre><br/><span class='lineno'>07626</span><pre class='pre'>			$this-&gt;message = &quot;ã¢ã«ãã ãDBã«ç»é²ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>07627</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07628</span><pre class='pre'>		}</pre><br/><span class='lineno'>07629</span><pre class='pre'>	}</pre><br/><span class='lineno'>07630</span><pre class='pre'></pre><br/><span class='lineno'>07631</span><pre class='pre'>	/*</pre><br/><span class='lineno'>07632</span><pre class='pre'>	 * é¢æ°åï¼set_data</pre><br/><span class='lineno'>07633</span><pre class='pre'>	 * é¢æ°èª¬æï¼åã®ãã¼ã¿ã¯ã©ã¹ããããã®ã¯ã©ã¹ã«è¨­å®ãã</pre><br/><span class='lineno'>07634</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>07635</span><pre class='pre'>	 * $rcdata:	åã®ãã¼ã¿ã¯ã©ã¹</pre><br/><span class='lineno'>07636</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>07637</span><pre class='pre'>	 */</pre><br/><span class='lineno'>07638</span><pre class='pre'>	function set_data($rcdata)</pre><br/><span class='lineno'>07639</span><pre class='pre'>	{</pre><br/><span class='lineno'>07640</span><pre class='pre'>		$this-&gt;sp_album_id = $rcdata['album_id'];						// ã¢ã«ãã ID</pre><br/><span class='lineno'>07641</span><pre class='pre'>		$this-&gt;sp_album_name = $rcdata['album_name'];					// ã¢ã«ãã å</pre><br/><span class='lineno'>07642</span><pre class='pre'>		$this-&gt;sp_album_explanation = $rcdata['album_explanation'];		// èª¬æ</pre><br/><span class='lineno'>07643</span><pre class='pre'>		$this-&gt;sp_registration_date = $rcdata['registration_date'];		// ç»é²æ¥</pre><br/><span class='lineno'>07644</span><pre class='pre'>	}</pre><br/><span class='lineno'>07645</span><pre class='pre'></pre><br/><span class='lineno'>07646</span><pre class='pre'>	/*</pre><br/><span class='lineno'>07647</span><pre class='pre'>	 * é¢æ°åï¼set_data2</pre><br/><span class='lineno'>07648</span><pre class='pre'>	 * é¢æ°èª¬æï¼åã®ãã¼ã¿ã¯ã©ã¹ããããã®ã¯ã©ã¹ã«è¨­å®ãã</pre><br/><span class='lineno'>07649</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>07650</span><pre class='pre'>	 * $rcdata:	åã®ãã¼ã¿ã¯ã©ã¹</pre><br/><span class='lineno'>07651</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>07652</span><pre class='pre'>	 */</pre><br/><span class='lineno'>07653</span><pre class='pre'>	function set_data2($rcdata)</pre><br/><span class='lineno'>07654</span><pre class='pre'>	{</pre><br/><span class='lineno'>07655</span><pre class='pre'>		$this-&gt;set_data($rcdata);</pre><br/><span class='lineno'>07656</span><pre class='pre'></pre><br/><span class='lineno'>07657</span><pre class='pre'>		$this-&gt;sp_up_url = array();</pre><br/><span class='lineno'>07658</span><pre class='pre'></pre><br/><span class='lineno'>07659</span><pre class='pre'>		$this-&gt;sp_photo_id   =  $rcdata['photo_id'];					// ã¤ã¡ã¼ã¸ID</pre><br/><span class='lineno'>07660</span><pre class='pre'>		$this-&gt;sp_photo_mno  =  $rcdata['photo_mno'];					// ã¤ã¡ã¼ã¸ç®¡ççªå·</pre><br/><span class='lineno'>07661</span><pre class='pre'>		$this-&gt;sp_photo_name =  $rcdata['photo_name'];					// åçåï¼ã¿ã¤ãã«ï¼</pre><br/><span class='lineno'>07662</span><pre class='pre'>		$this-&gt;sp_up_url[0]  =  $rcdata['photo_filename'];				//	0:åã1:ãµã ãã¤ã«1ã2:ãµã ãã¤ã«2ã»ã»ã»</pre><br/><span class='lineno'>07663</span><pre class='pre'>		$this-&gt;sp_up_url[1]  =  $rcdata['photo_filename_th1'];</pre><br/><span class='lineno'>07664</span><pre class='pre'>		$this-&gt;sp_up_url[2]  =  $rcdata['photo_filename_th2'];</pre><br/><span class='lineno'>07665</span><pre class='pre'>		$this-&gt;sp_up_url[3]  =  $rcdata['photo_filename_th3'];</pre><br/><span class='lineno'>07666</span><pre class='pre'>		$this-&gt;sp_up_url[4]  =  $rcdata['photo_filename_th4'];</pre><br/><span class='lineno'>07667</span><pre class='pre'>		$this-&gt;sp_up_url[5]  =  $rcdata['photo_filename_th5'];</pre><br/><span class='lineno'>07668</span><pre class='pre'>		$this-&gt;sp_up_url[6]  =  $rcdata['photo_filename_th6'];</pre><br/><span class='lineno'>07669</span><pre class='pre'>		$this-&gt;sp_up_url[7]  =  $rcdata['photo_filename_th7'];</pre><br/><span class='lineno'>07670</span><pre class='pre'>		$this-&gt;sp_up_url[8]  =  $rcdata['photo_filename_th8'];</pre><br/><span class='lineno'>07671</span><pre class='pre'>		$this-&gt;sp_up_url[9]  =  $rcdata['photo_filename_th9'];</pre><br/><span class='lineno'>07672</span><pre class='pre'>		$this-&gt;sp_up_url[10] =  $rcdata['photo_filename_th10'];</pre><br/><span class='lineno'>07673</span><pre class='pre'>	}</pre><br/><span class='lineno'>07674</span><pre class='pre'></pre><br/><span class='lineno'>07675</span><pre class='pre'>	/*</pre><br/><span class='lineno'>07676</span><pre class='pre'>	 * é¢æ°åï¼update_registration_date</pre><br/><span class='lineno'>07677</span><pre class='pre'>	 * é¢æ°èª¬æï¼æå®ã®ã¢ã«ãã ï¼©ï¼¤ã®ç»é²æ¥ãæ´æ°ãã</pre><br/><span class='lineno'>07678</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>07679</span><pre class='pre'>	 * $db_link:	ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>07680</span><pre class='pre'>	 * $album_id:	ã¢ã«ãã ï¼©ï¼¤</pre><br/><span class='lineno'>07681</span><pre class='pre'> 	 * $new_date:	ã·ã¹ãã æ¥ä»</pre><br/><span class='lineno'>07682</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>07683</span><pre class='pre'>	 */</pre><br/><span class='lineno'>07684</span><pre class='pre'>	function update_registration_date($db_link,$album_id,$new_date)</pre><br/><span class='lineno'>07685</span><pre class='pre'>	{</pre><br/><span class='lineno'>07686</span><pre class='pre'>		$sql = &quot;UPDATE album SET registration_date = \&quot;&quot;.$new_date.&quot;\&quot; WHERE album_id = &quot;.$album_id.&quot;;&quot;;</pre><br/><span class='lineno'>07687</span><pre class='pre'></pre><br/><span class='lineno'>07688</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07689</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07690</span><pre class='pre'>		if ($result == false)</pre><br/><span class='lineno'>07691</span><pre class='pre'>		{</pre><br/><span class='lineno'>07692</span><pre class='pre'>			$this-&gt;message = &quot;ã¢ã«ãã ãDBã«æ´æ°ã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>07693</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07694</span><pre class='pre'>		}</pre><br/><span class='lineno'>07695</span><pre class='pre'>	}</pre><br/><span class='lineno'>07696</span><pre class='pre'></pre><br/><span class='lineno'>07697</span><pre class='pre'>	/*</pre><br/><span class='lineno'>07698</span><pre class='pre'>	 * é¢æ°åï¼delete_data</pre><br/><span class='lineno'>07699</span><pre class='pre'>	 * é¢æ°èª¬æï¼æå®ã®ã¢ã«ãã ï¼©ï¼¤ã®æå­åãããã¢ã«ãã ãã¼ãã«ããåé¤ãã</pre><br/><span class='lineno'>07700</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>07701</span><pre class='pre'>	 * $db_link:	ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>07702</span><pre class='pre'>	 * $albm_id_str:ã¢ã«ãã ï¼©ï¼¤ã®æå­å</pre><br/><span class='lineno'>07703</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>07704</span><pre class='pre'>	 */</pre><br/><span class='lineno'>07705</span><pre class='pre'>	function delete_data($db_link,$albm_id_str)</pre><br/><span class='lineno'>07706</span><pre class='pre'>	{</pre><br/><span class='lineno'>07707</span><pre class='pre'>		// æ¡ä»¶ãæå­åããéåã«ãã¾ãã</pre><br/><span class='lineno'>07708</span><pre class='pre'>		$albm_id_a = array();</pre><br/><span class='lineno'>07709</span><pre class='pre'>		$albm_id_a = explode(&quot;,&quot;, $albm_id_str);</pre><br/><span class='lineno'>07710</span><pre class='pre'>		$ed = count($albm_id_a);</pre><br/><span class='lineno'>07711</span><pre class='pre'>		for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>07712</span><pre class='pre'>		{</pre><br/><span class='lineno'>07713</span><pre class='pre'>			if (!empty($albm_id_a[$i]))</pre><br/><span class='lineno'>07714</span><pre class='pre'>			{</pre><br/><span class='lineno'>07715</span><pre class='pre'>				$sql = &quot;DELETE FROM album WHERE album_id = &quot;.$albm_id_a[$i].&quot;;&quot;;</pre><br/><span class='lineno'>07716</span><pre class='pre'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07717</span><pre class='pre'>				$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07718</span><pre class='pre'>				if ($result == false)</pre><br/><span class='lineno'>07719</span><pre class='pre'>				{</pre><br/><span class='lineno'>07720</span><pre class='pre'>					// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07721</span><pre class='pre'>					$this-&gt;message = &quot;ã¢ã«ãã ã®åé¤ãã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>07722</span><pre class='pre'>					// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07723</span><pre class='pre'>					$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>07724</span><pre class='pre'>					throw new Exception($msg);</pre><br/><span class='lineno'>07725</span><pre class='pre'>				}</pre><br/><span class='lineno'>07726</span><pre class='pre'>			}</pre><br/><span class='lineno'>07727</span><pre class='pre'>		}</pre><br/><span class='lineno'>07728</span><pre class='pre'>	}</pre><br/><span class='lineno'>07729</span><pre class='pre'></pre><br/><span class='lineno'>07730</span><pre class='pre'>	/*</pre><br/><span class='lineno'>07731</span><pre class='pre'>	 * é¢æ°åï¼delete_data2</pre><br/><span class='lineno'>07732</span><pre class='pre'>	 * é¢æ°èª¬æï¼ã¢ã«ãã ãã¼ãã«ãããæå®ã®ã¢ã«ãã ï¼©ï¼¤ãåé¤ãã</pre><br/><span class='lineno'>07733</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>07734</span><pre class='pre'>	 * $db_link:ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>07735</span><pre class='pre'>	 * $albm_id:ã¢ã«ãã ï¼©ï¼¤</pre><br/><span class='lineno'>07736</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>07737</span><pre class='pre'>	 */</pre><br/><span class='lineno'>07738</span><pre class='pre'>	function delete_data2($db_link,$albm_id)</pre><br/><span class='lineno'>07739</span><pre class='pre'>	{</pre><br/><span class='lineno'>07740</span><pre class='pre'>		if (!empty($albm_id))</pre><br/><span class='lineno'>07741</span><pre class='pre'>		{</pre><br/><span class='lineno'>07742</span><pre class='pre'>			$sql = &quot;DELETE FROM album WHERE album_id = &quot;.$albm_id.&quot;;&quot;;</pre><br/><span class='lineno'>07743</span><pre class='pre'>			$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07744</span><pre class='pre'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07745</span><pre class='pre'>			if ($result == false)</pre><br/><span class='lineno'>07746</span><pre class='pre'>			{</pre><br/><span class='lineno'>07747</span><pre class='pre'>				// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07748</span><pre class='pre'>				$this-&gt;message = &quot;ã¢ã«ãã ã®åé¤ãã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>07749</span><pre class='pre'>				// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07750</span><pre class='pre'>				$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>07751</span><pre class='pre'>				throw new Exception($msg);</pre><br/><span class='lineno'>07752</span><pre class='pre'>			}</pre><br/><span class='lineno'>07753</span><pre class='pre'>		}</pre><br/><span class='lineno'>07754</span><pre class='pre'>	}</pre><br/><span class='lineno'>07755</span><pre class='pre'></pre><br/><span class='lineno'>07756</span><pre class='pre'>	/*</pre><br/><span class='lineno'>07757</span><pre class='pre'>	 * é¢æ°åï¼update_data</pre><br/><span class='lineno'>07758</span><pre class='pre'>	 * é¢æ°èª¬æï¼ã¢ã«ãã ãã¼ãã«ãæ´æ°ãã</pre><br/><span class='lineno'>07759</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>07760</span><pre class='pre'>	 * $db_link:ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>07761</span><pre class='pre'>	 * $albm_id:ã¢ã«ãã ï¼©ï¼¤</pre><br/><span class='lineno'>07762</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>07763</span><pre class='pre'>	 */</pre><br/><span class='lineno'>07764</span><pre class='pre'>	function update_data($db_link,$albm_id)</pre><br/><span class='lineno'>07765</span><pre class='pre'>	{</pre><br/><span class='lineno'>07766</span><pre class='pre'>		if (!empty($albm_id))</pre><br/><span class='lineno'>07767</span><pre class='pre'>		{</pre><br/><span class='lineno'>07768</span><pre class='pre'>			$sql = &quot;UPDATE album SET album_name = \&quot;&quot;.$this-&gt;sp_album_name.&quot;\&quot;, album_explanation = \&quot;&quot;.$this-&gt;sp_album_explanation.&quot;\&quot; WHERE album_id = &quot;.$albm_id.&quot;;&quot;;</pre><br/><span class='lineno'>07769</span><pre class='pre'>			$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07770</span><pre class='pre'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07771</span><pre class='pre'>			if ($result == false)</pre><br/><span class='lineno'>07772</span><pre class='pre'>			{</pre><br/><span class='lineno'>07773</span><pre class='pre'>				// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07774</span><pre class='pre'>				$this-&gt;message = &quot;ã¢ã«ãã ãæ´æ°ã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>07775</span><pre class='pre'>				// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07776</span><pre class='pre'>				$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>07777</span><pre class='pre'>				throw new Exception($msg);</pre><br/><span class='lineno'>07778</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>07779</span><pre class='pre'>				//$new_date = date(&quot;Y-m-d&quot;);</pre><br/><span class='lineno'>07780</span><pre class='pre'>				//$this-&gt;update_registration_date($db_link,$albm_id,$new_date);</pre><br/><span class='lineno'>07781</span><pre class='pre'>			}</pre><br/><span class='lineno'>07782</span><pre class='pre'>		}</pre><br/><span class='lineno'>07783</span><pre class='pre'>	}</pre><br/><span class='lineno'>07784</span><pre class='pre'>}</pre><br/><span class='lineno'>07785</span><pre class='pre'></pre><br/><span class='lineno'>07786</span><pre class='pre'>class AlbumDetail extends Album</pre><br/><span class='lineno'>07787</span><pre class='pre'>{</pre><br/><span class='lineno'>07788</span><pre class='pre'>	var $message;					// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>07789</span><pre class='pre'>	var $error;						// ã¨ã©ã¼</pre><br/><span class='lineno'>07790</span><pre class='pre'></pre><br/><span class='lineno'>07791</span><pre class='pre'>	var $sp_album_detail_id;		// ã¢ã«ãã è©³ç´°ID</pre><br/><span class='lineno'>07792</span><pre class='pre'>	var $sp_photo_id;				// åçID</pre><br/><span class='lineno'>07793</span><pre class='pre'>	var $sp_state;					// ã¹ãã¼ã¿ã¹ï¼ç¾å¨ã¯å¸¸ã«0ï¼</pre><br/><span class='lineno'>07794</span><pre class='pre'></pre><br/><span class='lineno'>07795</span><pre class='pre'>	function set_album_detail_id($album_detail_id)</pre><br/><span class='lineno'>07796</span><pre class='pre'>	{</pre><br/><span class='lineno'>07797</span><pre class='pre'>		if (!empty($album_detail_id))</pre><br/><span class='lineno'>07798</span><pre class='pre'>		{</pre><br/><span class='lineno'>07799</span><pre class='pre'>			$this-&gt;sp_album_detail_id = $album_detail_id;</pre><br/><span class='lineno'>07800</span><pre class='pre'>		}</pre><br/><span class='lineno'>07801</span><pre class='pre'>	}</pre><br/><span class='lineno'>07802</span><pre class='pre'></pre><br/><span class='lineno'>07803</span><pre class='pre'>	function set_photo_id($photo_id)</pre><br/><span class='lineno'>07804</span><pre class='pre'>	{</pre><br/><span class='lineno'>07805</span><pre class='pre'>		if (!empty($photo_id))</pre><br/><span class='lineno'>07806</span><pre class='pre'>		{</pre><br/><span class='lineno'>07807</span><pre class='pre'>			$this-&gt;sp_photo_id = $photo_id;</pre><br/><span class='lineno'>07808</span><pre class='pre'>		}</pre><br/><span class='lineno'>07809</span><pre class='pre'>	}</pre><br/><span class='lineno'>07810</span><pre class='pre'></pre><br/><span class='lineno'>07811</span><pre class='pre'>	function set_state($state)</pre><br/><span class='lineno'>07812</span><pre class='pre'>	{</pre><br/><span class='lineno'>07813</span><pre class='pre'>		if (!empty($state))</pre><br/><span class='lineno'>07814</span><pre class='pre'>		{</pre><br/><span class='lineno'>07815</span><pre class='pre'>			$this-&gt;sp_state = $state;</pre><br/><span class='lineno'>07816</span><pre class='pre'>		}</pre><br/><span class='lineno'>07817</span><pre class='pre'>	}</pre><br/><span class='lineno'>07818</span><pre class='pre'></pre><br/><span class='lineno'>07819</span><pre class='pre'>	function __construct()</pre><br/><span class='lineno'>07820</span><pre class='pre'>	{</pre><br/><span class='lineno'>07821</span><pre class='pre'>		// ã¿ã¤ã ã¾ã¼ã³ãè¨­å®ãã¾ãã</pre><br/><span class='lineno'>07822</span><pre class='pre'>		date_default_timezone_set(&quot;Asia/Tokyo&quot;);</pre><br/><span class='lineno'>07823</span><pre class='pre'>		Album::init_data();</pre><br/><span class='lineno'>07824</span><pre class='pre'>		// ã¡ã³ãã¼ãåæåãã¾ãã</pre><br/><span class='lineno'>07825</span><pre class='pre'>		$this-&gt;init_data();</pre><br/><span class='lineno'>07826</span><pre class='pre'>	}</pre><br/><span class='lineno'>07827</span><pre class='pre'></pre><br/><span class='lineno'>07828</span><pre class='pre'>	/**</pre><br/><span class='lineno'>07829</span><pre class='pre'>	 * ãã¼ã¿ãåæåãã¾ãã</pre><br/><span class='lineno'>07830</span><pre class='pre'>	 */</pre><br/><span class='lineno'>07831</span><pre class='pre'>	function init_data()</pre><br/><span class='lineno'>07832</span><pre class='pre'>	{</pre><br/><span class='lineno'>07833</span><pre class='pre'>		$this-&gt;sp_album_detail_id = -1;					// ã¢ã«ãã è©³ç´°ID</pre><br/><span class='lineno'>07834</span><pre class='pre'>		$this-&gt;sp_photo_id = -1;						// åçID</pre><br/><span class='lineno'>07835</span><pre class='pre'>		$this-&gt;state = 0;								// ã¹ãã¼ã¿ã¹ï¼ç¾å¨ã¯å¸¸ã«0ï¼</pre><br/><span class='lineno'>07836</span><pre class='pre'>	}</pre><br/><span class='lineno'>07837</span><pre class='pre'></pre><br/><span class='lineno'>07838</span><pre class='pre'>	/*</pre><br/><span class='lineno'>07839</span><pre class='pre'>	 * é¢æ°åï¼insert_data</pre><br/><span class='lineno'>07840</span><pre class='pre'>	 * é¢æ°èª¬æï¼ã¢ã«ãã è©³ç´°ãã¼ãã«ã«ç»é²ãã¾ãã</pre><br/><span class='lineno'>07841</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>07842</span><pre class='pre'>	 * $db_link:		ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>07843</span><pre class='pre'>	 * $photo_id_str:	ã¤ã¡ã¼ã¸ï¼©ï¼¤ã®æå­åï¼&quot;23,24,25&quot;ï¼</pre><br/><span class='lineno'>07844</span><pre class='pre'>	 * $flg:			ã0ãï¼ã¢ã«ãã ãã¼ãã«ã«ç»é²ãã</pre><br/><span class='lineno'>07845</span><pre class='pre'>	 *					ã1ãï¼ã¢ã«ãã ãã¼ãã«ã«ç»é²ããªã</pre><br/><span class='lineno'>07846</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>07847</span><pre class='pre'>	 */</pre><br/><span class='lineno'>07848</span><pre class='pre'>	function insert_data_detail($db_link,$photo_id_str,$flg)</pre><br/><span class='lineno'>07849</span><pre class='pre'>	{</pre><br/><span class='lineno'>07850</span><pre class='pre'>		if ($flg == 0) Album::insert_data($db_link);</pre><br/><span class='lineno'>07851</span><pre class='pre'></pre><br/><span class='lineno'>07852</span><pre class='pre'>		// æ¡ä»¶ãæå­åããéåã«ãã¾ãã</pre><br/><span class='lineno'>07853</span><pre class='pre'>		$sp_photo_id_a = explode(&quot;,&quot;, $photo_id_str);</pre><br/><span class='lineno'>07854</span><pre class='pre'>		$ed = count($sp_photo_id_a);</pre><br/><span class='lineno'>07855</span><pre class='pre'>		$this-&gt;images = array();</pre><br/><span class='lineno'>07856</span><pre class='pre'>		for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>07857</span><pre class='pre'>		{</pre><br/><span class='lineno'>07858</span><pre class='pre'>			if (!empty($sp_photo_id_a[$i]))</pre><br/><span class='lineno'>07859</span><pre class='pre'>			{</pre><br/><span class='lineno'>07860</span><pre class='pre'>				$sql = &quot;SELECT max( album_detail_id ) + 1 max_id FROM album_detail;&quot;;</pre><br/><span class='lineno'>07861</span><pre class='pre'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07862</span><pre class='pre'>				$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07863</span><pre class='pre'>				if ($result == true)</pre><br/><span class='lineno'>07864</span><pre class='pre'>				{</pre><br/><span class='lineno'>07865</span><pre class='pre'>					// æçµçªå·ãåå¾ãã¾ãã</pre><br/><span class='lineno'>07866</span><pre class='pre'>					$max = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>07867</span><pre class='pre'>					$this-&gt;sp_album_detail_id = $max['max_id'];</pre><br/><span class='lineno'>07868</span><pre class='pre'>				}</pre><br/><span class='lineno'>07869</span><pre class='pre'>				else</pre><br/><span class='lineno'>07870</span><pre class='pre'>				{</pre><br/><span class='lineno'>07871</span><pre class='pre'>					// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07872</span><pre class='pre'>					$this-&gt;message = &quot;æçµçªå·ã®MAXå¤ãåå¾ã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>07873</span><pre class='pre'>					throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07874</span><pre class='pre'>				}</pre><br/><span class='lineno'>07875</span><pre class='pre'>				// æçµçªå·ãè£æ­£ãã¾ãã</pre><br/><span class='lineno'>07876</span><pre class='pre'>				if (empty($this-&gt;sp_album_detail_id))</pre><br/><span class='lineno'>07877</span><pre class='pre'>				{</pre><br/><span class='lineno'>07878</span><pre class='pre'>					$this-&gt;sp_album_detail_id = 1;</pre><br/><span class='lineno'>07879</span><pre class='pre'>				}</pre><br/><span class='lineno'>07880</span><pre class='pre'></pre><br/><span class='lineno'>07881</span><pre class='pre'>				$sql = &quot;INSERT INTO album_detail (album_detail_id, album_id, photo_id, state) VALUES ( &quot;;</pre><br/><span class='lineno'>07882</span><pre class='pre'>				$sql .= $this-&gt;sp_album_detail_id . &quot;,&quot;;		// ã¢ã«ãã è©³ç´°ID</pre><br/><span class='lineno'>07883</span><pre class='pre'>				$sql .= $this-&gt;sp_album_id . &quot;,&quot;;				// ã¢ã«ãã ID</pre><br/><span class='lineno'>07884</span><pre class='pre'>				$sql .= $sp_photo_id_a[$i] . &quot;,&quot;;				// ç»åID</pre><br/><span class='lineno'>07885</span><pre class='pre'>				$sql .= $this-&gt;state;							// ã¹ãã¼ã¿ã¹</pre><br/><span class='lineno'>07886</span><pre class='pre'>				$sql .= &quot;);&quot;;</pre><br/><span class='lineno'>07887</span><pre class='pre'></pre><br/><span class='lineno'>07888</span><pre class='pre'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07889</span><pre class='pre'>				$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07890</span><pre class='pre'>				if ($result == true)</pre><br/><span class='lineno'>07891</span><pre class='pre'>				{</pre><br/><span class='lineno'>07892</span><pre class='pre'>					// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>07893</span><pre class='pre'>					$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>07894</span><pre class='pre'>					if ($icount != 1)</pre><br/><span class='lineno'>07895</span><pre class='pre'>					{</pre><br/><span class='lineno'>07896</span><pre class='pre'>						$this-&gt;message = &quot;ã¢ã«ãã è©³ç´°ãDBã«ç»é²ã§ãã¾ããã§ãããï¼å¦çæ°!=1ï¼ No=&quot; . $i;</pre><br/><span class='lineno'>07897</span><pre class='pre'>						throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>07898</span><pre class='pre'>					}</pre><br/><span class='lineno'>07899</span><pre class='pre'>				}</pre><br/><span class='lineno'>07900</span><pre class='pre'>				else</pre><br/><span class='lineno'>07901</span><pre class='pre'>				{</pre><br/><span class='lineno'>07902</span><pre class='pre'>					$this-&gt;message = &quot;ã¢ã«ãã è©³ç´°ãDBã«ç»é²ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼ No=&quot; . $i;</pre><br/><span class='lineno'>07903</span><pre class='pre'></pre><br/><span class='lineno'>07904</span><pre class='pre'>					// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07905</span><pre class='pre'>					$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>07906</span><pre class='pre'>					throw new Exception($msg);</pre><br/><span class='lineno'>07907</span><pre class='pre'>				}</pre><br/><span class='lineno'>07908</span><pre class='pre'>			}</pre><br/><span class='lineno'>07909</span><pre class='pre'>		}</pre><br/><span class='lineno'>07910</span><pre class='pre'>	}</pre><br/><span class='lineno'>07911</span><pre class='pre'></pre><br/><span class='lineno'>07912</span><pre class='pre'>	/*</pre><br/><span class='lineno'>07913</span><pre class='pre'>	 * é¢æ°åï¼insert_image</pre><br/><span class='lineno'>07914</span><pre class='pre'>	 * é¢æ°èª¬æï¼ã¤ã¡ã¼ã¸ãã¢ã«ãã è©³ç´°ã«ç»é²ãã¾ãã</pre><br/><span class='lineno'>07915</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>07916</span><pre class='pre'>	 * $db_link:		ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>07917</span><pre class='pre'>	 * $photo_id_str:	ã¤ã¡ã¼ã¸ï¼©ï¼¤ã®æå­åï¼&quot;23,24,25&quot;ï¼</pre><br/><span class='lineno'>07918</span><pre class='pre'>	 * $albm_id:		ã¢ã«ãã ï¼©ï¼¤</pre><br/><span class='lineno'>07919</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>07920</span><pre class='pre'>	 */</pre><br/><span class='lineno'>07921</span><pre class='pre'>	function insert_image($db_link,$albm_id,$photo_id_str)</pre><br/><span class='lineno'>07922</span><pre class='pre'>	{</pre><br/><span class='lineno'>07923</span><pre class='pre'>		// æ¡ä»¶ãæå­åããéåã«ãã¾ãã</pre><br/><span class='lineno'>07924</span><pre class='pre'>		$sp_photo_id_a = explode(&quot;,&quot;, $photo_id_str);</pre><br/><span class='lineno'>07925</span><pre class='pre'>		$ed = count($sp_photo_id_a);</pre><br/><span class='lineno'>07926</span><pre class='pre'>		$this-&gt;images = array();</pre><br/><span class='lineno'>07927</span><pre class='pre'>		for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>07928</span><pre class='pre'>		{</pre><br/><span class='lineno'>07929</span><pre class='pre'>			if (!empty($sp_photo_id_a[$i]))</pre><br/><span class='lineno'>07930</span><pre class='pre'>			{</pre><br/><span class='lineno'>07931</span><pre class='pre'>				$sql = &quot;SELECT count( * ) cnt FROM album_detail WHERE photo_id = \&quot;&quot;.$sp_photo_id_a[$i].&quot;\&quot; AND album_id = &quot;.$albm_id.&quot;;&quot;;</pre><br/><span class='lineno'>07932</span><pre class='pre'></pre><br/><span class='lineno'>07933</span><pre class='pre'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07934</span><pre class='pre'>				$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07935</span><pre class='pre'>				if ($result == true)</pre><br/><span class='lineno'>07936</span><pre class='pre'>				{</pre><br/><span class='lineno'>07937</span><pre class='pre'>					// ã¤ã¡ã¼ã¸ã®å­å¨æ§ã®ãã§ãã¯</pre><br/><span class='lineno'>07938</span><pre class='pre'>					$cnt = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>07939</span><pre class='pre'>					if ($cnt['cnt'] == 0)</pre><br/><span class='lineno'>07940</span><pre class='pre'>					{</pre><br/><span class='lineno'>07941</span><pre class='pre'>						$this-&gt;sp_album_id = $albm_id;</pre><br/><span class='lineno'>07942</span><pre class='pre'>						$this-&gt;insert_data($db_link,$sp_photo_id_a[$i],1);</pre><br/><span class='lineno'>07943</span><pre class='pre'>						$new_date = date(&quot;Y-m-d&quot;);</pre><br/><span class='lineno'>07944</span><pre class='pre'>						$this-&gt;update_registration_date($db_link,$albm_id,$new_date);</pre><br/><span class='lineno'>07945</span><pre class='pre'>					}</pre><br/><span class='lineno'>07946</span><pre class='pre'>				}</pre><br/><span class='lineno'>07947</span><pre class='pre'>				else</pre><br/><span class='lineno'>07948</span><pre class='pre'>				{</pre><br/><span class='lineno'>07949</span><pre class='pre'>					// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07950</span><pre class='pre'>					$this-&gt;message = &quot;ã¤ã¡ã¼ã¸ã®å­å¨æ§ã®ãã§ãã¯ãã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>07951</span><pre class='pre'>					// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07952</span><pre class='pre'>					$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>07953</span><pre class='pre'>					throw new Exception($msg);</pre><br/><span class='lineno'>07954</span><pre class='pre'>				}</pre><br/><span class='lineno'>07955</span><pre class='pre'>			}</pre><br/><span class='lineno'>07956</span><pre class='pre'>		}</pre><br/><span class='lineno'>07957</span><pre class='pre'>	}</pre><br/><span class='lineno'>07958</span><pre class='pre'></pre><br/><span class='lineno'>07959</span><pre class='pre'>	/*</pre><br/><span class='lineno'>07960</span><pre class='pre'>	 * é¢æ°åï¼delete_data</pre><br/><span class='lineno'>07961</span><pre class='pre'>	 * é¢æ°èª¬æï¼ã¢ã«ãã è©³ç´°ãã¼ãã«ãããã¼ã¿ãåé¤ããã</pre><br/><span class='lineno'>07962</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>07963</span><pre class='pre'>	 * $db_link:		ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>07964</span><pre class='pre'>	 * $albm_id_str:	ã¢ã«ãã ï¼©ï¼¤ã®æå­åï¼&quot;23,24,25&quot;ï¼</pre><br/><span class='lineno'>07965</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>07966</span><pre class='pre'>	 */</pre><br/><span class='lineno'>07967</span><pre class='pre'>	function delete_data($db_link,$albm_id_str)</pre><br/><span class='lineno'>07968</span><pre class='pre'>	{</pre><br/><span class='lineno'>07969</span><pre class='pre'>		// æ¡ä»¶ãæå­åããéåã«ãã¾ãã</pre><br/><span class='lineno'>07970</span><pre class='pre'>		$albm_id_a = array();</pre><br/><span class='lineno'>07971</span><pre class='pre'>		$albm_id_a = explode(&quot;,&quot;, $albm_id_str);</pre><br/><span class='lineno'>07972</span><pre class='pre'>		$ed = count($albm_id_a);</pre><br/><span class='lineno'>07973</span><pre class='pre'>		for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>07974</span><pre class='pre'>		{</pre><br/><span class='lineno'>07975</span><pre class='pre'>			if (!empty($albm_id_a[$i]))</pre><br/><span class='lineno'>07976</span><pre class='pre'>			{</pre><br/><span class='lineno'>07977</span><pre class='pre'>				Album::delete_data2($db_link,$albm_id_a[$i]);</pre><br/><span class='lineno'>07978</span><pre class='pre'>				$sql = &quot;DELETE FROM album_detail WHERE album_id = &quot;.$albm_id_a[$i].&quot;;&quot;;</pre><br/><span class='lineno'>07979</span><pre class='pre'>				$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>07980</span><pre class='pre'>				$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>07981</span><pre class='pre'>				if ($result == false)</pre><br/><span class='lineno'>07982</span><pre class='pre'>				{</pre><br/><span class='lineno'>07983</span><pre class='pre'>					// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07984</span><pre class='pre'>					$this-&gt;message = &quot;ã¢ã«ãã è©³ç´°ã®åé¤ãã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>07985</span><pre class='pre'>					// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>07986</span><pre class='pre'>					$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>07987</span><pre class='pre'>					throw new Exception($msg);</pre><br/><span class='lineno'>07988</span><pre class='pre'>				}</pre><br/><span class='lineno'>07989</span><pre class='pre'>			}</pre><br/><span class='lineno'>07990</span><pre class='pre'>		}</pre><br/><span class='lineno'>07991</span><pre class='pre'>	}</pre><br/><span class='lineno'>07992</span><pre class='pre'></pre><br/><span class='lineno'>07993</span><pre class='pre'>	/*</pre><br/><span class='lineno'>07994</span><pre class='pre'>	 * é¢æ°åï¼update_data</pre><br/><span class='lineno'>07995</span><pre class='pre'>	 * é¢æ°èª¬æï¼ã¢ã«ãã è©³ç´°ãã¼ãã«ãæ´æ°ããã</pre><br/><span class='lineno'>07996</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>07997</span><pre class='pre'>	 * $db_link:		ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>07998</span><pre class='pre'>	 * $photo_id_str:	ã¤ã¡ã¼ã¸ï¼©ï¼¤ã®æå­åï¼&quot;23,24,25&quot;ï¼</pre><br/><span class='lineno'>07999</span><pre class='pre'>	 * $albm_id:		ã¢ã«ãã ï¼©ï¼¤</pre><br/><span class='lineno'>08000</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>08001</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08002</span><pre class='pre'>	function update_data_detail($db_link,$albm_id,$photo_id_str)</pre><br/><span class='lineno'>08003</span><pre class='pre'>	{</pre><br/><span class='lineno'>08004</span><pre class='pre'>		if (empty($albm_id)) return;</pre><br/><span class='lineno'>08005</span><pre class='pre'></pre><br/><span class='lineno'>08006</span><pre class='pre'>		//ã¢ã«ãã ã®æå ±ãæ´æ°ãã</pre><br/><span class='lineno'>08007</span><pre class='pre'>		Album::update_data($db_link,$albm_id);</pre><br/><span class='lineno'>08008</span><pre class='pre'></pre><br/><span class='lineno'>08009</span><pre class='pre'>		if (!empty($photo_id_str))</pre><br/><span class='lineno'>08010</span><pre class='pre'>		{</pre><br/><span class='lineno'>08011</span><pre class='pre'>			// æ¡ä»¶ãæå­åããéåã«ãã¾ãã</pre><br/><span class='lineno'>08012</span><pre class='pre'>			$photoid_a = array();</pre><br/><span class='lineno'>08013</span><pre class='pre'>			$photoid_a = explode(&quot;,&quot;, $photo_id_str);</pre><br/><span class='lineno'>08014</span><pre class='pre'>			$ed = count($photoid_a);</pre><br/><span class='lineno'>08015</span><pre class='pre'>			$str1 = &quot;&quot;;</pre><br/><span class='lineno'>08016</span><pre class='pre'></pre><br/><span class='lineno'>08017</span><pre class='pre'>			for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>08018</span><pre class='pre'>			{</pre><br/><span class='lineno'>08019</span><pre class='pre'>				if (!empty($photoid_a[$i]))</pre><br/><span class='lineno'>08020</span><pre class='pre'>				{</pre><br/><span class='lineno'>08021</span><pre class='pre'>					$str1 .= $photoid_a[$i];</pre><br/><span class='lineno'>08022</span><pre class='pre'>					if ($i == $ed - 1)</pre><br/><span class='lineno'>08023</span><pre class='pre'>					{</pre><br/><span class='lineno'>08024</span><pre class='pre'>						$str1 .= &quot;'&quot;;</pre><br/><span class='lineno'>08025</span><pre class='pre'>					} else {</pre><br/><span class='lineno'>08026</span><pre class='pre'>						$str1 .= &quot;','&quot;;</pre><br/><span class='lineno'>08027</span><pre class='pre'>					}</pre><br/><span class='lineno'>08028</span><pre class='pre'>				}</pre><br/><span class='lineno'>08029</span><pre class='pre'>			}</pre><br/><span class='lineno'>08030</span><pre class='pre'>			if ($str1 != &quot;&quot;)</pre><br/><span class='lineno'>08031</span><pre class='pre'>			{</pre><br/><span class='lineno'>08032</span><pre class='pre'>				$str1 = &quot;'&quot;.$str1;</pre><br/><span class='lineno'>08033</span><pre class='pre'>			}</pre><br/><span class='lineno'>08034</span><pre class='pre'></pre><br/><span class='lineno'>08035</span><pre class='pre'>			//åé¤ã¤ã¡ã¼ã¸</pre><br/><span class='lineno'>08036</span><pre class='pre'>			$sql = &quot;DELETE FROM album_detail WHERE album_id = &quot;.$albm_id;</pre><br/><span class='lineno'>08037</span><pre class='pre'>			$sql .= &quot; AND photo_id NOT IN (&quot;.$str1.&quot;);&quot;;</pre><br/><span class='lineno'>08038</span><pre class='pre'></pre><br/><span class='lineno'>08039</span><pre class='pre'>			$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08040</span><pre class='pre'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08041</span><pre class='pre'>			if ($result == false)</pre><br/><span class='lineno'>08042</span><pre class='pre'>			{</pre><br/><span class='lineno'>08043</span><pre class='pre'>				// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08044</span><pre class='pre'>				$this-&gt;message = &quot;ã¢ã«ãã è©³ç´°ã®æ´æ°ãã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>08045</span><pre class='pre'>				// ã­ã¼ã«ããã¯ãã¾ãã</pre><br/><span class='lineno'>08046</span><pre class='pre'>				// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08047</span><pre class='pre'>				$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>08048</span><pre class='pre'>				throw new Exception($msg);</pre><br/><span class='lineno'>08049</span><pre class='pre'>			}</pre><br/><span class='lineno'>08050</span><pre class='pre'>		}</pre><br/><span class='lineno'>08051</span><pre class='pre'>	}</pre><br/><span class='lineno'>08052</span><pre class='pre'>}</pre><br/><span class='lineno'>08053</span><pre class='pre'></pre><br/><span class='lineno'>08054</span><pre class='pre'>class AlbumSearch</pre><br/><span class='lineno'>08055</span><pre class='pre'>{</pre><br/><span class='lineno'>08056</span><pre class='pre'>	// æ¬æ¥ãªãPrivateã«ããæ¹ãè¯ãã¨æãã¾ããå©ä¾¿æ§ãèãvarã§å®£è¨ãã¦ãã¾ãã</pre><br/><span class='lineno'>08057</span><pre class='pre'>	var $message;									// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>08058</span><pre class='pre'>	var $error;										// ã¨ã©ã¼</pre><br/><span class='lineno'>08059</span><pre class='pre'></pre><br/><span class='lineno'>08060</span><pre class='pre'>	var $albums;									//ãã¢ã«ãã ã®ã¤ã³ã¹ã¿ã³ã¹ä¿å­ç¨ï¼éåï¼</pre><br/><span class='lineno'>08061</span><pre class='pre'></pre><br/><span class='lineno'>08062</span><pre class='pre'>	function __construct()</pre><br/><span class='lineno'>08063</span><pre class='pre'>	{</pre><br/><span class='lineno'>08064</span><pre class='pre'>		// æ¡ä»¶ãåæåãã¾ãã</pre><br/><span class='lineno'>08065</span><pre class='pre'>		$this-&gt;init_condition();</pre><br/><span class='lineno'>08066</span><pre class='pre'>	}</pre><br/><span class='lineno'>08067</span><pre class='pre'></pre><br/><span class='lineno'>08068</span><pre class='pre'>	function init_condition()</pre><br/><span class='lineno'>08069</span><pre class='pre'>	{</pre><br/><span class='lineno'>08070</span><pre class='pre'>		$this-&gt;albums = array();					// ã¢ã«ãã ã®ã¤ã³ã¹ã¿ã³ã¹ä¿å­ç¨</pre><br/><span class='lineno'>08071</span><pre class='pre'>	}</pre><br/><span class='lineno'>08072</span><pre class='pre'></pre><br/><span class='lineno'>08073</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08074</span><pre class='pre'>	 * é¢æ°åï¼select_data</pre><br/><span class='lineno'>08075</span><pre class='pre'>	 * é¢æ°èª¬æï¼ã¢ã«ãã è©³ç´°ãã¼ãã«ããå¨é¨ãã¼ã¿ãæ¤ç´¢ããã</pre><br/><span class='lineno'>08076</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08077</span><pre class='pre'>	 * $db_link:		ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08078</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>08079</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08080</span><pre class='pre'>	function select_data($db_link)</pre><br/><span class='lineno'>08081</span><pre class='pre'>	{</pre><br/><span class='lineno'>08082</span><pre class='pre'>		// ã¢ã«ãã ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>08083</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>08084</span><pre class='pre'>		$sql = &quot;SELECT album.album_id, album.album_name, album.album_explanation, &quot;;</pre><br/><span class='lineno'>08085</span><pre class='pre'>		$sql .= &quot; album.registration_date FROM album ORDER BY album.album_id desc;&quot;;</pre><br/><span class='lineno'>08086</span><pre class='pre'></pre><br/><span class='lineno'>08087</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08088</span><pre class='pre'></pre><br/><span class='lineno'>08089</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>08090</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08091</span><pre class='pre'></pre><br/><span class='lineno'>08092</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>08093</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08094</span><pre class='pre'>		{</pre><br/><span class='lineno'>08095</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08096</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>08097</span><pre class='pre'>			if ($icount &gt;= 0)</pre><br/><span class='lineno'>08098</span><pre class='pre'>			{</pre><br/><span class='lineno'>08099</span><pre class='pre'>				$this-&gt;albums = array();</pre><br/><span class='lineno'>08100</span><pre class='pre'>				while ($album_class = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>08101</span><pre class='pre'>				{</pre><br/><span class='lineno'>08102</span><pre class='pre'>					// ã¢ã«ãã ãã»ãããã¾ãã</pre><br/><span class='lineno'>08103</span><pre class='pre'>					$ab_cls = new Album();</pre><br/><span class='lineno'>08104</span><pre class='pre'>					$ab_cls-&gt;set_data($album_class);</pre><br/><span class='lineno'>08105</span><pre class='pre'>					$this-&gt;albums[] = $ab_cls;</pre><br/><span class='lineno'>08106</span><pre class='pre'>				}</pre><br/><span class='lineno'>08107</span><pre class='pre'>			}</pre><br/><span class='lineno'>08108</span><pre class='pre'>		}</pre><br/><span class='lineno'>08109</span><pre class='pre'>		else</pre><br/><span class='lineno'>08110</span><pre class='pre'>		{</pre><br/><span class='lineno'>08111</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08112</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08113</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08114</span><pre class='pre'>			$this-&gt;message = &quot;ã¢ã«ãã ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>08115</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>08116</span><pre class='pre'>		}</pre><br/><span class='lineno'>08117</span><pre class='pre'>	}</pre><br/><span class='lineno'>08118</span><pre class='pre'></pre><br/><span class='lineno'>08119</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08120</span><pre class='pre'>	 * é¢æ°åï¼get_imgcnts</pre><br/><span class='lineno'>08121</span><pre class='pre'>	 * é¢æ°èª¬æï¼ãç¹æ°ããåå¾ããã</pre><br/><span class='lineno'>08122</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08123</span><pre class='pre'>	 * $db_link:ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08124</span><pre class='pre'>	 * $albm_id:ã¢ã«ãã ï¼©ï¼¤</pre><br/><span class='lineno'>08125</span><pre class='pre'>	 * æ»ãå¤ï¼åå¾ãããç¹æ°ã</pre><br/><span class='lineno'>08126</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08127</span><pre class='pre'>	function get_imgcnts($db_link,$albm_id)</pre><br/><span class='lineno'>08128</span><pre class='pre'>	{</pre><br/><span class='lineno'>08129</span><pre class='pre'>		$img_cnts = 0;</pre><br/><span class='lineno'>08130</span><pre class='pre'></pre><br/><span class='lineno'>08131</span><pre class='pre'>		if (!empty($albm_id))</pre><br/><span class='lineno'>08132</span><pre class='pre'>		{</pre><br/><span class='lineno'>08133</span><pre class='pre'>		 	$sql = &quot;SELECT COUNT( * ) cnt FROM album_detail WHERE album_id = &quot;.$albm_id.&quot;;&quot;;</pre><br/><span class='lineno'>08134</span><pre class='pre'>			$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08135</span><pre class='pre'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08136</span><pre class='pre'>			if ($result == true)</pre><br/><span class='lineno'>08137</span><pre class='pre'>			{</pre><br/><span class='lineno'>08138</span><pre class='pre'>				// ç¹æ°ãåå¾ãã¾ãã</pre><br/><span class='lineno'>08139</span><pre class='pre'>				$cnt = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>08140</span><pre class='pre'>				$img_cnts = $cnt['cnt'];</pre><br/><span class='lineno'>08141</span><pre class='pre'>			}</pre><br/><span class='lineno'>08142</span><pre class='pre'>			else</pre><br/><span class='lineno'>08143</span><pre class='pre'>			{</pre><br/><span class='lineno'>08144</span><pre class='pre'>				// ã¨ã©ã¼ã®å ´åã¯ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08145</span><pre class='pre'>				$this-&gt;message = &quot;ç¹æ°ãåå¾ã§ãã¾ããã§ããã&quot;;</pre><br/><span class='lineno'>08146</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>08147</span><pre class='pre'>			}</pre><br/><span class='lineno'>08148</span><pre class='pre'>		}</pre><br/><span class='lineno'>08149</span><pre class='pre'></pre><br/><span class='lineno'>08150</span><pre class='pre'>		return $img_cnts;</pre><br/><span class='lineno'>08151</span><pre class='pre'>	}</pre><br/><span class='lineno'>08152</span><pre class='pre'></pre><br/><span class='lineno'>08153</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08154</span><pre class='pre'>	 * é¢æ°åï¼set_sql</pre><br/><span class='lineno'>08155</span><pre class='pre'>	 * é¢æ°èª¬æï¼ï¼³ï¼±ï¼¬æå¥ã®è¨­å®ããã</pre><br/><span class='lineno'>08156</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08157</span><pre class='pre'>	 * $albm_id:ã¢ã«ãã ï¼©ï¼¤</pre><br/><span class='lineno'>08158</span><pre class='pre'>	 * æ»ãå¤ï¼ï¼³ï¼±ï¼¬æå¥</pre><br/><span class='lineno'>08159</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08160</span><pre class='pre'>	private function set_sql($albm_id)</pre><br/><span class='lineno'>08161</span><pre class='pre'>	{</pre><br/><span class='lineno'>08162</span><pre class='pre'>		$sql = &quot;SELECT album.album_id, album.album_name, album.album_explanation,&quot;;</pre><br/><span class='lineno'>08163</span><pre class='pre'>		$sql .= &quot; album.registration_date, album_detail.photo_id, photoimg.photo_mno, photoimg.photo_name,&quot;;</pre><br/><span class='lineno'>08164</span><pre class='pre'>		$sql .= &quot; photoimg.photo_filename, photoimg.photo_filename_th1, photoimg.photo_filename_th2,&quot;;</pre><br/><span class='lineno'>08165</span><pre class='pre'>		$sql .= &quot; photoimg.photo_filename_th3, photoimg.photo_filename_th4, photoimg.photo_filename_th5,&quot;;</pre><br/><span class='lineno'>08166</span><pre class='pre'>		$sql .= &quot; photoimg.photo_filename_th6,photoimg.photo_filename_th7,photoimg.photo_filename_th8,&quot;;</pre><br/><span class='lineno'>08167</span><pre class='pre'>		$sql .= &quot; photoimg.photo_filename_th9,photoimg.photo_filename_th10 FROM album &quot;;</pre><br/><span class='lineno'>08168</span><pre class='pre'>		$sql .= &quot; LEFT JOIN album_detail on album_detail.album_id = album.album_id &quot;;</pre><br/><span class='lineno'>08169</span><pre class='pre'>		$sql .= &quot; LEFT JOIN photoimg on photoimg.photo_id = album_detail.photo_id &quot;;</pre><br/><span class='lineno'>08170</span><pre class='pre'>		$sql .= &quot; WHERE album.album_id = &quot;.$albm_id;</pre><br/><span class='lineno'>08171</span><pre class='pre'></pre><br/><span class='lineno'>08172</span><pre class='pre'>		return $sql;</pre><br/><span class='lineno'>08173</span><pre class='pre'>	}</pre><br/><span class='lineno'>08174</span><pre class='pre'></pre><br/><span class='lineno'>08175</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08176</span><pre class='pre'>	 * é¢æ°åï¼select_data2</pre><br/><span class='lineno'>08177</span><pre class='pre'>	 * é¢æ°èª¬æï¼ã¢ã«ãã è©³ç´°ãã¼ãã«ãããæå®ã®ã¢ã«ãã ã®æå ±ãæ¤ç´¢ããã</pre><br/><span class='lineno'>08178</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08179</span><pre class='pre'>	 * $db_link:ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08180</span><pre class='pre'>	 * $albm_id:ã¢ã«ãã ï¼©ï¼¤</pre><br/><span class='lineno'>08181</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>08182</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08183</span><pre class='pre'>	function select_data2($db_link,$albm_id)</pre><br/><span class='lineno'>08184</span><pre class='pre'>	{</pre><br/><span class='lineno'>08185</span><pre class='pre'>		// ã¢ã«ãã ã¨ã¤ã¡ã¼ã¸ã®æå ±ãDBããåå¾ãã¾ãã</pre><br/><span class='lineno'>08186</span><pre class='pre'>		// åå¾ããããã®SQLãä½æãã¾ãã</pre><br/><span class='lineno'>08187</span><pre class='pre'>		// SQLãã»ãããã¾ãã</pre><br/><span class='lineno'>08188</span><pre class='pre'>		$sql = $this-&gt;set_sql($albm_id);</pre><br/><span class='lineno'>08189</span><pre class='pre'></pre><br/><span class='lineno'>08190</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08191</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>08192</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08193</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>08194</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08195</span><pre class='pre'>		{</pre><br/><span class='lineno'>08196</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08197</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>08198</span><pre class='pre'>			if ($icount &gt;= 0)</pre><br/><span class='lineno'>08199</span><pre class='pre'>			{</pre><br/><span class='lineno'>08200</span><pre class='pre'>				$this-&gt;albums = array();</pre><br/><span class='lineno'>08201</span><pre class='pre'>				while ($album_class = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>08202</span><pre class='pre'>				{</pre><br/><span class='lineno'>08203</span><pre class='pre'>					// ã¢ã«ãã ãã»ãããã¾ãã</pre><br/><span class='lineno'>08204</span><pre class='pre'>					$ab_cls = new Album();</pre><br/><span class='lineno'>08205</span><pre class='pre'>					$ab_cls-&gt;set_data2($album_class);</pre><br/><span class='lineno'>08206</span><pre class='pre'>					$this-&gt;albums[] = $ab_cls;</pre><br/><span class='lineno'>08207</span><pre class='pre'>				}</pre><br/><span class='lineno'>08208</span><pre class='pre'>			}</pre><br/><span class='lineno'>08209</span><pre class='pre'>		}</pre><br/><span class='lineno'>08210</span><pre class='pre'>		else</pre><br/><span class='lineno'>08211</span><pre class='pre'>		{</pre><br/><span class='lineno'>08212</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08213</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08214</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08215</span><pre class='pre'>			$this-&gt;message = &quot;ã¢ã«ãã ã¨ã¤ã¡ã¼ã¸ã®æå ±ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>08216</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>08217</span><pre class='pre'>		}</pre><br/><span class='lineno'>08218</span><pre class='pre'>	}</pre><br/><span class='lineno'>08219</span><pre class='pre'></pre><br/><span class='lineno'>08220</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08221</span><pre class='pre'>	 * é¢æ°åï¼select_data3</pre><br/><span class='lineno'>08222</span><pre class='pre'>	 * é¢æ°èª¬æï¼æå®ã®ã¢ã«ãã ã¨ã¤ã¡ã¼ã¸ã®æå ±ã¨ãæ¤ç´¢ããã</pre><br/><span class='lineno'>08223</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08224</span><pre class='pre'>	 * $db_link:		ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08225</span><pre class='pre'>	 * $albm_id:		ã¢ã«ãã ï¼©ï¼¤</pre><br/><span class='lineno'>08226</span><pre class='pre'>	 * $p_photoid_str:	ã¤ã¡ã¼ã¸ï¼©ï¼¤ã®æå­åï¼&quot;23,24,25&quot;ï¼</pre><br/><span class='lineno'>08227</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>08228</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08229</span><pre class='pre'>	function select_data3($db_link,$albm_id,$p_photoid_str)</pre><br/><span class='lineno'>08230</span><pre class='pre'>	{</pre><br/><span class='lineno'>08231</span><pre class='pre'>		// æ¤ç´¢æ¡ä»¶ãè¨­å®ããã¦ããªãå ´åã¯ãæ»ãã¾ãã</pre><br/><span class='lineno'>08232</span><pre class='pre'>		if (empty($p_photoid_str))</pre><br/><span class='lineno'>08233</span><pre class='pre'>		{</pre><br/><span class='lineno'>08234</span><pre class='pre'>			return ;</pre><br/><span class='lineno'>08235</span><pre class='pre'>		}</pre><br/><span class='lineno'>08236</span><pre class='pre'></pre><br/><span class='lineno'>08237</span><pre class='pre'>		// æ¡ä»¶ãæå­åããéåã«ãã¾ãã</pre><br/><span class='lineno'>08238</span><pre class='pre'>		$photoid_a = array();</pre><br/><span class='lineno'>08239</span><pre class='pre'>		$photoid_a = explode(&quot;,&quot;, $p_photoid_str);</pre><br/><span class='lineno'>08240</span><pre class='pre'>		$ed = count($photoid_a);</pre><br/><span class='lineno'>08241</span><pre class='pre'>		$str1 = &quot;&quot;;</pre><br/><span class='lineno'>08242</span><pre class='pre'>		for ($i = 0 ; $i &lt; $ed ; $i++)</pre><br/><span class='lineno'>08243</span><pre class='pre'>		{</pre><br/><span class='lineno'>08244</span><pre class='pre'>			if (!empty($photoid_a[$i]))</pre><br/><span class='lineno'>08245</span><pre class='pre'>			{</pre><br/><span class='lineno'>08246</span><pre class='pre'>				$str1 .= $photoid_a[$i];</pre><br/><span class='lineno'>08247</span><pre class='pre'>				if ($i == $ed - 1)</pre><br/><span class='lineno'>08248</span><pre class='pre'>				{</pre><br/><span class='lineno'>08249</span><pre class='pre'>					$str1 .= &quot;'&quot;;</pre><br/><span class='lineno'>08250</span><pre class='pre'>				} else {</pre><br/><span class='lineno'>08251</span><pre class='pre'>					$str1 .= &quot;','&quot;;</pre><br/><span class='lineno'>08252</span><pre class='pre'>				}</pre><br/><span class='lineno'>08253</span><pre class='pre'>			}</pre><br/><span class='lineno'>08254</span><pre class='pre'>		}</pre><br/><span class='lineno'>08255</span><pre class='pre'>		if ($str1 != &quot;&quot;)</pre><br/><span class='lineno'>08256</span><pre class='pre'>		{</pre><br/><span class='lineno'>08257</span><pre class='pre'>			$str1 = &quot;'&quot;.$str1;</pre><br/><span class='lineno'>08258</span><pre class='pre'>		}</pre><br/><span class='lineno'>08259</span><pre class='pre'></pre><br/><span class='lineno'>08260</span><pre class='pre'>		// SQLãã»ãããã¾ãã</pre><br/><span class='lineno'>08261</span><pre class='pre'>		$sql = $this-&gt;set_sql($albm_id);</pre><br/><span class='lineno'>08262</span><pre class='pre'>		$sql .= &quot; AND album_detail.photo_id IN (&quot; .$str1. &quot;)&quot;;</pre><br/><span class='lineno'>08263</span><pre class='pre'></pre><br/><span class='lineno'>08264</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08265</span><pre class='pre'>		// SQLãå®è¡ãã¾ãã</pre><br/><span class='lineno'>08266</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08267</span><pre class='pre'>		// å®è¡çµæããã§ãã¯ãã¾ãã</pre><br/><span class='lineno'>08268</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08269</span><pre class='pre'>		{</pre><br/><span class='lineno'>08270</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08271</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>08272</span><pre class='pre'>			if ($icount &gt;= 0)</pre><br/><span class='lineno'>08273</span><pre class='pre'>			{</pre><br/><span class='lineno'>08274</span><pre class='pre'>				$this-&gt;albums = array();</pre><br/><span class='lineno'>08275</span><pre class='pre'>				while ($album_class = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>08276</span><pre class='pre'>				{</pre><br/><span class='lineno'>08277</span><pre class='pre'>					// ã¢ã«ãã ãã»ãããã¾ãã</pre><br/><span class='lineno'>08278</span><pre class='pre'>					$ab_cls = new Album();</pre><br/><span class='lineno'>08279</span><pre class='pre'>					$ab_cls-&gt;set_data2($album_class);</pre><br/><span class='lineno'>08280</span><pre class='pre'>					$this-&gt;albums[] = $ab_cls;</pre><br/><span class='lineno'>08281</span><pre class='pre'>				}</pre><br/><span class='lineno'>08282</span><pre class='pre'>			}</pre><br/><span class='lineno'>08283</span><pre class='pre'>		}</pre><br/><span class='lineno'>08284</span><pre class='pre'>		else</pre><br/><span class='lineno'>08285</span><pre class='pre'>		{</pre><br/><span class='lineno'>08286</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08287</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08288</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08289</span><pre class='pre'>			$this-&gt;message = &quot;ã¢ã«ãã ã¨ã¤ã¡ã¼ã¸ã®æå ±ãåå¾ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>08290</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>08291</span><pre class='pre'>		}</pre><br/><span class='lineno'>08292</span><pre class='pre'>	}</pre><br/><span class='lineno'>08293</span><pre class='pre'>}</pre><br/><span class='lineno'>08294</span><pre class='pre'></pre><br/><span class='lineno'>08295</span><pre class='pre'>/*</pre><br/><span class='lineno'>08296</span><pre class='pre'> * ã¯ã©ã¹åï¼CsvFile</pre><br/><span class='lineno'>08297</span><pre class='pre'> * ã¯ã©ã¹èª¬æï¼ã¢ããã­ã¼ãã¨ãã¦ã­ã¼ãã®ç¶æãç®¡çãã</pre><br/><span class='lineno'>08298</span><pre class='pre'> */</pre><br/><span class='lineno'>08299</span><pre class='pre'>class CsvFile</pre><br/><span class='lineno'>08300</span><pre class='pre'>{</pre><br/><span class='lineno'>08301</span><pre class='pre'>	var $message;					// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>08302</span><pre class='pre'>	var $error;						// ã¨ã©ã¼</pre><br/><span class='lineno'>08303</span><pre class='pre'></pre><br/><span class='lineno'>08304</span><pre class='pre'>	var $file_name;					// CSVãã¡ã¤ã«å</pre><br/><span class='lineno'>08305</span><pre class='pre'>	var $up_user;					// ã¢ããã­ã¼ãã®ã¦ã¼ã¶ã¼</pre><br/><span class='lineno'>08306</span><pre class='pre'>	var $up_time;					// ã¢ããã­ã¼ãã®ã¿ã¤ã </pre><br/><span class='lineno'>08307</span><pre class='pre'>	var $down_user;					// ãã¦ã­ã¼ãã®ã¦ã¼ã¶ã¼</pre><br/><span class='lineno'>08308</span><pre class='pre'>	var $down_time;					// ãã¦ã­ã¼ãã®ã¿ã¤ã </pre><br/><span class='lineno'>08309</span><pre class='pre'></pre><br/><span class='lineno'>08310</span><pre class='pre'>	function set_file_name($sp_file_name)</pre><br/><span class='lineno'>08311</span><pre class='pre'>	{</pre><br/><span class='lineno'>08312</span><pre class='pre'>		if (!empty($sp_file_name))</pre><br/><span class='lineno'>08313</span><pre class='pre'>		{</pre><br/><span class='lineno'>08314</span><pre class='pre'>			$this-&gt;file_name = $sp_file_name;</pre><br/><span class='lineno'>08315</span><pre class='pre'>		}</pre><br/><span class='lineno'>08316</span><pre class='pre'>	}</pre><br/><span class='lineno'>08317</span><pre class='pre'></pre><br/><span class='lineno'>08318</span><pre class='pre'>	function set_up_user($sp_up_user)</pre><br/><span class='lineno'>08319</span><pre class='pre'>	{</pre><br/><span class='lineno'>08320</span><pre class='pre'>		if (!empty($sp_up_user))</pre><br/><span class='lineno'>08321</span><pre class='pre'>		{</pre><br/><span class='lineno'>08322</span><pre class='pre'>			$this-&gt;up_user = $sp_up_user;</pre><br/><span class='lineno'>08323</span><pre class='pre'>		}</pre><br/><span class='lineno'>08324</span><pre class='pre'>	}</pre><br/><span class='lineno'>08325</span><pre class='pre'></pre><br/><span class='lineno'>08326</span><pre class='pre'>	function set_up_time($sp_up_time)</pre><br/><span class='lineno'>08327</span><pre class='pre'>	{</pre><br/><span class='lineno'>08328</span><pre class='pre'>		if (!empty($sp_up_time))</pre><br/><span class='lineno'>08329</span><pre class='pre'>		{</pre><br/><span class='lineno'>08330</span><pre class='pre'>			$this-&gt;up_time = $sp_up_time;</pre><br/><span class='lineno'>08331</span><pre class='pre'>		}</pre><br/><span class='lineno'>08332</span><pre class='pre'>	}</pre><br/><span class='lineno'>08333</span><pre class='pre'></pre><br/><span class='lineno'>08334</span><pre class='pre'>	function set_down_user($sp_down_user)</pre><br/><span class='lineno'>08335</span><pre class='pre'>	{</pre><br/><span class='lineno'>08336</span><pre class='pre'>		if (!empty($sp_down_user))</pre><br/><span class='lineno'>08337</span><pre class='pre'>		{</pre><br/><span class='lineno'>08338</span><pre class='pre'>			$this-&gt;down_user = $sp_down_user;</pre><br/><span class='lineno'>08339</span><pre class='pre'>		}</pre><br/><span class='lineno'>08340</span><pre class='pre'>	}</pre><br/><span class='lineno'>08341</span><pre class='pre'></pre><br/><span class='lineno'>08342</span><pre class='pre'>	function set_down_time($sp_down_time)</pre><br/><span class='lineno'>08343</span><pre class='pre'>	{</pre><br/><span class='lineno'>08344</span><pre class='pre'>		if (!empty($sp_down_time))</pre><br/><span class='lineno'>08345</span><pre class='pre'>		{</pre><br/><span class='lineno'>08346</span><pre class='pre'>			$this-&gt;down_time = $sp_down_time;</pre><br/><span class='lineno'>08347</span><pre class='pre'>		}</pre><br/><span class='lineno'>08348</span><pre class='pre'>	}</pre><br/><span class='lineno'>08349</span><pre class='pre'></pre><br/><span class='lineno'>08350</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08351</span><pre class='pre'>	 * é¢æ°åï¼isExits</pre><br/><span class='lineno'>08352</span><pre class='pre'>	 * é¢æ°èª¬æï¼ç»é²ãããã©ãããã§ãã¯ãã</pre><br/><span class='lineno'>08353</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08354</span><pre class='pre'>	 * db_link:	ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08355</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>08356</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08357</span><pre class='pre'>	function isExits($db_link)</pre><br/><span class='lineno'>08358</span><pre class='pre'>	{</pre><br/><span class='lineno'>08359</span><pre class='pre'>		// æ¤ç´¢ã®SQLæ</pre><br/><span class='lineno'>08360</span><pre class='pre'>		$sql = &quot;SELECT count(*) cnt FROM csvfile &quot;;</pre><br/><span class='lineno'>08361</span><pre class='pre'>		$sql .= &quot; WHERE file_name = \&quot;&quot; .$this-&gt;file_name. &quot;\&quot;&quot;;</pre><br/><span class='lineno'>08362</span><pre class='pre'></pre><br/><span class='lineno'>08363</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08364</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08365</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08366</span><pre class='pre'>		{</pre><br/><span class='lineno'>08367</span><pre class='pre'>			$cnt = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>08368</span><pre class='pre'>			$img_cnts = $cnt['cnt'];</pre><br/><span class='lineno'>08369</span><pre class='pre'>			return $img_cnts;</pre><br/><span class='lineno'>08370</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>08371</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08372</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08373</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08374</span><pre class='pre'>			throw new Exception($err);</pre><br/><span class='lineno'>08375</span><pre class='pre'>			return -1;</pre><br/><span class='lineno'>08376</span><pre class='pre'>		}</pre><br/><span class='lineno'>08377</span><pre class='pre'>	}</pre><br/><span class='lineno'>08378</span><pre class='pre'></pre><br/><span class='lineno'>08379</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08380</span><pre class='pre'>	 * é¢æ°åï¼select_data</pre><br/><span class='lineno'>08381</span><pre class='pre'>	 * é¢æ°èª¬æï¼DBããCSVãã¡ã¤ã«ã®ç¶æãæ¤ç´¢ãã</pre><br/><span class='lineno'>08382</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08383</span><pre class='pre'>	 * db_link:	ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08384</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>08385</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08386</span><pre class='pre'>	function select_data($db_link)</pre><br/><span class='lineno'>08387</span><pre class='pre'>	{</pre><br/><span class='lineno'>08388</span><pre class='pre'>		// æ¤ç´¢ã®SQLæ</pre><br/><span class='lineno'>08389</span><pre class='pre'>		$sql = &quot;SELECT up_user,up_time,down_user,down_time FROM csvfile &quot;;</pre><br/><span class='lineno'>08390</span><pre class='pre'>		$sql .= &quot; WHERE file_name = \&quot;&quot; .$this-&gt;file_name. &quot;\&quot;&quot;;</pre><br/><span class='lineno'>08391</span><pre class='pre'></pre><br/><span class='lineno'>08392</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08393</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08394</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08395</span><pre class='pre'>		{</pre><br/><span class='lineno'>08396</span><pre class='pre'>			$csv = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>08397</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08398</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>08399</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>08400</span><pre class='pre'>			{</pre><br/><span class='lineno'>08401</span><pre class='pre'>				$this-&gt;up_user = $csv['up_user'];</pre><br/><span class='lineno'>08402</span><pre class='pre'>				$this-&gt;up_time = $csv['up_time'];</pre><br/><span class='lineno'>08403</span><pre class='pre'>				$this-&gt;down_user = $csv['down_user'];</pre><br/><span class='lineno'>08404</span><pre class='pre'>				$this-&gt;down_time = $csv['down_time'];</pre><br/><span class='lineno'>08405</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>08406</span><pre class='pre'>				$this-&gt;up_user = &quot;&quot;;</pre><br/><span class='lineno'>08407</span><pre class='pre'>				$this-&gt;up_time = null;</pre><br/><span class='lineno'>08408</span><pre class='pre'>				$this-&gt;down_user = &quot;&quot;;</pre><br/><span class='lineno'>08409</span><pre class='pre'>				$this-&gt;down_time = null;</pre><br/><span class='lineno'>08410</span><pre class='pre'>			}</pre><br/><span class='lineno'>08411</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>08412</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08413</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08414</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08415</span><pre class='pre'>			throw new Exception($err);</pre><br/><span class='lineno'>08416</span><pre class='pre'>			return -1;</pre><br/><span class='lineno'>08417</span><pre class='pre'>		}</pre><br/><span class='lineno'>08418</span><pre class='pre'>	}</pre><br/><span class='lineno'>08419</span><pre class='pre'></pre><br/><span class='lineno'>08420</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08421</span><pre class='pre'>	 * é¢æ°åï¼insert_data</pre><br/><span class='lineno'>08422</span><pre class='pre'>	 * é¢æ°èª¬æï¼CSVãã¡ã¤ã«ãã¼ãã«ã«ç»é²ãã¾ãã</pre><br/><span class='lineno'>08423</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08424</span><pre class='pre'>	 * $db_link: ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08425</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>08426</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08427</span><pre class='pre'>	function insert_data($db_link)</pre><br/><span class='lineno'>08428</span><pre class='pre'>	{</pre><br/><span class='lineno'>08429</span><pre class='pre'>		// æ°è¦ã®SQLæ</pre><br/><span class='lineno'>08430</span><pre class='pre'>		$sql = &quot;INSERT INTO csvfile (file_name, up_user, up_time) VALUES ( &quot;;</pre><br/><span class='lineno'>08431</span><pre class='pre'>		$sql .= &quot;\&quot;&quot;.$this-&gt;file_name . &quot;\&quot;,&quot;;		// CSVãã¡ã¤ã«å</pre><br/><span class='lineno'>08432</span><pre class='pre'>		$sql .= &quot;\&quot;&quot;.$this-&gt;up_user . &quot;\&quot;,&quot;;		// ã¢ããã­ã¼ãã®ã¦ã¼ã¶ã¼</pre><br/><span class='lineno'>08433</span><pre class='pre'>		$sql .= &quot;\&quot;&quot;.$this-&gt;up_time . &quot;\&quot;&quot;;			// ã¢ããã­ã¼ãã®ã¿ã¤ã </pre><br/><span class='lineno'>08434</span><pre class='pre'>		$sql .= &quot;);&quot;;</pre><br/><span class='lineno'>08435</span><pre class='pre'></pre><br/><span class='lineno'>08436</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08437</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08438</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08439</span><pre class='pre'>		{</pre><br/><span class='lineno'>08440</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08441</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>08442</span><pre class='pre'>			if ($icount != 1)</pre><br/><span class='lineno'>08443</span><pre class='pre'>			{</pre><br/><span class='lineno'>08444</span><pre class='pre'>				$this-&gt;message = &quot;CSVãã¡ã¤ã«ãDBã«ç»é²ã§ãã¾ããã§ãããï¼å¦çæ°!=1ï¼&quot;;</pre><br/><span class='lineno'>08445</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>08446</span><pre class='pre'>			}</pre><br/><span class='lineno'>08447</span><pre class='pre'>		}</pre><br/><span class='lineno'>08448</span><pre class='pre'>		else</pre><br/><span class='lineno'>08449</span><pre class='pre'>		{</pre><br/><span class='lineno'>08450</span><pre class='pre'>			$this-&gt;message = &quot;CSVãã¡ã¤ã«ãDBã«ç»é²ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>08451</span><pre class='pre'>			// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08452</span><pre class='pre'>			$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>08453</span><pre class='pre'>			throw new Exception($msg);</pre><br/><span class='lineno'>08454</span><pre class='pre'>		}</pre><br/><span class='lineno'>08455</span><pre class='pre'>	}</pre><br/><span class='lineno'>08456</span><pre class='pre'></pre><br/><span class='lineno'>08457</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08458</span><pre class='pre'>	 * é¢æ°å  ï¼update_data</pre><br/><span class='lineno'>08459</span><pre class='pre'>	 * é¢æ°èª¬æï¼CSVãã¡ã¤ã«ãã¼ãã«ã«æ´æ°ãã¾ãã</pre><br/><span class='lineno'>08460</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08461</span><pre class='pre'>	 * db_link ï¼ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08462</span><pre class='pre'>	 * flg     ï¼ã1ãï¼ã¢ããã­ã¼ããæ´æ°ããï¼</pre><br/><span class='lineno'>08463</span><pre class='pre'>	 *           ã2ãï¼ãã¦ã­ã¼ããæ´æ°ããï¼</pre><br/><span class='lineno'>08464</span><pre class='pre'>	 * æ»ãå¤ãï¼ç¡ã</pre><br/><span class='lineno'>08465</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08466</span><pre class='pre'>	function update_data($db_link,$flg)</pre><br/><span class='lineno'>08467</span><pre class='pre'>	{</pre><br/><span class='lineno'>08468</span><pre class='pre'>		// æ°è¦ãããã©ãããã§ãã¯ãã</pre><br/><span class='lineno'>08469</span><pre class='pre'>		$insert_flg = $this-&gt;isExits($db_link);</pre><br/><span class='lineno'>08470</span><pre class='pre'>		// å­å¨ããªãå ´å</pre><br/><span class='lineno'>08471</span><pre class='pre'>		if ((int)$insert_flg == 0)</pre><br/><span class='lineno'>08472</span><pre class='pre'>		{</pre><br/><span class='lineno'>08473</span><pre class='pre'>			$this-&gt;insert_data($db_link);</pre><br/><span class='lineno'>08474</span><pre class='pre'>		// å­å¨ããå ´å</pre><br/><span class='lineno'>08475</span><pre class='pre'>		} else if ((int)$insert_flg &gt; 0) {</pre><br/><span class='lineno'>08476</span><pre class='pre'>			// æ´æ°ã®SQLæ</pre><br/><span class='lineno'>08477</span><pre class='pre'>			$sql = &quot;UPDATE csvfile SET &quot;;</pre><br/><span class='lineno'>08478</span><pre class='pre'>			if ((int)$flg == 1)</pre><br/><span class='lineno'>08479</span><pre class='pre'>			{</pre><br/><span class='lineno'>08480</span><pre class='pre'>				$sql .= &quot;up_user = '&quot;.$this-&gt;up_user.&quot;',&quot;;</pre><br/><span class='lineno'>08481</span><pre class='pre'>				$sql .= &quot;up_time = now(),&quot;;</pre><br/><span class='lineno'>08482</span><pre class='pre'>				$sql .= &quot;down_user = '',&quot;;</pre><br/><span class='lineno'>08483</span><pre class='pre'>				$sql .= &quot;down_time = NULL&quot;;</pre><br/><span class='lineno'>08484</span><pre class='pre'>			} elseif ((int)$flg == 2) {</pre><br/><span class='lineno'>08485</span><pre class='pre'>				$sql .= &quot;up_user = '',&quot;;</pre><br/><span class='lineno'>08486</span><pre class='pre'>				$sql .= &quot;up_time = NULL,&quot;;</pre><br/><span class='lineno'>08487</span><pre class='pre'>				$sql .= &quot;down_user = '&quot;.$this-&gt;down_user.&quot;',&quot;;</pre><br/><span class='lineno'>08488</span><pre class='pre'>				$sql .= &quot;down_time = now()&quot;;</pre><br/><span class='lineno'>08489</span><pre class='pre'>			}</pre><br/><span class='lineno'>08490</span><pre class='pre'></pre><br/><span class='lineno'>08491</span><pre class='pre'>			$sql .= &quot; WHERE file_name = \&quot;&quot;.$this-&gt;file_name.&quot;\&quot;&quot;;</pre><br/><span class='lineno'>08492</span><pre class='pre'></pre><br/><span class='lineno'>08493</span><pre class='pre'>			$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08494</span><pre class='pre'>			$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08495</span><pre class='pre'>			if ($result == false)</pre><br/><span class='lineno'>08496</span><pre class='pre'>			{</pre><br/><span class='lineno'>08497</span><pre class='pre'>				$this-&gt;message = &quot;CSVãã¡ã¤ã«ãDBã«æ´æ°ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>08498</span><pre class='pre'>				// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08499</span><pre class='pre'>				$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>08500</span><pre class='pre'>				throw new Exception($msg);</pre><br/><span class='lineno'>08501</span><pre class='pre'>			}</pre><br/><span class='lineno'>08502</span><pre class='pre'>		}</pre><br/><span class='lineno'>08503</span><pre class='pre'>	}</pre><br/><span class='lineno'>08504</span><pre class='pre'>}</pre><br/><span class='lineno'>08505</span><pre class='pre'></pre><br/><span class='lineno'>08506</span><pre class='pre'>/*</pre><br/><span class='lineno'>08507</span><pre class='pre'> * ã¯ã©ã¹åï¼DispCounter</pre><br/><span class='lineno'>08508</span><pre class='pre'> * ã¯ã©ã¹èª¬æï¼ç»åè¡¨ç¤ºåæ°ãç®¡çãã</pre><br/><span class='lineno'>08509</span><pre class='pre'> */</pre><br/><span class='lineno'>08510</span><pre class='pre'>class DispCounter</pre><br/><span class='lineno'>08511</span><pre class='pre'>{</pre><br/><span class='lineno'>08512</span><pre class='pre'>	var $message;					// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>08513</span><pre class='pre'>	var $error;						// ã¨ã©ã¼</pre><br/><span class='lineno'>08514</span><pre class='pre'></pre><br/><span class='lineno'>08515</span><pre class='pre'>	var $photo_mno;					// ç»åç®¡ççªå·</pre><br/><span class='lineno'>08516</span><pre class='pre'>	var $disp_date;					// ç»åè¡¨ç¤ºæ¥ä»</pre><br/><span class='lineno'>08517</span><pre class='pre'>	var $counter;					// ã«ã¦ã³ã</pre><br/><span class='lineno'>08518</span><pre class='pre'>	var $disp_cnt_ary;				// ç»åè¡¨ç¤ºåæ°ã¯ã©ã¹</pre><br/><span class='lineno'>08519</span><pre class='pre'></pre><br/><span class='lineno'>08520</span><pre class='pre'>	function set_photo_mno($sp_photo_mno)</pre><br/><span class='lineno'>08521</span><pre class='pre'>	{</pre><br/><span class='lineno'>08522</span><pre class='pre'>		if (!empty($sp_photo_mno))</pre><br/><span class='lineno'>08523</span><pre class='pre'>		{</pre><br/><span class='lineno'>08524</span><pre class='pre'>			$this-&gt;photo_mno = $sp_photo_mno;</pre><br/><span class='lineno'>08525</span><pre class='pre'>		}</pre><br/><span class='lineno'>08526</span><pre class='pre'>	}</pre><br/><span class='lineno'>08527</span><pre class='pre'></pre><br/><span class='lineno'>08528</span><pre class='pre'>	function set_disp_date($sp_disp_date)</pre><br/><span class='lineno'>08529</span><pre class='pre'>	{</pre><br/><span class='lineno'>08530</span><pre class='pre'>		if (!empty($sp_disp_date))</pre><br/><span class='lineno'>08531</span><pre class='pre'>		{</pre><br/><span class='lineno'>08532</span><pre class='pre'>			$this-&gt;disp_date = $sp_disp_date;</pre><br/><span class='lineno'>08533</span><pre class='pre'>		}</pre><br/><span class='lineno'>08534</span><pre class='pre'>	}</pre><br/><span class='lineno'>08535</span><pre class='pre'></pre><br/><span class='lineno'>08536</span><pre class='pre'>	function set_counter($sp_counter)</pre><br/><span class='lineno'>08537</span><pre class='pre'>	{</pre><br/><span class='lineno'>08538</span><pre class='pre'>		if (!empty($sp_counter))</pre><br/><span class='lineno'>08539</span><pre class='pre'>		{</pre><br/><span class='lineno'>08540</span><pre class='pre'>			$this-&gt;counter = $sp_counter;</pre><br/><span class='lineno'>08541</span><pre class='pre'>		}</pre><br/><span class='lineno'>08542</span><pre class='pre'>	}</pre><br/><span class='lineno'>08543</span><pre class='pre'></pre><br/><span class='lineno'>08544</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08545</span><pre class='pre'>	 * é¢æ°åï¼isExitsCheck</pre><br/><span class='lineno'>08546</span><pre class='pre'>	 * é¢æ°èª¬æï¼ç»åç®¡ççªå·ããããã©ãããã§ãã¯ãã</pre><br/><span class='lineno'>08547</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08548</span><pre class='pre'>	 * db_link:	ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08549</span><pre class='pre'>	 * æ»ãå¤ï¼true/false</pre><br/><span class='lineno'>08550</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08551</span><pre class='pre'>	function isExitsCheck($db_link)</pre><br/><span class='lineno'>08552</span><pre class='pre'>	{</pre><br/><span class='lineno'>08553</span><pre class='pre'>		// æ¤ç´¢ã®SQLæ</pre><br/><span class='lineno'>08554</span><pre class='pre'>		$sql = &quot;SELECT * FROM disp_counter &quot;;</pre><br/><span class='lineno'>08555</span><pre class='pre'>		$sql .= &quot; WHERE photo_mno = \&quot;&quot; .$this-&gt;photo_mno. &quot;\&quot;&quot;;</pre><br/><span class='lineno'>08556</span><pre class='pre'>		$sql .= &quot; AND disp_date = \&quot;&quot; .$this-&gt;disp_date. &quot;\&quot;&quot;;</pre><br/><span class='lineno'>08557</span><pre class='pre'></pre><br/><span class='lineno'>08558</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08559</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08560</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08561</span><pre class='pre'>		{</pre><br/><span class='lineno'>08562</span><pre class='pre'>			$dp_cn = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>08563</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08564</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>08565</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>08566</span><pre class='pre'>			{</pre><br/><span class='lineno'>08567</span><pre class='pre'>				return true;</pre><br/><span class='lineno'>08568</span><pre class='pre'>			} else {</pre><br/><span class='lineno'>08569</span><pre class='pre'>				return false;</pre><br/><span class='lineno'>08570</span><pre class='pre'>			}</pre><br/><span class='lineno'>08571</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>08572</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08573</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08574</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08575</span><pre class='pre'>			throw new Exception($err);</pre><br/><span class='lineno'>08576</span><pre class='pre'>			return -1;</pre><br/><span class='lineno'>08577</span><pre class='pre'>		}</pre><br/><span class='lineno'>08578</span><pre class='pre'>	}</pre><br/><span class='lineno'>08579</span><pre class='pre'></pre><br/><span class='lineno'>08580</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08581</span><pre class='pre'>	 * é¢æ°åï¼select_data1</pre><br/><span class='lineno'>08582</span><pre class='pre'>	 * é¢æ°èª¬æï¼ç»åè¡¨ç¤ºåæ°ãæ¤ç´¢ãã</pre><br/><span class='lineno'>08583</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08584</span><pre class='pre'>	 * db_link:	ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08585</span><pre class='pre'>	 * æ»ãå¤ï¼true/false</pre><br/><span class='lineno'>08586</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08587</span><pre class='pre'>	function select_data1($db_link)</pre><br/><span class='lineno'>08588</span><pre class='pre'>	{</pre><br/><span class='lineno'>08589</span><pre class='pre'>		// æ¤ç´¢ã®SQLæ</pre><br/><span class='lineno'>08590</span><pre class='pre'>		$sql = &quot;SELECT photo_mno,sum(counter) cnt FROM disp_counter &quot;;</pre><br/><span class='lineno'>08591</span><pre class='pre'>		$sql .= &quot; GROUP BY photo_mno&quot;;</pre><br/><span class='lineno'>08592</span><pre class='pre'>		$sql .= &quot; ORDER BY cnt DESC&quot;;</pre><br/><span class='lineno'>08593</span><pre class='pre'></pre><br/><span class='lineno'>08594</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08595</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08596</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08597</span><pre class='pre'>		{</pre><br/><span class='lineno'>08598</span><pre class='pre'>			$this-&gt;disp_cnt_ary = array();</pre><br/><span class='lineno'>08599</span><pre class='pre'></pre><br/><span class='lineno'>08600</span><pre class='pre'>			while ($dp_cn = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>08601</span><pre class='pre'>			{</pre><br/><span class='lineno'>08602</span><pre class='pre'>				$tmp_disp = new DispCounter();</pre><br/><span class='lineno'>08603</span><pre class='pre'>				$tmp_disp-&gt;photo_mno = $dp_cn['photo_mno'];</pre><br/><span class='lineno'>08604</span><pre class='pre'>				$tmp_disp-&gt;counter = $dp_cn['cnt'];</pre><br/><span class='lineno'>08605</span><pre class='pre'>				$this-&gt;disp_cnt_ary[] = $tmp_disp;</pre><br/><span class='lineno'>08606</span><pre class='pre'>			}</pre><br/><span class='lineno'>08607</span><pre class='pre'>			return true;</pre><br/><span class='lineno'>08608</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>08609</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08610</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08611</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08612</span><pre class='pre'>			throw new Exception($err[2]);</pre><br/><span class='lineno'>08613</span><pre class='pre'>			return -1;</pre><br/><span class='lineno'>08614</span><pre class='pre'>		}</pre><br/><span class='lineno'>08615</span><pre class='pre'>	}</pre><br/><span class='lineno'>08616</span><pre class='pre'></pre><br/><span class='lineno'>08617</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08618</span><pre class='pre'>	 * é¢æ°åï¼select_data2</pre><br/><span class='lineno'>08619</span><pre class='pre'>	 * é¢æ°èª¬æï¼ç»åè¡¨ç¤ºåæ°ãæ¤ç´¢ãã</pre><br/><span class='lineno'>08620</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08621</span><pre class='pre'>	 * db_link:	ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08622</span><pre class='pre'>	 * æ»ãå¤ï¼true/false</pre><br/><span class='lineno'>08623</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08624</span><pre class='pre'>	function select_data2($db_link)</pre><br/><span class='lineno'>08625</span><pre class='pre'>	{</pre><br/><span class='lineno'>08626</span><pre class='pre'>		// æ¤ç´¢ã®SQLæ</pre><br/><span class='lineno'>08627</span><pre class='pre'>		$sql = &quot;SELECT photo_mno,sum(counter) cnt,disp_date FROM disp_counter &quot;;</pre><br/><span class='lineno'>08628</span><pre class='pre'>		$sql .= &quot; GROUP BY disp_date,photo_mno&quot;;</pre><br/><span class='lineno'>08629</span><pre class='pre'>		$sql .= &quot; ORDER BY disp_date,cnt DESC,photo_mno&quot;;</pre><br/><span class='lineno'>08630</span><pre class='pre'></pre><br/><span class='lineno'>08631</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08632</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08633</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08634</span><pre class='pre'>		{</pre><br/><span class='lineno'>08635</span><pre class='pre'>			$this-&gt;disp_cnt_ary = array();</pre><br/><span class='lineno'>08636</span><pre class='pre'></pre><br/><span class='lineno'>08637</span><pre class='pre'>			while ($dp_cn = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>08638</span><pre class='pre'>			{</pre><br/><span class='lineno'>08639</span><pre class='pre'>				$tmp_disp = new DispCounter();</pre><br/><span class='lineno'>08640</span><pre class='pre'>				$tmp_disp-&gt;photo_mno = $dp_cn['photo_mno'];</pre><br/><span class='lineno'>08641</span><pre class='pre'>				$tmp_disp-&gt;disp_date = $dp_cn['disp_date'];</pre><br/><span class='lineno'>08642</span><pre class='pre'>				$tmp_disp-&gt;counter = $dp_cn['cnt'];</pre><br/><span class='lineno'>08643</span><pre class='pre'>				$this-&gt;disp_cnt_ary[] = $tmp_disp;</pre><br/><span class='lineno'>08644</span><pre class='pre'>			}</pre><br/><span class='lineno'>08645</span><pre class='pre'>			return true;</pre><br/><span class='lineno'>08646</span><pre class='pre'>		} else {</pre><br/><span class='lineno'>08647</span><pre class='pre'>			// å®è¡çµæãNGã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08648</span><pre class='pre'>			// ã¨ã©ã¼æå ±ãã»ãããã¦ãä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08649</span><pre class='pre'>			$err = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08650</span><pre class='pre'>			throw new Exception($err);</pre><br/><span class='lineno'>08651</span><pre class='pre'>			return -1;</pre><br/><span class='lineno'>08652</span><pre class='pre'>		}</pre><br/><span class='lineno'>08653</span><pre class='pre'>	}</pre><br/><span class='lineno'>08654</span><pre class='pre'></pre><br/><span class='lineno'>08655</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08656</span><pre class='pre'>	 * é¢æ°åï¼insert_data</pre><br/><span class='lineno'>08657</span><pre class='pre'>	 * é¢æ°èª¬æï¼ç»åã®è¡¨ç¤ºåæ°ããã¼ãã«ã«ç»é²ãã¾ãã</pre><br/><span class='lineno'>08658</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08659</span><pre class='pre'>	 * $db_link: ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08660</span><pre class='pre'>	 * æ»ãå¤ï¼ç¡ã</pre><br/><span class='lineno'>08661</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08662</span><pre class='pre'>	function insert_data($db_link)</pre><br/><span class='lineno'>08663</span><pre class='pre'>	{</pre><br/><span class='lineno'>08664</span><pre class='pre'>		// æ°è¦ã®SQLæ</pre><br/><span class='lineno'>08665</span><pre class='pre'>		$sql = &quot;INSERT INTO disp_counter (photo_mno, disp_date, counter) VALUES ( &quot;;</pre><br/><span class='lineno'>08666</span><pre class='pre'>		$sql .= &quot;\&quot;&quot;.$this-&gt;photo_mno . &quot;\&quot;,&quot;;		// ç»åç®¡ççªå·</pre><br/><span class='lineno'>08667</span><pre class='pre'>		$sql .= &quot;\&quot;&quot;.$this-&gt;disp_date . &quot;\&quot;,&quot;;		// ç»åè¡¨ç¤ºæ¥ä»</pre><br/><span class='lineno'>08668</span><pre class='pre'>		$sql .= &quot;1&quot;;								// ã«ã¦ã³ã</pre><br/><span class='lineno'>08669</span><pre class='pre'>		$sql .= &quot;);&quot;;</pre><br/><span class='lineno'>08670</span><pre class='pre'></pre><br/><span class='lineno'>08671</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08672</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08673</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08674</span><pre class='pre'>		{</pre><br/><span class='lineno'>08675</span><pre class='pre'>			// å®è¡çµæãOKã®å ´åã®å¦çã§ãã</pre><br/><span class='lineno'>08676</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>08677</span><pre class='pre'>			if ($icount != 1)</pre><br/><span class='lineno'>08678</span><pre class='pre'>			{</pre><br/><span class='lineno'>08679</span><pre class='pre'>				$this-&gt;message = &quot;ç»åã®è¡¨ç¤ºåæ°ãDBã«ç»é²ã§ãã¾ããã§ãããï¼å¦çæ°!=1ï¼&quot;;</pre><br/><span class='lineno'>08680</span><pre class='pre'>				throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>08681</span><pre class='pre'>			}</pre><br/><span class='lineno'>08682</span><pre class='pre'>		}</pre><br/><span class='lineno'>08683</span><pre class='pre'>		else</pre><br/><span class='lineno'>08684</span><pre class='pre'>		{</pre><br/><span class='lineno'>08685</span><pre class='pre'>			$this-&gt;message = &quot;ç»åã®è¡¨ç¤ºåæ°ãDBã«ç»é²ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>08686</span><pre class='pre'>			// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08687</span><pre class='pre'>			$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>08688</span><pre class='pre'>			throw new Exception($msg);</pre><br/><span class='lineno'>08689</span><pre class='pre'>		}</pre><br/><span class='lineno'>08690</span><pre class='pre'>	}</pre><br/><span class='lineno'>08691</span><pre class='pre'></pre><br/><span class='lineno'>08692</span><pre class='pre'>	/*</pre><br/><span class='lineno'>08693</span><pre class='pre'>	 * é¢æ°å  ï¼update_data</pre><br/><span class='lineno'>08694</span><pre class='pre'>	 * é¢æ°èª¬æï¼ç»åã®è¡¨ç¤ºåæ°ãæ´æ°ãã¾ãã</pre><br/><span class='lineno'>08695</span><pre class='pre'>	 * ãã©ã¡ã¿ï¼</pre><br/><span class='lineno'>08696</span><pre class='pre'>	 * db_link ï¼ãã¼ã¿ãã¼ã¹ã®ãªã³ã¯</pre><br/><span class='lineno'>08697</span><pre class='pre'>	 * æ»ãå¤ãï¼ç¡ã</pre><br/><span class='lineno'>08698</span><pre class='pre'>	 */</pre><br/><span class='lineno'>08699</span><pre class='pre'>	function update_data($db_link)</pre><br/><span class='lineno'>08700</span><pre class='pre'>	{</pre><br/><span class='lineno'>08701</span><pre class='pre'>	//	// æ°è¦ãããã©ãããã§ãã¯ãã</pre><br/><span class='lineno'>08702</span><pre class='pre'>	//	$insert_flg = $this-&gt;isExitsCheck($db_link);</pre><br/><span class='lineno'>08703</span><pre class='pre'>	//	// å­å¨ããªãå ´å</pre><br/><span class='lineno'>08704</span><pre class='pre'>	//	if ((int)$insert_flg == 0)</pre><br/><span class='lineno'>08705</span><pre class='pre'>	//	{</pre><br/><span class='lineno'>08706</span><pre class='pre'>	//		$this-&gt;insert_data($db_link);</pre><br/><span class='lineno'>08707</span><pre class='pre'>	//	// å­å¨ããå ´å</pre><br/><span class='lineno'>08708</span><pre class='pre'>	//	} else if ((int)$insert_flg &gt; 0) {</pre><br/><span class='lineno'>08709</span><pre class='pre'>	//		// æ´æ°ã®SQLæ</pre><br/><span class='lineno'>08710</span><pre class='pre'>	//		$sql = &quot;UPDATE disp_counter SET &quot;;</pre><br/><span class='lineno'>08711</span><pre class='pre'>	//		$sql .= &quot;counter = counter + 1&quot;;</pre><br/><span class='lineno'>08712</span><pre class='pre'>	//		$sql .= &quot; WHERE photo_mno = \&quot;&quot; .$this-&gt;photo_mno. &quot;\&quot;&quot;;</pre><br/><span class='lineno'>08713</span><pre class='pre'>	//		$sql .= &quot; AND disp_date = \&quot;&quot; .$this-&gt;disp_date. &quot;\&quot;&quot;;</pre><br/><span class='lineno'>08714</span><pre class='pre'></pre><br/><span class='lineno'>08715</span><pre class='pre'>	//		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08716</span><pre class='pre'>	//		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08717</span><pre class='pre'>	//		if ($result == false)</pre><br/><span class='lineno'>08718</span><pre class='pre'>	//		{</pre><br/><span class='lineno'>08719</span><pre class='pre'>	//			$this-&gt;message = &quot;ç»åã®è¡¨ç¤ºåæ°ãDBã«æ´æ°ã§ãã¾ããã§ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;;</pre><br/><span class='lineno'>08720</span><pre class='pre'>	//			// ä¾å¤ãã¹ã­ã¼ãã¾ãã</pre><br/><span class='lineno'>08721</span><pre class='pre'>	//			$msg = $e-&gt;getMessage();</pre><br/><span class='lineno'>08722</span><pre class='pre'>	//			throw new Exception($msg);</pre><br/><span class='lineno'>08723</span><pre class='pre'>	//		}</pre><br/><span class='lineno'>08724</span><pre class='pre'>	//	}</pre><br/><span class='lineno'>08725</span><pre class='pre'>	}</pre><br/><span class='lineno'>08726</span><pre class='pre'>}</pre><br/><span class='lineno'>08727</span><pre class='pre'></pre><br/><span class='lineno'>08728</span><pre class='pre'>class UserManger</pre><br/><span class='lineno'>08729</span><pre class='pre'>{</pre><br/><span class='lineno'>08730</span><pre class='pre'>	var $message;					// ã¡ãã»ã¼ã¸</pre><br/><span class='lineno'>08731</span><pre class='pre'>	var $error;						// ã¨ã©ã¼</pre><br/><span class='lineno'>08732</span><pre class='pre'></pre><br/><span class='lineno'>08733</span><pre class='pre'>	var $ID;						// No</pre><br/><span class='lineno'>08734</span><pre class='pre'>	var $user_name;					// ã¦ã¼ã¶ã¼å</pre><br/><span class='lineno'>08735</span><pre class='pre'>	var $user_group;				// æå±</pre><br/><span class='lineno'>08736</span><pre class='pre'>	var $user_login_id;				// ID</pre><br/><span class='lineno'>08737</span><pre class='pre'>	var $user_password;				// ãã¹ã¯ã¼ã</pre><br/><span class='lineno'>08738</span><pre class='pre'>	var $user_comp_code;			// ç»åçªå·</pre><br/><span class='lineno'>08739</span><pre class='pre'>	var $user_security_level;		// æ¨©é</pre><br/><span class='lineno'>08740</span><pre class='pre'>	var $user_kikan;				// æé</pre><br/><span class='lineno'>08741</span><pre class='pre'>	var $start_date;				// éå§æ¥</pre><br/><span class='lineno'>08742</span><pre class='pre'>	var $end_date;					// çµäºæ¥</pre><br/><span class='lineno'>08743</span><pre class='pre'>	var $istart;					// éå§</pre><br/><span class='lineno'>08744</span><pre class='pre'>	var $iend;						// çµäº</pre><br/><span class='lineno'>08745</span><pre class='pre'>	var $users;						// ã¦ã¼ã¶ã¼</pre><br/><span class='lineno'>08746</span><pre class='pre'></pre><br/><span class='lineno'>08747</span><pre class='pre'>	function set_ID($sp_ID)</pre><br/><span class='lineno'>08748</span><pre class='pre'>	{</pre><br/><span class='lineno'>08749</span><pre class='pre'>		if (!empty($sp_ID)) $this-&gt;ID = $sp_ID;</pre><br/><span class='lineno'>08750</span><pre class='pre'>	}</pre><br/><span class='lineno'>08751</span><pre class='pre'></pre><br/><span class='lineno'>08752</span><pre class='pre'>	function set_user_name($sp_user_name)</pre><br/><span class='lineno'>08753</span><pre class='pre'>	{</pre><br/><span class='lineno'>08754</span><pre class='pre'>		if (!empty($sp_user_name)) $this-&gt;user_name = $sp_user_name;</pre><br/><span class='lineno'>08755</span><pre class='pre'>	}</pre><br/><span class='lineno'>08756</span><pre class='pre'></pre><br/><span class='lineno'>08757</span><pre class='pre'>	function set_user_group($sp_user_group)</pre><br/><span class='lineno'>08758</span><pre class='pre'>	{</pre><br/><span class='lineno'>08759</span><pre class='pre'>		if (!empty($sp_user_group)) $this-&gt;user_group = $sp_user_group;</pre><br/><span class='lineno'>08760</span><pre class='pre'>	}</pre><br/><span class='lineno'>08761</span><pre class='pre'></pre><br/><span class='lineno'>08762</span><pre class='pre'>	function set_user_login_id($sp_user_login_id)</pre><br/><span class='lineno'>08763</span><pre class='pre'>	{</pre><br/><span class='lineno'>08764</span><pre class='pre'>		if (!empty($sp_user_login_id)) $this-&gt;user_login_id = $sp_user_login_id;</pre><br/><span class='lineno'>08765</span><pre class='pre'>	}</pre><br/><span class='lineno'>08766</span><pre class='pre'></pre><br/><span class='lineno'>08767</span><pre class='pre'>	function set_user_password($sp_user_password)</pre><br/><span class='lineno'>08768</span><pre class='pre'>	{</pre><br/><span class='lineno'>08769</span><pre class='pre'>		if (!empty($sp_user_password)) $this-&gt;user_password = $sp_user_password;</pre><br/><span class='lineno'>08770</span><pre class='pre'>	}</pre><br/><span class='lineno'>08771</span><pre class='pre'></pre><br/><span class='lineno'>08772</span><pre class='pre'>	function set_user_comp_code($sp_user_comp_code)</pre><br/><span class='lineno'>08773</span><pre class='pre'>	{</pre><br/><span class='lineno'>08774</span><pre class='pre'>		if (!empty($sp_user_comp_code)) $this-&gt;user_comp_code = $sp_user_comp_code;</pre><br/><span class='lineno'>08775</span><pre class='pre'>	}</pre><br/><span class='lineno'>08776</span><pre class='pre'></pre><br/><span class='lineno'>08777</span><pre class='pre'>	function set_user_security_level($sp_user_security_level)</pre><br/><span class='lineno'>08778</span><pre class='pre'>	{</pre><br/><span class='lineno'>08779</span><pre class='pre'>		if(!empty($sp_user_security_level)) $this-&gt;user_security_level = $sp_user_security_level;</pre><br/><span class='lineno'>08780</span><pre class='pre'>	}</pre><br/><span class='lineno'>08781</span><pre class='pre'></pre><br/><span class='lineno'>08782</span><pre class='pre'>	function set_user_kikan($sp_user_kikan)</pre><br/><span class='lineno'>08783</span><pre class='pre'>	{</pre><br/><span class='lineno'>08784</span><pre class='pre'>		if (!empty($sp_user_kikan)) $this-&gt;user_kikan = $sp_user_kikan;</pre><br/><span class='lineno'>08785</span><pre class='pre'>	}</pre><br/><span class='lineno'>08786</span><pre class='pre'></pre><br/><span class='lineno'>08787</span><pre class='pre'>	function set_istart($sp_istart)</pre><br/><span class='lineno'>08788</span><pre class='pre'>	{</pre><br/><span class='lineno'>08789</span><pre class='pre'>		if (!empty($sp_istart) || $sp_istart == 0) $this-&gt;istart = $sp_istart;</pre><br/><span class='lineno'>08790</span><pre class='pre'>	}</pre><br/><span class='lineno'>08791</span><pre class='pre'></pre><br/><span class='lineno'>08792</span><pre class='pre'>	function set_iend($sp_iend)</pre><br/><span class='lineno'>08793</span><pre class='pre'>	{</pre><br/><span class='lineno'>08794</span><pre class='pre'>		if (!empty($sp_iend) || $sp_iend == 0) $this-&gt;iend = $sp_iend;</pre><br/><span class='lineno'>08795</span><pre class='pre'>	}</pre><br/><span class='lineno'>08796</span><pre class='pre'></pre><br/><span class='lineno'>08797</span><pre class='pre'>	function set_start_date($sp_start_date)</pre><br/><span class='lineno'>08798</span><pre class='pre'>	{</pre><br/><span class='lineno'>08799</span><pre class='pre'>		if (!empty($sp_start_date)) $this-&gt;start_date = $sp_start_date;</pre><br/><span class='lineno'>08800</span><pre class='pre'>	}</pre><br/><span class='lineno'>08801</span><pre class='pre'></pre><br/><span class='lineno'>08802</span><pre class='pre'>	function set_end_date($sp_end_date)</pre><br/><span class='lineno'>08803</span><pre class='pre'>	{</pre><br/><span class='lineno'>08804</span><pre class='pre'>		if (!empty($sp_end_date)) $this-&gt;end_date = $sp_end_date;</pre><br/><span class='lineno'>08805</span><pre class='pre'>	}</pre><br/><span class='lineno'>08806</span><pre class='pre'></pre><br/><span class='lineno'>08807</span><pre class='pre'>	function select_user($db_link)</pre><br/><span class='lineno'>08808</span><pre class='pre'>	{</pre><br/><span class='lineno'>08809</span><pre class='pre'>		$sql = &quot;select * from `user` order by user_id&quot;;</pre><br/><span class='lineno'>08810</span><pre class='pre'></pre><br/><span class='lineno'>08811</span><pre class='pre'>		$tmpistart = (int)$this-&gt;istart;</pre><br/><span class='lineno'>08812</span><pre class='pre'>		$tmpend = (int)$this-&gt;iend;</pre><br/><span class='lineno'>08813</span><pre class='pre'></pre><br/><span class='lineno'>08814</span><pre class='pre'>		if ($tmpistart &gt;= 0 &amp;&amp; $tmpend &gt; 0)</pre><br/><span class='lineno'>08815</span><pre class='pre'>		{</pre><br/><span class='lineno'>08816</span><pre class='pre'>			$sql .= &quot; LIMIT &quot;.$this-&gt;istart.&quot;,&quot;.$this-&gt;iend;</pre><br/><span class='lineno'>08817</span><pre class='pre'>		}</pre><br/><span class='lineno'>08818</span><pre class='pre'></pre><br/><span class='lineno'>08819</span><pre class='pre'>		$this-&gt;users = array();</pre><br/><span class='lineno'>08820</span><pre class='pre'></pre><br/><span class='lineno'>08821</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08822</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08823</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08824</span><pre class='pre'>		{</pre><br/><span class='lineno'>08825</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>08826</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>08827</span><pre class='pre'>			{</pre><br/><span class='lineno'>08828</span><pre class='pre'>				if (!empty($this-&gt;istart) &amp;&amp; !empty($this-&gt;iend))</pre><br/><span class='lineno'>08829</span><pre class='pre'>				{</pre><br/><span class='lineno'>08830</span><pre class='pre'>					if ((int)$this-&gt;istart &gt;= 0 &amp;&amp; (int)$this-&gt;iend &gt; 0)</pre><br/><span class='lineno'>08831</span><pre class='pre'>					{</pre><br/><span class='lineno'>08832</span><pre class='pre'>						$tmpend = $this-&gt;iend - $this-&gt;istart + 1;</pre><br/><span class='lineno'>08833</span><pre class='pre'>					} else {</pre><br/><span class='lineno'>08834</span><pre class='pre'>						$tmpend = 0;</pre><br/><span class='lineno'>08835</span><pre class='pre'>					}</pre><br/><span class='lineno'>08836</span><pre class='pre'>				} else {</pre><br/><span class='lineno'>08837</span><pre class='pre'>					$tmpend = 0;</pre><br/><span class='lineno'>08838</span><pre class='pre'>				}</pre><br/><span class='lineno'>08839</span><pre class='pre'></pre><br/><span class='lineno'>08840</span><pre class='pre'>				$tmpi = 0;</pre><br/><span class='lineno'>08841</span><pre class='pre'></pre><br/><span class='lineno'>08842</span><pre class='pre'>				while($user_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC))</pre><br/><span class='lineno'>08843</span><pre class='pre'>				{</pre><br/><span class='lineno'>08844</span><pre class='pre'>					$tmpi = $tmpi + 1;</pre><br/><span class='lineno'>08845</span><pre class='pre'>					if ($tmpend &gt; 0)</pre><br/><span class='lineno'>08846</span><pre class='pre'>					{</pre><br/><span class='lineno'>08847</span><pre class='pre'>						if ($tmpi &gt; $tmpend) break;</pre><br/><span class='lineno'>08848</span><pre class='pre'>					}</pre><br/><span class='lineno'>08849</span><pre class='pre'>					$users_data = new UserManger();</pre><br/><span class='lineno'>08850</span><pre class='pre'>					$users_data-&gt;set_ID($user_data['user_id']);</pre><br/><span class='lineno'>08851</span><pre class='pre'>					$users_data-&gt;set_user_name($user_data['user_name']);</pre><br/><span class='lineno'>08852</span><pre class='pre'>					$users_data-&gt;set_user_login_id($user_data['login_id']);</pre><br/><span class='lineno'>08853</span><pre class='pre'>					$users_data-&gt;set_user_password($user_data['password']);</pre><br/><span class='lineno'>08854</span><pre class='pre'>					$users_data-&gt;set_user_security_level($user_data['security_level']);</pre><br/><span class='lineno'>08855</span><pre class='pre'>					$users_data-&gt;set_user_group($user_data['group']);</pre><br/><span class='lineno'>08856</span><pre class='pre'>					$users_data-&gt;set_user_comp_code($user_data['compcode']);</pre><br/><span class='lineno'>08857</span><pre class='pre'>					$users_data-&gt;set_user_kikan($user_data['user_kikan']);</pre><br/><span class='lineno'>08858</span><pre class='pre'>					$users_data-&gt;set_start_date($user_data['start_date']);</pre><br/><span class='lineno'>08859</span><pre class='pre'>					$users_data-&gt;set_end_date($user_data['end_date']);</pre><br/><span class='lineno'>08860</span><pre class='pre'></pre><br/><span class='lineno'>08861</span><pre class='pre'>					$this-&gt;users[] = $users_data;</pre><br/><span class='lineno'>08862</span><pre class='pre'>				}</pre><br/><span class='lineno'>08863</span><pre class='pre'>			}</pre><br/><span class='lineno'>08864</span><pre class='pre'>		}</pre><br/><span class='lineno'>08865</span><pre class='pre'>		else</pre><br/><span class='lineno'>08866</span><pre class='pre'>		{</pre><br/><span class='lineno'>08867</span><pre class='pre'>			$this-&gt;error = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08868</span><pre class='pre'>			$this-&gt;message = &quot;ã¦ã¼ã¶ã¼ã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;.$this-&gt;error[2];</pre><br/><span class='lineno'>08869</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>08870</span><pre class='pre'>		}</pre><br/><span class='lineno'>08871</span><pre class='pre'>	}</pre><br/><span class='lineno'>08872</span><pre class='pre'></pre><br/><span class='lineno'>08873</span><pre class='pre'>	function select_data($db_link,$p_user_id)</pre><br/><span class='lineno'>08874</span><pre class='pre'>	{</pre><br/><span class='lineno'>08875</span><pre class='pre'>		$sql = &quot;select * from `user` where user_id = &quot;.$p_user_id;</pre><br/><span class='lineno'>08876</span><pre class='pre'></pre><br/><span class='lineno'>08877</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08878</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08879</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08880</span><pre class='pre'>		{</pre><br/><span class='lineno'>08881</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>08882</span><pre class='pre'>			if ($icount &gt; 0)</pre><br/><span class='lineno'>08883</span><pre class='pre'>			{</pre><br/><span class='lineno'>08884</span><pre class='pre'>				$user_data = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</pre><br/><span class='lineno'>08885</span><pre class='pre'>				$this-&gt;set_ID($user_data['user_id']);</pre><br/><span class='lineno'>08886</span><pre class='pre'>				$this-&gt;set_user_name($user_data['user_name']);</pre><br/><span class='lineno'>08887</span><pre class='pre'>				$this-&gt;set_user_login_id($user_data['login_id']);</pre><br/><span class='lineno'>08888</span><pre class='pre'>				$this-&gt;set_user_password($user_data['password']);</pre><br/><span class='lineno'>08889</span><pre class='pre'>				$this-&gt;set_user_security_level($user_data['security_level']);</pre><br/><span class='lineno'>08890</span><pre class='pre'>				$this-&gt;set_user_group($user_data['group']);</pre><br/><span class='lineno'>08891</span><pre class='pre'>				$this-&gt;set_user_comp_code($user_data['compcode']);</pre><br/><span class='lineno'>08892</span><pre class='pre'>				$this-&gt;set_user_kikan($user_data['user_kikan']);</pre><br/><span class='lineno'>08893</span><pre class='pre'>				if($user_data['user_kikan'] != &quot;mukigenn&quot;)</pre><br/><span class='lineno'>08894</span><pre class='pre'>				{</pre><br/><span class='lineno'>08895</span><pre class='pre'>					$this-&gt;set_start_date($user_data['start_date']);</pre><br/><span class='lineno'>08896</span><pre class='pre'>					$this-&gt;set_end_date($user_data['end_date']);</pre><br/><span class='lineno'>08897</span><pre class='pre'>				}</pre><br/><span class='lineno'>08898</span><pre class='pre'>			}</pre><br/><span class='lineno'>08899</span><pre class='pre'>		}</pre><br/><span class='lineno'>08900</span><pre class='pre'>		else</pre><br/><span class='lineno'>08901</span><pre class='pre'>		{</pre><br/><span class='lineno'>08902</span><pre class='pre'>			$this-&gt;error = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08903</span><pre class='pre'>			$this-&gt;message = &quot;ã¦ã¼ã¶ã¼ã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;.$this-&gt;error[2];</pre><br/><span class='lineno'>08904</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>08905</span><pre class='pre'>		}</pre><br/><span class='lineno'>08906</span><pre class='pre'>	}</pre><br/><span class='lineno'>08907</span><pre class='pre'></pre><br/><span class='lineno'>08908</span><pre class='pre'>	function select_data2($db_link,$p_login_id)</pre><br/><span class='lineno'>08909</span><pre class='pre'>	{</pre><br/><span class='lineno'>08910</span><pre class='pre'>		$sql = &quot;select * from `user` where login_id = '&quot;.$p_login_id.&quot;'&quot;;</pre><br/><span class='lineno'>08911</span><pre class='pre'></pre><br/><span class='lineno'>08912</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08913</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08914</span><pre class='pre'>		if ($result == true)</pre><br/><span class='lineno'>08915</span><pre class='pre'>		{</pre><br/><span class='lineno'>08916</span><pre class='pre'>			$icount = $stmt-&gt;rowCount();</pre><br/><span class='lineno'>08917</span><pre class='pre'>			return $icount;</pre><br/><span class='lineno'>08918</span><pre class='pre'>		}</pre><br/><span class='lineno'>08919</span><pre class='pre'>		else</pre><br/><span class='lineno'>08920</span><pre class='pre'>		{</pre><br/><span class='lineno'>08921</span><pre class='pre'>			$this-&gt;error = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08922</span><pre class='pre'>			$this-&gt;message = &quot;ã¦ã¼ã¶ã¼ã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;.$this-&gt;error[2];</pre><br/><span class='lineno'>08923</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>08924</span><pre class='pre'>		}</pre><br/><span class='lineno'>08925</span><pre class='pre'>	}</pre><br/><span class='lineno'>08926</span><pre class='pre'></pre><br/><span class='lineno'>08927</span><pre class='pre'>	function update_data($db_link)</pre><br/><span class='lineno'>08928</span><pre class='pre'>	{</pre><br/><span class='lineno'>08929</span><pre class='pre'>		$sql = &quot;update `user` &quot;;</pre><br/><span class='lineno'>08930</span><pre class='pre'>		$sql .= &quot;set password = '&quot;.$this-&gt;user_password.&quot;'&quot;;</pre><br/><span class='lineno'>08931</span><pre class='pre'>		$sql .= &quot;,security_level = &quot;.$this-&gt;user_security_level;</pre><br/><span class='lineno'>08932</span><pre class='pre'>		$sql .= &quot;,user_kikan = '&quot;.$this-&gt;user_kikan.&quot;'&quot;;</pre><br/><span class='lineno'>08933</span><pre class='pre'>		$sql .= &quot;,start_date = '&quot;.$this-&gt;start_date.&quot;'&quot;;</pre><br/><span class='lineno'>08934</span><pre class='pre'>		$sql .= &quot;,end_date = '&quot;.$this-&gt;end_date.&quot;'&quot;;</pre><br/><span class='lineno'>08935</span><pre class='pre'>		$sql .= &quot; where user_id = &quot;.$this-&gt;ID;</pre><br/><span class='lineno'>08936</span><pre class='pre'></pre><br/><span class='lineno'>08937</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08938</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08939</span><pre class='pre'>		if ($result == false)</pre><br/><span class='lineno'>08940</span><pre class='pre'>		{</pre><br/><span class='lineno'>08941</span><pre class='pre'>			$this-&gt;error = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08942</span><pre class='pre'>			$this-&gt;message = &quot;ã¦ã¼ã¶ã¼ãã¼ã¿ã®æ´æ°ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;.$this-&gt;error[2];</pre><br/><span class='lineno'>08943</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>08944</span><pre class='pre'>		}</pre><br/><span class='lineno'>08945</span><pre class='pre'></pre><br/><span class='lineno'>08946</span><pre class='pre'>		return $result;</pre><br/><span class='lineno'>08947</span><pre class='pre'>	}</pre><br/><span class='lineno'>08948</span><pre class='pre'></pre><br/><span class='lineno'>08949</span><pre class='pre'>	function insert_data($db_link)</pre><br/><span class='lineno'>08950</span><pre class='pre'>	{</pre><br/><span class='lineno'>08951</span><pre class='pre'>		$okflg = $this-&gt;select_data2($db_link,$this-&gt;user_login_id);</pre><br/><span class='lineno'>08952</span><pre class='pre'>		if($okflg)</pre><br/><span class='lineno'>08953</span><pre class='pre'>		{</pre><br/><span class='lineno'>08954</span><pre class='pre'>			$this-&gt;message = &quot;ãã®ã­ã°ã¤ã³IDã¯æ¢ã«ä½¿ç¨ããã¦ãã¾ããï¼&quot;.$this-&gt;user_login_id.&quot;ï¼&quot;;</pre><br/><span class='lineno'>08955</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>08956</span><pre class='pre'>		}</pre><br/><span class='lineno'>08957</span><pre class='pre'></pre><br/><span class='lineno'>08958</span><pre class='pre'>		$sql = &quot;insert into `user`(`user_name`,`login_id`,`password`,`email`,`security_level`,`group`,`compcode`,`user_kikan`,`start_date`,`end_date`,`register_date`)values(&quot;;</pre><br/><span class='lineno'>08959</span><pre class='pre'>		$sql .= &quot;'&quot;.$this-&gt;user_name.&quot;'&quot;;</pre><br/><span class='lineno'>08960</span><pre class='pre'>		$sql .= &quot;,&quot;.&quot;'&quot;.$this-&gt;user_login_id.&quot;'&quot;;</pre><br/><span class='lineno'>08961</span><pre class='pre'>		$sql .= &quot;,&quot;.&quot;'&quot;.$this-&gt;user_password.&quot;'&quot;;</pre><br/><span class='lineno'>08962</span><pre class='pre'>		$sql .= &quot;,''&quot;;</pre><br/><span class='lineno'>08963</span><pre class='pre'>		$sql .= &quot;,&quot;.$this-&gt;user_security_level;</pre><br/><span class='lineno'>08964</span><pre class='pre'>		$sql .= &quot;,'&quot;.$this-&gt;user_group.&quot;'&quot;;</pre><br/><span class='lineno'>08965</span><pre class='pre'>		$sql .= &quot;,'&quot;.$this-&gt;user_comp_code.&quot;'&quot;;</pre><br/><span class='lineno'>08966</span><pre class='pre'>		$sql .= &quot;,'&quot;.$this-&gt;user_kikan.&quot;'&quot;;</pre><br/><span class='lineno'>08967</span><pre class='pre'>		if(!empty($this-&gt;start_date)) $sql .= &quot;,'&quot;.$this-&gt;start_date.&quot;'&quot;; else $sql .= &quot;,'0000-00-00'&quot;;</pre><br/><span class='lineno'>08968</span><pre class='pre'>		if(!empty($this-&gt;end_date)) $sql .= &quot;,'&quot;.$this-&gt;end_date.&quot;'&quot;; else $sql .= &quot;,'0000-00-00'&quot;;</pre><br/><span class='lineno'>08969</span><pre class='pre'>		$sql .= &quot;,now())&quot;;</pre><br/><span class='lineno'>08970</span><pre class='pre'></pre><br/><span class='lineno'>08971</span><pre class='pre'>		$stmt = $db_link-&gt;prepare($sql);</pre><br/><span class='lineno'>08972</span><pre class='pre'>		$result = $stmt-&gt;execute();</pre><br/><span class='lineno'>08973</span><pre class='pre'>		if ($result == false)</pre><br/><span class='lineno'>08974</span><pre class='pre'>		{</pre><br/><span class='lineno'>08975</span><pre class='pre'>			$this-&gt;error = $stmt-&gt;errorInfo();</pre><br/><span class='lineno'>08976</span><pre class='pre'>			$this-&gt;message = &quot;ã¦ã¼ã¶ã¼ãã¼ã¿ã®æ°è¦ã«å¤±æãã¾ãããï¼æ¡ä»¶è¨­å®ã¨ã©ã¼ï¼&quot;.$this-&gt;error[2];</pre><br/><span class='lineno'>08977</span><pre class='pre'>			throw new Exception($this-&gt;message);</pre><br/><span class='lineno'>08978</span><pre class='pre'>		}</pre><br/><span class='lineno'>08979</span><pre class='pre'></pre><br/><span class='lineno'>08980</span><pre class='pre'>		return $result;</pre><br/><span class='lineno'>08981</span><pre class='pre'>	}</pre><br/><span class='lineno'>08982</span><pre class='pre'>}</pre><br/><span class='lineno'>08983</span><pre class='pre'>?&gt;</pre><br/></div>